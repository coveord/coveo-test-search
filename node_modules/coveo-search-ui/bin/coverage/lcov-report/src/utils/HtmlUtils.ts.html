<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/utils/HtmlUtils.ts</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../prettify.css">
    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header low">
    <h1>Code coverage report for <span class="entity">src/utils/HtmlUtils.ts</span></h1>
    <h2>
        Statements: <span class="metric">35.42% <small>(17 / 48)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">0% <small>(0 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">21.43% <small>(3 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">31.11% <small>(14 / 45)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">src/utils/</a> &#187; HtmlUtils.ts</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import {DeviceUtils} from './DeviceUtils';
import {IQueryResult} from '../rest/QueryResult';
import {SearchEndpoint} from '../rest/SearchEndpoint';
&nbsp;
/**
 * Options for building an `&lt;a&gt;` tag.
 */
export interface IAnchorUtilsOptions {
  /**
   * The tag's text content.
   */
  text?: string;
  /**
   * The target (`href` attribute).
   */
  target?: string;
  /**
   * The CSS class(es) of the tag.
   */
  class?: string;
}
&nbsp;
/**
 * Options for building an `&lt;img&gt;` tag.
 */
export interface IImageUtilsOptions {
  /**
   * The alternative text for the image (`alt` attribute).
   */
  alt?: string;
  /**
   * The height of the image
   */
  height?: string;
  /**
   * The width of the image
   */
  width?: string;
}
&nbsp;
export class HTMLUtils {
<span class="fstat-no" title="function not covered" >  static buildAttributeString(options: any)</span>: string {
<span class="cstat-no" title="statement not covered" >    var ret = []</span>
<span class="cstat-no" title="statement not covered" >    _.each(options, <span class="fstat-no" title="function not covered" >(val: any, key?: string, obj?)</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      if (val != undefined) {</span>
<span class="cstat-no" title="statement not covered" >        ret.push(key + '=' + JSON.stringify(val.toString()))</span>
      }
    })
<span class="cstat-no" title="statement not covered" >    return ret.join(' ');</span>
  }
}
&nbsp;
export class AnchorUtils {
<span class="fstat-no" title="function not covered" >  static buildAnchor(href: string, options?: IAnchorUtilsOptions)</span> {
<span class="cstat-no" title="statement not covered" >    var text;</span>
<span class="cstat-no" title="statement not covered" >    if (!options || !options.text) {</span>
<span class="cstat-no" title="statement not covered" >      text = href;</span>
    } else {
<span class="cstat-no" title="statement not covered" >      text = options.text;</span>
<span class="cstat-no" title="statement not covered" >      options.text = undefined;</span>
    }
<span class="cstat-no" title="statement not covered" >    return `&lt;a href='${href} ${HTMLUtils.buildAttributeString(options)} '&gt;${text}&lt;/a&gt;`;</span>
  }
}
&nbsp;
export class ImageUtils {
<span class="fstat-no" title="function not covered" >  static buildImage(src?: string, options?: IImageUtilsOptions)</span> {
<span class="cstat-no" title="statement not covered" >    var ret = '&lt;img ';</span>
<span class="cstat-no" title="statement not covered" >    ret += src ? `src='${src}' ` : '';</span>
<span class="cstat-no" title="statement not covered" >    ret += HTMLUtils.buildAttributeString(options) + '/&gt;';</span>
<span class="cstat-no" title="statement not covered" >    return ret;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  static selectImageFromResult(result: IQueryResult)</span>: HTMLElement {
<span class="cstat-no" title="statement not covered" >    return &lt;HTMLElement&gt;document.querySelector(`img[data-coveo-uri-hash=${result.raw['urihash']}]`);</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  static buildImageWithDirectSrcAttribute(endpoint: SearchEndpoint, result: IQueryResult)</span> {
<span class="cstat-no" title="statement not covered" >    var image = new Image();</span>
<span class="cstat-no" title="statement not covered" >    var dataStreamUri = endpoint.getViewAsDatastreamUri(result.uniqueId, '$Thumbnail$', { contentType: 'image/png' });</span>
<span class="cstat-no" title="statement not covered" >    image.onload = <span class="fstat-no" title="function not covered" >() =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >      ImageUtils.selectImageFromResult(result).setAttribute('src', dataStreamUri);</span>
    };
<span class="cstat-no" title="statement not covered" >    image.src = dataStreamUri;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  static buildImageWithBase64SrcAttribute(endpoint: SearchEndpoint, result: IQueryResult)</span> {
<span class="cstat-no" title="statement not covered" >    endpoint.getRawDataStream(result.uniqueId, '$Thumbnail$')</span>
      .then(<span class="fstat-no" title="function not covered" >(response)</span> =&gt; {
<span class="cstat-no" title="statement not covered" >        var rawBinary = String.fromCharCode.apply(null, new Uint8Array(response));</span>
<span class="cstat-no" title="statement not covered" >        ImageUtils.selectImageFromResult(result).setAttribute('src', 'data:image/png;base64, ' + btoa(rawBinary));</span>
      })
      .catch(<span class="fstat-no" title="function not covered" >() =&gt; {</span>
<span class="cstat-no" title="statement not covered" >        ImageUtils.selectImageFromResult(result).remove();</span>
      })
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  static buildImageFromResult(result: IQueryResult, endpoint: SearchEndpoint, options?: IImageUtilsOptions)</span> {
<span class="cstat-no" title="statement not covered" >    options = options ? options : &lt;IImageUtilsOptions&gt;{};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    let img = ImageUtils.buildImage(undefined, _.extend(options, { 'data-coveo-uri-hash': result.raw['urihash'] }));</span>
<span class="cstat-no" title="statement not covered" >    if (endpoint.isJsonp() || DeviceUtils.isIE8or9()) {</span>
      // For jsonp and IE8-9 (XDomain) we can't GET/POST for binary data. We are limited to only setting the src attribute directly on the img.
<span class="cstat-no" title="statement not covered" >      ImageUtils.buildImageWithDirectSrcAttribute(endpoint, result);</span>
    } else {
      // Base 64 img allows us to GET/POST the image as raw binary, so that we can also pass the credential of the user
      // Useful for phonegap.
<span class="cstat-no" title="statement not covered" >      ImageUtils.buildImageWithBase64SrcAttribute(endpoint, result);</span>
    }
<span class="cstat-no" title="statement not covered" >    return img</span>
  }
}
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Sep 20 2016 16:08:02 GMT+0000 (UTC)</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>

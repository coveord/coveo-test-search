{"version":3,"sources":["./src/ui/ResultFolding/ResultFolding.ts","./src/ui/ResultFolding/DefaultFoldingTemplate.ts","./sass/_ResultFolding.scss"],"names":[],"mappings":"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","file":"ResultFolding__93518d21988b4536d33d.js","sourcesContent":["import { Template } from '../Templates/Template';\r\nimport { Component } from '../Base/Component';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { DefaultFoldingTemplate } from './DefaultFoldingTemplate';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { QueryUtils } from '../../utils/QueryUtils';\r\nimport { Initialization } from '../Base/Initialization';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { $$, Win } from '../../utils/Dom';\r\nimport { l } from '../../strings/Strings';\r\nimport { each, map } from 'underscore';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { analyticsActionCauseList, IAnalyticsDocumentViewMeta } from '../Analytics/AnalyticsActionListMeta';\r\nimport { Logger } from '../../misc/Logger';\r\n\r\nimport 'styling/_ResultFolding';\r\nimport { SVGIcons } from '../../utils/SVGIcons';\r\nimport { SVGDom } from '../../utils/SVGDom';\r\nimport { TemplateComponentOptions } from '../Base/TemplateComponentOptions';\r\nimport { AccessibleButton } from '../../utils/AccessibleButton';\r\n\r\nexport interface IResultFoldingOptions {\r\n  resultTemplate?: Template;\r\n  normalCaption?: string;\r\n  expandedCaption?: string;\r\n  moreCaption?: string;\r\n  lessCaption?: string;\r\n  oneResultCaption?: string;\r\n}\r\n\r\n/**\r\n * The `ResultFolding` component renders folded result sets. It is usable inside a result template when there is an\r\n * active [`Folding`]{@link Folding} component in the page. This component takes care of rendering the parent result and\r\n * its child results in a coherent manner.\r\n *\r\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\r\n *\r\n * See [Folding Results](https://docs.coveo.com/en/428/).\r\n */\r\nexport class ResultFolding extends Component {\r\n  static ID = 'ResultFolding';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      ResultFolding: ResultFolding,\r\n      DefaultFoldingTemplate: DefaultFoldingTemplate\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the component\r\n   * @componentOptions\r\n   */\r\n  static options: IResultFoldingOptions = {\r\n    /**\r\n     * Specifies the template to use to render each of the child results for a top result.\r\n     *\r\n     * You can specify a previously registered template to use either by referring to its HTML `id` attribute or to a\r\n     * CSS selector (see {@link TemplateCache}).\r\n     *\r\n     * **Example:**\r\n     *\r\n     * Specifying a previously registered template by referring to its HTML `id` attribute:\r\n     *\r\n     * ```html\r\n     * <span class=\"CoveoResultFolding\" data-result-template-id=\"Foo\"></span>\r\n     * ```\r\n     *\r\n     * Specifying a previously registered template by referring to a CSS selector:\r\n     *\r\n     * ```html\r\n     * <span class='CoveoResultFolding' data-result-template-selector=\"#Foo\"></span>\r\n     * ```\r\n     *\r\n     * If you do not specify a custom folding template, the component uses the default result folding template.\r\n     */\r\n    resultTemplate: TemplateComponentOptions.buildTemplateOption({ defaultFunction: () => new DefaultFoldingTemplate() }),\r\n\r\n    /**\r\n     * Specifies the caption to display at the top of the child results when the folding result set is not expanded.\r\n     *\r\n     * Default value is `undefined`, which displays no caption.\r\n     */\r\n    normalCaption: ComponentOptions.buildLocalizedStringOption(),\r\n\r\n    /**\r\n     * Specifies the caption to display at the top of the child results when the folding result set is expanded.\r\n     *\r\n     * Default value is `undefined`, which displays no caption.\r\n     */\r\n    expandedCaption: ComponentOptions.buildLocalizedStringOption(),\r\n\r\n    /**\r\n     * Specifies the caption to display on the link to expand / show child results.\r\n     *\r\n     * Default value is the localized string for `ShowMore`.\r\n     */\r\n    moreCaption: ComponentOptions.buildLocalizedStringOption({ postProcessing: value => value || l('ShowMore') }),\r\n\r\n    /**\r\n     * Specifies the caption to display on the link to shrink the loaded folding result set back to only the top result.\r\n     *\r\n     * Default value is the localized string for `ShowLess`.\r\n     */\r\n    lessCaption: ComponentOptions.buildLocalizedStringOption({ postProcessing: value => value || l('ShowLess') }),\r\n\r\n    /**\r\n     * Specifies the caption to display when there is only one result in a folding result set.\r\n     *\r\n     * Default value is the localized string for `DisplayingTheOnlyMessage`\r\n     */\r\n    oneResultCaption: ComponentOptions.buildLocalizedStringOption({\r\n      postProcessing: value => value || l('DisplayingTheOnlyMessage')\r\n    })\r\n  };\r\n\r\n  private normalCaption: HTMLElement;\r\n  private expandedCaption: HTMLElement;\r\n  private oneResultCaption: HTMLElement;\r\n  private results: HTMLElement;\r\n  private showMore: HTMLElement;\r\n  private showLess: HTMLElement;\r\n  private waitAnimation: HTMLElement;\r\n  private moreResultsPromise: Promise<IQueryResult[]>;\r\n  private showingMoreResults = false;\r\n\r\n  public childResults: IQueryResult[];\r\n\r\n  /**\r\n   * Creates a new ResultFolding component.\r\n   * @param options The options for the ResultFolding component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   * @param result The result to associate the component with.\r\n   */\r\n  constructor(\r\n    public element: HTMLElement,\r\n    public options?: IResultFoldingOptions,\r\n    bindings?: IComponentBindings,\r\n    public result?: IQueryResult\r\n  ) {\r\n    super(element, ResultFolding.ID, bindings);\r\n\r\n    this.options = ComponentOptions.initComponentOptions(this.element, ResultFolding, options);\r\n\r\n    Assert.exists(result);\r\n\r\n    this.buildElements();\r\n    this.renderElements();\r\n  }\r\n\r\n  /**\r\n   * Show more results by fetching additional results from the index, which match the current folded conversation.\r\n   * This is the equivalent of clicking \"Show all conversation\".\r\n   * @returns {Promise<IQueryResult[]>}\r\n   */\r\n  public async showMoreResults() {\r\n    Assert.exists(this.result.moreResults);\r\n\r\n    this.cancelAnyPendingShowMore();\r\n    this.moreResultsPromise = this.result.moreResults();\r\n    this.waitAnimation = $$('div', { className: 'coveo-loading-spinner' }).el;\r\n    this.results.appendChild(this.waitAnimation);\r\n    this.updateElementVisibility();\r\n\r\n    const results = await this.moreResultsPromise;\r\n    this.childResults = results;\r\n    this.showingMoreResults = true;\r\n    this.usageAnalytics.logClickEvent<IAnalyticsDocumentViewMeta>(\r\n      analyticsActionCauseList.foldingShowMore,\r\n      this.getAnalyticsMetadata(),\r\n      this.result,\r\n      this.element\r\n    );\r\n\r\n    try {\r\n      await this.displayThoseResults(results);\r\n      this.updateElementVisibility(results.length);\r\n    } catch (e) {\r\n      const logger = new Logger(this);\r\n      logger.warn('An error occured when trying to display more results');\r\n    }\r\n\r\n    this.moreResultsPromise = undefined;\r\n    $$(this.waitAnimation).detach();\r\n    this.waitAnimation = undefined;\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Show less results for a given conversation. This is the equivalent of clicking \"Show less\"\r\n   */\r\n  public async showLessResults() {\r\n    this.cancelAnyPendingShowMore();\r\n    this.showingMoreResults = false;\r\n    this.usageAnalytics.logCustomEvent<IAnalyticsDocumentViewMeta>(\r\n      analyticsActionCauseList.foldingShowLess,\r\n      this.getAnalyticsMetadata(),\r\n      this.element\r\n    );\r\n    await this.displayThoseResults(this.result.childResults);\r\n    this.updateElementVisibility();\r\n    this.scrollToResultElement();\r\n  }\r\n\r\n  private buildElements() {\r\n    this.buildHeader();\r\n    this.buildResults();\r\n    this.buildFooter();\r\n  }\r\n\r\n  private async renderElements() {\r\n    await this.displayThoseResults(this.result.childResults);\r\n    this.updateElementVisibility();\r\n\r\n    if ($$(this.element.parentElement).hasClass('CoveoCardOverlay')) {\r\n      this.bindOverlayEvents();\r\n    }\r\n\r\n    if (this.result.childResults.length == 0 && !this.result.moreResults) {\r\n      $$(this.element).hide();\r\n    }\r\n  }\r\n\r\n  private buildHeader() {\r\n    let header = $$('div', { className: 'coveo-folding-header' }).el;\r\n    this.element.appendChild(header);\r\n    if (this.options.normalCaption != undefined && this.options.expandedCaption != undefined) {\r\n      this.normalCaption = $$('div', { className: 'coveo-folding-normal-caption' }, this.options.normalCaption).el;\r\n      header.appendChild(this.normalCaption);\r\n\r\n      this.expandedCaption = $$('div', { className: 'coveo-folding-expanded-caption' }, this.options.expandedCaption).el;\r\n      header.appendChild(this.expandedCaption);\r\n    }\r\n    this.oneResultCaption = $$('div', { className: 'coveo-folding-oneresult-caption' }, this.options.oneResultCaption).el;\r\n    header.appendChild(this.oneResultCaption);\r\n  }\r\n\r\n  private buildResults() {\r\n    this.results = $$('div', { className: 'coveo-folding-results' }).el;\r\n    this.element.appendChild(this.results);\r\n  }\r\n\r\n  private buildFooter() {\r\n    const footer = $$('div', { className: 'coveo-folding-footer' }).el;\r\n    this.element.parentElement.appendChild(footer);\r\n\r\n    if (this.result.moreResults) {\r\n      this.showMore = $$('div', { className: 'coveo-folding-footer-section-for-less' }).el;\r\n      footer.appendChild(this.showMore);\r\n\r\n      this.showLess = $$('div', { className: 'coveo-folding-footer-section-for-more' }).el;\r\n      footer.appendChild(this.showLess);\r\n\r\n      const footerIconShowMore = $$(\r\n        'div',\r\n        { className: 'coveo-folding-more' },\r\n        $$('span', { className: 'coveo-folding-footer-icon' }, SVGIcons.icons.arrowDown).el\r\n      ).el;\r\n      SVGDom.addClassToSVGInContainer(footerIconShowMore, 'coveo-folding-more-svg');\r\n\r\n      const footerIconShowLess = $$(\r\n        'div',\r\n        { className: 'coveo-folding-less' },\r\n        $$('span', { className: 'coveo-folding-footer-icon' }, SVGIcons.icons.arrowUp).el\r\n      ).el;\r\n      SVGDom.addClassToSVGInContainer(footerIconShowLess, 'coveo-folding-less-svg');\r\n\r\n      const showMoreLink = $$('a', { className: 'coveo-folding-show-more' }, this.options.moreCaption).el;\r\n      const showLessLink = $$('a', { className: 'coveo-folding-show-less' }, this.options.lessCaption).el;\r\n\r\n      new AccessibleButton()\r\n        .withElement(this.showMore)\r\n        .withLabel(this.options.moreCaption)\r\n        .withSelectAction(() => this.showMoreResults())\r\n        .build();\r\n\r\n      new AccessibleButton()\r\n        .withElement(this.showLess)\r\n        .withLabel(this.options.lessCaption)\r\n        .withSelectAction(() => this.showLessResults())\r\n        .build();\r\n\r\n      this.showMore.appendChild(showMoreLink);\r\n      this.showLess.appendChild(showLessLink);\r\n      this.showMore.appendChild(footerIconShowMore);\r\n      this.showLess.appendChild(footerIconShowLess);\r\n    }\r\n  }\r\n\r\n  private updateElementVisibility(subResultsLength?: number) {\r\n    if (this.normalCaption) {\r\n      $$(this.normalCaption).toggle(!this.showingMoreResults && this.result.childResults.length > 0);\r\n    }\r\n    if (this.expandedCaption) {\r\n      $$(this.expandedCaption).toggle(this.showingMoreResults);\r\n    }\r\n    $$(this.oneResultCaption).toggleClass('coveo-hidden', !(subResultsLength && subResultsLength == 1));\r\n\r\n    if (this.showMore) {\r\n      $$(this.showMore).toggleClass('coveo-visible', !this.showingMoreResults && !Utils.exists(this.moreResultsPromise));\r\n      $$(this.showLess).toggleClass('coveo-visible', this.showingMoreResults);\r\n    }\r\n\r\n    let showIfNormal = $$(this.element).find('.coveo-show-if-normal');\r\n    if (showIfNormal) {\r\n      $$(showIfNormal).toggle(!this.showingMoreResults);\r\n    }\r\n\r\n    let showIfExpanded = $$(this.element).find('.coveo-show-if-expanded');\r\n    if (showIfExpanded) {\r\n      $$(showIfExpanded).toggle(this.showingMoreResults);\r\n    }\r\n  }\r\n\r\n  private scrollToResultElement() {\r\n    let resultElem = $$(this.element).closest('CoveoResult');\r\n    window.scrollTo(0, new Win(window).scrollY() + resultElem.getBoundingClientRect().top);\r\n  }\r\n\r\n  private async displayThoseResults(results: IQueryResult[]): Promise<boolean> {\r\n    const childResultsPromises = map(results, result => {\r\n      return this.renderChildResult(result);\r\n    });\r\n\r\n    const childsToAppend: HTMLElement[] = await Promise.all(childResultsPromises);\r\n    $$(this.results).empty();\r\n    each(childsToAppend, oneChild => {\r\n      this.results.appendChild(oneChild);\r\n    });\r\n    return true;\r\n  }\r\n\r\n  private async renderChildResult(childResult: IQueryResult): Promise<HTMLElement> {\r\n    QueryUtils.setStateObjectOnQueryResult(this.queryStateModel.get(), childResult);\r\n    QueryUtils.setSearchInterfaceObjectOnQueryResult(this.searchInterface, childResult);\r\n\r\n    const oneChild: HTMLElement = await this.options.resultTemplate.instantiateToElement(childResult, {\r\n      wrapInDiv: false,\r\n      checkCondition: false,\r\n      responsiveComponents: this.searchInterface.responsiveComponents\r\n    });\r\n\r\n    $$(oneChild).addClass('coveo-result-folding-child-result');\r\n    $$(oneChild).toggleClass('coveo-normal-child-result', !this.showingMoreResults);\r\n    $$(oneChild).toggleClass('coveo-expanded-child-result', this.showingMoreResults);\r\n\r\n    await Initialization.automaticallyCreateComponentsInsideResult(oneChild, childResult).initResult;\r\n    return oneChild;\r\n  }\r\n\r\n  private cancelAnyPendingShowMore() {\r\n    if (this.moreResultsPromise) {\r\n      this.moreResultsPromise = undefined;\r\n    }\r\n\r\n    Assert.doesNotExists(this.moreResultsPromise);\r\n    Assert.doesNotExists(this.waitAnimation);\r\n  }\r\n\r\n  private bindOverlayEvents() {\r\n    this.bind.one(this.element.parentElement, 'openCardOverlay', () => {\r\n      if (this.result.moreResults) {\r\n        this.showMoreResults();\r\n      }\r\n    });\r\n  }\r\n\r\n  private getAnalyticsMetadata(): IAnalyticsDocumentViewMeta {\r\n    return {\r\n      documentURL: this.result.clickUri,\r\n      documentTitle: this.result.title,\r\n      author: Utils.getFieldValue(this.result, 'author')\r\n    };\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(ResultFolding);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultFolding/ResultFolding.ts","import { Template } from '../Templates/Template';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\n\r\nexport class DefaultFoldingTemplate extends Template {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  instantiateToString(queryResult?: IQueryResult): string {\r\n    return '<div class=\"coveo-child-result\"><span class=\"CoveoIcon\" data-small=\"true\"></span> <a class=\"CoveoResultLink\"></a> <span class=\"CoveoQuickview\"></span></div>';\r\n  }\r\n\r\n  getType() {\r\n    return 'DefaultFoldingTemplate';\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultFolding/DefaultFoldingTemplate.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_ResultFolding.scss\n// module id = 654\n// module chunks = 41 88"],"sourceRoot":""}
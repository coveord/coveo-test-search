{"version":3,"sources":["ErrorReport.min__5f3280c404a1ee75a113.js","./src/ui/ErrorReport/ErrorReport.ts"],"names":["webpackJsonpCoveo__temporary","248","module","exports","__webpack_require__","__extends","this","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","value","element","options","bindings","ErrorReport","ID","ComponentOptions","initComponentOptions","container","$$","className","appendChild","el","showDetailedError","message","append","helpSuggestion","hide","bind","onRootElement","QueryEvents","newQuery","handleNewQuery","queryError","data","handleQueryError","_this","back","usageAnalytics","logCustomEvent","analyticsActionCauseList","errorBack","root","logSearchEvent","history","reset","queryStateModel","errorClearQuery","queryController","executeQuery","retry","errorRetry","buildOrGetTitleElements","title","titleElement","find","prepend","firstHeading","secondHeading","h1","h2","setErrorTitle","errorName","errorTitle","l","text","buildPrevious","previous","AccessibleButton","withElement","withSelectAction","withLabel","build","buildReset","buildRetry","remove","closePopup","Assert","exists","error","endpoint","queryStringArguments","organizationId","isMissingAuthentication","name","buildEndpointErrorElements","undefined","buildOptionsElement","empty","on","buildErrorInfo","show","errorInfo","textArea","JSON","stringify","infoLabel","oldOptions","optionsElement","helpLink","link","href","setHtml","insertBefore","doExport","exportGlobally","buildBooleanOption","defaultValue","Component","Initialization","registerAutoCreateComponent","605"],"mappings":"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","file":"ErrorReport.min__5f3280c404a1ee75a113.js","sourcesContent":["webpackJsonpCoveo__temporary([72],{\n\n/***/ 248:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__webpack_require__(605);\r\nvar QueryEvents_1 = __webpack_require__(11);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\nvar Assert_1 = __webpack_require__(5);\r\nvar Strings_1 = __webpack_require__(6);\r\nvar AccessibleButton_1 = __webpack_require__(15);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\r\nvar Component_1 = __webpack_require__(7);\r\nvar ComponentOptions_1 = __webpack_require__(8);\r\nvar Initialization_1 = __webpack_require__(2);\r\n/**\r\n * The ErrorReport component takes care of handling fatal error when doing a query on the index / Search API.\r\n *\r\n * For example, the ErrorReport component displays a message when the service responds with a 401 or 503 error. This\r\n * component also renders a small text area with the JSON content of the error response, for debugging purposes.\r\n */\r\nvar ErrorReport = /** @class */ (function (_super) {\r\n    __extends(ErrorReport, _super);\r\n    /**\r\n     * Creates a new ErrorReport component.\r\n     * @param element The HTMLElement on which to instantiate the component.\r\n     * @param options The options for the ErrorReport component.\r\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n     * automatically resolved (with a slower execution time).\r\n     */\r\n    function ErrorReport(element, options, bindings) {\r\n        var _this = _super.call(this, element, ErrorReport.ID, bindings) || this;\r\n        _this.element = element;\r\n        _this.options = options;\r\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, ErrorReport, options);\r\n        _this.container = Dom_1.$$('div', { className: 'coveo-error-report-container' });\r\n        _this.element.appendChild(_this.container.el);\r\n        if (_this.options.showDetailedError) {\r\n            _this.message = Dom_1.$$('div', {\r\n                className: 'coveo-error-report-message'\r\n            });\r\n            _this.container.append(_this.message.el);\r\n        }\r\n        _this.helpSuggestion = Dom_1.$$('div', {\r\n            className: 'coveo-error-report-help-suggestion'\r\n        });\r\n        Dom_1.$$(_this.element).hide();\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.newQuery, function () { return _this.handleNewQuery(); });\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.queryError, function (data) { return _this.handleQueryError(data); });\r\n        return _this;\r\n    }\r\n    /**\r\n     * Performs the \"back\" action in the browser.\r\n     * Also logs an `errorBack` event in the usage analytics.\r\n     */\r\n    ErrorReport.prototype.back = function () {\r\n        this.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.errorBack, {}, this.root);\r\n        this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.errorBack, {});\r\n        history.back();\r\n    };\r\n    /**\r\n     * Resets the current state of the query and triggers a new query.\r\n     * Also logs an `errorClearQuery` event in the usage analytics.\r\n     */\r\n    ErrorReport.prototype.reset = function () {\r\n        this.queryStateModel.reset();\r\n        this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.errorClearQuery, {});\r\n        this.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.errorClearQuery, {}, this.root);\r\n        this.queryController.executeQuery();\r\n    };\r\n    /**\r\n     * Retries the same query, in case of a temporary service error.\r\n     * Also logs an `errorRetry` event in the usage analytics.\r\n     */\r\n    ErrorReport.prototype.retry = function () {\r\n        this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.errorRetry, {});\r\n        this.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.errorRetry, {}, this.root);\r\n        this.queryController.executeQuery();\r\n    };\r\n    ErrorReport.prototype.buildOrGetTitleElements = function () {\r\n        var titleElement = Dom_1.$$(this.element).find('.coveo-error-report-title');\r\n        var title;\r\n        if (titleElement) {\r\n            title = Dom_1.$$(titleElement);\r\n        }\r\n        else {\r\n            title = Dom_1.$$('div', { className: 'coveo-error-report-title' });\r\n            this.container.prepend(title.el);\r\n        }\r\n        var firstHeading = title.find('h1');\r\n        if (!firstHeading) {\r\n            firstHeading = Dom_1.$$('h1').el;\r\n            title.append(firstHeading);\r\n        }\r\n        var secondHeading = title.find('h2');\r\n        if (!secondHeading) {\r\n            secondHeading = Dom_1.$$('h2').el;\r\n            title.append(secondHeading);\r\n        }\r\n        return {\r\n            title: title,\r\n            h1: Dom_1.$$(firstHeading),\r\n            h2: Dom_1.$$(secondHeading)\r\n        };\r\n    };\r\n    ErrorReport.prototype.setErrorTitle = function (errorName, helpSuggestion) {\r\n        var errorTitle = {\r\n            h1: errorName ? Strings_1.l(errorName) : Strings_1.l('OopsError'),\r\n            h2: helpSuggestion ? Strings_1.l(helpSuggestion) : Strings_1.l('ProblemPersists')\r\n        };\r\n        var _a = this.buildOrGetTitleElements(), h1 = _a.h1, h2 = _a.h2;\r\n        if (h1 && h2) {\r\n            Dom_1.$$(h1).text(errorTitle.h1);\r\n            Dom_1.$$(h2).text(errorTitle.h2);\r\n        }\r\n    };\r\n    ErrorReport.prototype.buildPrevious = function () {\r\n        var _this = this;\r\n        var previous = Dom_1.$$('span', {\r\n            className: 'coveo-error-report-previous'\r\n        }, Strings_1.l('GoBack'));\r\n        new AccessibleButton_1.AccessibleButton()\r\n            .withElement(previous)\r\n            .withSelectAction(function () { return _this.back(); })\r\n            .withLabel(Strings_1.l('GoBack'))\r\n            .build();\r\n        return previous.el;\r\n    };\r\n    ErrorReport.prototype.buildReset = function () {\r\n        var _this = this;\r\n        var reset = Dom_1.$$('span', {\r\n            className: 'coveo-error-report-clear'\r\n        }, Strings_1.l('Reset'));\r\n        new AccessibleButton_1.AccessibleButton()\r\n            .withElement(reset)\r\n            .withSelectAction(function () { return _this.reset(); })\r\n            .withLabel(Strings_1.l('Reset'))\r\n            .build();\r\n        return reset.el;\r\n    };\r\n    ErrorReport.prototype.buildRetry = function () {\r\n        var _this = this;\r\n        var retry = Dom_1.$$('span', {\r\n            className: 'coveo-error-report-retry'\r\n        }, Strings_1.l('Retry'));\r\n        new AccessibleButton_1.AccessibleButton()\r\n            .withElement(retry)\r\n            .withSelectAction(function () { return _this.retry(); })\r\n            .withLabel(Strings_1.l('Retry'))\r\n            .build();\r\n        return retry.el;\r\n    };\r\n    ErrorReport.prototype.handleNewQuery = function () {\r\n        Dom_1.$$(this.element).hide();\r\n        var _a = this.buildOrGetTitleElements(), h1 = _a.h1, h2 = _a.h2;\r\n        h1.remove();\r\n        h2.remove();\r\n        if (this.closePopup != null) {\r\n            this.closePopup();\r\n        }\r\n    };\r\n    ErrorReport.prototype.handleQueryError = function (data) {\r\n        var _this = this;\r\n        Assert_1.Assert.exists(data);\r\n        Assert_1.Assert.exists(data.error);\r\n        if (data.endpoint.options.queryStringArguments.organizationId) {\r\n            this.organizationId = data.endpoint.options.queryStringArguments.organizationId;\r\n        }\r\n        else {\r\n            this.organizationId = Strings_1.l('CoveoOrganization');\r\n        }\r\n        // Do not display the panel if the error is for missing authentication. The\r\n        // appropriate authentication provider should take care of redirecting.\r\n        if (data.error.isMissingAuthentication) {\r\n            return;\r\n        }\r\n        switch (data.error.name) {\r\n            case 'NoEndpointsException':\r\n                this.options.showDetailedError = false;\r\n                this.buildEndpointErrorElements('https://docs.coveo.com/en/331/');\r\n                this.setErrorTitle(Strings_1.l('NoEndpoints', this.organizationId), Strings_1.l('AddSources'));\r\n                break;\r\n            case 'InvalidTokenException':\r\n                this.options.showDetailedError = false;\r\n                this.buildEndpointErrorElements('https://docs.coveo.com/en/56/');\r\n                this.setErrorTitle(Strings_1.l('CannotAccess', this.organizationId), Strings_1.l('InvalidToken'));\r\n                break;\r\n            case 'GroupByAndFacetBothExistingException':\r\n                this.options.showDetailedError = false;\r\n                this.buildEndpointErrorElements('https://docs.coveo.com/en/2917');\r\n                this.setErrorTitle(undefined, Strings_1.l('GroupByAndFacetRequestsCannotCoexist'));\r\n                break;\r\n            default:\r\n                this.buildOptionsElement();\r\n                this.setErrorTitle();\r\n        }\r\n        if (this.options.showDetailedError) {\r\n            this.message.empty();\r\n            var moreInfo_1 = Dom_1.$$('span', {\r\n                className: 'coveo-error-report-more-info'\r\n            }, Strings_1.l('MoreInfo'));\r\n            moreInfo_1.on('click', function () {\r\n                moreInfo_1.empty();\r\n                _this.message.el.appendChild(_this.buildErrorInfo(data.error));\r\n            });\r\n            this.message.el.appendChild(moreInfo_1.el);\r\n        }\r\n        Dom_1.$$(this.element).show();\r\n    };\r\n    ErrorReport.prototype.buildErrorInfo = function (data) {\r\n        var errorInfo = Dom_1.$$('div', {\r\n            className: 'coveo-error-info'\r\n        });\r\n        var textArea = Dom_1.$$('textarea', undefined, JSON.stringify(data, null, 2));\r\n        errorInfo.el.appendChild(textArea.el);\r\n        var infoLabel = Dom_1.$$('div', {\r\n            className: 'coveo-error-info-label'\r\n        }, Strings_1.l('CopyPasteToSupport'));\r\n        errorInfo.el.appendChild(infoLabel.el);\r\n        return errorInfo.el;\r\n    };\r\n    ErrorReport.prototype.buildOptionsElement = function () {\r\n        var oldOptions = this.container.find('.coveo-error-report-options');\r\n        if (oldOptions) {\r\n            Dom_1.$$(oldOptions).remove();\r\n        }\r\n        var optionsElement = Dom_1.$$('div', { className: 'coveo-error-report-options' });\r\n        optionsElement.el.appendChild(this.buildPrevious());\r\n        optionsElement.el.appendChild(this.buildReset());\r\n        optionsElement.el.appendChild(this.buildRetry());\r\n        this.container.append(optionsElement.el);\r\n    };\r\n    ErrorReport.prototype.buildEndpointErrorElements = function (helpLink) {\r\n        if (helpLink === void 0) { helpLink = 'https://docs.coveo.com/en/331/'; }\r\n        this.helpSuggestion.empty();\r\n        var link = Dom_1.$$('a', {\r\n            href: helpLink,\r\n            className: 'coveo-error-report-help-link'\r\n        });\r\n        link.setHtml(Strings_1.l('CoveoOnlineHelp'));\r\n        this.helpSuggestion.append(link.el);\r\n        this.container.el.insertBefore(this.helpSuggestion.el, this.message.el);\r\n    };\r\n    ErrorReport.ID = 'ErrorReport';\r\n    ErrorReport.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            ErrorReport: ErrorReport\r\n        });\r\n    };\r\n    /**\r\n     * The options for the component\r\n     * @componentOptions\r\n     */\r\n    ErrorReport.options = {\r\n        /**\r\n         * Specifies whether to display a detailed error message as a JSON in a text content area.\r\n         *\r\n         * Default value is `true`.\r\n         */\r\n        showDetailedError: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true })\r\n    };\r\n    return ErrorReport;\r\n}(Component_1.Component));\r\nexports.ErrorReport = ErrorReport;\r\nInitialization_1.Initialization.registerAutoCreateComponent(ErrorReport);\r\n\n\n/***/ }),\n\n/***/ 605:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// ErrorReport.min__5f3280c404a1ee75a113.js","import 'styling/_ErrorReport';\r\nimport { IQueryErrorEventArgs, QueryEvents } from '../../events/QueryEvents';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { IEndpointError } from '../../rest/EndpointError';\r\nimport { MissingAuthenticationError } from '../../rest/MissingAuthenticationError';\r\nimport { l } from '../../strings/Strings';\r\nimport { AccessibleButton } from '../../utils/AccessibleButton';\r\nimport { $$, Dom } from '../../utils/Dom';\r\nimport { analyticsActionCauseList, IAnalyticsNoMeta } from '../Analytics/AnalyticsActionListMeta';\r\nimport { Component } from '../Base/Component';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { Initialization } from '../Base/Initialization';\r\n\r\nexport interface IErrorReportOptions {\r\n  showDetailedError: boolean;\r\n}\r\n\r\n/**\r\n * The ErrorReport component takes care of handling fatal error when doing a query on the index / Search API.\r\n *\r\n * For example, the ErrorReport component displays a message when the service responds with a 401 or 503 error. This\r\n * component also renders a small text area with the JSON content of the error response, for debugging purposes.\r\n */\r\nexport class ErrorReport extends Component {\r\n  static ID = 'ErrorReport';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      ErrorReport: ErrorReport\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the component\r\n   * @componentOptions\r\n   */\r\n  static options: IErrorReportOptions = {\r\n    /**\r\n     * Specifies whether to display a detailed error message as a JSON in a text content area.\r\n     *\r\n     * Default value is `true`.\r\n     */\r\n    showDetailedError: ComponentOptions.buildBooleanOption({ defaultValue: true })\r\n  };\r\n  private organizationId;\r\n  private message: Dom;\r\n  private container: Dom;\r\n  private helpSuggestion: Dom;\r\n  private closePopup: () => void;\r\n\r\n  /**\r\n   * Creates a new ErrorReport component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the ErrorReport component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   */\r\n  constructor(public element: HTMLElement, public options?: IErrorReportOptions, bindings?: IComponentBindings) {\r\n    super(element, ErrorReport.ID, bindings);\r\n    this.options = ComponentOptions.initComponentOptions(element, ErrorReport, options);\r\n    this.container = $$('div', { className: 'coveo-error-report-container' });\r\n    this.element.appendChild(this.container.el);\r\n\r\n    if (this.options.showDetailedError) {\r\n      this.message = $$('div', {\r\n        className: 'coveo-error-report-message'\r\n      });\r\n      this.container.append(this.message.el);\r\n    }\r\n    this.helpSuggestion = $$('div', {\r\n      className: 'coveo-error-report-help-suggestion'\r\n    });\r\n\r\n    $$(this.element).hide();\r\n\r\n    this.bind.onRootElement(QueryEvents.newQuery, () => this.handleNewQuery());\r\n    this.bind.onRootElement(QueryEvents.queryError, (data: IQueryErrorEventArgs) => this.handleQueryError(data));\r\n  }\r\n\r\n  /**\r\n   * Performs the \"back\" action in the browser.\r\n   * Also logs an `errorBack` event in the usage analytics.\r\n   */\r\n  public back(): void {\r\n    this.usageAnalytics.logCustomEvent<IAnalyticsNoMeta>(analyticsActionCauseList.errorBack, {}, this.root);\r\n    this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.errorBack, {});\r\n    history.back();\r\n  }\r\n\r\n  /**\r\n   * Resets the current state of the query and triggers a new query.\r\n   * Also logs an `errorClearQuery` event in the usage analytics.\r\n   */\r\n  public reset(): void {\r\n    this.queryStateModel.reset();\r\n    this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.errorClearQuery, {});\r\n    this.usageAnalytics.logCustomEvent<IAnalyticsNoMeta>(analyticsActionCauseList.errorClearQuery, {}, this.root);\r\n    this.queryController.executeQuery();\r\n  }\r\n\r\n  /**\r\n   * Retries the same query, in case of a temporary service error.\r\n   * Also logs an `errorRetry` event in the usage analytics.\r\n   */\r\n  public retry(): void {\r\n    this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.errorRetry, {});\r\n    this.usageAnalytics.logCustomEvent<IAnalyticsNoMeta>(analyticsActionCauseList.errorRetry, {}, this.root);\r\n    this.queryController.executeQuery();\r\n  }\r\n\r\n  private buildOrGetTitleElements() {\r\n    const titleElement = $$(this.element).find('.coveo-error-report-title');\r\n\r\n    let title: Dom;\r\n    if (titleElement) {\r\n      title = $$(titleElement);\r\n    } else {\r\n      title = $$('div', { className: 'coveo-error-report-title' });\r\n      this.container.prepend(title.el);\r\n    }\r\n\r\n    let firstHeading = title.find('h1');\r\n\r\n    if (!firstHeading) {\r\n      firstHeading = $$('h1').el;\r\n      title.append(firstHeading);\r\n    }\r\n\r\n    let secondHeading = title.find('h2');\r\n    if (!secondHeading) {\r\n      secondHeading = $$('h2').el;\r\n      title.append(secondHeading);\r\n    }\r\n\r\n    return {\r\n      title,\r\n      h1: $$(firstHeading),\r\n      h2: $$(secondHeading)\r\n    };\r\n  }\r\n\r\n  private setErrorTitle(errorName?: string, helpSuggestion?: string): void {\r\n    const errorTitle = {\r\n      h1: errorName ? l(errorName) : l('OopsError'),\r\n      h2: helpSuggestion ? l(helpSuggestion) : l('ProblemPersists')\r\n    };\r\n\r\n    const { h1, h2 } = this.buildOrGetTitleElements();\r\n    if (h1 && h2) {\r\n      $$(h1).text(errorTitle.h1);\r\n      $$(h2).text(errorTitle.h2);\r\n    }\r\n  }\r\n\r\n  private buildPrevious(): HTMLElement {\r\n    const previous = $$(\r\n      'span',\r\n      {\r\n        className: 'coveo-error-report-previous'\r\n      },\r\n      l('GoBack')\r\n    );\r\n\r\n    new AccessibleButton()\r\n      .withElement(previous)\r\n      .withSelectAction(() => this.back())\r\n      .withLabel(l('GoBack'))\r\n      .build();\r\n\r\n    return previous.el;\r\n  }\r\n\r\n  private buildReset(): HTMLElement {\r\n    const reset = $$(\r\n      'span',\r\n      {\r\n        className: 'coveo-error-report-clear'\r\n      },\r\n      l('Reset')\r\n    );\r\n\r\n    new AccessibleButton()\r\n      .withElement(reset)\r\n      .withSelectAction(() => this.reset())\r\n      .withLabel(l('Reset'))\r\n      .build();\r\n\r\n    return reset.el;\r\n  }\r\n\r\n  private buildRetry(): HTMLElement {\r\n    const retry = $$(\r\n      'span',\r\n      {\r\n        className: 'coveo-error-report-retry'\r\n      },\r\n      l('Retry')\r\n    );\r\n\r\n    new AccessibleButton()\r\n      .withElement(retry)\r\n      .withSelectAction(() => this.retry())\r\n      .withLabel(l('Retry'))\r\n      .build();\r\n\r\n    return retry.el;\r\n  }\r\n\r\n  private handleNewQuery(): void {\r\n    $$(this.element).hide();\r\n    const { h1, h2 } = this.buildOrGetTitleElements();\r\n    h1.remove();\r\n    h2.remove();\r\n    if (this.closePopup != null) {\r\n      this.closePopup();\r\n    }\r\n  }\r\n\r\n  private handleQueryError(data: IQueryErrorEventArgs): void {\r\n    Assert.exists(data);\r\n    Assert.exists(data.error);\r\n\r\n    if (data.endpoint.options.queryStringArguments.organizationId) {\r\n      this.organizationId = data.endpoint.options.queryStringArguments.organizationId;\r\n    } else {\r\n      this.organizationId = l('CoveoOrganization');\r\n    }\r\n\r\n    // Do not display the panel if the error is for missing authentication. The\r\n    // appropriate authentication provider should take care of redirecting.\r\n    if ((<MissingAuthenticationError>data.error).isMissingAuthentication) {\r\n      return;\r\n    }\r\n\r\n    switch (data.error.name) {\r\n      case 'NoEndpointsException':\r\n        this.options.showDetailedError = false;\r\n        this.buildEndpointErrorElements('https://docs.coveo.com/en/331/');\r\n        this.setErrorTitle(l('NoEndpoints', this.organizationId), l('AddSources'));\r\n        break;\r\n\r\n      case 'InvalidTokenException':\r\n        this.options.showDetailedError = false;\r\n        this.buildEndpointErrorElements('https://docs.coveo.com/en/56/');\r\n        this.setErrorTitle(l('CannotAccess', this.organizationId), l('InvalidToken'));\r\n        break;\r\n\r\n      case 'GroupByAndFacetBothExistingException':\r\n        this.options.showDetailedError = false;\r\n        this.buildEndpointErrorElements('https://docs.coveo.com/en/2917');\r\n        this.setErrorTitle(undefined, l('GroupByAndFacetRequestsCannotCoexist'));\r\n        break;\r\n\r\n      default:\r\n        this.buildOptionsElement();\r\n        this.setErrorTitle();\r\n    }\r\n\r\n    if (this.options.showDetailedError) {\r\n      this.message.empty();\r\n      const moreInfo = $$(\r\n        'span',\r\n        {\r\n          className: 'coveo-error-report-more-info'\r\n        },\r\n        l('MoreInfo')\r\n      );\r\n\r\n      moreInfo.on('click', () => {\r\n        moreInfo.empty();\r\n        this.message.el.appendChild(this.buildErrorInfo(data.error));\r\n      });\r\n\r\n      this.message.el.appendChild(moreInfo.el);\r\n    }\r\n\r\n    $$(this.element).show();\r\n  }\r\n\r\n  private buildErrorInfo(data: IEndpointError): HTMLElement {\r\n    const errorInfo = $$('div', {\r\n      className: 'coveo-error-info'\r\n    });\r\n\r\n    let textArea = $$('textarea', undefined, JSON.stringify(data, null, 2));\r\n    errorInfo.el.appendChild(textArea.el);\r\n\r\n    const infoLabel = $$(\r\n      'div',\r\n      {\r\n        className: 'coveo-error-info-label'\r\n      },\r\n      l('CopyPasteToSupport')\r\n    );\r\n    errorInfo.el.appendChild(infoLabel.el);\r\n\r\n    return errorInfo.el;\r\n  }\r\n\r\n  private buildOptionsElement() {\r\n    const oldOptions = this.container.find('.coveo-error-report-options');\r\n    if (oldOptions) {\r\n      $$(oldOptions).remove();\r\n    }\r\n    const optionsElement = $$('div', { className: 'coveo-error-report-options' });\r\n    optionsElement.el.appendChild(this.buildPrevious());\r\n    optionsElement.el.appendChild(this.buildReset());\r\n    optionsElement.el.appendChild(this.buildRetry());\r\n    this.container.append(optionsElement.el);\r\n  }\r\n\r\n  private buildEndpointErrorElements(helpLink: string = 'https://docs.coveo.com/en/331/') {\r\n    this.helpSuggestion.empty();\r\n\r\n    const link = $$('a', {\r\n      href: helpLink,\r\n      className: 'coveo-error-report-help-link'\r\n    });\r\n\r\n    link.setHtml(l('CoveoOnlineHelp'));\r\n    this.helpSuggestion.append(link.el);\r\n    this.container.el.insertBefore(this.helpSuggestion.el, this.message.el);\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(ErrorReport);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ErrorReport/ErrorReport.ts"],"sourceRoot":""}
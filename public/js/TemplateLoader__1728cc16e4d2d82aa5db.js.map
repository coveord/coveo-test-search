{"version":3,"sources":["./src/ui/TemplateLoader/TemplateLoader.ts"],"names":[],"mappings":"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","file":"TemplateLoader__1728cc16e4d2d82aa5db.js","sourcesContent":["import { each } from 'underscore';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { $$ } from '../../utils/Dom';\r\nimport { Component } from '../Base/Component';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { IInitializationParameters, Initialization } from '../Base/Initialization';\r\nimport { TemplateComponentOptions } from '../Base/TemplateComponentOptions';\r\nimport { Template } from '../Templates/Template';\r\n\r\nexport interface ITemplateLoaderOptions {\r\n  template: Template;\r\n  condition?: String;\r\n}\r\n\r\n/**\r\n * The TemplateLoader component can load one result template into another. You should normally declare any reusable\r\n * result template outside of the {@link ResultList} component. Otherwise, the framework will evaluate the\r\n * `data-condition` of the reusable result template and possibly render it.\r\n *\r\n * **Example:**\r\n *\r\n * ```html\r\n * [ ... ]\r\n *\r\n * <!-- A reusable result template. Note that it is important to declare it outside of the ResultList component. -->\r\n * <script type='text/underscore' class='result-template' id='ReusableTemplate'>\r\n *   <table class='CoveoFieldTable'>\r\n *     <tr data-field='@source' data-caption='Source'></tr>\r\n *     <tr data-field='@percentScore' data-caption='Score'></tr>\r\n *   </table>\r\n * </script>\r\n *\r\n * [ ... ]\r\n *\r\n * <div class=\"CoveoResultList\" data-wait-animation=\"fade\" data-auto-select-fields-to-include=\"true\">\r\n *\r\n *   <!-- A custom result template for Lithium messages. -->\r\n *   <script type='text/underscore' class='result-template' data-condition='raw.filetype == \"lithiummessage\"'>\r\n *     <div>\r\n *       <img class='CoveoIcon' data-small='true'>\r\n *       <a class='CoveoResultLink'></a>\r\n *       <div class='CoveoTemplateLoader' data-template-id='ReusableTemplate'></div>\r\n *     </div>\r\n *   </script>\r\n *\r\n *   <!-- A custom result template for images. -->\r\n *   <script type='text/underscore' class='result-template' data-condition='raw.filetype == \"Image\"'>\r\n *     <div>\r\n *       <img class='CoveoIcon' data-small='true'></img>\r\n *         <a class='CoveoResultLink'>\r\n *           <img class='CoveoThumbnail'>\r\n *         </a>\r\n *       <div class='CoveoTemplateLoader' data-template-id='ReusableTemplate'></div>\r\n *     </div>\r\n *   </script>\r\n * </div>\r\n *\r\n * [ ... ]\r\n * ```\r\n *\r\n * See [Result Templates](https://docs.coveo.com/en/413/).\r\n */\r\nexport class TemplateLoader extends Component {\r\n  static ID = 'TemplateLoader';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      TemplateLoader: TemplateLoader\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The possible options for a TemplateLoader.\r\n   * @componentOptions\r\n   */\r\n  static options: ITemplateLoaderOptions = {\r\n    /**\r\n     * Specifies how to find the template. This can be either a CSS selector or an HTML `id` attribute.\r\n     *\r\n     * **Examples:**\r\n     *\r\n     * - With a CSS selector: `data-template-selector='.MySelector'`\r\n     * - With an HTML `id`: `data-template-id='MyId'`\r\n     */\r\n    template: TemplateComponentOptions.buildTemplateOption(),\r\n\r\n    /**\r\n     * Specifies the boolean condition that the result must satisfy in order for the template to load.\r\n     *\r\n     * **Example:**\r\n     *\r\n     * `data-condition='percentScore > 80'`\r\n     */\r\n    condition: ComponentOptions.buildStringOption()\r\n  };\r\n\r\n  /**\r\n   * Creates a new TemplateLoader.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the TemplateLoader component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   * @param result The result to associate the component with.\r\n   */\r\n  constructor(\r\n    public element: HTMLElement,\r\n    public options?: ITemplateLoaderOptions,\r\n    public bindings?: IComponentBindings,\r\n    public result?: IQueryResult\r\n  ) {\r\n    super(element, TemplateLoader.ID, bindings);\r\n    this.options = ComponentOptions.initComponentOptions(element, TemplateLoader, options);\r\n    this.result = this.result || this.resolveResult();\r\n    Assert.exists(this.result);\r\n\r\n    if (this.options.condition != null) {\r\n      var conditionFunction = new Function('obj', 'with(obj||{}){return ' + this.options.condition + '}');\r\n      if (conditionFunction(this.result)) {\r\n        this.initialize();\r\n      }\r\n    } else {\r\n      this.initialize();\r\n    }\r\n  }\r\n\r\n  private initialize() {\r\n    if (this.options.template != null) {\r\n      var initOptions = this.searchInterface.options;\r\n      var initParameters: IInitializationParameters = {\r\n        options: initOptions,\r\n        bindings: this.bindings,\r\n        result: this.result\r\n      };\r\n\r\n      var parents = $$(this.element).parents(Component.computeCssClassName(TemplateLoader));\r\n      each(parents, (parent: HTMLElement) => {\r\n        let clone = <HTMLElement>parent.cloneNode();\r\n        $$(clone).empty();\r\n        let outerHTMLParent = clone.outerHTML;\r\n        Assert.check(outerHTMLParent.indexOf(this.element.outerHTML) === -1, 'TemplateLoader cannot load a template into itself.');\r\n      });\r\n\r\n      this.element.innerHTML = this.options.template.instantiateToString(this.result, {\r\n        checkCondition: false,\r\n        responsiveComponents: this.bindings ? this.bindings.searchInterface.responsiveComponents : null\r\n      });\r\n      Initialization.automaticallyCreateComponentsInside(this.element, initParameters);\r\n    }\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(TemplateLoader);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/TemplateLoader/TemplateLoader.ts"],"sourceRoot":""}
{"version":3,"sources":["RelevanceInspector.min__5f3280c404a1ee75a113.js","./src/ui/RelevanceInspector/RelevanceInspector.ts","./src/ui/RelevanceInspector/TableBuilder.ts","./src/ui/RelevanceInspector/ExecutionReport.ts","./src/ui/RelevanceInspector/GenericValueOutput.ts","./src/ui/RelevanceInspector/ExecutionReportGenericSection.ts","./src/ui/RelevanceInspector/RankingInfoParser.ts","./src/ui/RelevanceInspector/ExecutionReportSimpleSection.ts","./src/ui/RelevanceInspector/RankingInfoTable.ts","./src/ui/RelevanceInspector/AgGrid.ts","./src/ui/RelevanceInspector/MetaDataTable.ts","./src/ui/RelevanceInspector/RelevanceInspectorTabs.ts","webpack:///./sass/_RelevanceInspector.scss?ff92","./sass/_RelevanceInspector.scss","./src/ui/RelevanceInspector/ExecutionReportAuthenticationSection.ts","./src/ui/RelevanceInspector/ExecutionReportResolvedPipelineSection.ts","./src/ui/RelevanceInspector/ExecutionReportQueryOverrideSection.ts","./src/ui/RelevanceInspector/ExecutionReportEffectiveIndexQuerySection.ts","./src/ui/RelevanceInspector/ExecutionReportRankingModifiers.ts","./src/ui/RelevanceInspector/ExecutionReportITDSection.ts","./src/ui/RelevanceInspector/AvailableFieldsTable.ts","./src/ui/RelevanceInspector/InlineRankingInfo.ts","./src/ui/ResultLink/ResultLink.ts"],"names":["webpackJsonpCoveo__temporary","232","module","exports","__webpack_require__","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","verb","n","v","op","f","TypeError","_","y","t","call","label","ops","pop","trys","length","push","g","sent","throw","return","Symbol","iterator","Object","defineProperty","element","bindings","opened","modalBoxModule","ModalBox","$$","text","addClass","root","on","queryStateModel","getEventName","QueryStateModel","eventTypes","changeOne","attributesEnum","debug","args","toggleFromState","open","ResultListEvents","newResultDisplayed","handleNewResultDisplayed","get","show","hide","set","enumerable","configurable","removeClass","content","animation","rows","_a","DomUtils","getBasicLoadingAnimation","append","modalBox","el","modalBoxOptions","buildTabs","remove","close","item","hasClass","InlineRankingInfo","build","prepend","title","titleClose","overlayClose","sizeMod","className","validation","document","getElementsByClassName","stateValue","lastResults","container","rankingInfoTable","metadataTable","executionReport","availableFields","inspectorTabs","debouncedResize","_b","_c","_d","_e","_f","_g","_h","_j","_k","_l","_m","_this","_o","queryController","getLastResults","results","rankingInfo","RankingInfoTable","MetaDataTable","ExecutionReport","AvailableFieldsTable","tabs","relevanceInspectorRankingInfo","relevanceInspectorMetadata","relevanceInspectorExecutionReport","relevanceInspectorAvailableFields","RelevanceInspectorTabs","tabChangedTo","activeTab","resize","debounce","window","addEventListener","addSection","Logger","error","select","navigationSection","tabContentSection","gridOptions","api","sizeColumnsToFit","RelevanceInspector","532","803","__assign","assign","s","i","arguments","p","prototype","hasOwnProperty","defaultGridOptions","domLayout","enableColResize","rowHeight","enableRangeSelection","suppressRowClickSelection","suppressCellSelection","defaultColDef","width","enableSorting","autoSizePadding","sources","table","firstData","mapToAgGridFormat","columnDefs","rowData","grid","first","key","children","field","headerName","marryChildren","flatten","map","child","source","merged","extractContent","each","loadAgGridLibrary","agGrid","Grid","thumbnailCell","Document","cellRenderer","ThumbnailHtmlRenderer","getQuickFilterText","params","TableBuilder","init","currentFilter","filterManager","quickFilter","getGui","cell","thumbnail","undefined","dom","resultLists","searchInterface","getComponents","firstActiveResultList","find","resultList","disabled","buildResult","builtResult","ResultLink","alwaysOpenInNewWindow","highlightSearch","refresh","elementToSearch","search","asHTMLElement","innerText","match","split","RegExp","StringUtils","regexEncode","innerHTML","forEach","span","regex","group","appendChild","substr","StreamHighlightUtils","highlightStreamHTML","Precision","GenericHtmlRenderer","804","EXECUTION_REPORT_SECTION","standardSectionHeader","agGridElement","authenticationSection","resolvedPipelineSection","resolvedRankingModifiers","queryParamOverrideSection","thesaurusSection","stopWordsSection","filtersSection","rankingSection","topResultsSection","itdSection","rankingWeightsSection","indexQuerySection","ExecutionReportAuthenticationSection","ExecutionReportResolvedPipelineSection","ExecutionReportRankingModifiers","rankingExpressions","ExecutionReportQueryOverrideSection","ExecutionReportSimpleSection","PREPROCESS_QUERY_EXPRESSION","THESAURUS","STOP_WORDS","PREPROCESS_QUERY","FILTERS","RANKING","TOP_RESULT","ExecutionReportITDSection","RANKING_WEIGHT","ExecutionReportEffectiveIndexQuerySection","option","805","output","section","isArray","arrayJoined","isObject","objectJoined","simpleValue","valueOrNullOutput","list","innerList","outerHTML","sectionValue","toString","GenericValueOutput","806","executionReportSection","descriptionSection","durationSection","Description","description","Duration","duration","ExecutionReportGenericSection","807","buildListOfTermsElement","weightPerTerm","listItems","dt","dd","total","reduce","memo","parseRankingInfo","REGEX_EXTRACT_DOCUMENT_WEIGHTS","REGEX_EXTRACT_TERMS_WEIGHTS","REGEX_EXTRACT_TOTAL_WEIGHTS","docWeightsRegexResult","exec","termsWeightRegexResult","totalWeigthRegexResult","qreWeights","parseQREWeights","documentWeights","parseWeights","termsWeight","parseTermsWeights","totalWeight","Number","REGEX_EXTRACT_LIST_OF_WEIGHTS","REGEX_EXTRACT_WEIGHT_GROUP","listOfWeight","object","weight","weightGroup","weightAppliedOn","weightValue","REGEX_EXTRACT_GROUP_OF_TERMS","REGEX_EXTRACT_SINGLE_TERM","terms","term","words","word","Correlation","weights","keys","join","Weights","REGEX_EXTRACT_QRE_WEIGHTS","qreWeightsRegexResult","expression","score","parseInt","808","topLevelProperty","secondLevelProperty","sectionTitle","dataSource","tableBuilder","name","findWhere","Applied","applied","809","topLevelInfoThatHaveAtLeastANonZeroValue","containsKeywordRankingInfo","data","uniq","documentsWeights","buildTopLevelDocumentsWeights","chain","sortBy","reverse","totalContent","Total","getRowHeight","onGridReady","setTimeout","setSortModel","colId","sort","hasAtLeastOneNonZeroValue","contains","810","isAgGridLoaded","isAgGridLoading","reset","doc","addAgGridScriptsToDocument","catch","src","type","async","styleBase","href","rel","style","head","resolveScriptLoaded","rejectScriptLoaded","onload","onerror","811","fieldsDescription","builders","builtTables","textInput","getEndpoint","listFields","nestedContainer","nestedAgGrid","fields","FieldValuesRenderer","allValues","raw","val","concat","onCellDoubleClicked","event","target","getSelection","createRange","selection","range","selectNodeContents","removeAllRanges","addRange","built","all","TextInput","input","setQuickFilter","getValue","onRowHeightChanged","getElement","listAsInput","eParentOfValue","height","Math","max","maxHeight","min","node","setRowHeight","fieldInResult","indexOf","isCurrentElementFilteredOut","inputGroup","fieldName","fieldValue","convertFieldValueToReadableFormat","fieldValueElement","matchInFieldName","toLowerCase","matchInFieldValue","matchingFieldDescription","replace","fieldType","DateUtils","convertToStandardDate","812","onTabChange","navigationElements","tabContentElements","id","navElementToActivate","findNavigationById","tabContentToActivate","findTabContentById","activateTabNavigation","activateTabContent","addNavigation","caption","navigationElement","addContent","targetId","tabContent","getAttribute","tabContentElement","contentElement","813","options","transform","locals","814","815","PERFORM_AUTHENTICATION","configurationSection","pipelineOuputSection","Configured","Primary","genericOutput","configured","primary","Secondary","secondary","Mandatory","mandatory","usersIds","userIds","queryRestrictions","Roles","roles","userGroups","userId","Kind","kind","Provider","provider","Info","info","816","RESOLVE_PIPELINE","Pipeline","pipeline","splitTest","817","queryOverrideSection","QUERY_PARAM_OVERRIDE","818","collapsibleSectionsInReport","INDEX_QUERY","in","paramValue","paramKey","row","btn","toggleClass","819","dataSourcePromises","rankingExpression","isAutomaticBoostRegex","thumbnailPreview","returnedByIndexForCurrentQuery","isAutomaticBoost","permanentIDUsedInAutomaticBoost","extracted","extractDocumentInfoFromBoost","ReturnedByIndexForCurrentQuery","IsRecommendation","isRecommendation","Expression","Modifier","modifier","permanentID","matchingResult","resultInResultSet","queryBuilder","resultsFromIndex","permanentid","urihash","QueryBuilder","advancedExpression","add","820","preprocessQuerySection","originalLongQuery","topClicksSection","lq","TOP_CLICKS","buildOriginalLongQueryCell","refinedQueries","buildRefinedQueryCell","buildFallbackEmptyTable","doHighlights","termsToHighlight","refined","q","highlightStreamText","preprocessSection","Utils","isNonEmptyArray","buildRefinedQueryByMLCell","fallbackIndexPartialMatch","PARTIAL_MATCH","out","buildRefinedQueryByPartialMatchCell","buildRefinedQueryNoExtraction","topLevelContainer","keywordsList","refinedQuery","refinedQueryContainer","partialMatch","NONE","821","allFieldsDescription","Name","defaultValue","fieldSourceType","includeInQuery","includeInResults","groupByField","splitGroupByField","sortByField","suppressSorting","suppressFilter","AvailableFieldsSampleValue","enableFilter","rowModelType","pagination","paginationPageSize","enableServerSideFilter","enableServerSideSorting","datasource","AvailableFieldsDatasource","popperElement","userHoveringButtonWithHisMouse","values","getFieldsValues","renderFieldValues","PopupUtils","positionPopup","horizontal","PopupHorizontalAlignment","LEFT","vertical","PopupVerticalAlignment","MIDDLE","fieldDesciption","queryResults","listFieldValues","getFieldValue","fieldValues","background","listItem","rowsData","getRows","filtered","filter","filterModel","filteredAndSorted","sortModel","successCallback","slice","startRow","endRow","where","possibleReturn","sortModels","second","firstValue","secondValue","ascendingOrDescendingMultiplier","isNullOrEmptyString","isNaN","localeCompare","822","buildTogglableTermsSection","buildTogglableQRESection","termsButton","termsSection","builtKey","qreButton","qreSection","92","__extends","extendStatics","setPrototypeOf","__proto__","Array","d","b","__","constructor","create","os","ID","logOpenDocument","saveLastQuery","documentURL","escapedClickUri","usageAnalytics","logClickEvent","analyticsActionCauseList","documentOpen","documentTitle","author","Defer","flush","initialOptions","ComponentOptions","initComponentOptions","resultLinkOptions","componentOptionsModel","ComponentOptionsModel","resultLink","extend","resolveResult","openQuickview","DeviceUtils","isMobileDevice","setAttribute","Assert","exists","quickviewShouldBeOpened","once","clearTimeout","renderUri","bindEventToOpen","test","getDisplayedTitle","getDisplayedTitleAsText","openLink","logAnalytics","location","getResultUri","openLinkInNewWindow","openLinkInOutlook","hasOutlookField","openLinkAsConfigured","toExecuteOnOpen","bindOnClickIfNotUndefined","bindOpenQuickviewIfNotUndefined","setHrefIfNotAlready","openLinkThatIsNotAnAnchor","titleTemplate","newTitle","buildStringTemplateFromResult","phrasesToHighlight","HighlightUtils","highlightString","titleHighlights","setHtml","escape","clickUri","onClick","AccessibleButton","withElement","withLabel","withSelectAction","resultElement","trigger","preventDefault","elementIsAnAnchor","openInOutlook","isNonEmptyString","filterProtocol","uri","isAbsolute","isRelative","hrefTemplate","setField","tagName","OSUtils","OS_NAME","MACOSX","WINDOWS","isUriThatMustBeOpenedInQuickview","QueryUtils","hasHTMLVersion","doExport","exportGlobally","buildFieldOption","buildBooleanOption","buildStringOption","buildCustomOption","Component","Initialization","registerAutoCreateComponent"],"mappings":"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","file":"RelevanceInspector.min__5f3280c404a1ee75a113.js","sourcesContent":["webpackJsonpCoveo__temporary([0,63],{\n\n/***/ 232:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RankingInfoTable_1 = __webpack_require__(809);\r\nvar MetaDataTable_1 = __webpack_require__(811);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar ExternalModulesShim_1 = __webpack_require__(26);\r\nvar Core_1 = __webpack_require__(20);\r\nvar RelevanceInspectorTabs_1 = __webpack_require__(812);\r\n__webpack_require__(813);\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar AvailableFieldsTable_1 = __webpack_require__(821);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar InlineRankingInfo_1 = __webpack_require__(822);\r\nvar RelevanceInspector = /** @class */ (function () {\r\n    function RelevanceInspector(element, bindings) {\r\n        var _this = this;\r\n        this.element = element;\r\n        this.bindings = bindings;\r\n        this.opened = false;\r\n        this.modalBoxModule = ExternalModulesShim_1.ModalBox;\r\n        Dom_1.$$(this.element).text('Relevance Inspector');\r\n        Dom_1.$$(this.element).addClass('coveo-button coveo-relevance-inspector');\r\n        Dom_1.$$(this.bindings.root).on(this.bindings.queryStateModel.getEventName(Core_1.QueryStateModel.eventTypes.changeOne + Core_1.QueryStateModel.attributesEnum.debug), function (e, args) { return _this.toggleFromState(args.value); });\r\n        Dom_1.$$(this.element).on('click', function () { return _this.open(); });\r\n        Dom_1.$$(this.bindings.root).on(Core_1.ResultListEvents.newResultDisplayed, function (e, args) {\r\n            return _this.handleNewResultDisplayed(args);\r\n        });\r\n        this.bindings.queryStateModel.get(Core_1.QueryStateModel.attributesEnum.debug) ? this.show() : this.hide();\r\n    }\r\n    Object.defineProperty(RelevanceInspector.prototype, \"modalBox\", {\r\n        get: function () {\r\n            return this.modalBoxModule;\r\n        },\r\n        set: function (modalBoxModule) {\r\n            this.modalBoxModule = modalBoxModule;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    RelevanceInspector.prototype.hide = function () {\r\n        Dom_1.$$(this.element).addClass('coveo-hidden');\r\n    };\r\n    RelevanceInspector.prototype.show = function () {\r\n        Dom_1.$$(this.element).removeClass('coveo-hidden');\r\n    };\r\n    RelevanceInspector.prototype.open = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var content, animation, rows;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.opened) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        this.opened = true;\r\n                        content = Dom_1.$$('div');\r\n                        animation = Core_1.DomUtils.getBasicLoadingAnimation();\r\n                        content.append(animation);\r\n                        this.modalBox.open(content.el, this.modalBoxOptions);\r\n                        return [4 /*yield*/, this.buildTabs()];\r\n                    case 1:\r\n                        rows = _a.sent();\r\n                        if (rows) {\r\n                            animation.remove();\r\n                            content.append(rows.el);\r\n                        }\r\n                        else {\r\n                            this.modalBox.close();\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RelevanceInspector.prototype.handleNewResultDisplayed = function (args) {\r\n        if (this.bindings.queryStateModel.get(Core_1.QueryStateModel.attributesEnum.debug)) {\r\n            Dom_1.$$(args.item).addClass('coveo-with-inline-ranking-info');\r\n            if (Dom_1.$$(args.item).hasClass('coveo-table-layout')) {\r\n                Dom_1.$$(args.item).append(new InlineRankingInfo_1.InlineRankingInfo(args.result).build().el);\r\n            }\r\n            else {\r\n                Dom_1.$$(args.item).prepend(new InlineRankingInfo_1.InlineRankingInfo(args.result).build().el);\r\n            }\r\n        }\r\n    };\r\n    Object.defineProperty(RelevanceInspector.prototype, \"modalBoxOptions\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return {\r\n                title: 'Relevance Inspector',\r\n                titleClose: false,\r\n                overlayClose: true,\r\n                sizeMod: 'big',\r\n                className: 'relevance-inspector-modal',\r\n                validation: function () {\r\n                    _this.opened = false;\r\n                    return true;\r\n                },\r\n                body: document.getElementsByClassName('CoveoSearchInterface')[0] // Will return undefined if no CoveoSearchInterface is present\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    RelevanceInspector.prototype.toggleFromState = function (stateValue) {\r\n        stateValue != 0 ? this.show() : this.hide();\r\n        this.modalBox.close();\r\n    };\r\n    RelevanceInspector.prototype.buildTabs = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var lastResults, container, rankingInfoTable, metadataTable, executionReport, availableFields, inspectorTabs, debouncedResize, _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\r\n            return __generator(this, function (_o) {\r\n                switch (_o.label) {\r\n                    case 0:\r\n                        lastResults = this.bindings.queryController.getLastResults().results;\r\n                        if (!lastResults || lastResults.length == 0) {\r\n                            new Core_1.Logger(this).error('Could not open Relevance Inspector because there is no results to display. Please execute a query beforehand', lastResults);\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (!lastResults[0].rankingInfo) {\r\n                            new Core_1.Logger(this).error('Could not open Relevance Inspector because there is no ranking info returned on the results. Please execute a query in debug mode beforehad', lastResults);\r\n                            return [2 /*return*/];\r\n                        }\r\n                        container = Dom_1.$$('div');\r\n                        rankingInfoTable = new RankingInfoTable_1.RankingInfoTable(lastResults, this.bindings);\r\n                        metadataTable = new MetaDataTable_1.MetaDataTable(lastResults, this.bindings);\r\n                        executionReport = new ExecutionReport_1.ExecutionReport(this.bindings.queryController.getLastResults(), this.bindings);\r\n                        availableFields = new AvailableFieldsTable_1.AvailableFieldsTable(this.bindings);\r\n                        this.tabs = {\r\n                            relevanceInspectorRankingInfo: rankingInfoTable,\r\n                            relevanceInspectorMetadata: metadataTable,\r\n                            relevanceInspectorExecutionReport: executionReport,\r\n                            relevanceInspectorAvailableFields: availableFields\r\n                        };\r\n                        inspectorTabs = new RelevanceInspectorTabs_1.RelevanceInspectorTabs(function (tabChangedTo) {\r\n                            _this.activeTab = tabChangedTo;\r\n                            _this.resize();\r\n                        });\r\n                        debouncedResize = underscore_1.debounce(function () { return _this.resize(); }, 100);\r\n                        window.addEventListener('resize', debouncedResize);\r\n                        _b = (_a = inspectorTabs).addSection;\r\n                        _c = ['Ranking Information'];\r\n                        return [4 /*yield*/, rankingInfoTable.build()];\r\n                    case 1:\r\n                        _b.apply(_a, _c.concat([_o.sent(), 'relevanceInspectorRankingInfo']));\r\n                        _e = (_d = inspectorTabs).addSection;\r\n                        _f = ['Metadata'];\r\n                        return [4 /*yield*/, metadataTable.build()];\r\n                    case 2:\r\n                        _e.apply(_d, _f.concat([_o.sent(), 'relevanceInspectorMetadata']));\r\n                        _h = (_g = inspectorTabs).addSection;\r\n                        _j = ['Execution Report'];\r\n                        return [4 /*yield*/, executionReport.build()];\r\n                    case 3:\r\n                        _h.apply(_g, _j.concat([_o.sent(), 'relevanceInspectorExecutionReport']));\r\n                        _l = (_k = inspectorTabs).addSection;\r\n                        _m = ['Available Fields'];\r\n                        return [4 /*yield*/, availableFields.build()];\r\n                    case 4:\r\n                        _l.apply(_k, _m.concat([_o.sent(), 'relevanceInspectorAvailableFields']));\r\n                        inspectorTabs.select('relevanceInspectorRankingInfo');\r\n                        container.append(inspectorTabs.navigationSection.el);\r\n                        container.append(inspectorTabs.tabContentSection.el);\r\n                        return [2 /*return*/, container];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RelevanceInspector.prototype.resize = function () {\r\n        if (!this.activeTab) {\r\n            return;\r\n        }\r\n        if (!this.tabs[this.activeTab]) {\r\n            return;\r\n        }\r\n        this.tabs[this.activeTab].gridOptions.api.sizeColumnsToFit();\r\n    };\r\n    return RelevanceInspector;\r\n}());\r\nexports.RelevanceInspector = RelevanceInspector;\r\n\n\n/***/ }),\n\n/***/ 532:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 803:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgGrid_1 = __webpack_require__(810);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar UtilsModules_1 = __webpack_require__(121);\r\nvar ResultLink_1 = __webpack_require__(92);\r\nexports.defaultGridOptions = {\r\n    domLayout: 'autoHeight',\r\n    enableColResize: true,\r\n    rowHeight: 100,\r\n    enableRangeSelection: true,\r\n    suppressRowClickSelection: true,\r\n    suppressCellSelection: true,\r\n    defaultColDef: {\r\n        width: 100\r\n    },\r\n    enableSorting: true,\r\n    autoSizePadding: 10\r\n};\r\nvar TableBuilder = /** @class */ (function () {\r\n    function TableBuilder() {\r\n    }\r\n    TableBuilder.prototype.build = function (sources, table, gridOptions) {\r\n        if (gridOptions === void 0) { gridOptions = exports.defaultGridOptions; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var firstData, mapToAgGridFormat, columnDefs, rowData, grid;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        firstData = underscore_1.first(sources) || {};\r\n                        mapToAgGridFormat = function (value, key) {\r\n                            if (value.children) {\r\n                                return {\r\n                                    field: key,\r\n                                    headerName: key,\r\n                                    marryChildren: true,\r\n                                    children: underscore_1.flatten(value.children.map(function (child) {\r\n                                        return underscore_1.map(child, mapToAgGridFormat);\r\n                                    }))\r\n                                };\r\n                            }\r\n                            else {\r\n                                return __assign({ field: key, headerName: key }, value);\r\n                            }\r\n                        };\r\n                        columnDefs = underscore_1.map(firstData, mapToAgGridFormat);\r\n                        rowData = underscore_1.map(sources, function (source) {\r\n                            var merged = {};\r\n                            var extractContent = function (value, key) {\r\n                                if (value.content) {\r\n                                    merged[key] = value.content;\r\n                                }\r\n                                else if (value.children) {\r\n                                    underscore_1.each(value.children, function (child) {\r\n                                        underscore_1.each(child, extractContent);\r\n                                    });\r\n                                }\r\n                            };\r\n                            underscore_1.each(source, extractContent);\r\n                            return merged;\r\n                        });\r\n                        this.gridOptions = __assign({}, exports.defaultGridOptions, { columnDefs: columnDefs,\r\n                            rowData: rowData }, gridOptions);\r\n                        return [4 /*yield*/, AgGrid_1.loadAgGridLibrary()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        grid = new agGrid.Grid(table.el, this.gridOptions);\r\n                        return [2 /*return*/, { grid: grid, gridOptions: this.gridOptions }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    TableBuilder.thumbnailCell = function (result, bindings) {\r\n        return {\r\n            Document: {\r\n                content: { result: result, bindings: bindings },\r\n                cellRenderer: ThumbnailHtmlRenderer,\r\n                width: 550,\r\n                getQuickFilterText: function (params) {\r\n                    return '';\r\n                }\r\n            }\r\n        };\r\n    };\r\n    return TableBuilder;\r\n}());\r\nexports.TableBuilder = TableBuilder;\r\nvar ThumbnailHtmlRenderer = /** @class */ (function () {\r\n    function ThumbnailHtmlRenderer() {\r\n    }\r\n    ThumbnailHtmlRenderer.prototype.init = function (params) {\r\n        if (params) {\r\n            this.element = params.value;\r\n            this.currentFilter = params.api.filterManager.quickFilter;\r\n        }\r\n    };\r\n    ThumbnailHtmlRenderer.prototype.getGui = function () {\r\n        var cell = UtilsModules_1.$$('div', { className: 'coveo-relevance-inspector-thumbnail-cell' });\r\n        if (this.element) {\r\n            var thumbnail = this.thumbnail(this.element.result, this.element.bindings);\r\n            cell.append(thumbnail.el);\r\n        }\r\n        else {\r\n            cell.append(UtilsModules_1.$$('p', undefined, '-- NULL --').el);\r\n        }\r\n        return cell.el;\r\n    };\r\n    ThumbnailHtmlRenderer.prototype.thumbnail = function (result, bindings) {\r\n        var dom;\r\n        if (bindings && result) {\r\n            var resultLists = bindings.searchInterface.getComponents('ResultList');\r\n            var firstActiveResultList = underscore_1.find(resultLists, function (resultList) { return !resultList.disabled; });\r\n            if (firstActiveResultList) {\r\n                dom = UtilsModules_1.$$('div', {\r\n                    className: 'coveo-relevance-inspector-result-thumbnail'\r\n                });\r\n                firstActiveResultList.buildResult(result).then(function (builtResult) {\r\n                    dom.append(builtResult);\r\n                });\r\n            }\r\n            else {\r\n                dom = UtilsModules_1.$$('a', {\r\n                    className: 'CoveoResultLink'\r\n                });\r\n                new ResultLink_1.ResultLink(dom.el, { alwaysOpenInNewWindow: true }, bindings, result);\r\n            }\r\n            if (this.currentFilter) {\r\n                this.highlightSearch(dom.el, this.currentFilter);\r\n            }\r\n        }\r\n        else {\r\n            dom = UtilsModules_1.$$('div', undefined, '-- NULL --');\r\n        }\r\n        return dom;\r\n    };\r\n    ThumbnailHtmlRenderer.prototype.refresh = function (params) {\r\n        return true;\r\n    };\r\n    ThumbnailHtmlRenderer.prototype.highlightSearch = function (elementToSearch, search) {\r\n        var asHTMLElement = elementToSearch;\r\n        if (asHTMLElement != null && asHTMLElement.innerText != null) {\r\n            var match = asHTMLElement.innerText.split(new RegExp('(?=' + UtilsModules_1.StringUtils.regexEncode(search) + ')', 'gi'));\r\n            asHTMLElement.innerHTML = '';\r\n            match.forEach(function (value) {\r\n                var regex = new RegExp('(' + UtilsModules_1.StringUtils.regexEncode(search) + ')', 'i');\r\n                var group = value.match(regex);\r\n                var span;\r\n                if (group != null) {\r\n                    span = UtilsModules_1.$$('span', {\r\n                        className: 'coveo-relevance-inspector-highlight'\r\n                    });\r\n                    span.text(group[1]);\r\n                    asHTMLElement.appendChild(span.el);\r\n                    span = UtilsModules_1.$$('span');\r\n                    span.text(value.substr(group[1].length));\r\n                    asHTMLElement.appendChild(span.el);\r\n                }\r\n                else {\r\n                    span = UtilsModules_1.$$('span');\r\n                    span.text(value);\r\n                    asHTMLElement.appendChild(span.el);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    return ThumbnailHtmlRenderer;\r\n}());\r\nexports.ThumbnailHtmlRenderer = ThumbnailHtmlRenderer;\r\nvar GenericHtmlRenderer = /** @class */ (function () {\r\n    function GenericHtmlRenderer() {\r\n    }\r\n    GenericHtmlRenderer.prototype.init = function (params) {\r\n        if (params && params.api) {\r\n            this.element = params.value;\r\n            this.currentFilter = params.api.filterManager.quickFilter;\r\n        }\r\n    };\r\n    GenericHtmlRenderer.prototype.getGui = function () {\r\n        if (this.element && this.currentFilter) {\r\n            return UtilsModules_1.$$('div', undefined, UtilsModules_1.StreamHighlightUtils.highlightStreamHTML(this.element, { Precision: ['precision'] }, {})).el;\r\n        }\r\n        else if (this.element) {\r\n            return UtilsModules_1.$$('div', undefined, this.element).el;\r\n        }\r\n        else {\r\n            return UtilsModules_1.$$('div', undefined, '-- NULL --').el;\r\n        }\r\n    };\r\n    GenericHtmlRenderer.prototype.refresh = function (params) {\r\n        return true;\r\n    };\r\n    return GenericHtmlRenderer;\r\n}());\r\nexports.GenericHtmlRenderer = GenericHtmlRenderer;\r\n\n\n/***/ }),\n\n/***/ 804:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReportAuthenticationSection_1 = __webpack_require__(815);\r\nvar ExecutionReportResolvedPipelineSection_1 = __webpack_require__(816);\r\nvar ExecutionReportQueryOverrideSection_1 = __webpack_require__(817);\r\nvar ExecutionReportSimpleSection_1 = __webpack_require__(808);\r\nvar ExecutionReportEffectiveIndexQuerySection_1 = __webpack_require__(818);\r\nvar UtilsModules_1 = __webpack_require__(121);\r\nvar ExecutionReportRankingModifiers_1 = __webpack_require__(819);\r\nvar Core_1 = __webpack_require__(20);\r\nvar ExecutionReportITDSection_1 = __webpack_require__(820);\r\nvar EXECUTION_REPORT_SECTION;\r\n(function (EXECUTION_REPORT_SECTION) {\r\n    EXECUTION_REPORT_SECTION[\"PERFORM_AUTHENTICATION\"] = \"PerformAuthentication\";\r\n    EXECUTION_REPORT_SECTION[\"RESOLVE_PIPELINE\"] = \"ResolvePipeline\";\r\n    EXECUTION_REPORT_SECTION[\"QUERY_PARAM_OVERRIDE\"] = \"ApplyQueryParamOverrideFeature\";\r\n    EXECUTION_REPORT_SECTION[\"THESAURUS\"] = \"ApplyThesaurusFeature\";\r\n    EXECUTION_REPORT_SECTION[\"PREPROCESS_QUERY_EXPRESSION\"] = \"PreprocessQueryExpression\";\r\n    EXECUTION_REPORT_SECTION[\"PREPROCESS_QUERY\"] = \"PreprocessQuery\";\r\n    EXECUTION_REPORT_SECTION[\"STOP_WORDS\"] = \"ApplyStopWordFeature\";\r\n    EXECUTION_REPORT_SECTION[\"FILTERS\"] = \"ApplyFilterFeature\";\r\n    EXECUTION_REPORT_SECTION[\"RANKING\"] = \"ApplyRankingFeature\";\r\n    EXECUTION_REPORT_SECTION[\"TOP_RESULT\"] = \"ApplyTopResultFeature\";\r\n    EXECUTION_REPORT_SECTION[\"RANKING_WEIGHT\"] = \"ApplyRankingWeightFeature\";\r\n    EXECUTION_REPORT_SECTION[\"INDEX_QUERY\"] = \"Send query to index\";\r\n    EXECUTION_REPORT_SECTION[\"TOP_CLICKS\"] = \"EvaluatingTopClicks\";\r\n    EXECUTION_REPORT_SECTION[\"PARTIAL_MATCH\"] = \"PartialMatch\";\r\n    EXECUTION_REPORT_SECTION[\"NONE\"] = \"NONE\";\r\n})(EXECUTION_REPORT_SECTION = exports.EXECUTION_REPORT_SECTION || (exports.EXECUTION_REPORT_SECTION = {}));\r\nvar ExecutionReport = /** @class */ (function () {\r\n    function ExecutionReport(results, bindings) {\r\n        this.results = results;\r\n        this.bindings = bindings;\r\n    }\r\n    ExecutionReport.standardSectionHeader = function (title) {\r\n        var container = UtilsModules_1.$$('div');\r\n        container.append(UtilsModules_1.$$('h4', undefined, title).el);\r\n        var agGridElement = UtilsModules_1.$$('div', {\r\n            className: 'ag-theme-fresh'\r\n        });\r\n        container.append(agGridElement.el);\r\n        return {\r\n            container: container,\r\n            agGridElement: agGridElement\r\n        };\r\n    };\r\n    ExecutionReport.prototype.build = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var container, gridOptions, authenticationSection, resolvedPipelineSection, resolvedRankingModifiers, queryParamOverrideSection, thesaurusSection, stopWordsSection, filtersSection, rankingSection, topResultsSection, itdSection, rankingWeightsSection, indexQuerySection;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.results.executionReport) {\r\n                            new Core_1.Logger(this).error('Could not open execution report : Missing execution report on results. Try executing the query in debug mode.');\r\n                            return [2 /*return*/, UtilsModules_1.$$('div')];\r\n                        }\r\n                        container = UtilsModules_1.$$('div', {\r\n                            className: 'execution-report-debug'\r\n                        });\r\n                        gridOptions = [];\r\n                        return [4 /*yield*/, new ExecutionReportAuthenticationSection_1.ExecutionReportAuthenticationSection().build(this.results.executionReport)];\r\n                    case 1:\r\n                        authenticationSection = _a.sent();\r\n                        container.append(authenticationSection.container.el);\r\n                        if (authenticationSection.gridOptions) {\r\n                            gridOptions.push(authenticationSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportResolvedPipelineSection_1.ExecutionReportResolvedPipelineSection().build(this.results.executionReport)];\r\n                    case 2:\r\n                        resolvedPipelineSection = _a.sent();\r\n                        container.append(resolvedPipelineSection.container.el);\r\n                        if (resolvedPipelineSection.gridOptions) {\r\n                            gridOptions.push(resolvedPipelineSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportRankingModifiers_1.ExecutionReportRankingModifiers().build(this.results.results, this.results.rankingExpressions, this.bindings)];\r\n                    case 3:\r\n                        resolvedRankingModifiers = _a.sent();\r\n                        container.append(resolvedRankingModifiers.container.el);\r\n                        if (resolvedRankingModifiers.gridOptions) {\r\n                            gridOptions.push(resolvedRankingModifiers.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportQueryOverrideSection_1.ExecutionReportQueryOverrideSection().build(this.results.executionReport)];\r\n                    case 4:\r\n                        queryParamOverrideSection = _a.sent();\r\n                        container.append(queryParamOverrideSection.container.el);\r\n                        if (queryParamOverrideSection.gridOptions) {\r\n                            gridOptions.push(queryParamOverrideSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportSimpleSection_1.ExecutionReportSimpleSection(EXECUTION_REPORT_SECTION.PREPROCESS_QUERY_EXPRESSION, EXECUTION_REPORT_SECTION.THESAURUS, 'Thesaurus').build(this.results.executionReport)];\r\n                    case 5:\r\n                        thesaurusSection = _a.sent();\r\n                        container.append(thesaurusSection.container.el);\r\n                        if (thesaurusSection.gridOptions) {\r\n                            gridOptions.push(thesaurusSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportSimpleSection_1.ExecutionReportSimpleSection(EXECUTION_REPORT_SECTION.PREPROCESS_QUERY_EXPRESSION, EXECUTION_REPORT_SECTION.STOP_WORDS, 'Stop words').build(this.results.executionReport)];\r\n                    case 6:\r\n                        stopWordsSection = _a.sent();\r\n                        container.append(stopWordsSection.container.el);\r\n                        if (stopWordsSection.gridOptions) {\r\n                            gridOptions.push(stopWordsSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportSimpleSection_1.ExecutionReportSimpleSection(EXECUTION_REPORT_SECTION.PREPROCESS_QUERY, EXECUTION_REPORT_SECTION.FILTERS, 'Filters').build(this.results.executionReport)];\r\n                    case 7:\r\n                        filtersSection = _a.sent();\r\n                        container.append(filtersSection.container.el);\r\n                        if (filtersSection.gridOptions) {\r\n                            gridOptions.push(filtersSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportSimpleSection_1.ExecutionReportSimpleSection(EXECUTION_REPORT_SECTION.PREPROCESS_QUERY, EXECUTION_REPORT_SECTION.RANKING, 'Ranking').build(this.results.executionReport)];\r\n                    case 8:\r\n                        rankingSection = _a.sent();\r\n                        container.append(rankingSection.container.el);\r\n                        if (rankingSection.gridOptions) {\r\n                            gridOptions.push(rankingSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportSimpleSection_1.ExecutionReportSimpleSection(EXECUTION_REPORT_SECTION.PREPROCESS_QUERY, EXECUTION_REPORT_SECTION.TOP_RESULT, 'Featured Results').build(this.results.executionReport)];\r\n                    case 9:\r\n                        topResultsSection = _a.sent();\r\n                        container.append(topResultsSection.container.el);\r\n                        if (topResultsSection.gridOptions) {\r\n                            gridOptions.push(topResultsSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportITDSection_1.ExecutionReportITDSection().build(this.results.executionReport)];\r\n                    case 10:\r\n                        itdSection = _a.sent();\r\n                        container.append(itdSection.container.el);\r\n                        if (itdSection.gridOptions) {\r\n                            gridOptions.push(itdSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportSimpleSection_1.ExecutionReportSimpleSection(EXECUTION_REPORT_SECTION.PREPROCESS_QUERY, EXECUTION_REPORT_SECTION.RANKING_WEIGHT, 'Ranking weights').build(this.results.executionReport)];\r\n                    case 11:\r\n                        rankingWeightsSection = _a.sent();\r\n                        container.append(rankingWeightsSection.container.el);\r\n                        if (rankingWeightsSection.gridOptions) {\r\n                            gridOptions.push(rankingWeightsSection.gridOptions);\r\n                        }\r\n                        return [4 /*yield*/, new ExecutionReportEffectiveIndexQuerySection_1.ExecutionReportEffectiveIndexQuerySection().build(this.results.executionReport)];\r\n                    case 12:\r\n                        indexQuerySection = _a.sent();\r\n                        container.append(indexQuerySection.container.el);\r\n                        this.gridOptions = {\r\n                            api: {\r\n                                sizeColumnsToFit: function () {\r\n                                    gridOptions.forEach(function (option) { return (option.api ? option.api.sizeColumnsToFit() : null); });\r\n                                }\r\n                            }\r\n                        };\r\n                        return [2 /*return*/, container];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ExecutionReport;\r\n}());\r\nexports.ExecutionReport = ExecutionReport;\r\n\n\n/***/ }),\n\n/***/ 805:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar defaultNullOutput = '-- NULL --';\r\nvar GenericValueOutput = /** @class */ (function () {\r\n    function GenericValueOutput() {\r\n    }\r\n    GenericValueOutput.prototype.output = function (section) {\r\n        if (underscore_1.isArray(section)) {\r\n            return this.arrayJoined(section);\r\n        }\r\n        if (underscore_1.isObject(section)) {\r\n            return this.objectJoined(section);\r\n        }\r\n        return this.simpleValue(section);\r\n    };\r\n    GenericValueOutput.prototype.simpleValue = function (section) {\r\n        return {\r\n            content: this.valueOrNullOutput(section)\r\n        };\r\n    };\r\n    GenericValueOutput.prototype.objectJoined = function (section) {\r\n        var _this = this;\r\n        var content = '';\r\n        underscore_1.each(section, function (value, key) {\r\n            if (underscore_1.isArray(value)) {\r\n                var list = Dom_1.$$('dl');\r\n                list.append(Dom_1.$$('dt', undefined, key).el);\r\n                var innerList = Dom_1.$$('dd', undefined, _this.arrayJoined(value).content);\r\n                list.append(innerList.el);\r\n                content += list.el.outerHTML;\r\n            }\r\n            else if (underscore_1.isObject(value)) {\r\n                content += _this.objectJoined(value).content;\r\n            }\r\n            else {\r\n                var list = Dom_1.$$('dl');\r\n                list.append(Dom_1.$$('dt', undefined, key).el);\r\n                list.append(Dom_1.$$('dd', undefined, _this.valueOrNullOutput(value)).el);\r\n                content += list.el.outerHTML;\r\n            }\r\n        });\r\n        return {\r\n            content: content,\r\n            cellRenderer: TableBuilder_1.GenericHtmlRenderer\r\n        };\r\n    };\r\n    GenericValueOutput.prototype.arrayJoined = function (section) {\r\n        var _this = this;\r\n        if (!section || section.length == 0) {\r\n            return {\r\n                content: defaultNullOutput\r\n            };\r\n        }\r\n        var list = Dom_1.$$('ul', {\r\n            className: 'relevance-inspector-list-output'\r\n        });\r\n        section.forEach(function (sectionValue) {\r\n            if (underscore_1.isObject(sectionValue)) {\r\n                list.append(Dom_1.$$('li', undefined, _this.objectJoined(sectionValue).content).el);\r\n            }\r\n            else {\r\n                list.append(Dom_1.$$('li', undefined, _this.valueOrNullOutput(sectionValue)).el);\r\n            }\r\n        });\r\n        return {\r\n            content: list.el.outerHTML,\r\n            cellRenderer: TableBuilder_1.GenericHtmlRenderer\r\n        };\r\n    };\r\n    GenericValueOutput.prototype.valueOrNullOutput = function (value) {\r\n        if (value != null && value !== '') {\r\n            return value.toString();\r\n        }\r\n        return defaultNullOutput;\r\n    };\r\n    return GenericValueOutput;\r\n}());\r\nexports.GenericValueOutput = GenericValueOutput;\r\n\n\n/***/ }),\n\n/***/ 806:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar ExecutionReportGenericSection = /** @class */ (function () {\r\n    function ExecutionReportGenericSection() {\r\n    }\r\n    ExecutionReportGenericSection.prototype.build = function (executionReportSection) {\r\n        return __assign({}, this.descriptionSection(executionReportSection), this.durationSection(executionReportSection));\r\n    };\r\n    ExecutionReportGenericSection.prototype.descriptionSection = function (executionReportSection) {\r\n        return {\r\n            Description: new GenericValueOutput_1.GenericValueOutput().output(executionReportSection.description)\r\n        };\r\n    };\r\n    ExecutionReportGenericSection.prototype.durationSection = function (executionReportSection) {\r\n        return {\r\n            Duration: new GenericValueOutput_1.GenericValueOutput().output(executionReportSection.duration + \" ms\")\r\n        };\r\n    };\r\n    return ExecutionReportGenericSection;\r\n}());\r\nexports.ExecutionReportGenericSection = ExecutionReportGenericSection;\r\n\n\n/***/ }),\n\n/***/ 807:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar underscore_1 = __webpack_require__(0);\r\nvar StringUtils_1 = __webpack_require__(22);\r\nvar Dom_1 = __webpack_require__(1);\r\nexports.buildListOfTermsElement = function (weightPerTerm) {\r\n    var listItems = underscore_1.map(weightPerTerm, function (value, key) {\r\n        return {\r\n            dt: Dom_1.$$('dt', {\r\n                className: 'coveo-relevance-inspector-dt'\r\n            }, \"\" + key),\r\n            dd: Dom_1.$$('dd', {\r\n                className: 'coveo-relevance-inspector-dd'\r\n            }, \"\" + value)\r\n        };\r\n    });\r\n    var total = underscore_1.reduce(weightPerTerm, function (memo, value) { return memo + value; }, 0);\r\n    var list = Dom_1.$$('dl');\r\n    listItems.forEach(function (item) {\r\n        list.append(item.dt.el);\r\n        list.append(item.dd.el);\r\n    });\r\n    list.append(Dom_1.$$('dt', { className: 'coveo-relevance-inspector-dt' }, \"Total\").el);\r\n    list.append(Dom_1.$$('dd', { className: 'coveo-relevance-inspector-dd coveo-relevance-inspector-highlight' }, \"\" + total).el);\r\n    return list;\r\n};\r\nexports.parseRankingInfo = function (value) {\r\n    var REGEX_EXTRACT_DOCUMENT_WEIGHTS = /Document weights:\\n((?:.)*?)\\n+/g;\r\n    var REGEX_EXTRACT_TERMS_WEIGHTS = /Terms weights:\\n((?:.|\\n)*)\\n+/g;\r\n    var REGEX_EXTRACT_TOTAL_WEIGHTS = /Total weight: ([0-9]+)/g;\r\n    if (value) {\r\n        var docWeightsRegexResult = REGEX_EXTRACT_DOCUMENT_WEIGHTS.exec(value);\r\n        var termsWeightRegexResult = REGEX_EXTRACT_TERMS_WEIGHTS.exec(value);\r\n        var totalWeigthRegexResult = REGEX_EXTRACT_TOTAL_WEIGHTS.exec(value);\r\n        var qreWeights = parseQREWeights(value);\r\n        var documentWeights = parseWeights(docWeightsRegexResult ? docWeightsRegexResult[1] : null);\r\n        var termsWeight = parseTermsWeights(termsWeightRegexResult);\r\n        var totalWeight = totalWeigthRegexResult ? Number(totalWeigthRegexResult[1]) : null;\r\n        return {\r\n            documentWeights: documentWeights,\r\n            termsWeight: termsWeight,\r\n            totalWeight: totalWeight,\r\n            qreWeights: qreWeights\r\n        };\r\n    }\r\n    return null;\r\n};\r\nvar parseWeights = function (value) {\r\n    var REGEX_EXTRACT_LIST_OF_WEIGHTS = /(\\w+(?:\\s\\w+)*): ([-0-9]+)/g;\r\n    var REGEX_EXTRACT_WEIGHT_GROUP = /^(\\w+(?:\\s\\w+)*): ([-0-9]+)$/;\r\n    if (value) {\r\n        var listOfWeight = value.match(REGEX_EXTRACT_LIST_OF_WEIGHTS);\r\n        if (listOfWeight) {\r\n            return underscore_1.object(listOfWeight.map(function (weight) {\r\n                var weightGroup = weight.match(REGEX_EXTRACT_WEIGHT_GROUP);\r\n                if (weightGroup) {\r\n                    var weightAppliedOn = weightGroup[1];\r\n                    var weightValue = weightGroup[2];\r\n                    return [weightAppliedOn, Number(weightValue)];\r\n                }\r\n                return null;\r\n            }));\r\n        }\r\n    }\r\n    return null;\r\n};\r\nvar parseTermsWeights = function (termsWeight) {\r\n    var REGEX_EXTRACT_GROUP_OF_TERMS = /((?:[^:]+: [0-9]+, [0-9]+; )+)\\n((?:\\w+: [0-9]+; )+)/g;\r\n    var REGEX_EXTRACT_SINGLE_TERM = /([^:]+): ([0-9]+), ([0-9]+); /g;\r\n    if (termsWeight && termsWeight[1]) {\r\n        var terms = StringUtils_1.StringUtils.match(termsWeight[1], REGEX_EXTRACT_GROUP_OF_TERMS);\r\n        return underscore_1.object(underscore_1.map(terms, function (term) {\r\n            var words = underscore_1.object(underscore_1.map(StringUtils_1.StringUtils.match(term[1], REGEX_EXTRACT_SINGLE_TERM), function (word) {\r\n                return [\r\n                    word[1],\r\n                    {\r\n                        Correlation: Number(word[2]),\r\n                        'TF-IDF': Number(word[3])\r\n                    }\r\n                ];\r\n            }));\r\n            var weights = parseWeights(term[2]);\r\n            return [\r\n                underscore_1.keys(words).join(', '),\r\n                {\r\n                    terms: words,\r\n                    Weights: weights\r\n                }\r\n            ];\r\n        }));\r\n    }\r\n    return null;\r\n};\r\nvar parseQREWeights = function (value) {\r\n    var REGEX_EXTRACT_QRE_WEIGHTS = /(Expression:\\s\".*\")\\sScore:\\s(?!0)([0-9]+)\\n+/g;\r\n    var qreWeightsRegexResult = REGEX_EXTRACT_QRE_WEIGHTS.exec(value);\r\n    var qreWeights = [];\r\n    while (qreWeightsRegexResult) {\r\n        qreWeights.push({\r\n            expression: qreWeightsRegexResult[1],\r\n            score: parseInt(qreWeightsRegexResult[2], 10)\r\n        });\r\n        qreWeightsRegexResult = REGEX_EXTRACT_QRE_WEIGHTS.exec(value);\r\n    }\r\n    return qreWeights;\r\n};\r\n\n\n/***/ }),\n\n/***/ 808:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar ExecutionReportGenericSection_1 = __webpack_require__(806);\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar ExecutionReportSimpleSection = /** @class */ (function () {\r\n    function ExecutionReportSimpleSection(topLevelProperty, secondLevelProperty, sectionTitle) {\r\n        this.topLevelProperty = topLevelProperty;\r\n        this.secondLevelProperty = secondLevelProperty;\r\n        this.sectionTitle = sectionTitle;\r\n    }\r\n    ExecutionReportSimpleSection.prototype.build = function (executionReport) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var _a, container, agGridElement, gridOptions, topLevelProperty, secondLevelProperty, dataSource, tableBuilder, tableBuilder, _b;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        _a = ExecutionReport_1.ExecutionReport.standardSectionHeader(this.sectionTitle), container = _a.container, agGridElement = _a.agGridElement;\r\n                        topLevelProperty = underscore_1.find(executionReport.children, function (child) {\r\n                            return child.name == _this.topLevelProperty && child.children && underscore_1.findWhere(child.children, { name: _this.secondLevelProperty });\r\n                        });\r\n                        if (!(topLevelProperty && topLevelProperty.children)) return [3 /*break*/, 3];\r\n                        secondLevelProperty = underscore_1.findWhere(topLevelProperty.children, { name: this.secondLevelProperty });\r\n                        if (!secondLevelProperty) return [3 /*break*/, 2];\r\n                        dataSource = [\r\n                            __assign({}, new ExecutionReportGenericSection_1.ExecutionReportGenericSection().build(secondLevelProperty), { Applied: new GenericValueOutput_1.GenericValueOutput().output(secondLevelProperty.applied) })\r\n                        ];\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(dataSource, agGridElement)];\r\n                    case 1:\r\n                        tableBuilder = _c.sent();\r\n                        gridOptions = tableBuilder.gridOptions;\r\n                        _c.label = 2;\r\n                    case 2: return [3 /*break*/, 5];\r\n                    case 3: return [4 /*yield*/, new TableBuilder_1.TableBuilder().build([\r\n                            (_b = {},\r\n                                _b[\"\" + this.sectionTitle] = {\r\n                                    content: \"NO DATA AVAILABLE FOR \" + this.sectionTitle + \" IN CURRENT EXECUTION REPORT\"\r\n                                },\r\n                                _b)\r\n                        ], agGridElement)];\r\n                    case 4:\r\n                        tableBuilder = _c.sent();\r\n                        gridOptions = tableBuilder.gridOptions;\r\n                        _c.label = 5;\r\n                    case 5: return [2 /*return*/, { container: container, gridOptions: gridOptions }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ExecutionReportSimpleSection;\r\n}());\r\nexports.ExecutionReportSimpleSection = ExecutionReportSimpleSection;\r\n\n\n/***/ }),\n\n/***/ 809:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RankingInfoParser_1 = __webpack_require__(807);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar RankingInfoTable = /** @class */ (function () {\r\n    function RankingInfoTable(results, bindings) {\r\n        this.results = results;\r\n        this.bindings = bindings;\r\n    }\r\n    RankingInfoTable.prototype.build = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var container, agGridElement, topLevelInfoThatHaveAtLeastANonZeroValue, containsKeywordRankingInfo, data, gridOptions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        container = Dom_1.$$('div');\r\n                        agGridElement = Dom_1.$$('div', {\r\n                            className: 'ag-theme-fresh'\r\n                        });\r\n                        container.append(agGridElement.el);\r\n                        topLevelInfoThatHaveAtLeastANonZeroValue = [];\r\n                        containsKeywordRankingInfo = false;\r\n                        this.results.forEach(function (result) {\r\n                            var rankingInfo = RankingInfoParser_1.parseRankingInfo(result.rankingInfo);\r\n                            containsKeywordRankingInfo = rankingInfo.termsWeight != null;\r\n                            if (rankingInfo && rankingInfo.documentWeights) {\r\n                                underscore_1.each(rankingInfo.documentWeights, function (value, key) {\r\n                                    if (value != 0) {\r\n                                        topLevelInfoThatHaveAtLeastANonZeroValue.push(key);\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                        topLevelInfoThatHaveAtLeastANonZeroValue = underscore_1.uniq(topLevelInfoThatHaveAtLeastANonZeroValue);\r\n                        data = this.results.map(function (result) {\r\n                            var rankingInfo = RankingInfoParser_1.parseRankingInfo(result.rankingInfo);\r\n                            if (rankingInfo) {\r\n                                var documentsWeights = _this.buildTopLevelDocumentsWeights(rankingInfo, topLevelInfoThatHaveAtLeastANonZeroValue);\r\n                                var breakdownPerTerm_1 = {};\r\n                                var onlyTopFewKeywords_1 = {};\r\n                                underscore_1.chain(rankingInfo.termsWeight)\r\n                                    .keys()\r\n                                    .sortBy(function (key) {\r\n                                    var total = underscore_1.reduce(rankingInfo.termsWeight[key].Weights, function (memo, value) { return memo + value; }, 0);\r\n                                    return total;\r\n                                })\r\n                                    .reverse()\r\n                                    .first(3)\r\n                                    .each(function (key) {\r\n                                    onlyTopFewKeywords_1[key] = rankingInfo.termsWeight[key];\r\n                                });\r\n                                underscore_1.each(onlyTopFewKeywords_1, function (value, key) {\r\n                                    var builtKey = \"Keyword: \" + key;\r\n                                    breakdownPerTerm_1[builtKey] = {\r\n                                        content: RankingInfoParser_1.buildListOfTermsElement(value.Weights).el.outerHTML,\r\n                                        cellRenderer: TableBuilder_1.GenericHtmlRenderer,\r\n                                        width: 200\r\n                                    };\r\n                                });\r\n                                var totalContent = rankingInfo.totalWeight ? rankingInfo.totalWeight : 0;\r\n                                return __assign({}, TableBuilder_1.TableBuilder.thumbnailCell(result, _this.bindings), documentsWeights, breakdownPerTerm_1, { Total: { content: totalContent || 0 } });\r\n                            }\r\n                            return {};\r\n                        });\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(data, agGridElement, {\r\n                                getRowHeight: function () {\r\n                                    return containsKeywordRankingInfo ? 400 : 250;\r\n                                },\r\n                                onGridReady: function (params) {\r\n                                    setTimeout(function () {\r\n                                        if (params) {\r\n                                            params.api.sizeColumnsToFit();\r\n                                            params.api.setSortModel([{ colId: 'Total', sort: 'desc' }]);\r\n                                        }\r\n                                    }, 0);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        gridOptions = (_a.sent()).gridOptions;\r\n                        this.gridOptions = gridOptions;\r\n                        return [2 /*return*/, container];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RankingInfoTable.prototype.buildTopLevelDocumentsWeights = function (rankingInfo, hasAtLeastOneNonZeroValue) {\r\n        var documentWeights = {};\r\n        underscore_1.each(rankingInfo.documentWeights || {}, function (value, key) {\r\n            if (underscore_1.contains(hasAtLeastOneNonZeroValue, key))\r\n                documentWeights[key] = { content: value || 0 };\r\n        });\r\n        return documentWeights;\r\n    };\r\n    return RankingInfoTable;\r\n}());\r\nexports.RankingInfoTable = RankingInfoTable;\r\n\n\n/***/ }),\n\n/***/ 810:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Dom_1 = __webpack_require__(1);\r\nvar isAgGridLoaded = false;\r\nvar isAgGridLoading = null;\r\nvar agGridLibUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ag-grid/16.0.1/ag-grid.min.noStyle.js';\r\nvar agGridStyleBaseUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ag-grid/16.0.1/styles/ag-grid.css';\r\nvar agGridStyleFreshUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ag-grid/16.0.1/styles/ag-theme-fresh.css';\r\n// Should only be used for UT\r\nexports.reset = function (doc) {\r\n    if (doc === void 0) { doc = document; }\r\n    isAgGridLoaded = false;\r\n    isAgGridLoading = null;\r\n};\r\nexports.loadAgGridLibrary = function (doc) {\r\n    if (doc === void 0) { doc = document; }\r\n    return new Promise(function (resolve, reject) {\r\n        if (isAgGridLoaded) {\r\n            resolve(true);\r\n        }\r\n        else if (typeof agGrid !== 'undefined') {\r\n            isAgGridLoaded = true;\r\n            resolve(true);\r\n        }\r\n        else {\r\n            addAgGridScriptsToDocument(doc);\r\n            isAgGridLoading.then(function () { return resolve(true); });\r\n            isAgGridLoading.catch(function () { return reject(false); });\r\n        }\r\n    });\r\n};\r\nvar addAgGridScriptsToDocument = function (doc) {\r\n    if (doc === void 0) { doc = document; }\r\n    if (!isAgGridLoading) {\r\n        var script_1 = Dom_1.$$('script', {\r\n            src: agGridLibUrl,\r\n            type: 'text/javascript',\r\n            async: true\r\n        }).el;\r\n        var styleBase = Dom_1.$$('link', {\r\n            href: agGridStyleBaseUrl,\r\n            rel: 'stylesheet',\r\n            type: 'text/css'\r\n        }).el;\r\n        var style = Dom_1.$$('link', {\r\n            href: agGridStyleFreshUrl,\r\n            rel: 'stylesheet',\r\n            type: 'text/css'\r\n        }).el;\r\n        doc.head.appendChild(script_1);\r\n        doc.head.appendChild(styleBase);\r\n        doc.head.appendChild(style);\r\n        isAgGridLoading = new Promise(function (resolveScriptLoaded, rejectScriptLoaded) {\r\n            script_1.onload = function () {\r\n                resolveScriptLoaded(true);\r\n            };\r\n            script_1.onerror = function () {\r\n                isAgGridLoaded = false;\r\n                rejectScriptLoaded(false);\r\n            };\r\n        });\r\n    }\r\n};\r\n\n\n/***/ }),\n\n/***/ 811:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar StringUtils_1 = __webpack_require__(22);\r\nvar DateUtils_1 = __webpack_require__(32);\r\nvar TextInput_1 = __webpack_require__(54);\r\nvar MetaDataTable = /** @class */ (function () {\r\n    function MetaDataTable(results, bindings) {\r\n        this.results = results;\r\n        this.bindings = bindings;\r\n    }\r\n    MetaDataTable.prototype.build = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var fieldsDescription, container, builders, builtTables, textInput;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.bindings.queryController) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, this.bindings.queryController.getEndpoint().listFields()];\r\n                    case 1:\r\n                        fieldsDescription = _a.sent();\r\n                        container = Dom_1.$$('div', {\r\n                            className: 'metadata-table'\r\n                        });\r\n                        builders = this.results.map(function (result) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var nestedContainer, nestedAgGrid, thumbnail, fields;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0:\r\n                                        nestedContainer = Dom_1.$$('div');\r\n                                        container.append(nestedContainer.el);\r\n                                        nestedAgGrid = Dom_1.$$('div', {\r\n                                            className: 'ag-theme-fresh'\r\n                                        });\r\n                                        nestedContainer.append(nestedAgGrid.el);\r\n                                        thumbnail = TableBuilder_1.TableBuilder.thumbnailCell(result, this.bindings);\r\n                                        fields = {};\r\n                                        fields[\"Fields Values\"] = {\r\n                                            content: { result: result, fieldsDescription: fieldsDescription },\r\n                                            cellRenderer: FieldValuesRenderer,\r\n                                            width: 900,\r\n                                            getQuickFilterText: function (params) {\r\n                                                var allValues = underscore_1.map(params.value.result.raw, function (val) { return val.toString(); });\r\n                                                return Object.keys(params.value.result.raw)\r\n                                                    .concat(allValues)\r\n                                                    .join(' ');\r\n                                            },\r\n                                            onCellDoubleClicked: function (params) {\r\n                                                var el = params.event ? params.event.target : null;\r\n                                                if (el && window.getSelection && document.createRange) {\r\n                                                    var selection = window.getSelection();\r\n                                                    var range = document.createRange();\r\n                                                    range.selectNodeContents(el);\r\n                                                    selection.removeAllRanges();\r\n                                                    selection.addRange(range);\r\n                                                }\r\n                                            }\r\n                                        };\r\n                                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build([\r\n                                                __assign({}, thumbnail, fields)\r\n                                            ], nestedAgGrid, {\r\n                                                rowHeight: 400\r\n                                            })];\r\n                                    case 1: return [2 /*return*/, _a.sent()];\r\n                                }\r\n                            });\r\n                        }); });\r\n                        this.gridOptions = {\r\n                            api: {\r\n                                sizeColumnsToFit: function () {\r\n                                    builtTables.forEach(function (built) { return (built.gridOptions.api ? built.gridOptions.api.sizeColumnsToFit : null); });\r\n                                }\r\n                            }\r\n                        };\r\n                        return [4 /*yield*/, Promise.all(builders)];\r\n                    case 2:\r\n                        builtTables = _a.sent();\r\n                        textInput = new TextInput_1.TextInput(function (input) {\r\n                            builtTables.forEach(function (built) {\r\n                                var api = built.gridOptions && built.gridOptions.api;\r\n                                if (api) {\r\n                                    api.setQuickFilter(input.getValue());\r\n                                    api.onRowHeightChanged();\r\n                                }\r\n                            });\r\n                        }, 'Filters on Fields Values');\r\n                        container.prepend(textInput.getElement());\r\n                        return [2 /*return*/, container];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return MetaDataTable;\r\n}());\r\nexports.MetaDataTable = MetaDataTable;\r\nvar FieldValuesRenderer = /** @class */ (function () {\r\n    function FieldValuesRenderer() {\r\n    }\r\n    FieldValuesRenderer.prototype.init = function (params) {\r\n        this.element = params.value;\r\n        this.params = params;\r\n        this.currentFilter = params.api.filterManager.quickFilter;\r\n        params.value.el = this.listAsInput(this.element.result);\r\n    };\r\n    FieldValuesRenderer.prototype.getGui = function () {\r\n        if (this.element) {\r\n            var list = this.listAsInput(this.element.result);\r\n            this.params.eParentOfValue.appendChild(list.el);\r\n            var height = Math.max(list.height() + 50, 200);\r\n            var maxHeight = Math.min(height, 5000);\r\n            this.params.node.setRowHeight(maxHeight);\r\n            return Dom_1.$$('div', undefined, list).el;\r\n        }\r\n        return Dom_1.$$('div', undefined, 'N.A').el;\r\n    };\r\n    FieldValuesRenderer.prototype.listAsInput = function (result) {\r\n        var _this = this;\r\n        var container = Dom_1.$$('div');\r\n        underscore_1.each(result.raw, function (value, fieldInResult) {\r\n            if (fieldInResult == 'allmetadatavalues' || fieldInResult.indexOf('sys') == 0) {\r\n                return;\r\n            }\r\n            if (_this.isCurrentElementFilteredOut(value, fieldInResult)) {\r\n                return;\r\n            }\r\n            var inputGroup = Dom_1.$$('div', { className: 'coveo-relevance-inspector-input-group' });\r\n            var fieldName = Dom_1.$$('div', {\r\n                className: 'coveo-relevance-inspector-metadata-name'\r\n            }, fieldInResult);\r\n            var fieldValue = _this.convertFieldValueToReadableFormat(result, fieldInResult);\r\n            var fieldValueElement = Dom_1.$$('div', {\r\n                className: 'coveo-relevance-inspector-metadata-value'\r\n            }, fieldValue);\r\n            if (_this.currentFilter) {\r\n                _this.highlightSearch(fieldName.el, _this.currentFilter);\r\n                _this.highlightSearch(fieldValueElement.el, _this.currentFilter);\r\n            }\r\n            inputGroup.append(fieldName.el);\r\n            inputGroup.append(fieldValueElement.el);\r\n            container.append(inputGroup.el);\r\n        });\r\n        return container;\r\n    };\r\n    FieldValuesRenderer.prototype.isCurrentElementFilteredOut = function (value, fieldInResult) {\r\n        if (this.currentFilter) {\r\n            var matchInFieldName = fieldInResult.toLowerCase().indexOf(this.currentFilter.toLowerCase()) != -1;\r\n            var matchInFieldValue = value\r\n                ? value\r\n                    .toString()\r\n                    .toLowerCase()\r\n                    .indexOf(this.currentFilter.toLowerCase()) != -1\r\n                : false;\r\n            if (!matchInFieldName && !matchInFieldValue) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    FieldValuesRenderer.prototype.convertFieldValueToReadableFormat = function (result, fieldInResult) {\r\n        var fieldValue = result.raw[fieldInResult].toString();\r\n        if (this.element.fieldsDescription) {\r\n            var matchingFieldDescription = underscore_1.find(this.element.fieldsDescription, function (description) {\r\n                return description.name.replace('@', '').toLowerCase() == fieldInResult;\r\n            });\r\n            if (matchingFieldDescription && matchingFieldDescription.fieldType == 'Date') {\r\n                fieldValue = DateUtils_1.DateUtils.convertToStandardDate(fieldValue).toString() + \" ( Epoch : \" + fieldValue + \" )\";\r\n            }\r\n        }\r\n        return fieldValue;\r\n    };\r\n    FieldValuesRenderer.prototype.highlightSearch = function (elementToSearch, search) {\r\n        var asHTMLElement = elementToSearch;\r\n        if (asHTMLElement != null && asHTMLElement.innerText != null) {\r\n            var match = asHTMLElement.innerText.split(new RegExp('(?=' + StringUtils_1.StringUtils.regexEncode(search) + ')', 'gi'));\r\n            asHTMLElement.innerHTML = '';\r\n            match.forEach(function (value) {\r\n                var regex = new RegExp('(' + StringUtils_1.StringUtils.regexEncode(search) + ')', 'i');\r\n                var group = value.match(regex);\r\n                var span;\r\n                if (group != null) {\r\n                    span = Dom_1.$$('span', {\r\n                        className: 'coveo-relevance-inspector-highlight'\r\n                    });\r\n                    span.text(group[1]);\r\n                    asHTMLElement.appendChild(span.el);\r\n                    span = Dom_1.$$('span');\r\n                    span.text(value.substr(group[1].length));\r\n                    asHTMLElement.appendChild(span.el);\r\n                }\r\n                else {\r\n                    span = Dom_1.$$('span');\r\n                    span.text(value);\r\n                    asHTMLElement.appendChild(span.el);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    FieldValuesRenderer.prototype.refresh = function (params) {\r\n        return true;\r\n    };\r\n    return FieldValuesRenderer;\r\n}());\r\nexports.FieldValuesRenderer = FieldValuesRenderer;\r\n\n\n/***/ }),\n\n/***/ 812:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Dom_1 = __webpack_require__(1);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar RelevanceInspectorTabs = /** @class */ (function () {\r\n    function RelevanceInspectorTabs(onTabChange) {\r\n        this.onTabChange = onTabChange;\r\n        this.navigationSection = Dom_1.$$('div', {\r\n            className: 'coveo-relevance-inspector-tab-navigation-section'\r\n        });\r\n        this.tabContentSection = Dom_1.$$('div', {\r\n            className: 'coveo-relevance-inspector-tab-content-section'\r\n        });\r\n        this.navigationElements = [];\r\n        this.tabContentElements = [];\r\n    }\r\n    RelevanceInspectorTabs.prototype.select = function (id) {\r\n        var navElementToActivate = this.findNavigationById(id);\r\n        var tabContentToActivate = this.findTabContentById(id);\r\n        if (navElementToActivate && tabContentToActivate) {\r\n            this.activateTabNavigation(navElementToActivate);\r\n            this.activateTabContent(tabContentToActivate);\r\n            if (this.onTabChange) {\r\n                this.onTabChange(id);\r\n            }\r\n        }\r\n    };\r\n    RelevanceInspectorTabs.prototype.addNavigation = function (caption, id) {\r\n        var _this = this;\r\n        var navigationElement = Dom_1.$$('div', {\r\n            id: id,\r\n            className: 'coveo-relevance-inspector-tab'\r\n        }, caption);\r\n        navigationElement.on('click', function () { return _this.select(id); });\r\n        this.navigationElements.push(navigationElement);\r\n        this.navigationSection.append(navigationElement.el);\r\n        return this;\r\n    };\r\n    RelevanceInspectorTabs.prototype.addContent = function (content, targetId) {\r\n        var tabContent = Dom_1.$$('div', {\r\n            className: 'coveo-relevance-inspector-tab-content',\r\n            'data-target-tab': targetId\r\n        });\r\n        tabContent.append(content.el);\r\n        this.tabContentElements.push(tabContent);\r\n        this.tabContentSection.append(tabContent.el);\r\n        return this;\r\n    };\r\n    RelevanceInspectorTabs.prototype.addSection = function (caption, content, id) {\r\n        return this.addNavigation(caption, id).addContent(content, id);\r\n    };\r\n    RelevanceInspectorTabs.prototype.findNavigationById = function (id) {\r\n        return underscore_1.find(this.navigationElements, function (element) { return element.getAttribute('id') == id; });\r\n    };\r\n    RelevanceInspectorTabs.prototype.findTabContentById = function (id) {\r\n        return underscore_1.find(this.tabContentElements, function (tabContentElement) { return tabContentElement.getAttribute('data-target-tab') == id; });\r\n    };\r\n    RelevanceInspectorTabs.prototype.activateTabNavigation = function (navigationElement) {\r\n        this.navigationElements.forEach(function (element) {\r\n            element.removeClass('coveo-selected');\r\n        });\r\n        navigationElement.addClass('coveo-selected');\r\n    };\r\n    RelevanceInspectorTabs.prototype.activateTabContent = function (contentElement) {\r\n        this.tabContentElements.forEach(function (element) {\r\n            element.removeClass('coveo-selected');\r\n        });\r\n        contentElement.addClass('coveo-selected');\r\n    };\r\n    return RelevanceInspectorTabs;\r\n}());\r\nexports.RelevanceInspectorTabs = RelevanceInspectorTabs;\r\n\n\n/***/ }),\n\n/***/ 813:\n/***/ (function(module, exports, __webpack_require__) {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(814);\nif(typeof content === 'string') content = [[module.i, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {\"hmr\":true}\noptions.transform = transform\n// add the styles to the DOM\nvar update = __webpack_require__(705)(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(false) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../node_modules/css-loader/index.js??ref--0-2!../node_modules/resolve-url-loader/index.js??ref--0-3!../node_modules/sass-loader/lib/loader.js??ref--0-4!./_RelevanceInspector.scss\", function() {\n\t\t\tvar newContent = require(\"!!../node_modules/css-loader/index.js??ref--0-2!../node_modules/resolve-url-loader/index.js??ref--0-3!../node_modules/sass-loader/lib/loader.js??ref--0-4!./_RelevanceInspector.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}\n\n/***/ }),\n\n/***/ 814:\n/***/ (function(module, exports, __webpack_require__) {\n\nexports = module.exports = __webpack_require__(704)();\n// imports\n\n\n// module\nexports.push([module.i, \"@keyframes fadeout{0%{opacity:1}to{opacity:0}}@keyframes fadein{0%{opacity:0}to{opacity:1}}@keyframes slideInLeft{0%{transform:translateX(-2000px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes coveo-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes loadingFade{0%{opacity:0}50%{opacity:.8}to{opacity:0}}.coveo-relevance-inspector{text-align:center;padding:10px;line-height:20px;height:40px;top:0;z-index:1000}.coveo-relevance-inspector.coveo-hidden{display:none}.relevance-inspector-modal .coveo-logo{height:64px;width:178px}.ag-theme-fresh .ag-cell{overflow:auto;white-space:normal;word-break:break-word}.ag-theme-fresh .ag-font-style{user-select:auto}.coveo-relevance-inspector-tab-navigation-section{margin-bottom:20px}.coveo-relevance-inspector-tab-content{display:none}.coveo-relevance-inspector-tab-content.coveo-selected{display:block;animation:slideInLeft .3s ease-in}.coveo-relevance-inspector-tab{display:-moz-flex;display:-ms-flexbox;display:flex;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;font-size:12px;font-weight:700;padding:0 5px 10px;border-bottom:1px solid #bcc3ca;text-transform:uppercase;border-bottom:2px solid #bcc3ca;display:inline-block;margin-right:10px}.coveo-relevance-inspector-tab.coveo-selected,.coveo-relevance-inspector-tab.coveo-selected:hover{border-bottom:2px solid #263e55}.coveo-relevance-inspector-tab:hover{color:#263e55}.coveo-relevance-inspector-highlight{display:inline-block;font-weight:700}.coveo-relevance-inspector-result-thumbnail{min-width:500px;white-space:normal}.coveo-relevance-inspector-dt{font-weight:700}.coveo-relevance-inspector-dd,.coveo-relevance-inspector-dt{font-size:14px;line-height:14px;padding:2px 0 4px}.coveo-relevance-inspector-metadata-name,.coveo-relevance-inspector-metadata-value{background-color:#e9ecef;display:block;padding:10px;line-height:1.5;border:1px solid #ced4da;border-radius:2px;position:relative;flex:1 1 auto;margin-bottom:0}.coveo-relevance-inspector-metadata-name{max-width:25%;min-width:25%}.coveo-relevance-inspector-metadata-value{width:75%;overflow:auto}.coveo-relevance-inspector-input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.coveo-relevance-inspector-tab-content .coveo-input{margin:40px 0 10px}.coveo-relevance-inspector-available-fields-popup{background:#fff;border:1px solid #bcc3ca;border-radius:2px;padding:10px 5px 10px 20px;width:200px;overflow:hidden;list-style-type:none}.coveo-relevance-inspector-available-fields-popup-value{padding:0 0 10px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.coveo-available-fields-table-button{overflow:hidden;display:inline-block;position:relative;top:50%;transform:translateY(-50%)}.coveo-relevance-inspector-effective-query-collapsible{display:none}.coveo-relevance-inspector-effective-query-collapsible.coveo-active{display:inherit}.coveo-relevance-inspector-table{width:100%;text-align:left;border:none;border-spacing:0}.coveo-relevance-inspector-table tr{height:37px;font-size:15px;line-height:18px}.coveo-relevance-inspector-table tr:first-child{padding-left:10px}.coveo-relevance-inspector-table tr:hover td{background-color:#e6ecf0}.coveo-relevance-inspector-table td{position:relative;vertical-align:middle;padding:9px 15px;margin-left:15px;text-align:left;border-bottom:1px solid #bcc3ca}.coveo-relevance-inspector-table td:first-child{border-left:5px solid transparent}.coveo-relevance-inspector-inline-ranking{border:1px solid #bcc3ca;border-radius:2px;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:10px;margin-bottom:10px}.coveo-relevance-inspector-inline-ranking-section{margin:10px}.coveo-relevance-inspector-inline-ranking-terms{display:none;padding:10px;width:100%}.coveo-relevance-inspector-inline-ranking-terms.coveo-active{display:block;animation:fadein .5s}.coveo-relevance-inspector-inline-ranking-terms h2{border-bottom:1px solid #bcc3ca}.coveo-relevance-inspector-inline-ranking-terms dl{display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center}.coveo-relevance-inspector-inline-ranking-terms dt{margin:10px 20px}.coveo-relevance-inspector-inline-ranking-terms dd{margin-left:0}.coveo-relevance-inspector-inline-ranking-button{height:35px;margin:5px 0}.relevance-inspector-list-output{padding-left:5px;margin-top:0}.coveo-relevance-inspector-inline-ranking-qre-expression{font-weight:700;word-break:break-all}\", \"\"]);\n\n// exports\n\n\n/***/ }),\n\n/***/ 815:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar ExecutionReportGenericSection_1 = __webpack_require__(806);\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar ExecutionReportAuthenticationSection = /** @class */ (function () {\r\n    function ExecutionReportAuthenticationSection() {\r\n    }\r\n    ExecutionReportAuthenticationSection.prototype.build = function (executionReport) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, container, agGridElement, gridOptions, authenticationSection, dataSource, tableBuilder;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = ExecutionReport_1.ExecutionReport.standardSectionHeader('Authentication'), container = _a.container, agGridElement = _a.agGridElement;\r\n                        authenticationSection = underscore_1.find(executionReport.children, function (child) { return child.name == ExecutionReport_1.EXECUTION_REPORT_SECTION.PERFORM_AUTHENTICATION; });\r\n                        if (!authenticationSection) return [3 /*break*/, 2];\r\n                        dataSource = [\r\n                            __assign({}, new ExecutionReportGenericSection_1.ExecutionReportGenericSection().build(authenticationSection), this.configurationSection(authenticationSection), this.pipelineOuputSection(authenticationSection))\r\n                        ];\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(dataSource, agGridElement, {\r\n                                rowHeight: 150\r\n                            })];\r\n                    case 1:\r\n                        tableBuilder = _b.sent();\r\n                        gridOptions = tableBuilder.gridOptions;\r\n                        _b.label = 2;\r\n                    case 2: return [2 /*return*/, { container: container, gridOptions: gridOptions }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ExecutionReportAuthenticationSection.prototype.configurationSection = function (authenticationSection) {\r\n        return {\r\n            Configured: {\r\n                children: [\r\n                    {\r\n                        Primary: this.genericOutput(authenticationSection.configured.primary),\r\n                        Secondary: this.genericOutput(authenticationSection.configured.secondary),\r\n                        Mandatory: this.genericOutput(authenticationSection.configured.mandatory)\r\n                    }\r\n                ]\r\n            }\r\n        };\r\n    };\r\n    ExecutionReportAuthenticationSection.prototype.pipelineOuputSection = function (authenticationSection) {\r\n        return {\r\n            'Pipeline Output': {\r\n                children: [\r\n                    {\r\n                        'User ids': {\r\n                            children: this.usersIds(authenticationSection.result.userIds)\r\n                        },\r\n                        'Query restriction': {\r\n                            children: this.queryRestrictions(authenticationSection.result.queryRestrictions)\r\n                        },\r\n                        Roles: __assign({}, this.genericOutput(authenticationSection.result.roles), { width: 200 }),\r\n                        'User groups': this.genericOutput(authenticationSection.result.userGroups)\r\n                    }\r\n                ]\r\n            }\r\n        };\r\n    };\r\n    ExecutionReportAuthenticationSection.prototype.usersIds = function (userIds) {\r\n        var _this = this;\r\n        return underscore_1.map(userIds, function (userId) {\r\n            return _a = {},\r\n                _a[userId.name] = {\r\n                    children: [\r\n                        {\r\n                            Kind: _this.genericOutput(userId.kind),\r\n                            Provider: __assign({}, _this.genericOutput(userId.provider), { width: 150 }),\r\n                            Info: { content: userId.info }\r\n                        }\r\n                    ]\r\n                },\r\n                _a;\r\n            var _a;\r\n        });\r\n    };\r\n    ExecutionReportAuthenticationSection.prototype.genericOutput = function (section) {\r\n        return new GenericValueOutput_1.GenericValueOutput().output(section);\r\n    };\r\n    ExecutionReportAuthenticationSection.prototype.queryRestrictions = function (queryRestrictions) {\r\n        var _this = this;\r\n        return underscore_1.map(queryRestrictions, function (value, key) {\r\n            return _a = {},\r\n                _a[key] = _this.genericOutput(value),\r\n                _a;\r\n            var _a;\r\n        });\r\n    };\r\n    return ExecutionReportAuthenticationSection;\r\n}());\r\nexports.ExecutionReportAuthenticationSection = ExecutionReportAuthenticationSection;\r\n\n\n/***/ }),\n\n/***/ 816:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar ExecutionReportGenericSection_1 = __webpack_require__(806);\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar ExecutionReportResolvedPipelineSection = /** @class */ (function () {\r\n    function ExecutionReportResolvedPipelineSection() {\r\n    }\r\n    ExecutionReportResolvedPipelineSection.prototype.build = function (executionReport) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, container, agGridElement, gridOptions, resolvedPipelineSection, dataSource, tableBuilder;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = ExecutionReport_1.ExecutionReport.standardSectionHeader('Pipeline'), container = _a.container, agGridElement = _a.agGridElement;\r\n                        resolvedPipelineSection = underscore_1.find(executionReport.children, function (child) { return child.name == ExecutionReport_1.EXECUTION_REPORT_SECTION.RESOLVE_PIPELINE; });\r\n                        if (!resolvedPipelineSection) return [3 /*break*/, 2];\r\n                        dataSource = [\r\n                            __assign({}, new ExecutionReportGenericSection_1.ExecutionReportGenericSection().build(resolvedPipelineSection), { Pipeline: new GenericValueOutput_1.GenericValueOutput().output(resolvedPipelineSection.result.pipeline) }, { 'Split Test': new GenericValueOutput_1.GenericValueOutput().output(resolvedPipelineSection.result.splitTest) })\r\n                        ];\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(dataSource, agGridElement)];\r\n                    case 1:\r\n                        tableBuilder = _b.sent();\r\n                        gridOptions = tableBuilder.gridOptions;\r\n                        _b.label = 2;\r\n                    case 2: return [2 /*return*/, { container: container, gridOptions: gridOptions }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ExecutionReportResolvedPipelineSection;\r\n}());\r\nexports.ExecutionReportResolvedPipelineSection = ExecutionReportResolvedPipelineSection;\r\n\n\n/***/ }),\n\n/***/ 817:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar ExecutionReportGenericSection_1 = __webpack_require__(806);\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar ExecutionReportQueryOverrideSection = /** @class */ (function () {\r\n    function ExecutionReportQueryOverrideSection() {\r\n    }\r\n    ExecutionReportQueryOverrideSection.prototype.build = function (executionReport) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, container, agGridElement, gridOptions, queryOverrideSection, dataSource, tableBuilder;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = ExecutionReport_1.ExecutionReport.standardSectionHeader('Query Params Override'), container = _a.container, agGridElement = _a.agGridElement;\r\n                        queryOverrideSection = underscore_1.find(executionReport.children, function (child) { return child.name == ExecutionReport_1.EXECUTION_REPORT_SECTION.QUERY_PARAM_OVERRIDE; });\r\n                        if (!queryOverrideSection) return [3 /*break*/, 2];\r\n                        dataSource = [\r\n                            __assign({}, new ExecutionReportGenericSection_1.ExecutionReportGenericSection().build(queryOverrideSection), { Applied: new GenericValueOutput_1.GenericValueOutput().output(queryOverrideSection.applied) })\r\n                        ];\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(dataSource, agGridElement)];\r\n                    case 1:\r\n                        tableBuilder = _b.sent();\r\n                        gridOptions = tableBuilder.gridOptions;\r\n                        _b.label = 2;\r\n                    case 2: return [2 /*return*/, { container: container, gridOptions: gridOptions }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ExecutionReportQueryOverrideSection;\r\n}());\r\nexports.ExecutionReportQueryOverrideSection = ExecutionReportQueryOverrideSection;\r\n\n\n/***/ }),\n\n/***/ 818:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar collapsibleSectionsInReport = ['Facets', 'RankingOverrides', 'RankingExpressions'];\r\nvar ExecutionReportEffectiveIndexQuerySection = /** @class */ (function () {\r\n    function ExecutionReportEffectiveIndexQuerySection() {\r\n    }\r\n    ExecutionReportEffectiveIndexQuerySection.prototype.build = function (executionReport) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var container, table, indexQuerySection;\r\n            return __generator(this, function (_a) {\r\n                container = ExecutionReport_1.ExecutionReport.standardSectionHeader('Query sent to index').container;\r\n                table = Dom_1.$$('table', {\r\n                    className: 'coveo-relevance-inspector-table'\r\n                });\r\n                container.append(table.el);\r\n                indexQuerySection = underscore_1.findWhere(executionReport.children, { description: ExecutionReport_1.EXECUTION_REPORT_SECTION.INDEX_QUERY });\r\n                if (indexQuerySection) {\r\n                    underscore_1.each(indexQuerySection.result.in, function (paramValue, paramKey) {\r\n                        var row = Dom_1.$$('tr');\r\n                        table.append(row.el);\r\n                        var id = \"executionReportIndexExecution\" + paramKey;\r\n                        if (underscore_1.contains(collapsibleSectionsInReport, paramKey) && paramValue) {\r\n                            var btn = Dom_1.$$('button', {\r\n                                className: 'coveo-button'\r\n                            }, paramKey);\r\n                            var tdTarget_1 = Dom_1.$$('td', {\r\n                                id: id,\r\n                                className: 'coveo-relevance-inspector-effective-query-collapsible'\r\n                            }, new GenericValueOutput_1.GenericValueOutput().output(paramValue).content);\r\n                            btn.on('click', function () {\r\n                                tdTarget_1.toggleClass('coveo-active');\r\n                            });\r\n                            row.append(Dom_1.$$('td', undefined, btn).el);\r\n                            row.append(tdTarget_1.el);\r\n                        }\r\n                        else {\r\n                            row.append(Dom_1.$$('td', undefined, paramKey).el);\r\n                            row.append(Dom_1.$$('td', undefined, new GenericValueOutput_1.GenericValueOutput().output(paramValue).content).el);\r\n                        }\r\n                    });\r\n                }\r\n                return [2 /*return*/, { container: container }];\r\n            });\r\n        });\r\n    };\r\n    return ExecutionReportEffectiveIndexQuerySection;\r\n}());\r\nexports.ExecutionReportEffectiveIndexQuerySection = ExecutionReportEffectiveIndexQuerySection;\r\n\n\n/***/ }),\n\n/***/ 819:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar QueryBuilder_1 = __webpack_require__(46);\r\nvar ExecutionReportRankingModifiers = /** @class */ (function () {\r\n    function ExecutionReportRankingModifiers() {\r\n    }\r\n    ExecutionReportRankingModifiers.prototype.build = function (results, rankingExpressions, bindings) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var _a, container, agGridElement, dataSourcePromises, dataSource, gridOptions;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = ExecutionReport_1.ExecutionReport.standardSectionHeader('Ranking Modifiers & Machine Learning Boosts'), container = _a.container, agGridElement = _a.agGridElement;\r\n                        dataSourcePromises = underscore_1.map(rankingExpressions, function (rankingExpression) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var isAutomaticBoostRegex, thumbnailPreview, returnedByIndexForCurrentQuery, result, isAutomaticBoost, permanentIDUsedInAutomaticBoost, extracted;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0:\r\n                                        isAutomaticBoostRegex = /^(@permanentid|@urihash)=\"?([a-zA-Z0-9]+)\"?$/;\r\n                                        thumbnailPreview = TableBuilder_1.TableBuilder.thumbnailCell(null, null);\r\n                                        returnedByIndexForCurrentQuery = '-- NULL --';\r\n                                        result = null;\r\n                                        isAutomaticBoost = rankingExpression.expression.match(isAutomaticBoostRegex);\r\n                                        if (!isAutomaticBoost) return [3 /*break*/, 2];\r\n                                        permanentIDUsedInAutomaticBoost = isAutomaticBoost[2];\r\n                                        return [4 /*yield*/, this.extractDocumentInfoFromBoost(results, permanentIDUsedInAutomaticBoost, rankingExpression, bindings)];\r\n                                    case 1:\r\n                                        extracted = _a.sent();\r\n                                        thumbnailPreview = TableBuilder_1.TableBuilder.thumbnailCell(extracted.result, bindings);\r\n                                        result = extracted.result;\r\n                                        returnedByIndexForCurrentQuery = extracted.returnedByIndexForCurrentQuery.toString();\r\n                                        _a.label = 2;\r\n                                    case 2: return [2 /*return*/, __assign({}, thumbnailPreview, { ReturnedByIndexForCurrentQuery: new GenericValueOutput_1.GenericValueOutput().output(returnedByIndexForCurrentQuery), IsRecommendation: new GenericValueOutput_1.GenericValueOutput().output(result ? result.isRecommendation : '-- NULL --'), Expression: __assign({}, new GenericValueOutput_1.GenericValueOutput().output(rankingExpression.expression), { width: 150 }), Modifier: new GenericValueOutput_1.GenericValueOutput().output(rankingExpression.modifier) })];\r\n                                }\r\n                            });\r\n                        }); });\r\n                        return [4 /*yield*/, Promise.all(dataSourcePromises)];\r\n                    case 1:\r\n                        dataSource = _b.sent();\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(dataSource, agGridElement, {\r\n                                rowHeight: 150\r\n                            })];\r\n                    case 2:\r\n                        gridOptions = (_b.sent()).gridOptions;\r\n                        return [2 /*return*/, {\r\n                                container: container,\r\n                                gridOptions: gridOptions\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ExecutionReportRankingModifiers.prototype.extractDocumentInfoFromBoost = function (results, permanentID, rankingExpression, bindings) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var matchingResult, resultInResultSet, queryBuilder, resultsFromIndex;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        matchingResult = {\r\n                            result: null,\r\n                            returnedByIndexForCurrentQuery: false\r\n                        };\r\n                        resultInResultSet = underscore_1.find(results, function (result) {\r\n                            return result.raw.permanentid == permanentID || result.raw.urihash == permanentID;\r\n                        });\r\n                        if (resultInResultSet) {\r\n                            matchingResult = {\r\n                                result: resultInResultSet,\r\n                                returnedByIndexForCurrentQuery: true\r\n                            };\r\n                            return [2 /*return*/, matchingResult];\r\n                        }\r\n                        queryBuilder = new QueryBuilder_1.QueryBuilder();\r\n                        queryBuilder.advancedExpression.add(rankingExpression.expression);\r\n                        return [4 /*yield*/, bindings.queryController.getEndpoint().search(queryBuilder.build())];\r\n                    case 1:\r\n                        resultsFromIndex = _a.sent();\r\n                        matchingResult = {\r\n                            result: resultsFromIndex.results[0],\r\n                            returnedByIndexForCurrentQuery: false\r\n                        };\r\n                        return [2 /*return*/, matchingResult];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ExecutionReportRankingModifiers;\r\n}());\r\nexports.ExecutionReportRankingModifiers = ExecutionReportRankingModifiers;\r\n\n\n/***/ }),\n\n/***/ 820:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ExecutionReport_1 = __webpack_require__(804);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar StreamHighlightUtils_1 = __webpack_require__(114);\r\nvar ExecutionReportSimpleSection_1 = __webpack_require__(808);\r\nvar ExecutionReportITDSection = /** @class */ (function () {\r\n    function ExecutionReportITDSection() {\r\n    }\r\n    ExecutionReportITDSection.prototype.build = function (executionReport) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var preprocessQuerySection, originalLongQuery, topClicksSection, _a, container, agGridElement, gridOptions, dataSource, tableBuilder;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        preprocessQuerySection = underscore_1.find(executionReport.children, function (child) { return child.name == ExecutionReport_1.EXECUTION_REPORT_SECTION.PREPROCESS_QUERY; });\r\n                        if (!preprocessQuerySection) {\r\n                            return [2 /*return*/, this.buildFallbackEmptyTable(executionReport)];\r\n                        }\r\n                        originalLongQuery = preprocessQuerySection.result.in.lq;\r\n                        topClicksSection = underscore_1.find(preprocessQuerySection.children, function (child) { return child.name == ExecutionReport_1.EXECUTION_REPORT_SECTION.TOP_CLICKS; });\r\n                        if (!topClicksSection || !originalLongQuery) {\r\n                            return [2 /*return*/, this.buildFallbackEmptyTable(executionReport)];\r\n                        }\r\n                        _a = ExecutionReport_1.ExecutionReport.standardSectionHeader('Large Query Intelligent Term Detection (ITD)'), container = _a.container, agGridElement = _a.agGridElement;\r\n                        dataSource = [\r\n                            {\r\n                                'Original large query': this.buildOriginalLongQueryCell(originalLongQuery, topClicksSection.refinedQueries),\r\n                                'Keyword(s) extracted': this.buildRefinedQueryCell(executionReport, topClicksSection.refinedQueries, preprocessQuerySection)\r\n                            }\r\n                        ];\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(dataSource, agGridElement, {\r\n                                rowHeight: 300\r\n                            })];\r\n                    case 1:\r\n                        tableBuilder = _b.sent();\r\n                        gridOptions = tableBuilder.gridOptions;\r\n                        return [2 /*return*/, { container: container, gridOptions: gridOptions }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ExecutionReportITDSection.prototype.doHighlights = function (originalLongQuery, refinedQueries) {\r\n        var termsToHighlight = {};\r\n        underscore_1.each(refinedQueries, function (refined) {\r\n            termsToHighlight[refined.q] = [];\r\n        });\r\n        return StreamHighlightUtils_1.StreamHighlightUtils.highlightStreamText(originalLongQuery, termsToHighlight, {});\r\n    };\r\n    ExecutionReportITDSection.prototype.buildOriginalLongQueryCell = function (originalLongQuery, refinedQueries) {\r\n        return {\r\n            content: this.doHighlights(originalLongQuery, refinedQueries),\r\n            cellRenderer: TableBuilder_1.GenericHtmlRenderer\r\n        };\r\n    };\r\n    ExecutionReportITDSection.prototype.buildRefinedQueryCell = function (executionReport, refinedQueries, preprocessSection) {\r\n        if (Utils_1.Utils.isNonEmptyArray(refinedQueries)) {\r\n            return this.buildRefinedQueryByMLCell(refinedQueries);\r\n        }\r\n        var fallbackIndexPartialMatch = underscore_1.find(preprocessSection.children, function (child) { return child.name == ExecutionReport_1.EXECUTION_REPORT_SECTION.PARTIAL_MATCH; });\r\n        var isUsingPartialMatch = fallbackIndexPartialMatch ? fallbackIndexPartialMatch.result.out.match(/^PartialMatch/) : false;\r\n        if (isUsingPartialMatch) {\r\n            return this.buildRefinedQueryByPartialMatchCell(fallbackIndexPartialMatch);\r\n        }\r\n        return this.buildRefinedQueryNoExtraction();\r\n    };\r\n    ExecutionReportITDSection.prototype.buildRefinedQueryByMLCell = function (refinedQueries) {\r\n        var _this = this;\r\n        var topLevelContainer = Dom_1.$$('div', undefined, Dom_1.$$('h2', undefined, 'Extraction and scoring performed using Coveo Machine Learning:'));\r\n        var keywordsList = Dom_1.$$('ul');\r\n        topLevelContainer.append(keywordsList.el);\r\n        underscore_1.chain(refinedQueries)\r\n            .map(function (refinedQuery) {\r\n            var content = _this.doHighlights(\"Keyword: \" + refinedQuery.q + \" ==> Score: \" + refinedQuery.score, [refinedQuery]);\r\n            var container = Dom_1.$$('li', null, content);\r\n            return container;\r\n        })\r\n            .each(function (refinedQueryContainer) {\r\n            keywordsList.append(refinedQueryContainer.el);\r\n        });\r\n        return {\r\n            content: topLevelContainer,\r\n            cellRenderer: TableBuilder_1.GenericHtmlRenderer\r\n        };\r\n    };\r\n    ExecutionReportITDSection.prototype.buildRefinedQueryByPartialMatchCell = function (partialMatch) {\r\n        var topLevelContainer = Dom_1.$$('div');\r\n        topLevelContainer.append(Dom_1.$$('h2', undefined, 'Coveo Machine learning was unable to suggest any refined keywords').el);\r\n        topLevelContainer.append(Dom_1.$$('h4', undefined, 'Fallback on Coveo Index partial match feature').el);\r\n        var content = Dom_1.$$('code', undefined, partialMatch.result.out);\r\n        topLevelContainer.append(content.el);\r\n        return {\r\n            content: topLevelContainer,\r\n            cellRenderer: TableBuilder_1.GenericHtmlRenderer\r\n        };\r\n    };\r\n    ExecutionReportITDSection.prototype.buildRefinedQueryNoExtraction = function () {\r\n        var topLevelContainer = Dom_1.$$('div');\r\n        topLevelContainer.append(Dom_1.$$('h2', undefined, 'No keywords were extracted').el);\r\n        topLevelContainer.append(Dom_1.$$('h4', undefined, 'The query is probably too small, or Coveo is lacking usage analytics data to return any meaningful suggestions.')\r\n            .el);\r\n        return {\r\n            content: topLevelContainer,\r\n            cellRenderer: TableBuilder_1.GenericHtmlRenderer\r\n        };\r\n    };\r\n    ExecutionReportITDSection.prototype.buildFallbackEmptyTable = function (executionReport) {\r\n        return new ExecutionReportSimpleSection_1.ExecutionReportSimpleSection(ExecutionReport_1.EXECUTION_REPORT_SECTION.NONE, ExecutionReport_1.EXECUTION_REPORT_SECTION.NONE, 'Large Query Intelligent Term Detection (ITD)').build(executionReport);\r\n    };\r\n    return ExecutionReportITDSection;\r\n}());\r\nexports.ExecutionReportITDSection = ExecutionReportITDSection;\r\n\n\n/***/ }),\n\n/***/ 821:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar TableBuilder_1 = __webpack_require__(803);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar GenericValueOutput_1 = __webpack_require__(805);\r\nvar UtilsModules_1 = __webpack_require__(121);\r\nvar QueryBuilder_1 = __webpack_require__(46);\r\nvar PopupUtils_1 = __webpack_require__(194);\r\nvar AvailableFieldsTable = /** @class */ (function () {\r\n    function AvailableFieldsTable(bindings) {\r\n        this.bindings = bindings;\r\n    }\r\n    AvailableFieldsTable.prototype.build = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var container, agGridElement, allFieldsDescription, _a, dataSource, gridOptions;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        container = UtilsModules_1.$$('div');\r\n                        agGridElement = UtilsModules_1.$$('div', {\r\n                            className: 'ag-theme-fresh'\r\n                        });\r\n                        container.append(agGridElement.el);\r\n                        if (!this.bindings.queryController) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.bindings.queryController.getEndpoint().listFields()];\r\n                    case 1:\r\n                        _a = _b.sent();\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        _a = null;\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        allFieldsDescription = _a;\r\n                        if (!allFieldsDescription) return [3 /*break*/, 5];\r\n                        dataSource = underscore_1.map(allFieldsDescription, function (description) {\r\n                            return {\r\n                                Name: new GenericValueOutput_1.GenericValueOutput().output(description.name),\r\n                                Description: __assign({}, new GenericValueOutput_1.GenericValueOutput().output(description.description), { width: 150 }),\r\n                                'Default Value': new GenericValueOutput_1.GenericValueOutput().output(description.defaultValue),\r\n                                'Field Type': new GenericValueOutput_1.GenericValueOutput().output(description.fieldType),\r\n                                'Field Source Type': new GenericValueOutput_1.GenericValueOutput().output(description.fieldSourceType),\r\n                                'Include In Query': new GenericValueOutput_1.GenericValueOutput().output(description.includeInQuery),\r\n                                'Include In Results': new GenericValueOutput_1.GenericValueOutput().output(description.includeInResults),\r\n                                'Group By Field': new GenericValueOutput_1.GenericValueOutput().output(description.groupByField),\r\n                                'Split Group By Field': new GenericValueOutput_1.GenericValueOutput().output(description.splitGroupByField),\r\n                                'Sort By Field': new GenericValueOutput_1.GenericValueOutput().output(description.sortByField),\r\n                                'Sample Of Available Values': {\r\n                                    content: {\r\n                                        content: {\r\n                                            description: description,\r\n                                            bindings: _this.bindings,\r\n                                            container: container\r\n                                        }\r\n                                    },\r\n                                    width: 200,\r\n                                    suppressSorting: true,\r\n                                    suppressFilter: true,\r\n                                    cellRenderer: AvailableFieldsSampleValue\r\n                                }\r\n                            };\r\n                        });\r\n                        return [4 /*yield*/, new TableBuilder_1.TableBuilder().build(dataSource, agGridElement, {\r\n                                enableFilter: true,\r\n                                rowModelType: 'infinite',\r\n                                pagination: true,\r\n                                paginationPageSize: 25,\r\n                                rowHeight: 100,\r\n                                enableServerSideFilter: true,\r\n                                enableServerSideSorting: true,\r\n                                datasource: new AvailableFieldsDatasource(dataSource)\r\n                            })];\r\n                    case 4:\r\n                        gridOptions = (_b.sent()).gridOptions;\r\n                        this.gridOptions = gridOptions;\r\n                        _b.label = 5;\r\n                    case 5: return [2 /*return*/, container];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return AvailableFieldsTable;\r\n}());\r\nexports.AvailableFieldsTable = AvailableFieldsTable;\r\nvar AvailableFieldsSampleValue = /** @class */ (function () {\r\n    function AvailableFieldsSampleValue() {\r\n    }\r\n    AvailableFieldsSampleValue.prototype.init = function (params) {\r\n        if (params.value && params.value.content) {\r\n            this.description = params.value.content.description;\r\n            this.bindings = params.value.content.bindings;\r\n            this.container = params.value.content.container;\r\n        }\r\n    };\r\n    AvailableFieldsSampleValue.prototype.getGui = function () {\r\n        var _this = this;\r\n        var btn = UtilsModules_1.$$('button', {\r\n            className: 'coveo-button coveo-available-fields-table-button'\r\n        }, 'Hover For Sample Values');\r\n        var popperElement;\r\n        var userHoveringButtonWithHisMouse = false;\r\n        btn.on('mouseover', function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var values;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        userHoveringButtonWithHisMouse = true;\r\n                        if (!(this.description && this.container && userHoveringButtonWithHisMouse)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.getFieldsValues(this.description)];\r\n                    case 1:\r\n                        values = _a.sent();\r\n                        if (userHoveringButtonWithHisMouse) {\r\n                            popperElement = this.renderFieldValues(values);\r\n                            this.container.append(popperElement.el);\r\n                            UtilsModules_1.PopupUtils.positionPopup(popperElement.el, btn.el, document.body, {\r\n                                horizontal: PopupUtils_1.PopupHorizontalAlignment.LEFT,\r\n                                vertical: PopupUtils_1.PopupVerticalAlignment.MIDDLE\r\n                            });\r\n                        }\r\n                        userHoveringButtonWithHisMouse = false;\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); });\r\n        btn.on('mouseout', function () {\r\n            if (popperElement) {\r\n                popperElement.remove();\r\n            }\r\n            userHoveringButtonWithHisMouse = false;\r\n        });\r\n        return btn.el;\r\n    };\r\n    AvailableFieldsSampleValue.prototype.getFieldsValues = function (fieldDesciption) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var queryBuilder, queryResults, _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!this.bindings || !this.description || !this.bindings.queryController || !this.container) {\r\n                            return [2 /*return*/, []];\r\n                        }\r\n                        if (!fieldDesciption.groupByField) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.bindings.queryController.getEndpoint().listFieldValues({\r\n                                field: this.description.name\r\n                            })];\r\n                    case 1: return [2 /*return*/, _b.sent()];\r\n                    case 2:\r\n                        queryBuilder = new QueryBuilder_1.QueryBuilder();\r\n                        queryBuilder.advancedExpression.add(fieldDesciption.name);\r\n                        if (!this.bindings) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, this.bindings.queryController.getEndpoint().search(queryBuilder.build())];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        _a = null;\r\n                        _b.label = 5;\r\n                    case 5:\r\n                        queryResults = _a;\r\n                        if (queryResults) {\r\n                            return [2 /*return*/, underscore_1.map(queryResults.results, function (result) {\r\n                                    return { value: UtilsModules_1.Utils.getFieldValue(result, fieldDesciption.name) };\r\n                                })];\r\n                        }\r\n                        else {\r\n                            return [2 /*return*/, []];\r\n                        }\r\n                        _b.label = 6;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AvailableFieldsSampleValue.prototype.renderFieldValues = function (fieldValues) {\r\n        var list = UtilsModules_1.$$('ul', { className: 'coveo-relevance-inspector-available-fields-popup' });\r\n        list.el.style.background = 'white';\r\n        if (fieldValues.length == 0) {\r\n            list.append(UtilsModules_1.$$('li', undefined, 'No Values Available ...').el);\r\n        }\r\n        else {\r\n            fieldValues.forEach(function (fieldValue) {\r\n                var listItem = UtilsModules_1.$$('li', {\r\n                    className: 'coveo-relevance-inspector-available-fields-popup-value'\r\n                }, new GenericValueOutput_1.GenericValueOutput().output(fieldValue.value).content);\r\n                list.append(listItem.el);\r\n            });\r\n        }\r\n        return list;\r\n    };\r\n    AvailableFieldsSampleValue.prototype.refresh = function () {\r\n        return true;\r\n    };\r\n    return AvailableFieldsSampleValue;\r\n}());\r\nexports.AvailableFieldsSampleValue = AvailableFieldsSampleValue;\r\nvar AvailableFieldsDatasource = /** @class */ (function () {\r\n    function AvailableFieldsDatasource(dataSource) {\r\n        this.dataSource = dataSource;\r\n        this.rowsData = [];\r\n        this.rowsData = underscore_1.map(this.dataSource, function (source) {\r\n            var merged = {};\r\n            var extractContent = function (value, key) {\r\n                if (value.content != null) {\r\n                    merged[key] = value.content;\r\n                }\r\n                else if (value.children) {\r\n                    underscore_1.each(value.children, function (child) {\r\n                        underscore_1.each(child, extractContent);\r\n                    });\r\n                }\r\n            };\r\n            underscore_1.each(source, extractContent);\r\n            return merged;\r\n        });\r\n    }\r\n    AvailableFieldsDatasource.prototype.getRows = function (params) {\r\n        var filtered = this.filter(this.rowsData, params.filterModel);\r\n        var filteredAndSorted = this.sort(filtered, params.sortModel);\r\n        params.successCallback(filteredAndSorted.slice(params.startRow, params.endRow), filteredAndSorted.length);\r\n    };\r\n    AvailableFieldsDatasource.prototype.filter = function (rows, filterModel) {\r\n        underscore_1.each(filterModel, function (value, key) {\r\n            switch (value.type) {\r\n                case 'equals':\r\n                    rows = underscore_1.where(rows, (_a = {}, _a[key] = value.filter, _a));\r\n                    break;\r\n                case 'notEqual':\r\n                    rows = underscore_1.reject(rows, function (possibleReturn) {\r\n                        return possibleReturn[key] == value.filter;\r\n                    });\r\n                    break;\r\n                case 'startsWith':\r\n                    rows = underscore_1.filter(rows, function (possibleReturn) {\r\n                        return possibleReturn[key].toLowerCase().indexOf(value.filter) == 0;\r\n                    });\r\n                    break;\r\n                case 'endsWith':\r\n                    rows = underscore_1.filter(rows, function (possibleReturn) {\r\n                        return possibleReturn[key].toLowerCase().indexOf(value.filter) == possibleReturn[key].length - value.filter.length;\r\n                    });\r\n                    break;\r\n                case 'contains':\r\n                    rows = underscore_1.filter(rows, function (possibleReturn) {\r\n                        return possibleReturn[key].toLowerCase().indexOf(value.filter) != -1;\r\n                    });\r\n                    break;\r\n                case 'notContains':\r\n                    rows = underscore_1.filter(rows, function (possibleReturn) {\r\n                        return possibleReturn[key].toLowerCase().indexOf(value.filter) == -1;\r\n                    });\r\n                    break;\r\n            }\r\n            var _a;\r\n        });\r\n        return rows;\r\n    };\r\n    AvailableFieldsDatasource.prototype.sort = function (rows, sortModels) {\r\n        if (sortModels && sortModels[0]) {\r\n            var sortModel_1 = sortModels[0];\r\n            return rows.sort(function (first, second) {\r\n                var firstValue = first[sortModel_1.colId];\r\n                var secondValue = second[sortModel_1.colId];\r\n                var ascendingOrDescendingMultiplier = sortModel_1.sort == 'asc' ? 1 : -1;\r\n                if (UtilsModules_1.Utils.isNullOrEmptyString(firstValue) && UtilsModules_1.Utils.isNullOrEmptyString(secondValue)) {\r\n                    return 0;\r\n                }\r\n                if (UtilsModules_1.Utils.isNullOrEmptyString(firstValue)) {\r\n                    return -1 * ascendingOrDescendingMultiplier;\r\n                }\r\n                if (UtilsModules_1.Utils.isNullOrEmptyString(secondValue)) {\r\n                    return 1 * ascendingOrDescendingMultiplier;\r\n                }\r\n                if (isNaN(firstValue) || isNaN(secondValue)) {\r\n                    return firstValue.localeCompare(secondValue) * ascendingOrDescendingMultiplier;\r\n                }\r\n                else {\r\n                    return (Number(firstValue) - Number(secondValue)) * ascendingOrDescendingMultiplier;\r\n                }\r\n            });\r\n        }\r\n        return rows;\r\n    };\r\n    return AvailableFieldsDatasource;\r\n}());\r\nexports.AvailableFieldsDatasource = AvailableFieldsDatasource;\r\n\n\n/***/ }),\n\n/***/ 822:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RankingInfoParser_1 = __webpack_require__(807);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar InlineRankingInfo = /** @class */ (function () {\r\n    function InlineRankingInfo(result) {\r\n        this.result = result;\r\n        this.rankingInfo = RankingInfoParser_1.parseRankingInfo(result.rankingInfo);\r\n    }\r\n    InlineRankingInfo.prototype.build = function () {\r\n        var container = Dom_1.$$('div', {\r\n            className: 'coveo-relevance-inspector-inline-ranking'\r\n        });\r\n        underscore_1.each(this.rankingInfo.documentWeights, function (value, key) {\r\n            var section = Dom_1.$$('div', { className: 'coveo-relevance-inspector-inline-ranking-section' }, key + \": \" + value);\r\n            container.append(section.el);\r\n        });\r\n        var total = Dom_1.$$('div', { className: 'coveo-relevance-inspector-highlight coveo-relevance-inspector-inline-ranking-section' }, \"Total: \" + this.rankingInfo.totalWeight);\r\n        container.append(total.el);\r\n        if (this.rankingInfo.termsWeight) {\r\n            this.buildTogglableTermsSection(container);\r\n        }\r\n        if (Utils_1.Utils.isNonEmptyArray(this.rankingInfo.qreWeights)) {\r\n            this.buildTogglableQRESection(container);\r\n        }\r\n        return container;\r\n    };\r\n    InlineRankingInfo.prototype.buildTogglableTermsSection = function (container) {\r\n        var termsButton = Dom_1.$$('button', { className: 'coveo-button coveo-relevance-inspector-inline-ranking-button' }, 'Toggle Terms Relevancy Breakdown');\r\n        container.append(termsButton.el);\r\n        var termsSection = Dom_1.$$('div', { className: 'coveo-relevance-inspector-inline-ranking-terms' });\r\n        container.append(termsSection.el);\r\n        underscore_1.each(this.rankingInfo.termsWeight || {}, function (value, key) {\r\n            var builtKey = \"Keyword: \" + key;\r\n            termsSection.append(Dom_1.$$('h2', undefined, builtKey).el);\r\n            termsSection.append(RankingInfoParser_1.buildListOfTermsElement(value.Weights).el);\r\n        });\r\n        termsButton.on('click', function () { return termsSection.toggleClass('coveo-active'); });\r\n    };\r\n    InlineRankingInfo.prototype.buildTogglableQRESection = function (container) {\r\n        var qreButton = Dom_1.$$('button', { className: 'coveo-button coveo-relevance-inspector-inline-ranking-button' }, 'Toggle QRE Breakdown');\r\n        container.append(qreButton.el);\r\n        var qreSection = Dom_1.$$('ul', { className: 'coveo-relevance-inspector-inline-ranking-terms' });\r\n        container.append(qreSection.el);\r\n        underscore_1.each(this.rankingInfo.qreWeights, function (value) {\r\n            qreSection.append(Dom_1.$$('dd', { className: 'coveo-relevance-inspector-inline-ranking-qre-expression' }, \"\" + value.expression).el);\r\n            qreSection.append(Dom_1.$$('dt', undefined, \"Score: \" + value.score).el);\r\n        });\r\n        qreButton.on('click', function () { return qreSection.toggleClass('coveo-active'); });\r\n    };\r\n    return InlineRankingInfo;\r\n}());\r\nexports.InlineRankingInfo = InlineRankingInfo;\r\n\n\n/***/ }),\n\n/***/ 92:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Component_1 = __webpack_require__(7);\r\nvar ComponentOptions_1 = __webpack_require__(8);\r\nvar ComponentOptionsModel_1 = __webpack_require__(28);\r\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\r\nvar ResultListEvents_1 = __webpack_require__(29);\r\nvar HighlightUtils_1 = __webpack_require__(68);\r\nvar DeviceUtils_1 = __webpack_require__(24);\r\nvar OSUtils_1 = __webpack_require__(181);\r\nvar Initialization_1 = __webpack_require__(2);\r\nvar QueryUtils_1 = __webpack_require__(21);\r\nvar Assert_1 = __webpack_require__(5);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar Defer_1 = __webpack_require__(31);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar StreamHighlightUtils_1 = __webpack_require__(114);\r\nvar StringUtils_1 = __webpack_require__(22);\r\nvar underscore_1 = __webpack_require__(0);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\n__webpack_require__(532);\r\nvar AccessibleButton_1 = __webpack_require__(15);\r\n/**\r\n * The `ResultLink` component automatically transform a search result title into a clickable link pointing to the\r\n * original item.\r\n *\r\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\r\n */\r\nvar ResultLink = /** @class */ (function (_super) {\r\n    __extends(ResultLink, _super);\r\n    /**\r\n     * Creates a new `ResultLink` component.\r\n     * @param element The HTMLElement on which to instantiate the component.\r\n     * @param options The options for the `ResultLink` component.\r\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n     * automatically resolved (with a slower execution time).\r\n     * @param result The result to associate the component with.\r\n     * @param os\r\n     */\r\n    function ResultLink(element, options, bindings, result, os) {\r\n        var _this = _super.call(this, element, ResultLink.ID, bindings) || this;\r\n        _this.element = element;\r\n        _this.options = options;\r\n        _this.bindings = bindings;\r\n        _this.result = result;\r\n        _this.os = os;\r\n        _this.logOpenDocument = underscore_1.debounce(function () {\r\n            _this.queryController.saveLastQuery();\r\n            var documentURL = Dom_1.$$(_this.element).getAttribute('href');\r\n            if (documentURL == undefined || documentURL == '') {\r\n                documentURL = _this.escapedClickUri;\r\n            }\r\n            _this.usageAnalytics.logClickEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.documentOpen, {\r\n                documentURL: documentURL,\r\n                documentTitle: _this.result.title,\r\n                author: Utils_1.Utils.getFieldValue(_this.result, 'author')\r\n            }, _this.result, _this.root);\r\n            Defer_1.Defer.flush();\r\n        }, 1500, true);\r\n        var initialOptions = ComponentOptions_1.ComponentOptions.initComponentOptions(element, ResultLink, options);\r\n        var resultLinkOptions = _this.componentOptionsModel.get(ComponentOptionsModel_1.ComponentOptionsModel.attributesEnum.resultLink);\r\n        _this.options = underscore_1.extend({}, initialOptions, resultLinkOptions);\r\n        _this.result = result || _this.resolveResult();\r\n        if (_this.options.openQuickview == null) {\r\n            _this.options.openQuickview = result.raw['connectortype'] == 'ExchangeCrawler' && DeviceUtils_1.DeviceUtils.isMobileDevice();\r\n        }\r\n        _this.element.setAttribute('tabindex', '0');\r\n        Assert_1.Assert.exists(_this.componentOptionsModel);\r\n        Assert_1.Assert.exists(_this.result);\r\n        if (!_this.quickviewShouldBeOpened()) {\r\n            // Bind on multiple \"click\" or \"mouse\" events.\r\n            // Create a function that will be executed only once, so as not to log multiple events\r\n            // Once a result link has been opened, and that we log at least one analytics event,\r\n            // it should not matter if the end user open the same link multiple times with different methods.\r\n            // It's still only one \"click\" event as far as UA is concerned.\r\n            // Also need to handle \"longpress\" on mobile (the contextual menu), which we assume to be 1 s long.\r\n            var executeOnlyOnce_1 = underscore_1.once(function () { return _this.logOpenDocument(); });\r\n            Dom_1.$$(element).on(['contextmenu', 'click', 'mousedown', 'mouseup'], executeOnlyOnce_1);\r\n            var longPressTimer_1;\r\n            Dom_1.$$(element).on('touchstart', function () {\r\n                longPressTimer_1 = window.setTimeout(executeOnlyOnce_1, 1000);\r\n            });\r\n            Dom_1.$$(element).on('touchend', function () {\r\n                if (longPressTimer_1) {\r\n                    clearTimeout(longPressTimer_1);\r\n                }\r\n            });\r\n        }\r\n        _this.renderUri(element, result);\r\n        _this.bindEventToOpen();\r\n        return _this;\r\n    }\r\n    ResultLink.prototype.renderUri = function (element, result) {\r\n        if (/^\\s*$/.test(this.element.innerHTML)) {\r\n            var title = this.getDisplayedTitle();\r\n            this.element.innerHTML = title;\r\n            if (!this.element.title) {\r\n                this.element.title = this.getDisplayedTitleAsText();\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Opens the result in the same window, no matter how the actual component is configured for the end user.\r\n     * @param logAnalytics Specifies whether the method should log an analytics event.\r\n     */\r\n    ResultLink.prototype.openLink = function (logAnalytics) {\r\n        if (logAnalytics === void 0) { logAnalytics = true; }\r\n        if (logAnalytics) {\r\n            this.logOpenDocument();\r\n        }\r\n        window.location.href = this.getResultUri();\r\n    };\r\n    /**\r\n     * Opens the result in a new window, no matter how the actual component is configured for the end user.\r\n     * @param logAnalytics Specifies whether the method should log an analytics event.\r\n     */\r\n    ResultLink.prototype.openLinkInNewWindow = function (logAnalytics) {\r\n        if (logAnalytics === void 0) { logAnalytics = true; }\r\n        if (logAnalytics) {\r\n            this.logOpenDocument();\r\n        }\r\n        window.open(this.getResultUri(), '_blank');\r\n    };\r\n    /**\r\n     * Tries to open the result in Microsoft Outlook if the result has an `outlookformacuri` or `outlookuri` field.\r\n     *\r\n     * Normally, this implies the result should be a link to an email.\r\n     *\r\n     * If the needed fields are not present, this method does nothing.\r\n     * @param logAnalytics Specifies whether the method should log an analytics event.\r\n     */\r\n    ResultLink.prototype.openLinkInOutlook = function (logAnalytics) {\r\n        if (logAnalytics === void 0) { logAnalytics = true; }\r\n        if (this.hasOutlookField()) {\r\n            if (logAnalytics) {\r\n                this.logOpenDocument();\r\n            }\r\n            this.openLink();\r\n        }\r\n    };\r\n    /**\r\n     * Opens the link in the same manner the end user would.\r\n     *\r\n     * This essentially simulates a click on the result link.\r\n     *\r\n     * @param logAnalytics Specifies whether the method should log an analytics event.\r\n     */\r\n    ResultLink.prototype.openLinkAsConfigured = function (logAnalytics) {\r\n        if (logAnalytics === void 0) { logAnalytics = true; }\r\n        if (this.toExecuteOnOpen) {\r\n            if (logAnalytics) {\r\n                this.logOpenDocument();\r\n            }\r\n            this.toExecuteOnOpen();\r\n        }\r\n    };\r\n    ResultLink.prototype.bindEventToOpen = function () {\r\n        return (this.bindOnClickIfNotUndefined() ||\r\n            this.bindOpenQuickviewIfNotUndefined() ||\r\n            this.setHrefIfNotAlready() ||\r\n            this.openLinkThatIsNotAnAnchor());\r\n    };\r\n    ResultLink.prototype.getDisplayedTitle = function () {\r\n        if (!this.options.titleTemplate) {\r\n            return this.result.title\r\n                ? HighlightUtils_1.HighlightUtils.highlightString(this.result.title, this.result.titleHighlights, null, 'coveo-highlight')\r\n                : this.escapedClickUri;\r\n        }\r\n        else {\r\n            var newTitle = StringUtils_1.StringUtils.buildStringTemplateFromResult(this.options.titleTemplate, this.result);\r\n            return newTitle\r\n                ? StreamHighlightUtils_1.StreamHighlightUtils.highlightStreamText(newTitle, this.result.termsToHighlight, this.result.phrasesToHighlight)\r\n                : this.escapedClickUri;\r\n        }\r\n    };\r\n    ResultLink.prototype.getDisplayedTitleAsText = function () {\r\n        var container = Dom_1.$$('div');\r\n        container.setHtml(this.getDisplayedTitle());\r\n        return container.text();\r\n    };\r\n    Object.defineProperty(ResultLink.prototype, \"escapedClickUri\", {\r\n        get: function () {\r\n            return underscore_1.escape(this.result.clickUri);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ResultLink.prototype.bindOnClickIfNotUndefined = function () {\r\n        var _this = this;\r\n        if (this.options.onClick != undefined) {\r\n            this.toExecuteOnOpen = function (e) {\r\n                _this.options.onClick.call(_this, e, _this.result);\r\n            };\r\n            new AccessibleButton_1.AccessibleButton()\r\n                .withElement(this.element)\r\n                .withLabel(this.result.title)\r\n                .withSelectAction(function (e) { return _this.toExecuteOnOpen(e); })\r\n                .build();\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    };\r\n    ResultLink.prototype.bindOpenQuickviewIfNotUndefined = function () {\r\n        var _this = this;\r\n        if (this.quickviewShouldBeOpened()) {\r\n            this.toExecuteOnOpen = function () {\r\n                Dom_1.$$(_this.bindings.resultElement).trigger(ResultListEvents_1.ResultListEvents.openQuickview);\r\n            };\r\n            Dom_1.$$(this.element).on('click', function (e) {\r\n                e.preventDefault();\r\n                _this.toExecuteOnOpen();\r\n            });\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    };\r\n    ResultLink.prototype.openLinkThatIsNotAnAnchor = function () {\r\n        var _this = this;\r\n        if (!this.elementIsAnAnchor()) {\r\n            this.toExecuteOnOpen = function () {\r\n                if (_this.options.alwaysOpenInNewWindow) {\r\n                    if (_this.options.openInOutlook) {\r\n                        _this.openLinkInOutlook();\r\n                    }\r\n                    else {\r\n                        _this.openLinkInNewWindow();\r\n                    }\r\n                }\r\n                else {\r\n                    _this.openLink();\r\n                }\r\n            };\r\n            Dom_1.$$(this.element).on('click', function () {\r\n                _this.toExecuteOnOpen();\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    ResultLink.prototype.setHrefIfNotAlready = function () {\r\n        // Do not erase any value put in href by the template, etc. Allows\r\n        // using custom click urls while still keeping analytics recording\r\n        // and other behavior brought by the component.\r\n        if (this.elementIsAnAnchor() && !Utils_1.Utils.isNonEmptyString(Dom_1.$$(this.element).getAttribute('href'))) {\r\n            Dom_1.$$(this.element).setAttribute('href', this.getResultUri());\r\n            if (this.options.alwaysOpenInNewWindow && !(this.options.openInOutlook && this.hasOutlookField())) {\r\n                Dom_1.$$(this.element).setAttribute('target', '_blank');\r\n            }\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    };\r\n    ResultLink.prototype.filterProtocol = function (uri) {\r\n        var isAbsolute = /^(https?|ftp|file|mailto|tel):/i.test(uri);\r\n        var isRelative = /^\\//.test(uri);\r\n        return isAbsolute || isRelative ? uri : '';\r\n    };\r\n    ResultLink.prototype.getResultUri = function () {\r\n        if (this.options.hrefTemplate) {\r\n            var uri = StringUtils_1.StringUtils.buildStringTemplateFromResult(this.options.hrefTemplate, this.result);\r\n            return this.filterProtocol(uri);\r\n        }\r\n        if (this.options.field == undefined && this.options.openInOutlook) {\r\n            this.setField();\r\n        }\r\n        if (this.options.field != undefined) {\r\n            return this.filterProtocol(Utils_1.Utils.getFieldValue(this.result, this.options.field));\r\n        }\r\n        return this.filterProtocol(this.result.clickUri);\r\n    };\r\n    ResultLink.prototype.elementIsAnAnchor = function () {\r\n        return this.element.tagName == 'A';\r\n    };\r\n    ResultLink.prototype.setField = function () {\r\n        var os = Utils_1.Utils.exists(this.os) ? this.os : OSUtils_1.OSUtils.get();\r\n        if (os == OSUtils_1.OS_NAME.MACOSX && this.hasOutlookField()) {\r\n            this.options.field = '@outlookformacuri';\r\n        }\r\n        else if (os == OSUtils_1.OS_NAME.WINDOWS && this.hasOutlookField()) {\r\n            this.options.field = '@outlookuri';\r\n        }\r\n    };\r\n    ResultLink.prototype.hasOutlookField = function () {\r\n        var os = Utils_1.Utils.exists(this.os) ? this.os : OSUtils_1.OSUtils.get();\r\n        if (os == OSUtils_1.OS_NAME.MACOSX && this.result.raw['outlookformacuri'] != undefined) {\r\n            return true;\r\n        }\r\n        else if (os == OSUtils_1.OS_NAME.WINDOWS && this.result.raw['outlookuri'] != undefined) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    ResultLink.prototype.isUriThatMustBeOpenedInQuickview = function () {\r\n        return this.escapedClickUri.toLowerCase().indexOf('ldap://') == 0;\r\n    };\r\n    ResultLink.prototype.quickviewShouldBeOpened = function () {\r\n        return (this.options.openQuickview || this.isUriThatMustBeOpenedInQuickview()) && QueryUtils_1.QueryUtils.hasHTMLVersion(this.result);\r\n    };\r\n    ResultLink.ID = 'ResultLink';\r\n    ResultLink.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            ResultLink: ResultLink\r\n        });\r\n    };\r\n    /**\r\n     * The options for the ResultLink\r\n     * @componentOptions\r\n     */\r\n    ResultLink.options = {\r\n        /**\r\n         * Specifies the field to use to output the component `href` attribute value.\r\n         *\r\n         * **Tip:**\r\n         * > Instead of specifying a value for the `field` option, you can directly add an `href` attribute to the\r\n         * > `ResultLink` HTML element. Then, you can use a custom script to generate the `href` value.\r\n         *\r\n         * **Examples:**\r\n         * - With the following markup, the `ResultLink` outputs its `href` value using the `@uri` field (rather than the\r\n         * default field):\r\n         *\r\n         * ```html\r\n         * <a class=\"CoveoResultLink\" data-field=\"@uri\"></a>\r\n         * ```\r\n         *\r\n         * - In the following result template, the custom `getMyKBUri()` function provides the `href` value:\r\n         *\r\n         * ```html\r\n         * <script id=\"KnowledgeArticle\" type=\"text/underscore\" class=\"result-template\">\r\n         *   <div class='CoveoIcon>'></div>\r\n         *   <a class=\"CoveoResultLink\" href=\"<%= getMyKBUri(raw) %>\"></a>\r\n         *   <div class=\"CoveoExcerpt\"></div>\r\n         * </script>\r\n         * ```\r\n         *\r\n         * See also [`hrefTemplate`]{@link ResultLink.options.hrefTemplate}, which can override this option.\r\n         *\r\n         * By default, the component uses the `@clickUri` field of the item to output the value of its `href` attribute.\r\n         */\r\n        field: ComponentOptions_1.ComponentOptions.buildFieldOption(),\r\n        /**\r\n         * Specifies whether the component should try to open its link in Microsoft Outlook.\r\n         *\r\n         * Setting this option to `true` is normally useful for `ResultLink` instances related to Microsoft Exchange emails.\r\n         *\r\n         * If this option is `true`, clicking the `ResultLink` calls the\r\n         * [`openLinkInOutlook`]{@link ResultLink.openLinkInOutlook} method instead of the\r\n         * [`openLink`]{@link ResultLink.openLink} method.\r\n         *\r\n         * Default value is `false`.\r\n         */\r\n        openInOutlook: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\r\n        /**\r\n         * Specifies whether the component should open its link in the [`Quickview`]{@link Quickview} component rather than\r\n         * loading through the original URL.\r\n         *\r\n         * Default value is `false`.\r\n         */\r\n        openQuickview: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\r\n        /**\r\n         * Specifies whether the component should open its link in a new window instead of opening it in the current\r\n         * context.\r\n         *\r\n         * If this option is `true`, clicking the `ResultLink` calls the\r\n         * [`openLinkInNewWindow`]{@link ResultLink.openLinkInNewWindow} method instead of the\r\n         * [`openLink`]{@link ResultLink.openLink} method.\r\n         *\r\n         * **Note:**\r\n         * > If a search page contains a [`ResultPreferences`]{@link ResultsPreferences} component whose\r\n         * > [`enableOpenInNewWindow`]{@link ResultsPreferences.options.enableOpenInNewWindow} option is `true`, and the end\r\n         * > user checks the <b>Always open results in new window</b> box, `ResultLink` components in this page will always\r\n         * > open their links in a new window when the end user clicks them, no matter what the value of their\r\n         * > `alwaysOpenInNewWindow` option is.\r\n         *\r\n         * Default value is `false`.\r\n         */\r\n        alwaysOpenInNewWindow: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\r\n        /**\r\n         * Specifies a template literal from which to generate the `ResultLink` `href` attribute value (see\r\n         * [Template literals](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Template_literals)).\r\n         *\r\n         * This option overrides the [`field`]{@link ResultLink.options.field} option value.\r\n         *\r\n         * The template literal can reference any number of fields from the parent result. It can also reference global\r\n         * scope properties.\r\n         *\r\n         * **Examples:**\r\n         *\r\n         * - The following markup generates an `href` value such as `http://uri.com?id=itemTitle`:\r\n         *\r\n         * ```html\r\n         * <a class='CoveoResultLink' data-href-template='${clickUri}?id=${raw.title}'></a>\r\n         * ```\r\n         *\r\n         * - The following markup generates an `href` value such as `localhost/fooBar`:\r\n         *\r\n         * ```html\r\n         * <a class='CoveoResultLink' data-href-template='${window.location.hostname}/{Foo.Bar}'></a>\r\n         * ```\r\n         *\r\n         * Default value is `undefined`.\r\n         */\r\n        hrefTemplate: ComponentOptions_1.ComponentOptions.buildStringOption(),\r\n        /**\r\n         * Specifies a template literal from which to generate the `ResultLink` display title (see\r\n         * [Template literals](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Template_literals)).\r\n         *\r\n         * This option overrides the default `ResultLink` display title behavior.\r\n         *\r\n         * The template literal can reference any number of fields from the parent result. However, if the template literal\r\n         * references a key whose value is undefined in the parent result fields, the `ResultLink` title displays the\r\n         * name of this key instead.\r\n         *\r\n         * This option is ignored if the `ResultLink` innerHTML contains any value.\r\n         *\r\n         * **Examples:**\r\n         *\r\n         * - The following markup generates a `ResultLink` display title such as `Case number: 123456` if both the\r\n         * `raw.objecttype` and `raw.objectnumber` keys are defined in the parent result fields:\r\n         *\r\n         * ```html\r\n         * <a class=\"CoveoResultLink\" data-title-template=\"${raw.objecttype} number: ${raw.objectnumber}\"></a>\r\n         * ```\r\n         *\r\n         * - The following markup generates `${myField}` as a `ResultLink` display title if the `myField` key is undefined\r\n         * in the parent result fields:\r\n         *\r\n         * ```html\r\n         * <a class=\"CoveoResultLink\" data-title-template=\"${myField}\"></a>\r\n         * ```\r\n         *\r\n         * - The following markup generates `Foobar` as a `ResultLink` display title, because the `ResultLink` innterHTML is\r\n         * not empty:\r\n         *\r\n         * ```html\r\n         * <a class=\"CoveoResultLink\" data-title-template=\"${will} ${be} ${ignored}\">Foobar</a>\r\n         * ```\r\n         *\r\n         * Default value is `undefined`.\r\n         *\r\n         * @availablesince [January 2017 Release (v1.1865.9)](https://docs.coveo.com/en/396/#january-2017-release-v118659)\r\n         */\r\n        titleTemplate: ComponentOptions_1.ComponentOptions.buildStringOption(),\r\n        /**\r\n         * Specifies an event handler function to execute when the user clicks the `ResultLink` component.\r\n         *\r\n         * The handler function takes a JavaScript [`Event`](https://developer.mozilla.org/en/docs/Web/API/Event) object and\r\n         * an [`IQueryResult`]{@link IQueryResult} as its parameters.\r\n         *\r\n         * Overriding the default behavior of the `onClick` event can allow you to execute specific code instead.\r\n         *\r\n         * **Note:**\r\n         * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\r\n         * > [`init`]{@link init} call of your search interface (see\r\n         * > [Passing Component Options in the init Call](https://docs.coveo.com/en/346/#passing-component-options-in-the-init-call)),\r\n         * > or before the `init` call, using the `options` top-level function (see\r\n         * > [Passing Component Options Before the init Call](https://docs.coveo.com/en/346/#passing-component-options-before-the-init-call)).\r\n         *\r\n         * **Example:**\r\n         * ```javascript\r\n         * // You can set the option in the 'init' call:\r\n         * Coveo.init(document.querySelector(\"#search\"), {\r\n         *   ResultLink : {\r\n         *     onClick : function(e, result) {\r\n         *       e.preventDefault();\r\n         *       // Custom code to execute with the item URI and title.\r\n         *       openUriInASpecialTab(result.clickUri, result.title);\r\n         *     }\r\n         *   }\r\n         * });\r\n         *\r\n         * // Or before the 'init' call, using the 'options' top-level function:\r\n         * // Coveo.options(document.querySelector('#search'), {\r\n         * //   ResultLink : {\r\n         * //     onClick : function(e, result) {\r\n         * //       e.preventDefault();\r\n         * //       // Custom code to execute with the item URI and title.\r\n         * //       openUriInASpecialTab(result.clickUri, result.title);\r\n         * //     }\r\n         * //   }\r\n         * // });\r\n         * ```\r\n         */\r\n        onClick: ComponentOptions_1.ComponentOptions.buildCustomOption(function () {\r\n            return null;\r\n        })\r\n    };\r\n    return ResultLink;\r\n}(Component_1.Component));\r\nexports.ResultLink = ResultLink;\r\nInitialization_1.Initialization.registerAutoCreateComponent(ResultLink);\r\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// RelevanceInspector.min__5f3280c404a1ee75a113.js","import { RankingInfoTable } from './RankingInfoTable';\r\nimport { MetaDataTable } from './MetaDataTable';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { IAttributeChangedEventArg } from '../../models/Model';\r\nimport { $$ } from '../../utils/Dom';\r\nimport { ModalBox } from '../../ExternalModulesShim';\r\nimport { QueryStateModel, ResultListEvents, DomUtils, Logger } from '../../Core';\r\nimport { RelevanceInspectorTabs } from './RelevanceInspectorTabs';\r\nimport 'styling/_RelevanceInspector';\r\nimport { ExecutionReport } from './ExecutionReport';\r\nimport { AvailableFieldsTable } from './AvailableFieldsTable';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { debounce } from 'underscore';\r\nimport { IDisplayedNewResultEventArgs } from '../../events/ResultListEvents';\r\nimport { InlineRankingInfo } from './InlineRankingInfo';\r\n\r\nexport interface IRelevanceInspectorConstructor {\r\n  new (element: HTMLElement, bindings: IComponentBindings): RelevanceInspector;\r\n}\r\n\r\nexport interface IRelevanceInspectorTab {\r\n  gridOptions: agGridModule.GridOptions;\r\n}\r\n\r\nexport class RelevanceInspector {\r\n  private opened = false;\r\n  private activeTab: string;\r\n  private tabs: Record<string, IRelevanceInspectorTab>;\r\n  private modalBoxModule = ModalBox;\r\n\r\n  constructor(public element: HTMLElement, public bindings: IComponentBindings) {\r\n    $$(this.element).text('Relevance Inspector');\r\n    $$(this.element).addClass('coveo-button coveo-relevance-inspector');\r\n    $$(this.bindings.root).on(\r\n      this.bindings.queryStateModel.getEventName(QueryStateModel.eventTypes.changeOne + QueryStateModel.attributesEnum.debug),\r\n      (e, args: IAttributeChangedEventArg) => this.toggleFromState(args.value)\r\n    );\r\n    $$(this.element).on('click', () => this.open());\r\n    $$(this.bindings.root).on(ResultListEvents.newResultDisplayed, (e, args: IDisplayedNewResultEventArgs) =>\r\n      this.handleNewResultDisplayed(args)\r\n    );\r\n    this.bindings.queryStateModel.get(QueryStateModel.attributesEnum.debug) ? this.show() : this.hide();\r\n  }\r\n\r\n  public get modalBox() {\r\n    return this.modalBoxModule;\r\n  }\r\n\r\n  public set modalBox(modalBoxModule) {\r\n    this.modalBoxModule = modalBoxModule;\r\n  }\r\n\r\n  public hide() {\r\n    $$(this.element).addClass('coveo-hidden');\r\n  }\r\n\r\n  public show() {\r\n    $$(this.element).removeClass('coveo-hidden');\r\n  }\r\n\r\n  public async open() {\r\n    if (this.opened) {\r\n      return;\r\n    }\r\n    this.opened = true;\r\n\r\n    const content = $$('div');\r\n    const animation = DomUtils.getBasicLoadingAnimation();\r\n    content.append(animation);\r\n    this.modalBox.open(content.el, this.modalBoxOptions);\r\n    const rows = await this.buildTabs();\r\n    if (rows) {\r\n      animation.remove();\r\n      content.append(rows.el);\r\n    } else {\r\n      this.modalBox.close();\r\n    }\r\n  }\r\n\r\n  private handleNewResultDisplayed(args: IDisplayedNewResultEventArgs) {\r\n    if (this.bindings.queryStateModel.get(QueryStateModel.attributesEnum.debug)) {\r\n      $$(args.item).addClass('coveo-with-inline-ranking-info');\r\n      if ($$(args.item).hasClass('coveo-table-layout')) {\r\n        $$(args.item).append(new InlineRankingInfo(args.result).build().el);\r\n      } else {\r\n        $$(args.item).prepend(new InlineRankingInfo(args.result).build().el);\r\n      }\r\n    }\r\n  }\r\n\r\n  private get modalBoxOptions() {\r\n    return {\r\n      title: 'Relevance Inspector',\r\n      titleClose: false,\r\n      overlayClose: true,\r\n      sizeMod: 'big',\r\n      className: 'relevance-inspector-modal',\r\n      validation: () => {\r\n        this.opened = false;\r\n        return true;\r\n      },\r\n      body: document.getElementsByClassName('CoveoSearchInterface')[0] // Will return undefined if no CoveoSearchInterface is present\r\n    };\r\n  }\r\n\r\n  private toggleFromState(stateValue: number) {\r\n    stateValue != 0 ? this.show() : this.hide();\r\n    this.modalBox.close();\r\n  }\r\n\r\n  private async buildTabs() {\r\n    const lastResults = this.bindings.queryController.getLastResults().results;\r\n    if (!lastResults || lastResults.length == 0) {\r\n      new Logger(this).error(\r\n        'Could not open Relevance Inspector because there is no results to display. Please execute a query beforehand',\r\n        lastResults\r\n      );\r\n      return;\r\n    }\r\n    if (!lastResults[0].rankingInfo) {\r\n      new Logger(this).error(\r\n        'Could not open Relevance Inspector because there is no ranking info returned on the results. Please execute a query in debug mode beforehad',\r\n        lastResults\r\n      );\r\n      return;\r\n    }\r\n\r\n    const container = $$('div');\r\n\r\n    const rankingInfoTable = new RankingInfoTable(lastResults, this.bindings);\r\n    const metadataTable = new MetaDataTable(lastResults, this.bindings);\r\n    const executionReport = new ExecutionReport(this.bindings.queryController.getLastResults(), this.bindings);\r\n    const availableFields = new AvailableFieldsTable(this.bindings);\r\n\r\n    this.tabs = {\r\n      relevanceInspectorRankingInfo: rankingInfoTable,\r\n      relevanceInspectorMetadata: metadataTable,\r\n      relevanceInspectorExecutionReport: executionReport,\r\n      relevanceInspectorAvailableFields: availableFields\r\n    };\r\n\r\n    const inspectorTabs = new RelevanceInspectorTabs(tabChangedTo => {\r\n      this.activeTab = tabChangedTo;\r\n      this.resize();\r\n    });\r\n\r\n    const debouncedResize = debounce(() => this.resize(), 100);\r\n\r\n    window.addEventListener('resize', debouncedResize);\r\n\r\n    inspectorTabs.addSection('Ranking Information', await rankingInfoTable.build(), 'relevanceInspectorRankingInfo');\r\n    inspectorTabs.addSection('Metadata', await metadataTable.build(), 'relevanceInspectorMetadata');\r\n    inspectorTabs.addSection('Execution Report', await executionReport.build(), 'relevanceInspectorExecutionReport');\r\n    inspectorTabs.addSection('Available Fields', await availableFields.build(), 'relevanceInspectorAvailableFields');\r\n    inspectorTabs.select('relevanceInspectorRankingInfo');\r\n\r\n    container.append(inspectorTabs.navigationSection.el);\r\n    container.append(inspectorTabs.tabContentSection.el);\r\n\r\n    return container;\r\n  }\r\n\r\n  private resize() {\r\n    if (!this.activeTab) {\r\n      return;\r\n    }\r\n    if (!this.tabs[this.activeTab]) {\r\n      return;\r\n    }\r\n    this.tabs[this.activeTab].gridOptions.api.sizeColumnsToFit();\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/RelevanceInspector.ts","import { loadAgGridLibrary } from './AgGrid';\r\nimport { first, map, each, flatten, find } from 'underscore';\r\n\r\nimport agGridModule = require('ag-grid/main');\r\nimport { Dom, $$, StringUtils, StreamHighlightUtils } from '../../UtilsModules';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { IResultsComponentBindings } from '../Base/ResultsComponentBindings';\r\nimport ResultListModule = require('../ResultList/ResultList');\r\nimport { ResultLink } from '../ResultLink/ResultLink';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\ndeclare const agGrid: typeof agGridModule;\r\n\r\nexport interface ITableDataSource extends agGridModule.ColDef {\r\n  content?: any;\r\n  width?: number;\r\n  children?: Record<string, ITableDataSource>[];\r\n  cellRenderer?: new () => agGridModule.ICellRendererComp;\r\n}\r\n\r\nexport const defaultGridOptions: agGridModule.GridOptions = {\r\n  domLayout: 'autoHeight',\r\n  enableColResize: true,\r\n  rowHeight: 100,\r\n  enableRangeSelection: true,\r\n  suppressRowClickSelection: true,\r\n  suppressCellSelection: true,\r\n  defaultColDef: {\r\n    width: 100\r\n  },\r\n  enableSorting: true,\r\n  autoSizePadding: 10\r\n};\r\n\r\nexport class TableBuilder {\r\n  private gridOptions: agGridModule.GridOptions | undefined;\r\n\r\n  public async build(sources: Record<string, ITableDataSource>[], table: Dom, gridOptions = defaultGridOptions) {\r\n    const firstData = first(sources) || {};\r\n    const mapToAgGridFormat = (value: agGridModule.ColDef & agGridModule.ColGroupDef, key: string): any => {\r\n      if (value.children) {\r\n        return {\r\n          field: key,\r\n          headerName: key,\r\n          marryChildren: true,\r\n          children: flatten(\r\n            value.children.map((child: any) => {\r\n              return map(child, mapToAgGridFormat);\r\n            })\r\n          )\r\n        };\r\n      } else {\r\n        return {\r\n          field: key,\r\n          headerName: key,\r\n          ...value\r\n        };\r\n      }\r\n    };\r\n\r\n    const columnDefs = map(firstData as any, mapToAgGridFormat) as agGridModule.ColDef[];\r\n\r\n    const rowData = map(sources, source => {\r\n      const merged: any = {};\r\n\r\n      const extractContent = (value: ITableDataSource & agGridModule.ColGroupDef, key: string) => {\r\n        if (value.content) {\r\n          merged[key] = value.content;\r\n        } else if (value.children) {\r\n          each(value.children, (child: any) => {\r\n            each(child, extractContent);\r\n          });\r\n        }\r\n      };\r\n\r\n      each(source, extractContent as any);\r\n      return merged;\r\n    });\r\n\r\n    this.gridOptions = {\r\n      ...defaultGridOptions,\r\n      columnDefs,\r\n      rowData,\r\n      ...gridOptions\r\n    };\r\n\r\n    await loadAgGridLibrary();\r\n    const grid = new agGrid.Grid(table.el, this.gridOptions);\r\n\r\n    return { grid, gridOptions: this.gridOptions };\r\n  }\r\n\r\n  public static thumbnailCell(result: IQueryResult, bindings: IComponentBindings): Record<string, ITableDataSource> {\r\n    return {\r\n      Document: {\r\n        content: { result, bindings },\r\n        cellRenderer: ThumbnailHtmlRenderer,\r\n        width: 550,\r\n        getQuickFilterText: (params: agGridModule.GetQuickFilterTextParams) => {\r\n          return '';\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nexport class ThumbnailHtmlRenderer implements agGridModule.ICellRendererComp {\r\n  private element: any | undefined;\r\n  private currentFilter: string | undefined;\r\n\r\n  public init(params?: { value: { result: IQueryResult; bindings: IComponentBindings }; api: any }) {\r\n    if (params) {\r\n      this.element = params.value;\r\n      this.currentFilter = params.api.filterManager.quickFilter;\r\n    }\r\n  }\r\n\r\n  public getGui(): HTMLElement {\r\n    const cell = $$('div', { className: 'coveo-relevance-inspector-thumbnail-cell' });\r\n    if (this.element) {\r\n      const thumbnail = this.thumbnail(this.element.result, this.element.bindings);\r\n      cell.append(thumbnail.el);\r\n    } else {\r\n      cell.append($$('p', undefined, '-- NULL --').el);\r\n    }\r\n    return cell.el;\r\n  }\r\n\r\n  private thumbnail(result: IQueryResult, bindings: IResultsComponentBindings) {\r\n    let dom: Dom;\r\n\r\n    if (bindings && result) {\r\n      const resultLists = bindings.searchInterface.getComponents('ResultList') as ResultListModule.ResultList[];\r\n      const firstActiveResultList = find(resultLists, resultList => !resultList.disabled);\r\n\r\n      if (firstActiveResultList) {\r\n        dom = $$('div', {\r\n          className: 'coveo-relevance-inspector-result-thumbnail'\r\n        });\r\n        firstActiveResultList.buildResult(result).then(builtResult => {\r\n          dom.append(builtResult);\r\n        });\r\n      } else {\r\n        dom = $$('a', {\r\n          className: 'CoveoResultLink'\r\n        });\r\n        new ResultLink(dom.el, { alwaysOpenInNewWindow: true }, bindings, result);\r\n      }\r\n\r\n      if (this.currentFilter) {\r\n        this.highlightSearch(dom.el, this.currentFilter);\r\n      }\r\n    } else {\r\n      dom = $$('div', undefined, '-- NULL --');\r\n    }\r\n\r\n    return dom;\r\n  }\r\n\r\n  public refresh(params: any): boolean {\r\n    return true;\r\n  }\r\n\r\n  private highlightSearch(elementToSearch: HTMLElement, search: string) {\r\n    let asHTMLElement: HTMLElement = elementToSearch;\r\n\r\n    if (asHTMLElement != null && asHTMLElement.innerText != null) {\r\n      const match = asHTMLElement.innerText.split(new RegExp('(?=' + StringUtils.regexEncode(search) + ')', 'gi'));\r\n      asHTMLElement.innerHTML = '';\r\n      match.forEach(value => {\r\n        const regex = new RegExp('(' + StringUtils.regexEncode(search) + ')', 'i');\r\n        const group = value.match(regex);\r\n        let span;\r\n\r\n        if (group != null) {\r\n          span = $$('span', {\r\n            className: 'coveo-relevance-inspector-highlight'\r\n          });\r\n          span.text(group[1]);\r\n          asHTMLElement.appendChild(span.el);\r\n          span = $$('span');\r\n          span.text(value.substr(group[1].length));\r\n          asHTMLElement.appendChild(span.el);\r\n        } else {\r\n          span = $$('span');\r\n          span.text(value);\r\n          asHTMLElement.appendChild(span.el);\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport class GenericHtmlRenderer implements agGridModule.ICellRendererComp {\r\n  private element: string | undefined;\r\n  private currentFilter: string | undefined;\r\n\r\n  public init(params?: any) {\r\n    if (params && params.api) {\r\n      this.element = params.value;\r\n      this.currentFilter = params.api.filterManager.quickFilter;\r\n    }\r\n  }\r\n  public getGui(): HTMLElement {\r\n    if (this.element && this.currentFilter) {\r\n      return $$('div', undefined, StreamHighlightUtils.highlightStreamHTML(this.element, { Precision: ['precision'] }, {})).el;\r\n    } else if (this.element) {\r\n      return $$('div', undefined, this.element).el;\r\n    } else {\r\n      return $$('div', undefined, '-- NULL --').el;\r\n    }\r\n  }\r\n\r\n  public refresh(params: any): boolean {\r\n    return true;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/TableBuilder.ts","import { ExecutionReportAuthenticationSection } from './ExecutionReportAuthenticationSection';\r\nimport { ExecutionReportResolvedPipelineSection } from './ExecutionReportResolvedPipelineSection';\r\nimport { ExecutionReportQueryOverrideSection } from './ExecutionReportQueryOverrideSection';\r\nimport { ExecutionReportSimpleSection } from './ExecutionReportSimpleSection';\r\nimport { ExecutionReportEffectiveIndexQuerySection } from './ExecutionReportEffectiveIndexQuerySection';\r\nimport { IQueryResults } from '../../rest/QueryResults';\r\nimport { $$, Dom } from '../../UtilsModules';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { IRelevanceInspectorTab } from './RelevanceInspector';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { ExecutionReportRankingModifiers } from './ExecutionReportRankingModifiers';\r\nimport { IResultsComponentBindings, Logger } from '../../Core';\r\nimport { ExecutionReportITDSection } from './ExecutionReportITDSection';\r\n\r\nexport interface IExecutionReport {\r\n  duration: number;\r\n  children: IExecutionReportSection[];\r\n}\r\n\r\nexport interface IRankingExpressionExecutionReport {\r\n  expression: string;\r\n  modifer: number;\r\n  isConstant: boolean;\r\n}\r\n\r\nexport enum EXECUTION_REPORT_SECTION {\r\n  PERFORM_AUTHENTICATION = 'PerformAuthentication',\r\n  RESOLVE_PIPELINE = 'ResolvePipeline',\r\n  QUERY_PARAM_OVERRIDE = 'ApplyQueryParamOverrideFeature',\r\n  THESAURUS = 'ApplyThesaurusFeature',\r\n  PREPROCESS_QUERY_EXPRESSION = 'PreprocessQueryExpression',\r\n  PREPROCESS_QUERY = 'PreprocessQuery',\r\n  STOP_WORDS = 'ApplyStopWordFeature',\r\n  FILTERS = 'ApplyFilterFeature',\r\n  RANKING = 'ApplyRankingFeature',\r\n  TOP_RESULT = 'ApplyTopResultFeature',\r\n  RANKING_WEIGHT = 'ApplyRankingWeightFeature',\r\n  INDEX_QUERY = 'Send query to index',\r\n  TOP_CLICKS = 'EvaluatingTopClicks',\r\n  PARTIAL_MATCH = 'PartialMatch',\r\n  NONE = 'NONE'\r\n}\r\n\r\nexport interface IExecutionReportSection {\r\n  name: string;\r\n  duration: number;\r\n  result: Record<string, any>;\r\n  description: string;\r\n  children?: IExecutionReportSection[];\r\n  applied?: string[];\r\n}\r\n\r\nexport interface IExecutionReportSectionBuilder {\r\n  build(executionReport: IExecutionReport): Promise<{ container: Dom; gridOptions?: agGridModule.GridOptions }>;\r\n}\r\n\r\nexport class ExecutionReport implements IRelevanceInspectorTab {\r\n  public gridOptions: agGridModule.GridOptions;\r\n  constructor(public results: IQueryResults, public bindings: IComponentBindings) {}\r\n\r\n  public static standardSectionHeader(title: string) {\r\n    const container = $$('div');\r\n    container.append($$('h4', undefined, title).el);\r\n\r\n    const agGridElement = $$('div', {\r\n      className: 'ag-theme-fresh'\r\n    });\r\n    container.append(agGridElement.el);\r\n\r\n    return {\r\n      container,\r\n      agGridElement\r\n    };\r\n  }\r\n\r\n  public async build() {\r\n    if (!this.results.executionReport) {\r\n      new Logger(this).error(\r\n        'Could not open execution report : Missing execution report on results. Try executing the query in debug mode.'\r\n      );\r\n      return $$('div');\r\n    }\r\n\r\n    const container = $$('div', {\r\n      className: 'execution-report-debug'\r\n    });\r\n\r\n    const gridOptions: agGridModule.GridOptions[] = [];\r\n\r\n    const authenticationSection = await new ExecutionReportAuthenticationSection().build(this.results.executionReport);\r\n    container.append(authenticationSection.container.el);\r\n    if (authenticationSection.gridOptions) {\r\n      gridOptions.push(authenticationSection.gridOptions);\r\n    }\r\n\r\n    const resolvedPipelineSection = await new ExecutionReportResolvedPipelineSection().build(this.results.executionReport);\r\n    container.append(resolvedPipelineSection.container.el);\r\n    if (resolvedPipelineSection.gridOptions) {\r\n      gridOptions.push(resolvedPipelineSection.gridOptions);\r\n    }\r\n\r\n    const resolvedRankingModifiers = await new ExecutionReportRankingModifiers().build(\r\n      this.results.results,\r\n      this.results.rankingExpressions,\r\n      this.bindings as IResultsComponentBindings\r\n    );\r\n    container.append(resolvedRankingModifiers.container.el);\r\n    if (resolvedRankingModifiers.gridOptions) {\r\n      gridOptions.push(resolvedRankingModifiers.gridOptions);\r\n    }\r\n\r\n    const queryParamOverrideSection = await new ExecutionReportQueryOverrideSection().build(this.results.executionReport);\r\n    container.append(queryParamOverrideSection.container.el);\r\n    if (queryParamOverrideSection.gridOptions) {\r\n      gridOptions.push(queryParamOverrideSection.gridOptions);\r\n    }\r\n\r\n    const thesaurusSection = await new ExecutionReportSimpleSection(\r\n      EXECUTION_REPORT_SECTION.PREPROCESS_QUERY_EXPRESSION,\r\n      EXECUTION_REPORT_SECTION.THESAURUS,\r\n      'Thesaurus'\r\n    ).build(this.results.executionReport);\r\n\r\n    container.append(thesaurusSection.container.el);\r\n    if (thesaurusSection.gridOptions) {\r\n      gridOptions.push(thesaurusSection.gridOptions);\r\n    }\r\n\r\n    const stopWordsSection = await new ExecutionReportSimpleSection(\r\n      EXECUTION_REPORT_SECTION.PREPROCESS_QUERY_EXPRESSION,\r\n      EXECUTION_REPORT_SECTION.STOP_WORDS,\r\n      'Stop words'\r\n    ).build(this.results.executionReport);\r\n    container.append(stopWordsSection.container.el);\r\n    if (stopWordsSection.gridOptions) {\r\n      gridOptions.push(stopWordsSection.gridOptions);\r\n    }\r\n\r\n    const filtersSection = await new ExecutionReportSimpleSection(\r\n      EXECUTION_REPORT_SECTION.PREPROCESS_QUERY,\r\n      EXECUTION_REPORT_SECTION.FILTERS,\r\n      'Filters'\r\n    ).build(this.results.executionReport);\r\n    container.append(filtersSection.container.el);\r\n    if (filtersSection.gridOptions) {\r\n      gridOptions.push(filtersSection.gridOptions);\r\n    }\r\n\r\n    const rankingSection = await new ExecutionReportSimpleSection(\r\n      EXECUTION_REPORT_SECTION.PREPROCESS_QUERY,\r\n      EXECUTION_REPORT_SECTION.RANKING,\r\n      'Ranking'\r\n    ).build(this.results.executionReport);\r\n    container.append(rankingSection.container.el);\r\n    if (rankingSection.gridOptions) {\r\n      gridOptions.push(rankingSection.gridOptions);\r\n    }\r\n\r\n    const topResultsSection = await new ExecutionReportSimpleSection(\r\n      EXECUTION_REPORT_SECTION.PREPROCESS_QUERY,\r\n      EXECUTION_REPORT_SECTION.TOP_RESULT,\r\n      'Featured Results'\r\n    ).build(this.results.executionReport);\r\n    container.append(topResultsSection.container.el);\r\n\r\n    if (topResultsSection.gridOptions) {\r\n      gridOptions.push(topResultsSection.gridOptions);\r\n    }\r\n\r\n    const itdSection = await new ExecutionReportITDSection().build(this.results.executionReport);\r\n    container.append(itdSection.container.el);\r\n\r\n    if (itdSection.gridOptions) {\r\n      gridOptions.push(itdSection.gridOptions);\r\n    }\r\n\r\n    const rankingWeightsSection = await new ExecutionReportSimpleSection(\r\n      EXECUTION_REPORT_SECTION.PREPROCESS_QUERY,\r\n      EXECUTION_REPORT_SECTION.RANKING_WEIGHT,\r\n      'Ranking weights'\r\n    ).build(this.results.executionReport);\r\n    container.append(rankingWeightsSection.container.el);\r\n    if (rankingWeightsSection.gridOptions) {\r\n      gridOptions.push(rankingWeightsSection.gridOptions);\r\n    }\r\n\r\n    const indexQuerySection = await new ExecutionReportEffectiveIndexQuerySection().build(this.results.executionReport);\r\n    container.append(indexQuerySection.container.el);\r\n\r\n    this.gridOptions = {\r\n      api: {\r\n        sizeColumnsToFit: () => {\r\n          gridOptions.forEach(option => (option.api ? option.api.sizeColumnsToFit() : null));\r\n        }\r\n      }\r\n    } as any;\r\n\r\n    return container;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReport.ts","import { ITableDataSource, GenericHtmlRenderer } from './TableBuilder';\r\nimport { isArray, isObject, each } from 'underscore';\r\nimport { $$ } from '../../utils/Dom';\r\n\r\nexport type GenericValueOutputType = string | number | string[] | Record<string, any> | boolean | undefined;\r\n\r\nconst defaultNullOutput = '-- NULL --';\r\n\r\nexport class GenericValueOutput {\r\n  public output(section: GenericValueOutputType): ITableDataSource {\r\n    if (isArray(section)) {\r\n      return this.arrayJoined(section);\r\n    }\r\n    if (isObject(section)) {\r\n      return this.objectJoined(section as Record<string, any>);\r\n    }\r\n\r\n    return this.simpleValue(section as string | number | undefined);\r\n  }\r\n\r\n  private simpleValue(section: string | number | undefined) {\r\n    return {\r\n      content: this.valueOrNullOutput(section)\r\n    };\r\n  }\r\n\r\n  private objectJoined(section: Record<string, any>): ITableDataSource {\r\n    let content = '';\r\n    each(section, (value, key) => {\r\n      if (isArray(value)) {\r\n        const list = $$('dl');\r\n        list.append($$('dt', undefined, key).el);\r\n        const innerList = $$('dd', undefined, this.arrayJoined(value).content);\r\n        list.append(innerList.el);\r\n        content += list.el.outerHTML;\r\n      } else if (isObject(value)) {\r\n        content += this.objectJoined(value).content;\r\n      } else {\r\n        const list = $$('dl');\r\n        list.append($$('dt', undefined, key).el);\r\n        list.append($$('dd', undefined, this.valueOrNullOutput(value)).el);\r\n\r\n        content += list.el.outerHTML;\r\n      }\r\n    });\r\n\r\n    return {\r\n      content,\r\n      cellRenderer: GenericHtmlRenderer\r\n    };\r\n  }\r\n\r\n  private arrayJoined(section: string[] | undefined): ITableDataSource {\r\n    if (!section || section.length == 0) {\r\n      return {\r\n        content: defaultNullOutput\r\n      };\r\n    }\r\n\r\n    const list = $$('ul', {\r\n      className: 'relevance-inspector-list-output'\r\n    });\r\n\r\n    section.forEach(sectionValue => {\r\n      if (isObject(sectionValue)) {\r\n        list.append($$('li', undefined, this.objectJoined(sectionValue as any).content).el);\r\n      } else {\r\n        list.append($$('li', undefined, this.valueOrNullOutput(sectionValue)).el);\r\n      }\r\n    });\r\n    return {\r\n      content: list.el.outerHTML,\r\n      cellRenderer: GenericHtmlRenderer\r\n    };\r\n  }\r\n\r\n  private valueOrNullOutput(value: any) {\r\n    if (value != null && value !== '') {\r\n      return value.toString();\r\n    }\r\n    return defaultNullOutput;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/GenericValueOutput.ts","import { IExecutionReportSection } from './ExecutionReport';\r\nimport { GenericValueOutput } from './GenericValueOutput';\r\nimport { ITableDataSource } from './TableBuilder';\r\n\r\nexport class ExecutionReportGenericSection {\r\n  public build(executionReportSection: IExecutionReportSection): Record<string, ITableDataSource> {\r\n    return {\r\n      ...this.descriptionSection(executionReportSection),\r\n      ...this.durationSection(executionReportSection)\r\n    };\r\n  }\r\n\r\n  private descriptionSection(executionReportSection: IExecutionReportSection): Record<string, ITableDataSource> {\r\n    return {\r\n      Description: new GenericValueOutput().output(executionReportSection.description)\r\n    };\r\n  }\r\n\r\n  private durationSection(executionReportSection: IExecutionReportSection): Record<string, ITableDataSource> {\r\n    return {\r\n      Duration: new GenericValueOutput().output(`${executionReportSection.duration} ms`)\r\n    };\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportGenericSection.ts","import { object, map, keys, reduce } from 'underscore';\r\nimport { StringUtils } from '../../utils/StringUtils';\r\nimport { $$, Dom } from '../../utils/Dom';\r\n\r\nexport interface IRankingInfo {\r\n  documentWeights: IListOfWeights;\r\n  totalWeight: number;\r\n  termsWeight: IListOfTermsWeights;\r\n  qreWeights: IListOfQRE[];\r\n}\r\n\r\nexport interface IListOfWeights {\r\n  Adjacency: number;\r\n  'Collaborative rating': number;\r\n  Custom: number;\r\n  Date: number;\r\n  QRE: number;\r\n  Quality: number;\r\n  'Ranking functions': number;\r\n  Source: number;\r\n  Title: number;\r\n  [key: string]: number;\r\n}\r\n\r\nexport interface IListOfQRE {\r\n  expression: string;\r\n  score: number;\r\n}\r\n\r\nexport type IListOfTermsWeights = Record<string, IWeightsPerTerm>;\r\n\r\nexport interface IWeightsPerTerm {\r\n  Weights: IWeightsPerTermBreakdown;\r\n  terms: Record<string, IWeightsPerTermPerDocument>;\r\n}\r\n\r\nexport interface IWeightsPerTermBreakdown {\r\n  Casing: number;\r\n  Concept: number;\r\n  Formatted: number;\r\n  Frequency: number;\r\n  Relation: number;\r\n  Summary: number;\r\n  Title: number;\r\n  URI: number;\r\n  [key: string]: number;\r\n}\r\n\r\nexport interface IWeightsPerTermPerDocument {\r\n  Correlation: number;\r\n  'TF-IDF': number;\r\n}\r\n\r\nexport const buildListOfTermsElement = (weightPerTerm: IWeightsPerTermBreakdown): Dom => {\r\n  const listItems = map(weightPerTerm, (value, key) => {\r\n    return {\r\n      dt: $$(\r\n        'dt',\r\n        {\r\n          className: 'coveo-relevance-inspector-dt'\r\n        },\r\n        `${key}`\r\n      ),\r\n      dd: $$(\r\n        'dd',\r\n        {\r\n          className: 'coveo-relevance-inspector-dd'\r\n        },\r\n        `${value}`\r\n      )\r\n    };\r\n  });\r\n  const total = reduce(weightPerTerm, (memo, value) => memo + value, 0);\r\n  const list = $$('dl');\r\n  listItems.forEach(item => {\r\n    list.append(item.dt.el);\r\n    list.append(item.dd.el);\r\n  });\r\n  list.append($$('dt', { className: 'coveo-relevance-inspector-dt' }, `Total`).el);\r\n  list.append($$('dd', { className: 'coveo-relevance-inspector-dd coveo-relevance-inspector-highlight' }, `${total}`).el);\r\n  return list;\r\n};\r\n\r\nexport const parseRankingInfo = (value: string): IRankingInfo | null => {\r\n  const REGEX_EXTRACT_DOCUMENT_WEIGHTS = /Document weights:\\n((?:.)*?)\\n+/g;\r\n  const REGEX_EXTRACT_TERMS_WEIGHTS = /Terms weights:\\n((?:.|\\n)*)\\n+/g;\r\n  const REGEX_EXTRACT_TOTAL_WEIGHTS = /Total weight: ([0-9]+)/g;\r\n\r\n  if (value) {\r\n    const docWeightsRegexResult = REGEX_EXTRACT_DOCUMENT_WEIGHTS.exec(value);\r\n    const termsWeightRegexResult = REGEX_EXTRACT_TERMS_WEIGHTS.exec(value);\r\n    const totalWeigthRegexResult = REGEX_EXTRACT_TOTAL_WEIGHTS.exec(value);\r\n\r\n    const qreWeights = parseQREWeights(value);\r\n    const documentWeights = parseWeights(docWeightsRegexResult ? docWeightsRegexResult[1] : null);\r\n    const termsWeight = parseTermsWeights(termsWeightRegexResult);\r\n    const totalWeight = totalWeigthRegexResult ? Number(totalWeigthRegexResult[1]) : null;\r\n\r\n    return {\r\n      documentWeights,\r\n      termsWeight,\r\n      totalWeight,\r\n      qreWeights\r\n    };\r\n  }\r\n  return null;\r\n};\r\n\r\nconst parseWeights = (value: string | null): IListOfWeights | null => {\r\n  const REGEX_EXTRACT_LIST_OF_WEIGHTS = /(\\w+(?:\\s\\w+)*): ([-0-9]+)/g;\r\n  const REGEX_EXTRACT_WEIGHT_GROUP = /^(\\w+(?:\\s\\w+)*): ([-0-9]+)$/;\r\n\r\n  if (value) {\r\n    const listOfWeight = value.match(REGEX_EXTRACT_LIST_OF_WEIGHTS);\r\n\r\n    if (listOfWeight) {\r\n      return object(\r\n        listOfWeight.map(weight => {\r\n          let weightGroup = weight.match(REGEX_EXTRACT_WEIGHT_GROUP);\r\n\r\n          if (weightGroup) {\r\n            const weightAppliedOn = weightGroup[1];\r\n            const weightValue = weightGroup[2];\r\n            return [weightAppliedOn, Number(weightValue)];\r\n          }\r\n          return null;\r\n        })\r\n      ) as IListOfWeights;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst parseTermsWeights = (termsWeight: RegExpExecArray | null): IListOfTermsWeights | null => {\r\n  const REGEX_EXTRACT_GROUP_OF_TERMS = /((?:[^:]+: [0-9]+, [0-9]+; )+)\\n((?:\\w+: [0-9]+; )+)/g;\r\n  const REGEX_EXTRACT_SINGLE_TERM = /([^:]+): ([0-9]+), ([0-9]+); /g;\r\n\r\n  if (termsWeight && termsWeight[1]) {\r\n    let terms = StringUtils.match(termsWeight[1], REGEX_EXTRACT_GROUP_OF_TERMS);\r\n\r\n    return object(\r\n      map(terms, term => {\r\n        let words = object(\r\n          map(StringUtils.match(term[1], REGEX_EXTRACT_SINGLE_TERM), word => {\r\n            return [\r\n              word[1],\r\n              {\r\n                Correlation: Number(word[2]),\r\n                'TF-IDF': Number(word[3])\r\n              }\r\n            ];\r\n          })\r\n        );\r\n        const weights = parseWeights(term[2]);\r\n        return [\r\n          keys(words).join(', '),\r\n          {\r\n            terms: words,\r\n            Weights: weights\r\n          }\r\n        ];\r\n      })\r\n    ) as IListOfTermsWeights;\r\n  }\r\n  return null;\r\n};\r\n\r\nconst parseQREWeights = (value: string): IListOfQRE[] => {\r\n  const REGEX_EXTRACT_QRE_WEIGHTS = /(Expression:\\s\".*\")\\sScore:\\s(?!0)([0-9]+)\\n+/g;\r\n\r\n  let qreWeightsRegexResult = REGEX_EXTRACT_QRE_WEIGHTS.exec(value);\r\n\r\n  const qreWeights: IListOfQRE[] = [];\r\n  while (qreWeightsRegexResult) {\r\n    qreWeights.push({\r\n      expression: qreWeightsRegexResult[1],\r\n      score: parseInt(qreWeightsRegexResult[2], 10)\r\n    });\r\n    qreWeightsRegexResult = REGEX_EXTRACT_QRE_WEIGHTS.exec(value);\r\n  }\r\n\r\n  return qreWeights;\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/RankingInfoParser.ts","import {\r\n  IExecutionReportSectionBuilder,\r\n  EXECUTION_REPORT_SECTION,\r\n  IExecutionReportSection,\r\n  IExecutionReport,\r\n  ExecutionReport\r\n} from './ExecutionReport';\r\nimport { findWhere, find } from 'underscore';\r\nimport { ExecutionReportGenericSection } from './ExecutionReportGenericSection';\r\nimport { GenericValueOutput } from './GenericValueOutput';\r\nimport { TableBuilder } from './TableBuilder';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { Dom } from '../../Core';\r\n\r\nexport interface IExecutionReportSimpleSection extends IExecutionReportSection {\r\n  applied: string[];\r\n}\r\n\r\nexport class ExecutionReportSimpleSection implements IExecutionReportSectionBuilder {\r\n  public constructor(\r\n    public topLevelProperty: EXECUTION_REPORT_SECTION,\r\n    public secondLevelProperty: EXECUTION_REPORT_SECTION,\r\n    public sectionTitle: string\r\n  ) {}\r\n\r\n  public async build(executionReport: IExecutionReport): Promise<{ container: Dom; gridOptions: agGridModule.GridOptions }> {\r\n    const { container, agGridElement } = ExecutionReport.standardSectionHeader(this.sectionTitle);\r\n    let gridOptions: agGridModule.GridOptions;\r\n    const topLevelProperty = find(executionReport.children, child => {\r\n      return child.name == this.topLevelProperty && child.children && findWhere(child.children, { name: this.secondLevelProperty });\r\n    });\r\n\r\n    if (topLevelProperty && topLevelProperty.children) {\r\n      const secondLevelProperty = findWhere(topLevelProperty.children, { name: this.secondLevelProperty }) as\r\n        | IExecutionReportSimpleSection\r\n        | undefined;\r\n\r\n      if (secondLevelProperty) {\r\n        const dataSource = [\r\n          {\r\n            ...new ExecutionReportGenericSection().build(secondLevelProperty),\r\n            ...{ Applied: new GenericValueOutput().output(secondLevelProperty.applied) }\r\n          }\r\n        ];\r\n\r\n        const tableBuilder = await new TableBuilder().build(dataSource, agGridElement);\r\n        gridOptions = tableBuilder.gridOptions;\r\n      }\r\n    } else {\r\n      const tableBuilder = await new TableBuilder().build(\r\n        [\r\n          {\r\n            [`${this.sectionTitle}`]: {\r\n              content: `NO DATA AVAILABLE FOR ${this.sectionTitle} IN CURRENT EXECUTION REPORT`\r\n            }\r\n          }\r\n        ],\r\n        agGridElement\r\n      );\r\n\r\n      gridOptions = tableBuilder.gridOptions;\r\n    }\r\n\r\n    return { container, gridOptions };\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportSimpleSection.ts","import { parseRankingInfo, IRankingInfo, buildListOfTermsElement, IWeightsPerTerm } from './RankingInfoParser';\r\nimport { each, uniq, contains, chain, reduce } from 'underscore';\r\nimport { TableBuilder, ITableDataSource, GenericHtmlRenderer } from './TableBuilder';\r\nimport { $$, Dom } from '../../utils/Dom';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { IResultsComponentBindings } from '../Base/ResultsComponentBindings';\r\nimport { IRelevanceInspectorTab } from './RelevanceInspector';\r\nimport agGridModule = require('ag-grid/main');\r\n\r\nexport class RankingInfoTable implements IRelevanceInspectorTab {\r\n  public gridOptions: agGridModule.GridOptions;\r\n  constructor(public results: IQueryResult[], public bindings: IComponentBindings) {}\r\n\r\n  public async build(): Promise<Dom> {\r\n    const container = $$('div');\r\n\r\n    const agGridElement = $$('div', {\r\n      className: 'ag-theme-fresh'\r\n    });\r\n    container.append(agGridElement.el);\r\n\r\n    let topLevelInfoThatHaveAtLeastANonZeroValue: string[] = [];\r\n    let containsKeywordRankingInfo = false;\r\n\r\n    this.results.forEach(result => {\r\n      const rankingInfo = parseRankingInfo(result.rankingInfo);\r\n      containsKeywordRankingInfo = rankingInfo.termsWeight != null;\r\n      if (rankingInfo && rankingInfo.documentWeights) {\r\n        each(rankingInfo.documentWeights, (value: number, key: string) => {\r\n          if (value != 0) {\r\n            topLevelInfoThatHaveAtLeastANonZeroValue.push(key);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    topLevelInfoThatHaveAtLeastANonZeroValue = uniq(topLevelInfoThatHaveAtLeastANonZeroValue);\r\n\r\n    const data = this.results.map(result => {\r\n      const rankingInfo = parseRankingInfo(result.rankingInfo);\r\n\r\n      if (rankingInfo) {\r\n        const documentsWeights = this.buildTopLevelDocumentsWeights(rankingInfo, topLevelInfoThatHaveAtLeastANonZeroValue);\r\n        const breakdownPerTerm: Record<string, ITableDataSource> = {};\r\n\r\n        const onlyTopFewKeywords: Record<string, IWeightsPerTerm> = {};\r\n\r\n        chain(rankingInfo.termsWeight)\r\n          .keys()\r\n          .sortBy(key => {\r\n            const total = reduce(rankingInfo.termsWeight[key].Weights, (memo, value) => memo + value, 0);\r\n            return total;\r\n          })\r\n          .reverse()\r\n          .first(3)\r\n          .each(key => {\r\n            onlyTopFewKeywords[key] = rankingInfo.termsWeight[key];\r\n          });\r\n\r\n        each(onlyTopFewKeywords, (value, key) => {\r\n          const builtKey = `Keyword: ${key}`;\r\n          breakdownPerTerm[builtKey] = {\r\n            content: buildListOfTermsElement(value.Weights).el.outerHTML,\r\n            cellRenderer: GenericHtmlRenderer,\r\n            width: 200\r\n          };\r\n        });\r\n\r\n        const totalContent = rankingInfo.totalWeight ? rankingInfo.totalWeight : 0;\r\n        return {\r\n          ...TableBuilder.thumbnailCell(result, this.bindings as IResultsComponentBindings),\r\n          ...documentsWeights,\r\n          ...breakdownPerTerm,\r\n          ...{ Total: { content: totalContent || 0 } }\r\n        };\r\n      }\r\n      return {};\r\n    });\r\n\r\n    const { gridOptions } = await new TableBuilder().build(data, agGridElement, {\r\n      getRowHeight: () => {\r\n        return containsKeywordRankingInfo ? 400 : 250;\r\n      },\r\n      onGridReady: params => {\r\n        setTimeout(() => {\r\n          if (params) {\r\n            params.api.sizeColumnsToFit();\r\n            params.api.setSortModel([{ colId: 'Total', sort: 'desc' }]);\r\n          }\r\n        }, 0);\r\n      }\r\n    });\r\n\r\n    this.gridOptions = gridOptions;\r\n\r\n    return container;\r\n  }\r\n\r\n  private buildTopLevelDocumentsWeights(rankingInfo: IRankingInfo, hasAtLeastOneNonZeroValue: string[]): Record<string, ITableDataSource> {\r\n    const documentWeights: Record<string, ITableDataSource> = {};\r\n    each(rankingInfo.documentWeights || {}, (value, key) => {\r\n      if (contains(hasAtLeastOneNonZeroValue, key)) documentWeights[key] = { content: value || 0 };\r\n    });\r\n    return documentWeights;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/RankingInfoTable.ts","import { $$ } from '../../utils/Dom';\r\n\r\nlet isAgGridLoaded = false;\r\nlet isAgGridLoading: Promise<boolean> | null = null;\r\nconst agGridLibUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ag-grid/16.0.1/ag-grid.min.noStyle.js';\r\nconst agGridStyleBaseUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ag-grid/16.0.1/styles/ag-grid.css';\r\nconst agGridStyleFreshUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ag-grid/16.0.1/styles/ag-theme-fresh.css';\r\n\r\ndeclare const agGrid: any;\r\n\r\n// Should only be used for UT\r\nexport const reset = (doc = document) => {\r\n  isAgGridLoaded = false;\r\n  isAgGridLoading = null;\r\n};\r\n\r\nexport const loadAgGridLibrary = (doc = document) => {\r\n  return new Promise((resolve, reject) => {\r\n    if (isAgGridLoaded) {\r\n      resolve(true);\r\n    } else if (typeof agGrid !== 'undefined') {\r\n      isAgGridLoaded = true;\r\n      resolve(true);\r\n    } else {\r\n      addAgGridScriptsToDocument(doc);\r\n      isAgGridLoading.then(() => resolve(true));\r\n      isAgGridLoading.catch(() => reject(false));\r\n    }\r\n  });\r\n};\r\n\r\nconst addAgGridScriptsToDocument = (doc = document) => {\r\n  if (!isAgGridLoading) {\r\n    const script = $$('script', {\r\n      src: agGridLibUrl,\r\n      type: 'text/javascript',\r\n      async: true\r\n    }).el as HTMLScriptElement;\r\n\r\n    const styleBase = $$('link', {\r\n      href: agGridStyleBaseUrl,\r\n      rel: 'stylesheet',\r\n      type: 'text/css'\r\n    }).el as HTMLLinkElement;\r\n\r\n    const style = $$('link', {\r\n      href: agGridStyleFreshUrl,\r\n      rel: 'stylesheet',\r\n      type: 'text/css'\r\n    }).el as HTMLLinkElement;\r\n\r\n    doc.head.appendChild(script);\r\n    doc.head.appendChild(styleBase);\r\n    doc.head.appendChild(style);\r\n\r\n    isAgGridLoading = new Promise((resolveScriptLoaded, rejectScriptLoaded) => {\r\n      script.onload = () => {\r\n        resolveScriptLoaded(true);\r\n      };\r\n      script.onerror = () => {\r\n        isAgGridLoaded = false;\r\n        rejectScriptLoaded(false);\r\n      };\r\n    });\r\n  }\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/AgGrid.ts","import { TableBuilder, ITableDataSource } from './TableBuilder';\r\nimport { map, each, find } from 'underscore';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { $$, Dom } from '../../utils/Dom';\r\nimport { StringUtils } from '../../utils/StringUtils';\r\nimport { DateUtils } from '../../utils/DateUtils';\r\nimport { IResultsComponentBindings } from '../Base/ResultsComponentBindings';\r\nimport { IRelevanceInspectorTab } from './RelevanceInspector';\r\nimport { TextInput } from '../FormWidgets/TextInput';\r\nimport { IFieldDescription } from '../../rest/FieldDescription';\r\n\r\nexport class MetaDataTable implements IRelevanceInspectorTab {\r\n  public gridOptions: agGridModule.GridOptions;\r\n\r\n  constructor(public results: IQueryResult[], public bindings: IComponentBindings) {}\r\n\r\n  public async build(): Promise<Dom> {\r\n    if (!this.bindings.queryController) {\r\n      return;\r\n    }\r\n\r\n    const fieldsDescription = await this.bindings.queryController.getEndpoint().listFields();\r\n\r\n    const container = $$('div', {\r\n      className: 'metadata-table'\r\n    });\r\n\r\n    const builders = this.results.map(async result => {\r\n      const nestedContainer = $$('div');\r\n      container.append(nestedContainer.el);\r\n\r\n      const nestedAgGrid = $$('div', {\r\n        className: 'ag-theme-fresh'\r\n      });\r\n\r\n      nestedContainer.append(nestedAgGrid.el);\r\n\r\n      const thumbnail = TableBuilder.thumbnailCell(result, this.bindings as IResultsComponentBindings);\r\n      const fields: Record<string, ITableDataSource> = {};\r\n\r\n      fields[`Fields Values`] = {\r\n        content: { result, fieldsDescription },\r\n        cellRenderer: FieldValuesRenderer,\r\n        width: 900,\r\n        getQuickFilterText: (params: agGridModule.GetQuickFilterTextParams) => {\r\n          const allValues = map(params.value.result.raw, val => val.toString());\r\n          return Object.keys(params.value.result.raw)\r\n            .concat(allValues)\r\n            .join(' ');\r\n        },\r\n        onCellDoubleClicked: (params: agGridModule.CellDoubleClickedEvent) => {\r\n          const el = params.event ? (params.event.target as Node) : null;\r\n          if (el && window.getSelection && document.createRange) {\r\n            const selection = window.getSelection();\r\n            const range = document.createRange();\r\n            range.selectNodeContents(el);\r\n            selection.removeAllRanges();\r\n            selection.addRange(range);\r\n          }\r\n        }\r\n      };\r\n\r\n      return await new TableBuilder().build(\r\n        [\r\n          {\r\n            ...thumbnail,\r\n            ...fields\r\n          }\r\n        ],\r\n        nestedAgGrid,\r\n        {\r\n          rowHeight: 400\r\n        }\r\n      );\r\n    });\r\n\r\n    this.gridOptions = {\r\n      api: {\r\n        sizeColumnsToFit: () => {\r\n          builtTables.forEach(built => (built.gridOptions.api ? built.gridOptions.api.sizeColumnsToFit : null));\r\n        }\r\n      }\r\n    } as any;\r\n\r\n    const builtTables = await Promise.all(builders);\r\n    const textInput = new TextInput(input => {\r\n      builtTables.forEach(built => {\r\n        const api = built.gridOptions && built.gridOptions.api;\r\n        if (api) {\r\n          api.setQuickFilter(input.getValue());\r\n          api.onRowHeightChanged();\r\n        }\r\n      });\r\n    }, 'Filters on Fields Values');\r\n    container.prepend(textInput.getElement());\r\n\r\n    return container;\r\n  }\r\n}\r\n\r\nexport class FieldValuesRenderer implements agGridModule.ICellRendererComp {\r\n  private element: any | undefined;\r\n  private currentFilter: string | undefined;\r\n  private params: any;\r\n\r\n  public init(params: any) {\r\n    this.element = params.value;\r\n    this.params = params;\r\n    this.currentFilter = params.api.filterManager.quickFilter;\r\n    params.value.el = this.listAsInput(this.element.result);\r\n  }\r\n\r\n  public getGui(): HTMLElement {\r\n    if (this.element) {\r\n      const list = this.listAsInput(this.element.result);\r\n      this.params.eParentOfValue.appendChild(list.el);\r\n      const height = Math.max(list.height() + 50, 200);\r\n      const maxHeight = Math.min(height, 5000);\r\n      this.params.node.setRowHeight(maxHeight);\r\n      return $$('div', undefined, list).el;\r\n    }\r\n    return $$('div', undefined, 'N.A').el;\r\n  }\r\n\r\n  private listAsInput(result: IQueryResult) {\r\n    const container = $$('div');\r\n\r\n    each(result.raw, (value: string, fieldInResult: string) => {\r\n      if (fieldInResult == 'allmetadatavalues' || fieldInResult.indexOf('sys') == 0) {\r\n        return;\r\n      }\r\n\r\n      if (this.isCurrentElementFilteredOut(value, fieldInResult)) {\r\n        return;\r\n      }\r\n\r\n      const inputGroup = $$('div', { className: 'coveo-relevance-inspector-input-group' });\r\n      const fieldName = $$(\r\n        'div',\r\n        {\r\n          className: 'coveo-relevance-inspector-metadata-name'\r\n        },\r\n        fieldInResult\r\n      );\r\n\r\n      const fieldValue = this.convertFieldValueToReadableFormat(result, fieldInResult);\r\n\r\n      const fieldValueElement = $$(\r\n        'div',\r\n        {\r\n          className: 'coveo-relevance-inspector-metadata-value'\r\n        },\r\n        fieldValue\r\n      );\r\n\r\n      if (this.currentFilter) {\r\n        this.highlightSearch(fieldName.el, this.currentFilter);\r\n        this.highlightSearch(fieldValueElement.el, this.currentFilter);\r\n      }\r\n\r\n      inputGroup.append(fieldName.el);\r\n      inputGroup.append(fieldValueElement.el);\r\n      container.append(inputGroup.el);\r\n    });\r\n\r\n    return container;\r\n  }\r\n\r\n  private isCurrentElementFilteredOut(value: string, fieldInResult: string) {\r\n    if (this.currentFilter) {\r\n      const matchInFieldName = fieldInResult.toLowerCase().indexOf(this.currentFilter.toLowerCase()) != -1;\r\n      const matchInFieldValue = value\r\n        ? value\r\n            .toString()\r\n            .toLowerCase()\r\n            .indexOf(this.currentFilter.toLowerCase()) != -1\r\n        : false;\r\n\r\n      if (!matchInFieldName && !matchInFieldValue) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  private convertFieldValueToReadableFormat(result: IQueryResult, fieldInResult: string) {\r\n    let fieldValue = result.raw[fieldInResult].toString();\r\n    if (this.element.fieldsDescription) {\r\n      const matchingFieldDescription = find(this.element.fieldsDescription as IFieldDescription[], description => {\r\n        return description.name.replace('@', '').toLowerCase() == fieldInResult;\r\n      });\r\n      if (matchingFieldDescription && matchingFieldDescription.fieldType == 'Date') {\r\n        fieldValue = `${DateUtils.convertToStandardDate(fieldValue).toString()} ( Epoch : ${fieldValue} )`;\r\n      }\r\n    }\r\n    return fieldValue;\r\n  }\r\n\r\n  private highlightSearch(elementToSearch: HTMLElement, search: string) {\r\n    let asHTMLElement: HTMLElement = elementToSearch;\r\n\r\n    if (asHTMLElement != null && asHTMLElement.innerText != null) {\r\n      const match = asHTMLElement.innerText.split(new RegExp('(?=' + StringUtils.regexEncode(search) + ')', 'gi'));\r\n      asHTMLElement.innerHTML = '';\r\n      match.forEach(value => {\r\n        const regex = new RegExp('(' + StringUtils.regexEncode(search) + ')', 'i');\r\n        const group = value.match(regex);\r\n        let span;\r\n\r\n        if (group != null) {\r\n          span = $$('span', {\r\n            className: 'coveo-relevance-inspector-highlight'\r\n          });\r\n          span.text(group[1]);\r\n          asHTMLElement.appendChild(span.el);\r\n          span = $$('span');\r\n          span.text(value.substr(group[1].length));\r\n          asHTMLElement.appendChild(span.el);\r\n        } else {\r\n          span = $$('span');\r\n          span.text(value);\r\n          asHTMLElement.appendChild(span.el);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public refresh(params: any): boolean {\r\n    return true;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/MetaDataTable.ts","import { $$, Dom } from '../../utils/Dom';\r\nimport { find } from 'underscore';\r\n\r\nexport class RelevanceInspectorTabs {\r\n  public navigationSection: Dom;\r\n  public tabContentSection: Dom;\r\n  private navigationElements: Dom[];\r\n  private tabContentElements: Dom[];\r\n\r\n  constructor(public onTabChange: (id: string) => void) {\r\n    this.navigationSection = $$('div', {\r\n      className: 'coveo-relevance-inspector-tab-navigation-section'\r\n    });\r\n\r\n    this.tabContentSection = $$('div', {\r\n      className: 'coveo-relevance-inspector-tab-content-section'\r\n    });\r\n\r\n    this.navigationElements = [];\r\n    this.tabContentElements = [];\r\n  }\r\n\r\n  public select(id: string) {\r\n    const navElementToActivate = this.findNavigationById(id);\r\n    const tabContentToActivate = this.findTabContentById(id);\r\n\r\n    if (navElementToActivate && tabContentToActivate) {\r\n      this.activateTabNavigation(navElementToActivate);\r\n      this.activateTabContent(tabContentToActivate);\r\n      if (this.onTabChange) {\r\n        this.onTabChange(id);\r\n      }\r\n    }\r\n  }\r\n\r\n  public addNavigation(caption: string, id: string) {\r\n    const navigationElement = $$(\r\n      'div',\r\n      {\r\n        id,\r\n        className: 'coveo-relevance-inspector-tab'\r\n      },\r\n      caption\r\n    );\r\n\r\n    navigationElement.on('click', () => this.select(id));\r\n\r\n    this.navigationElements.push(navigationElement);\r\n    this.navigationSection.append(navigationElement.el);\r\n\r\n    return this;\r\n  }\r\n\r\n  public addContent(content: Dom, targetId: string) {\r\n    const tabContent = $$('div', {\r\n      className: 'coveo-relevance-inspector-tab-content',\r\n      'data-target-tab': targetId\r\n    });\r\n    tabContent.append(content.el);\r\n\r\n    this.tabContentElements.push(tabContent);\r\n    this.tabContentSection.append(tabContent.el);\r\n\r\n    return this;\r\n  }\r\n\r\n  public addSection(caption: string, content: Dom, id: string) {\r\n    return this.addNavigation(caption, id).addContent(content, id);\r\n  }\r\n\r\n  private findNavigationById(id: string) {\r\n    return find(this.navigationElements, element => element.getAttribute('id') == id);\r\n  }\r\n\r\n  private findTabContentById(id: string) {\r\n    return find(this.tabContentElements, tabContentElement => tabContentElement.getAttribute('data-target-tab') == id);\r\n  }\r\n\r\n  private activateTabNavigation(navigationElement: Dom) {\r\n    this.navigationElements.forEach(element => {\r\n      element.removeClass('coveo-selected');\r\n    });\r\n    navigationElement.addClass('coveo-selected');\r\n  }\r\n\r\n  private activateTabContent(contentElement: Dom) {\r\n    this.tabContentElements.forEach(element => {\r\n      element.removeClass('coveo-selected');\r\n    });\r\n    contentElement.addClass('coveo-selected');\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/RelevanceInspectorTabs.ts","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../node_modules/css-loader/index.js??ref--0-2!../node_modules/resolve-url-loader/index.js??ref--0-3!../node_modules/sass-loader/lib/loader.js??ref--0-4!./_RelevanceInspector.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {\"hmr\":true}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../node_modules/css-loader/index.js??ref--0-2!../node_modules/resolve-url-loader/index.js??ref--0-3!../node_modules/sass-loader/lib/loader.js??ref--0-4!./_RelevanceInspector.scss\", function() {\n\t\t\tvar newContent = require(\"!!../node_modules/css-loader/index.js??ref--0-2!../node_modules/resolve-url-loader/index.js??ref--0-3!../node_modules/sass-loader/lib/loader.js??ref--0-4!./_RelevanceInspector.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_RelevanceInspector.scss\n// module id = 813\n// module chunks = 0","exports = module.exports = require(\"../node_modules/css-loader/lib/css-base.js\")();\n// imports\n\n\n// module\nexports.push([module.id, \"@keyframes fadeout{0%{opacity:1}to{opacity:0}}@keyframes fadein{0%{opacity:0}to{opacity:1}}@keyframes slideInLeft{0%{transform:translateX(-2000px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes coveo-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes loadingFade{0%{opacity:0}50%{opacity:.8}to{opacity:0}}.coveo-relevance-inspector{text-align:center;padding:10px;line-height:20px;height:40px;top:0;z-index:1000}.coveo-relevance-inspector.coveo-hidden{display:none}.relevance-inspector-modal .coveo-logo{height:64px;width:178px}.ag-theme-fresh .ag-cell{overflow:auto;white-space:normal;word-break:break-word}.ag-theme-fresh .ag-font-style{user-select:auto}.coveo-relevance-inspector-tab-navigation-section{margin-bottom:20px}.coveo-relevance-inspector-tab-content{display:none}.coveo-relevance-inspector-tab-content.coveo-selected{display:block;animation:slideInLeft .3s ease-in}.coveo-relevance-inspector-tab{display:-moz-flex;display:-ms-flexbox;display:flex;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;font-size:12px;font-weight:700;padding:0 5px 10px;border-bottom:1px solid #bcc3ca;text-transform:uppercase;border-bottom:2px solid #bcc3ca;display:inline-block;margin-right:10px}.coveo-relevance-inspector-tab.coveo-selected,.coveo-relevance-inspector-tab.coveo-selected:hover{border-bottom:2px solid #263e55}.coveo-relevance-inspector-tab:hover{color:#263e55}.coveo-relevance-inspector-highlight{display:inline-block;font-weight:700}.coveo-relevance-inspector-result-thumbnail{min-width:500px;white-space:normal}.coveo-relevance-inspector-dt{font-weight:700}.coveo-relevance-inspector-dd,.coveo-relevance-inspector-dt{font-size:14px;line-height:14px;padding:2px 0 4px}.coveo-relevance-inspector-metadata-name,.coveo-relevance-inspector-metadata-value{background-color:#e9ecef;display:block;padding:10px;line-height:1.5;border:1px solid #ced4da;border-radius:2px;position:relative;flex:1 1 auto;margin-bottom:0}.coveo-relevance-inspector-metadata-name{max-width:25%;min-width:25%}.coveo-relevance-inspector-metadata-value{width:75%;overflow:auto}.coveo-relevance-inspector-input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.coveo-relevance-inspector-tab-content .coveo-input{margin:40px 0 10px}.coveo-relevance-inspector-available-fields-popup{background:#fff;border:1px solid #bcc3ca;border-radius:2px;padding:10px 5px 10px 20px;width:200px;overflow:hidden;list-style-type:none}.coveo-relevance-inspector-available-fields-popup-value{padding:0 0 10px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.coveo-available-fields-table-button{overflow:hidden;display:inline-block;position:relative;top:50%;transform:translateY(-50%)}.coveo-relevance-inspector-effective-query-collapsible{display:none}.coveo-relevance-inspector-effective-query-collapsible.coveo-active{display:inherit}.coveo-relevance-inspector-table{width:100%;text-align:left;border:none;border-spacing:0}.coveo-relevance-inspector-table tr{height:37px;font-size:15px;line-height:18px}.coveo-relevance-inspector-table tr:first-child{padding-left:10px}.coveo-relevance-inspector-table tr:hover td{background-color:#e6ecf0}.coveo-relevance-inspector-table td{position:relative;vertical-align:middle;padding:9px 15px;margin-left:15px;text-align:left;border-bottom:1px solid #bcc3ca}.coveo-relevance-inspector-table td:first-child{border-left:5px solid transparent}.coveo-relevance-inspector-inline-ranking{border:1px solid #bcc3ca;border-radius:2px;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:10px;margin-bottom:10px}.coveo-relevance-inspector-inline-ranking-section{margin:10px}.coveo-relevance-inspector-inline-ranking-terms{display:none;padding:10px;width:100%}.coveo-relevance-inspector-inline-ranking-terms.coveo-active{display:block;animation:fadein .5s}.coveo-relevance-inspector-inline-ranking-terms h2{border-bottom:1px solid #bcc3ca}.coveo-relevance-inspector-inline-ranking-terms dl{display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-lines:multiple;-moz-box-lines:multiple;box-lines:multiple;-ms-flex-wrap:wrap;flex-wrap:wrap;box-align:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center}.coveo-relevance-inspector-inline-ranking-terms dt{margin:10px 20px}.coveo-relevance-inspector-inline-ranking-terms dd{margin-left:0}.coveo-relevance-inspector-inline-ranking-button{height:35px;margin:5px 0}.relevance-inspector-list-output{padding-left:5px;margin-top:0}.coveo-relevance-inspector-inline-ranking-qre-expression{font-weight:700;word-break:break-all}\", \"\"]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader??ref--0-2!./node_modules/resolve-url-loader??ref--0-3!./node_modules/sass-loader/lib/loader.js??ref--0-4!./sass/_RelevanceInspector.scss\n// module id = 814\n// module chunks = 0","import {\r\n  IExecutionReport,\r\n  EXECUTION_REPORT_SECTION,\r\n  IExecutionReportSection,\r\n  IExecutionReportSectionBuilder,\r\n  ExecutionReport\r\n} from './ExecutionReport';\r\nimport { TableBuilder } from './TableBuilder';\r\nimport { find, map } from 'underscore';\r\nimport { ExecutionReportGenericSection } from './ExecutionReportGenericSection';\r\nimport { GenericValueOutput, GenericValueOutputType } from './GenericValueOutput';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { Dom } from '../../utils/Dom';\r\n\r\nexport interface IUserIDExecutionReport {\r\n  name: string;\r\n  kind: string;\r\n  provider: string;\r\n  info: Record<string, string>;\r\n}\r\n\r\nexport interface IExecutionReportAuthenticationSection extends IExecutionReportSection {\r\n  name: 'PerformAuthentication';\r\n  configured: {\r\n    primary: string;\r\n    secondary: string[];\r\n    mandatory: string[];\r\n  };\r\n  result: {\r\n    userIds: IUserIDExecutionReport[];\r\n    queryRestrictions: Record<string, string>;\r\n    roles: string[];\r\n    userGroups: string[];\r\n  };\r\n}\r\n\r\nexport class ExecutionReportAuthenticationSection implements IExecutionReportSectionBuilder {\r\n  public async build(executionReport: IExecutionReport): Promise<{ container: Dom; gridOptions: agGridModule.GridOptions }> {\r\n    const { container, agGridElement } = ExecutionReport.standardSectionHeader('Authentication');\r\n    let gridOptions: agGridModule.GridOptions;\r\n    const authenticationSection = find(executionReport.children, child => child.name == EXECUTION_REPORT_SECTION.PERFORM_AUTHENTICATION) as\r\n      | IExecutionReportAuthenticationSection\r\n      | undefined;\r\n\r\n    if (authenticationSection) {\r\n      const dataSource = [\r\n        {\r\n          ...new ExecutionReportGenericSection().build(authenticationSection),\r\n          ...this.configurationSection(authenticationSection),\r\n          ...this.pipelineOuputSection(authenticationSection)\r\n        }\r\n      ];\r\n\r\n      const tableBuilder = await new TableBuilder().build(dataSource, agGridElement, {\r\n        rowHeight: 150\r\n      });\r\n      gridOptions = tableBuilder.gridOptions;\r\n    }\r\n\r\n    return { container, gridOptions };\r\n  }\r\n\r\n  private configurationSection(authenticationSection: IExecutionReportAuthenticationSection) {\r\n    return {\r\n      Configured: {\r\n        children: [\r\n          {\r\n            Primary: this.genericOutput(authenticationSection.configured.primary),\r\n            Secondary: this.genericOutput(authenticationSection.configured.secondary),\r\n            Mandatory: this.genericOutput(authenticationSection.configured.mandatory)\r\n          }\r\n        ]\r\n      }\r\n    };\r\n  }\r\n\r\n  private pipelineOuputSection(authenticationSection: IExecutionReportAuthenticationSection) {\r\n    return {\r\n      'Pipeline Output': {\r\n        children: [\r\n          {\r\n            'User ids': {\r\n              children: this.usersIds(authenticationSection.result.userIds)\r\n            },\r\n            'Query restriction': {\r\n              children: this.queryRestrictions(authenticationSection.result.queryRestrictions)\r\n            },\r\n            Roles: { ...this.genericOutput(authenticationSection.result.roles), width: 200 },\r\n            'User groups': this.genericOutput(authenticationSection.result.userGroups)\r\n          }\r\n        ]\r\n      }\r\n    };\r\n  }\r\n\r\n  private usersIds(userIds: IUserIDExecutionReport[]) {\r\n    return map(userIds, userId => {\r\n      return {\r\n        [userId.name]: {\r\n          children: [\r\n            {\r\n              Kind: this.genericOutput(userId.kind),\r\n              Provider: { ...this.genericOutput(userId.provider), width: 150 },\r\n              Info: { content: userId.info }\r\n            }\r\n          ]\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  private genericOutput(section: GenericValueOutputType) {\r\n    return new GenericValueOutput().output(section);\r\n  }\r\n\r\n  private queryRestrictions(queryRestrictions: Record<string, string>) {\r\n    return map(queryRestrictions, (value, key) => {\r\n      return {\r\n        [key]: this.genericOutput(value)\r\n      };\r\n    });\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportAuthenticationSection.ts","import {\r\n  IExecutionReportSection,\r\n  IExecutionReport,\r\n  EXECUTION_REPORT_SECTION,\r\n  IExecutionReportSectionBuilder,\r\n  ExecutionReport\r\n} from './ExecutionReport';\r\nimport { find } from 'underscore';\r\nimport { ExecutionReportGenericSection } from './ExecutionReportGenericSection';\r\nimport { TableBuilder } from './TableBuilder';\r\nimport { GenericValueOutput } from './GenericValueOutput';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { Dom } from '../../utils/Dom';\r\n\r\nexport interface IExecutionReportResolvePipelineSection extends IExecutionReportSection {\r\n  result: {\r\n    pipeline: string;\r\n    splitTest: {\r\n      name: string;\r\n      ratio: number;\r\n    };\r\n  };\r\n}\r\n\r\nexport class ExecutionReportResolvedPipelineSection implements IExecutionReportSectionBuilder {\r\n  public async build(executionReport: IExecutionReport): Promise<{ container: Dom; gridOptions: agGridModule.GridOptions }> {\r\n    const { container, agGridElement } = ExecutionReport.standardSectionHeader('Pipeline');\r\n    let gridOptions: agGridModule.GridOptions;\r\n\r\n    const resolvedPipelineSection = find(executionReport.children, child => child.name == EXECUTION_REPORT_SECTION.RESOLVE_PIPELINE) as\r\n      | IExecutionReportResolvePipelineSection\r\n      | undefined;\r\n\r\n    if (resolvedPipelineSection) {\r\n      const dataSource = [\r\n        {\r\n          ...new ExecutionReportGenericSection().build(resolvedPipelineSection),\r\n          ...{ Pipeline: new GenericValueOutput().output(resolvedPipelineSection.result.pipeline) },\r\n          ...{ 'Split Test': new GenericValueOutput().output(resolvedPipelineSection.result.splitTest) }\r\n        }\r\n      ];\r\n\r\n      const tableBuilder = await new TableBuilder().build(dataSource, agGridElement);\r\n      gridOptions = tableBuilder.gridOptions;\r\n    }\r\n\r\n    return { container, gridOptions };\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportResolvedPipelineSection.ts","import {\r\n  IExecutionReportSection,\r\n  IExecutionReportSectionBuilder,\r\n  IExecutionReport,\r\n  EXECUTION_REPORT_SECTION,\r\n  ExecutionReport\r\n} from './ExecutionReport';\r\nimport { find } from 'underscore';\r\nimport { ExecutionReportGenericSection } from './ExecutionReportGenericSection';\r\nimport { TableBuilder } from './TableBuilder';\r\nimport { GenericValueOutput } from './GenericValueOutput';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { Dom } from '../../utils/Dom';\r\n\r\nexport interface IExecutionReportQueryOverrideSection extends IExecutionReportSection {\r\n  applied: string[];\r\n}\r\n\r\nexport class ExecutionReportQueryOverrideSection implements IExecutionReportSectionBuilder {\r\n  public async build(executionReport: IExecutionReport): Promise<{ container: Dom; gridOptions: agGridModule.GridOptions }> {\r\n    const { container, agGridElement } = ExecutionReport.standardSectionHeader('Query Params Override');\r\n    let gridOptions: agGridModule.GridOptions;\r\n\r\n    const queryOverrideSection = find(executionReport.children, child => child.name == EXECUTION_REPORT_SECTION.QUERY_PARAM_OVERRIDE) as\r\n      | IExecutionReportQueryOverrideSection\r\n      | undefined;\r\n\r\n    if (queryOverrideSection) {\r\n      const dataSource = [\r\n        {\r\n          ...new ExecutionReportGenericSection().build(queryOverrideSection),\r\n          Applied: new GenericValueOutput().output(queryOverrideSection.applied)\r\n        }\r\n      ];\r\n\r\n      const tableBuilder = await new TableBuilder().build(dataSource, agGridElement);\r\n      gridOptions = tableBuilder.gridOptions;\r\n    }\r\n\r\n    return { container, gridOptions };\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportQueryOverrideSection.ts","import { IExecutionReport, IExecutionReportSectionBuilder, EXECUTION_REPORT_SECTION, ExecutionReport } from './ExecutionReport';\r\nimport { findWhere, each, contains } from 'underscore';\r\nimport { GenericValueOutput } from './GenericValueOutput';\r\nimport { $$, Dom } from '../../utils/Dom';\r\n\r\nexport interface IExecutionReportEffectiveIndexQuerySection {\r\n  result: {\r\n    in: Record<string, any>;\r\n  };\r\n}\r\n\r\nconst collapsibleSectionsInReport: string[] = ['Facets', 'RankingOverrides', 'RankingExpressions'];\r\n\r\nexport class ExecutionReportEffectiveIndexQuerySection implements IExecutionReportSectionBuilder {\r\n  public async build(executionReport: IExecutionReport): Promise<{ container: Dom }> {\r\n    const { container } = ExecutionReport.standardSectionHeader('Query sent to index');\r\n\r\n    const table = $$('table', {\r\n      className: 'coveo-relevance-inspector-table'\r\n    });\r\n\r\n    container.append(table.el);\r\n\r\n    const indexQuerySection = findWhere(executionReport.children, { description: EXECUTION_REPORT_SECTION.INDEX_QUERY });\r\n\r\n    if (indexQuerySection) {\r\n      each(indexQuerySection.result.in, (paramValue: string, paramKey: string) => {\r\n        const row = $$('tr');\r\n        table.append(row.el);\r\n\r\n        const id = `executionReportIndexExecution${paramKey}`;\r\n\r\n        if (contains(collapsibleSectionsInReport, paramKey) && paramValue) {\r\n          const btn = $$(\r\n            'button',\r\n            {\r\n              className: 'coveo-button'\r\n            },\r\n            paramKey\r\n          );\r\n\r\n          const tdTarget = $$(\r\n            'td',\r\n            {\r\n              id,\r\n              className: 'coveo-relevance-inspector-effective-query-collapsible'\r\n            },\r\n            new GenericValueOutput().output(paramValue).content\r\n          );\r\n\r\n          btn.on('click', () => {\r\n            tdTarget.toggleClass('coveo-active');\r\n          });\r\n\r\n          row.append($$('td', undefined, btn).el);\r\n          row.append(tdTarget.el);\r\n        } else {\r\n          row.append($$('td', undefined, paramKey).el);\r\n          row.append($$('td', undefined, new GenericValueOutput().output(paramValue).content).el);\r\n        }\r\n      });\r\n    }\r\n    return { container };\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportEffectiveIndexQuerySection.ts","import { ExecutionReport } from './ExecutionReport';\r\nimport { TableBuilder, ITableDataSource } from './TableBuilder';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { IRankingExpression } from '../../rest/RankingExpression';\r\nimport { map, find } from 'underscore';\r\nimport { GenericValueOutput } from './GenericValueOutput';\r\nimport { Dom } from '../../utils/Dom';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { QueryBuilder } from '../Base/QueryBuilder';\r\n\r\nexport class ExecutionReportRankingModifiers {\r\n  public async build(\r\n    results: IQueryResult[],\r\n    rankingExpressions: IRankingExpression[],\r\n    bindings: IComponentBindings\r\n  ): Promise<{ container: Dom; gridOptions: agGridModule.GridOptions }> {\r\n    const { container, agGridElement } = ExecutionReport.standardSectionHeader('Ranking Modifiers & Machine Learning Boosts');\r\n\r\n    const dataSourcePromises = map(rankingExpressions, async rankingExpression => {\r\n      const isAutomaticBoostRegex = /^(@permanentid|@urihash)=\"?([a-zA-Z0-9]+)\"?$/;\r\n\r\n      let thumbnailPreview: Record<string, ITableDataSource> = TableBuilder.thumbnailCell(null, null);\r\n      let returnedByIndexForCurrentQuery = '-- NULL --';\r\n      let result: IQueryResult = null;\r\n\r\n      const isAutomaticBoost = rankingExpression.expression.match(isAutomaticBoostRegex);\r\n      if (isAutomaticBoost) {\r\n        const permanentIDUsedInAutomaticBoost = isAutomaticBoost[2];\r\n        const extracted = await this.extractDocumentInfoFromBoost(results, permanentIDUsedInAutomaticBoost, rankingExpression, bindings);\r\n        thumbnailPreview = TableBuilder.thumbnailCell(extracted.result, bindings);\r\n        result = extracted.result;\r\n        returnedByIndexForCurrentQuery = extracted.returnedByIndexForCurrentQuery.toString();\r\n      }\r\n\r\n      return {\r\n        ...thumbnailPreview,\r\n        ReturnedByIndexForCurrentQuery: new GenericValueOutput().output(returnedByIndexForCurrentQuery),\r\n        IsRecommendation: new GenericValueOutput().output(result ? result.isRecommendation : '-- NULL --'),\r\n        Expression: { ...new GenericValueOutput().output(rankingExpression.expression), width: 150 },\r\n        Modifier: new GenericValueOutput().output(rankingExpression.modifier)\r\n      };\r\n    });\r\n\r\n    const dataSource = await Promise.all(dataSourcePromises);\r\n\r\n    const { gridOptions } = await new TableBuilder().build(dataSource, agGridElement, {\r\n      rowHeight: 150\r\n    });\r\n\r\n    return {\r\n      container,\r\n      gridOptions\r\n    };\r\n  }\r\n\r\n  private async extractDocumentInfoFromBoost(\r\n    results: IQueryResult[],\r\n    permanentID: string,\r\n    rankingExpression: IRankingExpression,\r\n    bindings: IComponentBindings\r\n  ) {\r\n    let matchingResult = {\r\n      result: null,\r\n      returnedByIndexForCurrentQuery: false\r\n    };\r\n\r\n    const resultInResultSet = find(results, result => {\r\n      return result.raw.permanentid == permanentID || result.raw.urihash == permanentID;\r\n    });\r\n\r\n    if (resultInResultSet) {\r\n      matchingResult = {\r\n        result: resultInResultSet,\r\n        returnedByIndexForCurrentQuery: true\r\n      };\r\n      return matchingResult;\r\n    }\r\n\r\n    const queryBuilder = new QueryBuilder();\r\n    queryBuilder.advancedExpression.add(rankingExpression.expression);\r\n    const resultsFromIndex = await bindings.queryController.getEndpoint().search(queryBuilder.build());\r\n    matchingResult = {\r\n      result: resultsFromIndex.results[0],\r\n      returnedByIndexForCurrentQuery: false\r\n    };\r\n\r\n    return matchingResult;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportRankingModifiers.ts","import agGridModule = require('ag-grid/main');\r\nimport {\r\n  IExecutionReportSectionBuilder,\r\n  IExecutionReport,\r\n  ExecutionReport,\r\n  EXECUTION_REPORT_SECTION,\r\n  IExecutionReportSection\r\n} from './ExecutionReport';\r\nimport { find, chain, each } from 'underscore';\r\nimport { TableBuilder, ITableDataSource, GenericHtmlRenderer } from './TableBuilder';\r\nimport { Dom, $$ } from '../../utils/Dom';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { StreamHighlightUtils } from '../../utils/StreamHighlightUtils';\r\nimport { ExecutionReportSimpleSection } from './ExecutionReportSimpleSection';\r\n\r\nexport type IRefinedQueriesFromTopClicks = { q: string; score: number };\r\n\r\nexport interface IExecutionReportITDSection extends IExecutionReportSection {\r\n  refinedQueries: IRefinedQueriesFromTopClicks[];\r\n}\r\n\r\nexport interface IExecutionReportMLTopClicksInput extends IExecutionReportSection {\r\n  largeQueryKeywords: string[];\r\n}\r\n\r\nexport class ExecutionReportITDSection implements IExecutionReportSectionBuilder {\r\n  public async build(executionReport: IExecutionReport): Promise<{ container: Dom; gridOptions: agGridModule.GridOptions }> {\r\n    const preprocessQuerySection = find(executionReport.children, child => child.name == EXECUTION_REPORT_SECTION.PREPROCESS_QUERY);\r\n    if (!preprocessQuerySection) {\r\n      return this.buildFallbackEmptyTable(executionReport);\r\n    }\r\n\r\n    const originalLongQuery = preprocessQuerySection.result.in.lq;\r\n    const topClicksSection = find(preprocessQuerySection.children, child => child.name == EXECUTION_REPORT_SECTION.TOP_CLICKS) as\r\n      | IExecutionReportITDSection\r\n      | undefined;\r\n\r\n    if (!topClicksSection || !originalLongQuery) {\r\n      return this.buildFallbackEmptyTable(executionReport);\r\n    }\r\n\r\n    const { container, agGridElement } = ExecutionReport.standardSectionHeader('Large Query Intelligent Term Detection (ITD)');\r\n    let gridOptions: agGridModule.GridOptions;\r\n\r\n    const dataSource = [\r\n      {\r\n        'Original large query': this.buildOriginalLongQueryCell(originalLongQuery, topClicksSection.refinedQueries),\r\n        'Keyword(s) extracted': this.buildRefinedQueryCell(executionReport, topClicksSection.refinedQueries, preprocessQuerySection)\r\n      }\r\n    ];\r\n\r\n    const tableBuilder = await new TableBuilder().build(dataSource, agGridElement, {\r\n      rowHeight: 300\r\n    });\r\n    gridOptions = tableBuilder.gridOptions;\r\n\r\n    return { container, gridOptions };\r\n  }\r\n\r\n  private doHighlights(originalLongQuery: string, refinedQueries: IRefinedQueriesFromTopClicks[]) {\r\n    const termsToHighlight = {};\r\n    each(refinedQueries, refined => {\r\n      termsToHighlight[refined.q] = [];\r\n    });\r\n    return StreamHighlightUtils.highlightStreamText(originalLongQuery, termsToHighlight, {});\r\n  }\r\n\r\n  private buildOriginalLongQueryCell(originalLongQuery: string, refinedQueries: IRefinedQueriesFromTopClicks[]): ITableDataSource {\r\n    return {\r\n      content: this.doHighlights(originalLongQuery, refinedQueries),\r\n      cellRenderer: GenericHtmlRenderer\r\n    };\r\n  }\r\n\r\n  private buildRefinedQueryCell(\r\n    executionReport: IExecutionReport,\r\n    refinedQueries: IRefinedQueriesFromTopClicks[],\r\n    preprocessSection: IExecutionReportSection\r\n  ): ITableDataSource {\r\n    if (Utils.isNonEmptyArray(refinedQueries)) {\r\n      return this.buildRefinedQueryByMLCell(refinedQueries);\r\n    }\r\n\r\n    const fallbackIndexPartialMatch = find(preprocessSection.children, child => child.name == EXECUTION_REPORT_SECTION.PARTIAL_MATCH);\r\n    const isUsingPartialMatch = fallbackIndexPartialMatch ? fallbackIndexPartialMatch.result.out.match(/^PartialMatch/) : false;\r\n    if (isUsingPartialMatch) {\r\n      return this.buildRefinedQueryByPartialMatchCell(fallbackIndexPartialMatch);\r\n    }\r\n\r\n    return this.buildRefinedQueryNoExtraction();\r\n  }\r\n\r\n  private buildRefinedQueryByMLCell(refinedQueries: IRefinedQueriesFromTopClicks[]): ITableDataSource {\r\n    const topLevelContainer = $$('div', undefined, $$('h2', undefined, 'Extraction and scoring performed using Coveo Machine Learning:'));\r\n\r\n    const keywordsList = $$('ul');\r\n    topLevelContainer.append(keywordsList.el);\r\n\r\n    chain(refinedQueries)\r\n      .map(refinedQuery => {\r\n        const content = this.doHighlights(`Keyword: ${refinedQuery.q} ==> Score: ${refinedQuery.score}`, [refinedQuery]);\r\n        const container = $$('li', null, content);\r\n        return container;\r\n      })\r\n      .each(refinedQueryContainer => {\r\n        keywordsList.append(refinedQueryContainer.el);\r\n      });\r\n\r\n    return {\r\n      content: topLevelContainer,\r\n      cellRenderer: GenericHtmlRenderer\r\n    };\r\n  }\r\n\r\n  private buildRefinedQueryByPartialMatchCell(partialMatch: IExecutionReportSection) {\r\n    const topLevelContainer = $$('div');\r\n    topLevelContainer.append($$('h2', undefined, 'Coveo Machine learning was unable to suggest any refined keywords').el);\r\n    topLevelContainer.append($$('h4', undefined, 'Fallback on Coveo Index partial match feature').el);\r\n    const content = $$('code', undefined, partialMatch.result.out);\r\n    topLevelContainer.append(content.el);\r\n    return {\r\n      content: topLevelContainer,\r\n      cellRenderer: GenericHtmlRenderer\r\n    };\r\n  }\r\n\r\n  private buildRefinedQueryNoExtraction(): ITableDataSource {\r\n    const topLevelContainer = $$('div');\r\n    topLevelContainer.append($$('h2', undefined, 'No keywords were extracted').el);\r\n    topLevelContainer.append(\r\n      $$('h4', undefined, 'The query is probably too small, or Coveo is lacking usage analytics data to return any meaningful suggestions.')\r\n        .el\r\n    );\r\n    return {\r\n      content: topLevelContainer,\r\n      cellRenderer: GenericHtmlRenderer\r\n    };\r\n  }\r\n\r\n  private buildFallbackEmptyTable(executionReport: IExecutionReport) {\r\n    return new ExecutionReportSimpleSection(\r\n      EXECUTION_REPORT_SECTION.NONE,\r\n      EXECUTION_REPORT_SECTION.NONE,\r\n      'Large Query Intelligent Term Detection (ITD)'\r\n    ).build(executionReport);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/ExecutionReportITDSection.ts","import { TableBuilder, ITableDataSource } from './TableBuilder';\r\nimport { map, each, where, reject, filter } from 'underscore';\r\nimport agGridModule = require('ag-grid/main');\r\nimport { GenericValueOutput } from './GenericValueOutput';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { $$, Dom, Utils, PopupUtils } from '../../UtilsModules';\r\nimport { IFieldDescription } from '../../rest/FieldDescription';\r\nimport { QueryBuilder } from '../Base/QueryBuilder';\r\nimport { IIndexFieldValue } from '../../rest/FieldValue';\r\nimport { PopupHorizontalAlignment, PopupVerticalAlignment } from '../../utils/PopupUtils';\r\nimport { IRelevanceInspectorTab } from './RelevanceInspector';\r\n\r\nexport class AvailableFieldsTable implements IRelevanceInspectorTab {\r\n  public gridOptions: agGridModule.GridOptions;\r\n\r\n  public constructor(public bindings: IComponentBindings) {}\r\n\r\n  public async build() {\r\n    const container = $$('div');\r\n\r\n    const agGridElement = $$('div', {\r\n      className: 'ag-theme-fresh'\r\n    });\r\n    container.append(agGridElement.el);\r\n\r\n    const allFieldsDescription = this.bindings.queryController ? await this.bindings.queryController.getEndpoint().listFields() : null;\r\n\r\n    if (allFieldsDescription) {\r\n      const dataSource: Record<string, ITableDataSource>[] = map(allFieldsDescription, description => {\r\n        return {\r\n          Name: new GenericValueOutput().output(description.name),\r\n          Description: { ...new GenericValueOutput().output(description.description), width: 150 },\r\n          'Default Value': new GenericValueOutput().output(description.defaultValue),\r\n          'Field Type': new GenericValueOutput().output(description.fieldType),\r\n          'Field Source Type': new GenericValueOutput().output(description.fieldSourceType),\r\n          'Include In Query': new GenericValueOutput().output(description.includeInQuery),\r\n          'Include In Results': new GenericValueOutput().output(description.includeInResults),\r\n          'Group By Field': new GenericValueOutput().output(description.groupByField),\r\n          'Split Group By Field': new GenericValueOutput().output(description.splitGroupByField),\r\n          'Sort By Field': new GenericValueOutput().output(description.sortByField),\r\n          'Sample Of Available Values': {\r\n            content: {\r\n              content: {\r\n                description,\r\n                bindings: this.bindings,\r\n                container\r\n              }\r\n            },\r\n            width: 200,\r\n            suppressSorting: true,\r\n            suppressFilter: true,\r\n            cellRenderer: AvailableFieldsSampleValue\r\n          }\r\n        };\r\n      });\r\n\r\n      const { gridOptions } = await new TableBuilder().build(dataSource, agGridElement, {\r\n        enableFilter: true,\r\n        rowModelType: 'infinite',\r\n        pagination: true,\r\n        paginationPageSize: 25,\r\n        rowHeight: 100,\r\n        enableServerSideFilter: true,\r\n        enableServerSideSorting: true,\r\n        datasource: new AvailableFieldsDatasource(dataSource)\r\n      });\r\n\r\n      this.gridOptions = gridOptions;\r\n    }\r\n\r\n    return container;\r\n  }\r\n}\r\n\r\nexport class AvailableFieldsSampleValue implements agGridModule.ICellRendererComp {\r\n  private description: IFieldDescription | undefined;\r\n  private bindings: IComponentBindings | undefined;\r\n  private container: Dom | undefined;\r\n\r\n  public init(params: any) {\r\n    if (params.value && params.value.content) {\r\n      this.description = params.value.content.description;\r\n      this.bindings = params.value.content.bindings;\r\n      this.container = params.value.content.container;\r\n    }\r\n  }\r\n\r\n  public getGui() {\r\n    const btn = $$(\r\n      'button',\r\n      {\r\n        className: 'coveo-button coveo-available-fields-table-button'\r\n      },\r\n      'Hover For Sample Values'\r\n    );\r\n\r\n    let popperElement: Dom | undefined;\r\n    let userHoveringButtonWithHisMouse = false;\r\n\r\n    btn.on('mouseover', async () => {\r\n      userHoveringButtonWithHisMouse = true;\r\n      if (this.description && this.container && userHoveringButtonWithHisMouse) {\r\n        const values = await this.getFieldsValues(this.description);\r\n        if (userHoveringButtonWithHisMouse) {\r\n          popperElement = this.renderFieldValues(values);\r\n          this.container.append(popperElement.el);\r\n          PopupUtils.positionPopup(popperElement.el, btn.el, document.body, {\r\n            horizontal: PopupHorizontalAlignment.LEFT,\r\n            vertical: PopupVerticalAlignment.MIDDLE\r\n          });\r\n        }\r\n        userHoveringButtonWithHisMouse = false;\r\n      }\r\n    });\r\n\r\n    btn.on('mouseout', () => {\r\n      if (popperElement) {\r\n        popperElement.remove();\r\n      }\r\n      userHoveringButtonWithHisMouse = false;\r\n    });\r\n\r\n    return btn.el;\r\n  }\r\n\r\n  private async getFieldsValues(fieldDesciption: IFieldDescription) {\r\n    if (!this.bindings || !this.description || !this.bindings.queryController || !this.container) {\r\n      return [];\r\n    }\r\n\r\n    if (fieldDesciption.groupByField) {\r\n      return await this.bindings.queryController.getEndpoint().listFieldValues({\r\n        field: this.description.name\r\n      });\r\n    } else {\r\n      const queryBuilder = new QueryBuilder();\r\n      queryBuilder.advancedExpression.add(fieldDesciption.name);\r\n      const queryResults = this.bindings ? await this.bindings.queryController.getEndpoint().search(queryBuilder.build()) : null;\r\n      if (queryResults) {\r\n        return map(queryResults.results, result => {\r\n          return { value: Utils.getFieldValue(result, fieldDesciption.name) } as IIndexFieldValue;\r\n        });\r\n      } else {\r\n        return [];\r\n      }\r\n    }\r\n  }\r\n\r\n  private renderFieldValues(fieldValues: IIndexFieldValue[]) {\r\n    const list = $$('ul', { className: 'coveo-relevance-inspector-available-fields-popup' });\r\n    list.el.style.background = 'white';\r\n    if (fieldValues.length == 0) {\r\n      list.append($$('li', undefined, 'No Values Available ...').el);\r\n    } else {\r\n      fieldValues.forEach(fieldValue => {\r\n        const listItem = $$(\r\n          'li',\r\n          {\r\n            className: 'coveo-relevance-inspector-available-fields-popup-value'\r\n          },\r\n          new GenericValueOutput().output(fieldValue.value).content\r\n        );\r\n\r\n        list.append(listItem.el);\r\n      });\r\n    }\r\n\r\n    return list;\r\n  }\r\n\r\n  public refresh() {\r\n    return true;\r\n  }\r\n}\r\n\r\ninterface IFilterModel {\r\n  type: 'equals' | 'notEqual' | 'startsWith' | 'endsWith' | 'contains' | 'notContains';\r\n  filter: string;\r\n}\r\n\r\ninterface ISortModel {\r\n  colId: string;\r\n  sort: 'asc' | 'desc';\r\n}\r\n\r\nexport class AvailableFieldsDatasource implements agGridModule.IDatasource {\r\n  private rowsData: any[] = [];\r\n  constructor(public dataSource: Record<string, ITableDataSource>[]) {\r\n    this.rowsData = map(this.dataSource, source => {\r\n      const merged: any = {};\r\n\r\n      const extractContent = (value: ITableDataSource & agGridModule.ColGroupDef, key: string) => {\r\n        if (value.content != null) {\r\n          merged[key] = value.content;\r\n        } else if (value.children) {\r\n          each(value.children, (child: any) => {\r\n            each(child, extractContent);\r\n          });\r\n        }\r\n      };\r\n\r\n      each(source, extractContent as any);\r\n      return merged;\r\n    });\r\n  }\r\n\r\n  public getRows(params: agGridModule.IGetRowsParams) {\r\n    const filtered = this.filter(this.rowsData, params.filterModel);\r\n    const filteredAndSorted = this.sort(filtered, params.sortModel);\r\n\r\n    params.successCallback(filteredAndSorted.slice(params.startRow, params.endRow), filteredAndSorted.length);\r\n  }\r\n\r\n  private filter(rows: any[], filterModel: Record<string, IFilterModel>) {\r\n    each(filterModel, (value, key) => {\r\n      switch (value.type) {\r\n        case 'equals':\r\n          rows = where(rows, { [key]: value.filter });\r\n          break;\r\n\r\n        case 'notEqual':\r\n          rows = reject(rows, possibleReturn => {\r\n            return possibleReturn[key] == value.filter;\r\n          });\r\n          break;\r\n\r\n        case 'startsWith':\r\n          rows = filter(rows, possibleReturn => {\r\n            return possibleReturn[key].toLowerCase().indexOf(value.filter) == 0;\r\n          });\r\n          break;\r\n\r\n        case 'endsWith':\r\n          rows = filter(rows, possibleReturn => {\r\n            return possibleReturn[key].toLowerCase().indexOf(value.filter) == possibleReturn[key].length - value.filter.length;\r\n          });\r\n          break;\r\n\r\n        case 'contains':\r\n          rows = filter(rows, possibleReturn => {\r\n            return possibleReturn[key].toLowerCase().indexOf(value.filter) != -1;\r\n          });\r\n          break;\r\n\r\n        case 'notContains':\r\n          rows = filter(rows, possibleReturn => {\r\n            return possibleReturn[key].toLowerCase().indexOf(value.filter) == -1;\r\n          });\r\n          break;\r\n      }\r\n    });\r\n\r\n    return rows;\r\n  }\r\n\r\n  private sort(rows: any[], sortModels: ISortModel[]) {\r\n    if (sortModels && sortModels[0]) {\r\n      const sortModel = sortModels[0];\r\n      return rows.sort((first, second) => {\r\n        const firstValue = first[sortModel.colId];\r\n        const secondValue = second[sortModel.colId];\r\n\r\n        const ascendingOrDescendingMultiplier = sortModel.sort == 'asc' ? 1 : -1;\r\n\r\n        if (Utils.isNullOrEmptyString(firstValue) && Utils.isNullOrEmptyString(secondValue)) {\r\n          return 0;\r\n        }\r\n\r\n        if (Utils.isNullOrEmptyString(firstValue)) {\r\n          return -1 * ascendingOrDescendingMultiplier;\r\n        }\r\n\r\n        if (Utils.isNullOrEmptyString(secondValue)) {\r\n          return 1 * ascendingOrDescendingMultiplier;\r\n        }\r\n\r\n        if (isNaN(firstValue) || isNaN(secondValue)) {\r\n          return firstValue.localeCompare(secondValue) * ascendingOrDescendingMultiplier;\r\n        } else {\r\n          return (Number(firstValue) - Number(secondValue)) * ascendingOrDescendingMultiplier;\r\n        }\r\n      });\r\n    }\r\n    return rows;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/AvailableFieldsTable.ts","import { IQueryResult } from '../../rest/QueryResult';\r\nimport { parseRankingInfo, IRankingInfo, buildListOfTermsElement } from './RankingInfoParser';\r\nimport { $$, Dom } from '../../utils/Dom';\r\nimport { each } from 'underscore';\r\nimport { Utils } from '../../utils/Utils';\r\n\r\nexport class InlineRankingInfo {\r\n  private rankingInfo: IRankingInfo;\r\n  constructor(public result: IQueryResult) {\r\n    this.rankingInfo = parseRankingInfo(result.rankingInfo);\r\n  }\r\n\r\n  public build(): Dom {\r\n    const container = $$('div', {\r\n      className: 'coveo-relevance-inspector-inline-ranking'\r\n    });\r\n\r\n    each(this.rankingInfo.documentWeights, (value: any, key: string) => {\r\n      const section = $$('div', { className: 'coveo-relevance-inspector-inline-ranking-section' }, `${key}: ${value}`);\r\n      container.append(section.el);\r\n    });\r\n\r\n    const total = $$(\r\n      'div',\r\n      { className: 'coveo-relevance-inspector-highlight coveo-relevance-inspector-inline-ranking-section' },\r\n      `Total: ${this.rankingInfo.totalWeight}`\r\n    );\r\n    container.append(total.el);\r\n\r\n    if (this.rankingInfo.termsWeight) {\r\n      this.buildTogglableTermsSection(container);\r\n    }\r\n\r\n    if (Utils.isNonEmptyArray(this.rankingInfo.qreWeights)) {\r\n      this.buildTogglableQRESection(container);\r\n    }\r\n\r\n    return container;\r\n  }\r\n\r\n  private buildTogglableTermsSection(container: Dom) {\r\n    const termsButton = $$(\r\n      'button',\r\n      { className: 'coveo-button coveo-relevance-inspector-inline-ranking-button' },\r\n      'Toggle Terms Relevancy Breakdown'\r\n    );\r\n    container.append(termsButton.el);\r\n\r\n    const termsSection = $$('div', { className: 'coveo-relevance-inspector-inline-ranking-terms' });\r\n\r\n    container.append(termsSection.el);\r\n    each(this.rankingInfo.termsWeight || {}, (value, key) => {\r\n      const builtKey = `Keyword: ${key}`;\r\n      termsSection.append($$('h2', undefined, builtKey).el);\r\n      termsSection.append(buildListOfTermsElement(value.Weights).el);\r\n    });\r\n\r\n    termsButton.on('click', () => termsSection.toggleClass('coveo-active'));\r\n  }\r\n\r\n  private buildTogglableQRESection(container: Dom) {\r\n    const qreButton = $$('button', { className: 'coveo-button coveo-relevance-inspector-inline-ranking-button' }, 'Toggle QRE Breakdown');\r\n    container.append(qreButton.el);\r\n    const qreSection = $$('ul', { className: 'coveo-relevance-inspector-inline-ranking-terms' });\r\n\r\n    container.append(qreSection.el);\r\n    each(this.rankingInfo.qreWeights, value => {\r\n      qreSection.append($$('dd', { className: 'coveo-relevance-inspector-inline-ranking-qre-expression' }, `${value.expression}`).el);\r\n      qreSection.append($$('dt', undefined, `Score: ${value.score}`).el);\r\n    });\r\n\r\n    qreButton.on('click', () => qreSection.toggleClass('coveo-active'));\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/RelevanceInspector/InlineRankingInfo.ts","import { Component } from '../Base/Component';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { ComponentOptionsModel } from '../../models/ComponentOptionsModel';\r\nimport { IResultsComponentBindings } from '../Base/ResultsComponentBindings';\r\nimport { analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\r\nimport { IResultLinkOptions } from './ResultLinkOptions';\r\nimport { ResultListEvents } from '../../events/ResultListEvents';\r\nimport { HighlightUtils } from '../../utils/HighlightUtils';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { DeviceUtils } from '../../utils/DeviceUtils';\r\nimport { OS_NAME, OSUtils } from '../../utils/OSUtils';\r\nimport { Initialization } from '../Base/Initialization';\r\nimport { QueryUtils } from '../../utils/QueryUtils';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { Defer } from '../../misc/Defer';\r\nimport { $$ } from '../../utils/Dom';\r\nimport { StreamHighlightUtils } from '../../utils/StreamHighlightUtils';\r\nimport { StringUtils } from '../../utils/StringUtils';\r\nimport { once, debounce, extend, escape } from 'underscore';\r\nimport { exportGlobally } from '../../GlobalExports';\r\n\r\nimport 'styling/_ResultLink';\r\nimport { AccessibleButton } from '../../utils/AccessibleButton';\r\n\r\n/**\r\n * The `ResultLink` component automatically transform a search result title into a clickable link pointing to the\r\n * original item.\r\n *\r\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\r\n */\r\nexport class ResultLink extends Component {\r\n  static ID = 'ResultLink';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      ResultLink: ResultLink\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the ResultLink\r\n   * @componentOptions\r\n   */\r\n  static options: IResultLinkOptions = {\r\n    /**\r\n     * Specifies the field to use to output the component `href` attribute value.\r\n     *\r\n     * **Tip:**\r\n     * > Instead of specifying a value for the `field` option, you can directly add an `href` attribute to the\r\n     * > `ResultLink` HTML element. Then, you can use a custom script to generate the `href` value.\r\n     *\r\n     * **Examples:**\r\n     * - With the following markup, the `ResultLink` outputs its `href` value using the `@uri` field (rather than the\r\n     * default field):\r\n     *\r\n     * ```html\r\n     * <a class=\"CoveoResultLink\" data-field=\"@uri\"></a>\r\n     * ```\r\n     *\r\n     * - In the following result template, the custom `getMyKBUri()` function provides the `href` value:\r\n     *\r\n     * ```html\r\n     * <script id=\"KnowledgeArticle\" type=\"text/underscore\" class=\"result-template\">\r\n     *   <div class='CoveoIcon>'></div>\r\n     *   <a class=\"CoveoResultLink\" href=\"<%= getMyKBUri(raw) %>\"></a>\r\n     *   <div class=\"CoveoExcerpt\"></div>\r\n     * </script>\r\n     * ```\r\n     *\r\n     * See also [`hrefTemplate`]{@link ResultLink.options.hrefTemplate}, which can override this option.\r\n     *\r\n     * By default, the component uses the `@clickUri` field of the item to output the value of its `href` attribute.\r\n     */\r\n    field: ComponentOptions.buildFieldOption(),\r\n\r\n    /**\r\n     * Specifies whether the component should try to open its link in Microsoft Outlook.\r\n     *\r\n     * Setting this option to `true` is normally useful for `ResultLink` instances related to Microsoft Exchange emails.\r\n     *\r\n     * If this option is `true`, clicking the `ResultLink` calls the\r\n     * [`openLinkInOutlook`]{@link ResultLink.openLinkInOutlook} method instead of the\r\n     * [`openLink`]{@link ResultLink.openLink} method.\r\n     *\r\n     * Default value is `false`.\r\n     */\r\n    openInOutlook: ComponentOptions.buildBooleanOption({ defaultValue: false }),\r\n\r\n    /**\r\n     * Specifies whether the component should open its link in the [`Quickview`]{@link Quickview} component rather than\r\n     * loading through the original URL.\r\n     *\r\n     * Default value is `false`.\r\n     */\r\n    openQuickview: ComponentOptions.buildBooleanOption({ defaultValue: false }),\r\n\r\n    /**\r\n     * Specifies whether the component should open its link in a new window instead of opening it in the current\r\n     * context.\r\n     *\r\n     * If this option is `true`, clicking the `ResultLink` calls the\r\n     * [`openLinkInNewWindow`]{@link ResultLink.openLinkInNewWindow} method instead of the\r\n     * [`openLink`]{@link ResultLink.openLink} method.\r\n     *\r\n     * **Note:**\r\n     * > If a search page contains a [`ResultPreferences`]{@link ResultsPreferences} component whose\r\n     * > [`enableOpenInNewWindow`]{@link ResultsPreferences.options.enableOpenInNewWindow} option is `true`, and the end\r\n     * > user checks the <b>Always open results in new window</b> box, `ResultLink` components in this page will always\r\n     * > open their links in a new window when the end user clicks them, no matter what the value of their\r\n     * > `alwaysOpenInNewWindow` option is.\r\n     *\r\n     * Default value is `false`.\r\n     */\r\n    alwaysOpenInNewWindow: ComponentOptions.buildBooleanOption({ defaultValue: false }),\r\n\r\n    /**\r\n     * Specifies a template literal from which to generate the `ResultLink` `href` attribute value (see\r\n     * [Template literals](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Template_literals)).\r\n     *\r\n     * This option overrides the [`field`]{@link ResultLink.options.field} option value.\r\n     *\r\n     * The template literal can reference any number of fields from the parent result. It can also reference global\r\n     * scope properties.\r\n     *\r\n     * **Examples:**\r\n     *\r\n     * - The following markup generates an `href` value such as `http://uri.com?id=itemTitle`:\r\n     *\r\n     * ```html\r\n     * <a class='CoveoResultLink' data-href-template='${clickUri}?id=${raw.title}'></a>\r\n     * ```\r\n     *\r\n     * - The following markup generates an `href` value such as `localhost/fooBar`:\r\n     *\r\n     * ```html\r\n     * <a class='CoveoResultLink' data-href-template='${window.location.hostname}/{Foo.Bar}'></a>\r\n     * ```\r\n     *\r\n     * Default value is `undefined`.\r\n     */\r\n    hrefTemplate: ComponentOptions.buildStringOption(),\r\n\r\n    /**\r\n     * Specifies a template literal from which to generate the `ResultLink` display title (see\r\n     * [Template literals](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Template_literals)).\r\n     *\r\n     * This option overrides the default `ResultLink` display title behavior.\r\n     *\r\n     * The template literal can reference any number of fields from the parent result. However, if the template literal\r\n     * references a key whose value is undefined in the parent result fields, the `ResultLink` title displays the\r\n     * name of this key instead.\r\n     *\r\n     * This option is ignored if the `ResultLink` innerHTML contains any value.\r\n     *\r\n     * **Examples:**\r\n     *\r\n     * - The following markup generates a `ResultLink` display title such as `Case number: 123456` if both the\r\n     * `raw.objecttype` and `raw.objectnumber` keys are defined in the parent result fields:\r\n     *\r\n     * ```html\r\n     * <a class=\"CoveoResultLink\" data-title-template=\"${raw.objecttype} number: ${raw.objectnumber}\"></a>\r\n     * ```\r\n     *\r\n     * - The following markup generates `${myField}` as a `ResultLink` display title if the `myField` key is undefined\r\n     * in the parent result fields:\r\n     *\r\n     * ```html\r\n     * <a class=\"CoveoResultLink\" data-title-template=\"${myField}\"></a>\r\n     * ```\r\n     *\r\n     * - The following markup generates `Foobar` as a `ResultLink` display title, because the `ResultLink` innterHTML is\r\n     * not empty:\r\n     *\r\n     * ```html\r\n     * <a class=\"CoveoResultLink\" data-title-template=\"${will} ${be} ${ignored}\">Foobar</a>\r\n     * ```\r\n     *\r\n     * Default value is `undefined`.\r\n     *\r\n     * @availablesince [January 2017 Release (v1.1865.9)](https://docs.coveo.com/en/396/#january-2017-release-v118659)\r\n     */\r\n    titleTemplate: ComponentOptions.buildStringOption(),\r\n\r\n    /**\r\n     * Specifies an event handler function to execute when the user clicks the `ResultLink` component.\r\n     *\r\n     * The handler function takes a JavaScript [`Event`](https://developer.mozilla.org/en/docs/Web/API/Event) object and\r\n     * an [`IQueryResult`]{@link IQueryResult} as its parameters.\r\n     *\r\n     * Overriding the default behavior of the `onClick` event can allow you to execute specific code instead.\r\n     *\r\n     * **Note:**\r\n     * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\r\n     * > [`init`]{@link init} call of your search interface (see\r\n     * > [Passing Component Options in the init Call](https://docs.coveo.com/en/346/#passing-component-options-in-the-init-call)),\r\n     * > or before the `init` call, using the `options` top-level function (see\r\n     * > [Passing Component Options Before the init Call](https://docs.coveo.com/en/346/#passing-component-options-before-the-init-call)).\r\n     *\r\n     * **Example:**\r\n     * ```javascript\r\n     * // You can set the option in the 'init' call:\r\n     * Coveo.init(document.querySelector(\"#search\"), {\r\n     *   ResultLink : {\r\n     *     onClick : function(e, result) {\r\n     *       e.preventDefault();\r\n     *       // Custom code to execute with the item URI and title.\r\n     *       openUriInASpecialTab(result.clickUri, result.title);\r\n     *     }\r\n     *   }\r\n     * });\r\n     *\r\n     * // Or before the 'init' call, using the 'options' top-level function:\r\n     * // Coveo.options(document.querySelector('#search'), {\r\n     * //   ResultLink : {\r\n     * //     onClick : function(e, result) {\r\n     * //       e.preventDefault();\r\n     * //       // Custom code to execute with the item URI and title.\r\n     * //       openUriInASpecialTab(result.clickUri, result.title);\r\n     * //     }\r\n     * //   }\r\n     * // });\r\n     * ```\r\n     */\r\n    onClick: ComponentOptions.buildCustomOption<(e: Event, result: IQueryResult) => any>(() => {\r\n      return null;\r\n    })\r\n  };\r\n\r\n  private toExecuteOnOpen: (e?: Event) => void;\r\n\r\n  /**\r\n   * Creates a new `ResultLink` component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the `ResultLink` component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   * @param result The result to associate the component with.\r\n   * @param os\r\n   */\r\n  constructor(\r\n    public element: HTMLElement,\r\n    public options: IResultLinkOptions,\r\n    public bindings?: IResultsComponentBindings,\r\n    public result?: IQueryResult,\r\n    public os?: OS_NAME\r\n  ) {\r\n    super(element, ResultLink.ID, bindings);\r\n\r\n    const initialOptions = ComponentOptions.initComponentOptions(element, ResultLink, options);\r\n    const resultLinkOptions = this.componentOptionsModel.get(ComponentOptionsModel.attributesEnum.resultLink);\r\n    this.options = extend({}, initialOptions, resultLinkOptions);\r\n\r\n    this.result = result || this.resolveResult();\r\n\r\n    if (this.options.openQuickview == null) {\r\n      this.options.openQuickview = result.raw['connectortype'] == 'ExchangeCrawler' && DeviceUtils.isMobileDevice();\r\n    }\r\n    this.element.setAttribute('tabindex', '0');\r\n\r\n    Assert.exists(this.componentOptionsModel);\r\n    Assert.exists(this.result);\r\n\r\n    if (!this.quickviewShouldBeOpened()) {\r\n      // Bind on multiple \"click\" or \"mouse\" events.\r\n      // Create a function that will be executed only once, so as not to log multiple events\r\n      // Once a result link has been opened, and that we log at least one analytics event,\r\n      // it should not matter if the end user open the same link multiple times with different methods.\r\n      // It's still only one \"click\" event as far as UA is concerned.\r\n      // Also need to handle \"longpress\" on mobile (the contextual menu), which we assume to be 1 s long.\r\n\r\n      const executeOnlyOnce = once(() => this.logOpenDocument());\r\n\r\n      $$(element).on(['contextmenu', 'click', 'mousedown', 'mouseup'], executeOnlyOnce);\r\n      let longPressTimer: number;\r\n      $$(element).on('touchstart', () => {\r\n        longPressTimer = window.setTimeout(executeOnlyOnce, 1000);\r\n      });\r\n      $$(element).on('touchend', () => {\r\n        if (longPressTimer) {\r\n          clearTimeout(longPressTimer);\r\n        }\r\n      });\r\n    }\r\n    this.renderUri(element, result);\r\n    this.bindEventToOpen();\r\n  }\r\n  public renderUri(element: HTMLElement, result?: IQueryResult) {\r\n    if (/^\\s*$/.test(this.element.innerHTML)) {\r\n      const title = this.getDisplayedTitle();\r\n      this.element.innerHTML = title;\r\n      if (!this.element.title) {\r\n        this.element.title = this.getDisplayedTitleAsText();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * Opens the result in the same window, no matter how the actual component is configured for the end user.\r\n   * @param logAnalytics Specifies whether the method should log an analytics event.\r\n   */\r\n  public openLink(logAnalytics = true) {\r\n    if (logAnalytics) {\r\n      this.logOpenDocument();\r\n    }\r\n    window.location.href = this.getResultUri();\r\n  }\r\n\r\n  /**\r\n   * Opens the result in a new window, no matter how the actual component is configured for the end user.\r\n   * @param logAnalytics Specifies whether the method should log an analytics event.\r\n   */\r\n  public openLinkInNewWindow(logAnalytics = true) {\r\n    if (logAnalytics) {\r\n      this.logOpenDocument();\r\n    }\r\n    window.open(this.getResultUri(), '_blank');\r\n  }\r\n\r\n  /**\r\n   * Tries to open the result in Microsoft Outlook if the result has an `outlookformacuri` or `outlookuri` field.\r\n   *\r\n   * Normally, this implies the result should be a link to an email.\r\n   *\r\n   * If the needed fields are not present, this method does nothing.\r\n   * @param logAnalytics Specifies whether the method should log an analytics event.\r\n   */\r\n  public openLinkInOutlook(logAnalytics = true) {\r\n    if (this.hasOutlookField()) {\r\n      if (logAnalytics) {\r\n        this.logOpenDocument();\r\n      }\r\n      this.openLink();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Opens the link in the same manner the end user would.\r\n   *\r\n   * This essentially simulates a click on the result link.\r\n   *\r\n   * @param logAnalytics Specifies whether the method should log an analytics event.\r\n   */\r\n  public openLinkAsConfigured(logAnalytics = true) {\r\n    if (this.toExecuteOnOpen) {\r\n      if (logAnalytics) {\r\n        this.logOpenDocument();\r\n      }\r\n      this.toExecuteOnOpen();\r\n    }\r\n  }\r\n\r\n  protected bindEventToOpen(): boolean {\r\n    return (\r\n      this.bindOnClickIfNotUndefined() ||\r\n      this.bindOpenQuickviewIfNotUndefined() ||\r\n      this.setHrefIfNotAlready() ||\r\n      this.openLinkThatIsNotAnAnchor()\r\n    );\r\n  }\r\n\r\n  private getDisplayedTitle() {\r\n    if (!this.options.titleTemplate) {\r\n      return this.result.title\r\n        ? HighlightUtils.highlightString(this.result.title, this.result.titleHighlights, null, 'coveo-highlight')\r\n        : this.escapedClickUri;\r\n    } else {\r\n      let newTitle = StringUtils.buildStringTemplateFromResult(this.options.titleTemplate, this.result);\r\n      return newTitle\r\n        ? StreamHighlightUtils.highlightStreamText(newTitle, this.result.termsToHighlight, this.result.phrasesToHighlight)\r\n        : this.escapedClickUri;\r\n    }\r\n  }\r\n\r\n  private getDisplayedTitleAsText() {\r\n    const container = $$('div');\r\n    container.setHtml(this.getDisplayedTitle());\r\n    return container.text();\r\n  }\r\n\r\n  private get escapedClickUri() {\r\n    return escape(this.result.clickUri);\r\n  }\r\n\r\n  private bindOnClickIfNotUndefined() {\r\n    if (this.options.onClick != undefined) {\r\n      this.toExecuteOnOpen = (e: MouseEvent) => {\r\n        this.options.onClick.call(this, e, this.result);\r\n      };\r\n\r\n      new AccessibleButton()\r\n        .withElement(this.element)\r\n        .withLabel(this.result.title)\r\n        .withSelectAction((e: Event) => this.toExecuteOnOpen(e))\r\n        .build();\r\n\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private bindOpenQuickviewIfNotUndefined() {\r\n    if (this.quickviewShouldBeOpened()) {\r\n      this.toExecuteOnOpen = () => {\r\n        $$(this.bindings.resultElement).trigger(ResultListEvents.openQuickview);\r\n      };\r\n\r\n      $$(this.element).on('click', (e: Event) => {\r\n        e.preventDefault();\r\n        this.toExecuteOnOpen();\r\n      });\r\n\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private openLinkThatIsNotAnAnchor() {\r\n    if (!this.elementIsAnAnchor()) {\r\n      this.toExecuteOnOpen = () => {\r\n        if (this.options.alwaysOpenInNewWindow) {\r\n          if (this.options.openInOutlook) {\r\n            this.openLinkInOutlook();\r\n          } else {\r\n            this.openLinkInNewWindow();\r\n          }\r\n        } else {\r\n          this.openLink();\r\n        }\r\n      };\r\n\r\n      $$(this.element).on('click', () => {\r\n        this.toExecuteOnOpen();\r\n      });\r\n\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private setHrefIfNotAlready() {\r\n    // Do not erase any value put in href by the template, etc. Allows\r\n    // using custom click urls while still keeping analytics recording\r\n    // and other behavior brought by the component.\r\n    if (this.elementIsAnAnchor() && !Utils.isNonEmptyString($$(this.element).getAttribute('href'))) {\r\n      $$(this.element).setAttribute('href', this.getResultUri());\r\n      if (this.options.alwaysOpenInNewWindow && !(this.options.openInOutlook && this.hasOutlookField())) {\r\n        $$(this.element).setAttribute('target', '_blank');\r\n      }\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private logOpenDocument = debounce(\r\n    () => {\r\n      this.queryController.saveLastQuery();\r\n      let documentURL = $$(this.element).getAttribute('href');\r\n      if (documentURL == undefined || documentURL == '') {\r\n        documentURL = this.escapedClickUri;\r\n      }\r\n      this.usageAnalytics.logClickEvent(\r\n        analyticsActionCauseList.documentOpen,\r\n        {\r\n          documentURL: documentURL,\r\n          documentTitle: this.result.title,\r\n          author: Utils.getFieldValue(this.result, 'author')\r\n        },\r\n        this.result,\r\n        this.root\r\n      );\r\n      Defer.flush();\r\n    },\r\n    1500,\r\n    true\r\n  );\r\n\r\n  private filterProtocol(uri: string) {\r\n    const isAbsolute = /^(https?|ftp|file|mailto|tel):/i.test(uri);\r\n    const isRelative = /^\\//.test(uri);\r\n\r\n    return isAbsolute || isRelative ? uri : '';\r\n  }\r\n\r\n  private getResultUri(): string {\r\n    if (this.options.hrefTemplate) {\r\n      const uri = StringUtils.buildStringTemplateFromResult(this.options.hrefTemplate, this.result);\r\n      return this.filterProtocol(uri);\r\n    }\r\n\r\n    if (this.options.field == undefined && this.options.openInOutlook) {\r\n      this.setField();\r\n    }\r\n\r\n    if (this.options.field != undefined) {\r\n      return this.filterProtocol(Utils.getFieldValue(this.result, <string>this.options.field));\r\n    }\r\n\r\n    return this.filterProtocol(this.result.clickUri);\r\n  }\r\n\r\n  private elementIsAnAnchor() {\r\n    return this.element.tagName == 'A';\r\n  }\r\n\r\n  private setField() {\r\n    let os = Utils.exists(this.os) ? this.os : OSUtils.get();\r\n    if (os == OS_NAME.MACOSX && this.hasOutlookField()) {\r\n      this.options.field = '@outlookformacuri';\r\n    } else if (os == OS_NAME.WINDOWS && this.hasOutlookField()) {\r\n      this.options.field = '@outlookuri';\r\n    }\r\n  }\r\n\r\n  private hasOutlookField() {\r\n    let os = Utils.exists(this.os) ? this.os : OSUtils.get();\r\n    if (os == OS_NAME.MACOSX && this.result.raw['outlookformacuri'] != undefined) {\r\n      return true;\r\n    } else if (os == OS_NAME.WINDOWS && this.result.raw['outlookuri'] != undefined) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private isUriThatMustBeOpenedInQuickview(): boolean {\r\n    return this.escapedClickUri.toLowerCase().indexOf('ldap://') == 0;\r\n  }\r\n\r\n  private quickviewShouldBeOpened() {\r\n    return (this.options.openQuickview || this.isUriThatMustBeOpenedInQuickview()) && QueryUtils.hasHTMLVersion(this.result);\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(ResultLink);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultLink/ResultLink.ts"],"sourceRoot":""}
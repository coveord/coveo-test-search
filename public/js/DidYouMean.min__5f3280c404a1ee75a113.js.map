{"version":3,"sources":["DidYouMean.min__5f3280c404a1ee75a113.js","./src/ui/DidYouMean/DidYouMean.ts"],"names":["webpackJsonpCoveo__temporary","246","module","exports","__webpack_require__","__extends","this","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","value","element","options","bindings","DidYouMean","ID","ComponentOptions","initComponentOptions","Assert","exists","hideNext","correctedTerm","bind","onRootElement","QueryEvents","buildingQuery","handlePrepareQueryBuilder","querySuccess","handleProcessNewQueryResults","noResults","handleNoResults","newQuery","handleNewQuery","$$","hide","_this","doQueryWithCorrectedTerm","queryStateModel","set","QueryStateModel","attributesEnum","q","queryController","deferExecuteQuery","beforeExecuteQuery","usageAnalytics","logSearchEvent","analyticsActionCauseList","didyoumeanClick","empty","data","queryBuilder","enableDidYouMean","Utils","isNonEmptyArray","results","queryCorrections","searchAsYouType","enableAutoCorrection","originalQuery","get","correctedQuery","correctedSentence","buildCorrectedSentence","searchInterface","historyManager","replaceState","getAttributes","retryTheQuery","noResultsFor","className","el","innerHTML","l","StringUtils","htmlEncode","appendChild","automaticCorrect","show","didyoumeanAutomatic","logger","trace","correctedWordEl","didYouMean","outerHTML","appendedCorrectedWordEl","find","tagName","on","correction","toReturn","currentOffset","_","each","wordCorrections","wordCorrection","push","slice","offset","length","join","doExport","exportGlobally","buildBooleanOption","defaultValue","Component","Initialization","registerAutoCreateComponent","601"],"mappings":"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","file":"DidYouMean.min__5f3280c404a1ee75a113.js","sourcesContent":["webpackJsonpCoveo__temporary([73],{\n\n/***/ 246:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__webpack_require__(601);\r\nvar _ = __webpack_require__(0);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\nvar QueryEvents_1 = __webpack_require__(11);\r\nvar Assert_1 = __webpack_require__(5);\r\nvar QueryStateModel_1 = __webpack_require__(13);\r\nvar Strings_1 = __webpack_require__(6);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar StringUtils_1 = __webpack_require__(22);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\r\nvar Component_1 = __webpack_require__(7);\r\nvar ComponentOptions_1 = __webpack_require__(8);\r\nvar Initialization_1 = __webpack_require__(2);\r\n/**\r\n * The DidYouMean component is responsible for displaying query corrections. If this component is in the page and the\r\n * query returns no result but finds a possible query correction, the component either suggests the correction or\r\n * automatically triggers a new query with the suggested term.\r\n */\r\nvar DidYouMean = /** @class */ (function (_super) {\r\n    __extends(DidYouMean, _super);\r\n    /**\r\n     * Creates a new DidYouMean component.\r\n     * @param element The HTMLElement on which to instantiate the component.\r\n     * @param options The options for the DidYouMean component.\r\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n     * automatically resolved (with a slower execution time).\r\n     */\r\n    function DidYouMean(element, options, bindings) {\r\n        var _this = _super.call(this, element, DidYouMean.ID, bindings) || this;\r\n        _this.element = element;\r\n        _this.options = options;\r\n        _this.bindings = bindings;\r\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, DidYouMean, options);\r\n        Assert_1.Assert.exists(element);\r\n        Assert_1.Assert.exists(_this.options);\r\n        _this.hideNext = true;\r\n        _this.correctedTerm = null;\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, _this.handlePrepareQueryBuilder);\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.querySuccess, _this.handleProcessNewQueryResults);\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.noResults, _this.handleNoResults);\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.newQuery, _this.handleNewQuery);\r\n        Dom_1.$$(_this.element).hide();\r\n        return _this;\r\n    }\r\n    /**\r\n     * Executes a query with the corrected term.\r\n     * Throws an exception if the corrected term has not been initialized.\r\n     * If successful, logs a `didyoumeanClick` event in the usage analytics.\r\n     */\r\n    DidYouMean.prototype.doQueryWithCorrectedTerm = function () {\r\n        var _this = this;\r\n        Assert_1.Assert.exists(this.correctedTerm);\r\n        this.queryStateModel.set(QueryStateModel_1.QueryStateModel.attributesEnum.q, this.correctedTerm);\r\n        this.queryController.deferExecuteQuery({\r\n            beforeExecuteQuery: function () { return _this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.didyoumeanClick, {}); }\r\n        });\r\n    };\r\n    DidYouMean.prototype.handleNewQuery = function () {\r\n        if (this.hideNext) {\r\n            Dom_1.$$(this.element).empty();\r\n            Dom_1.$$(this.element).hide();\r\n            this.correctedTerm = null;\r\n        }\r\n        else {\r\n            this.hideNext = true;\r\n        }\r\n    };\r\n    DidYouMean.prototype.handlePrepareQueryBuilder = function (data) {\r\n        Assert_1.Assert.exists(data);\r\n        data.queryBuilder.enableDidYouMean = true;\r\n    };\r\n    DidYouMean.prototype.handleNoResults = function (data) {\r\n        // We do not auto-correct on search-as-you-type queries\r\n        if (Utils_1.Utils.isNonEmptyArray(data.results.queryCorrections) && !data.searchAsYouType && this.options.enableAutoCorrection) {\r\n            var originalQuery = this.queryStateModel.get(QueryStateModel_1.QueryStateModel.attributesEnum.q);\r\n            this.correctedTerm = data.results.queryCorrections[0].correctedQuery;\r\n            var correctedSentence = this.buildCorrectedSentence(data.results.queryCorrections[0]);\r\n            this.queryStateModel.set(QueryStateModel_1.QueryStateModel.attributesEnum.q, data.results.queryCorrections[0].correctedQuery);\r\n            this.searchInterface.historyManager.replaceState(this.queryStateModel.getAttributes());\r\n            data.retryTheQuery = true;\r\n            this.hideNext = false;\r\n            var noResultsFor = Dom_1.$$('div', { className: 'coveo-did-you-mean-no-results-for' }).el;\r\n            noResultsFor.innerHTML = Strings_1.l('noResultFor', '<span class=\"coveo-highlight coveo-did-you-mean-highlight\">' + StringUtils_1.StringUtils.htmlEncode(originalQuery) + '</span>');\r\n            this.element.appendChild(noResultsFor);\r\n            var automaticCorrect = Dom_1.$$('div', { className: 'coveo-did-you-mean-automatic-correct' }).el;\r\n            automaticCorrect.innerHTML = Strings_1.l('autoCorrectedQueryTo', '<span class=\"coveo-highlight\">' + correctedSentence + '</span>');\r\n            this.element.appendChild(automaticCorrect);\r\n            Dom_1.$$(this.element).show();\r\n            this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.didyoumeanAutomatic, {});\r\n        }\r\n    };\r\n    DidYouMean.prototype.handleProcessNewQueryResults = function (data) {\r\n        var _this = this;\r\n        Assert_1.Assert.exists(data);\r\n        Assert_1.Assert.exists(data.results);\r\n        var results = data.results;\r\n        this.logger.trace('Received query results from new query', results);\r\n        if (Utils_1.Utils.isNonEmptyArray(results.queryCorrections)) {\r\n            var correctedSentence = this.buildCorrectedSentence(results.queryCorrections[0]);\r\n            this.correctedTerm = results.queryCorrections[0].correctedQuery;\r\n            var correctedWordEl = Dom_1.$$('button', {}, correctedSentence).el;\r\n            var didYouMean = Dom_1.$$('div', { className: 'coveo-did-you-mean-suggestion' }, Strings_1.l('didYouMean', correctedWordEl.outerHTML));\r\n            this.element.appendChild(didYouMean.el);\r\n            var appendedCorrectedWordEl = didYouMean.find(correctedWordEl.tagName);\r\n            Dom_1.$$(appendedCorrectedWordEl).on('click', function () { return _this.doQueryWithCorrectedTerm(); });\r\n            Dom_1.$$(this.element).show();\r\n        }\r\n    };\r\n    DidYouMean.prototype.buildCorrectedSentence = function (correction) {\r\n        var toReturn = [];\r\n        var tagStart = \"<span class='coveo-did-you-mean-word-correction'>\";\r\n        var tagEnd = '</span>';\r\n        var currentOffset = 0;\r\n        _.each(correction.wordCorrections, function (wordCorrection) {\r\n            toReturn.push(StringUtils_1.StringUtils.htmlEncode(correction.correctedQuery.slice(currentOffset, wordCorrection.offset)));\r\n            currentOffset = wordCorrection.offset;\r\n            toReturn.push(tagStart);\r\n            toReturn.push(StringUtils_1.StringUtils.htmlEncode(correction.correctedQuery.slice(currentOffset, wordCorrection.length + currentOffset)));\r\n            toReturn.push(tagEnd);\r\n            currentOffset = wordCorrection.offset + wordCorrection.length;\r\n        });\r\n        toReturn.push(StringUtils_1.StringUtils.htmlEncode(correction.correctedQuery.slice(currentOffset)));\r\n        return toReturn.join('');\r\n    };\r\n    DidYouMean.ID = 'DidYouMean';\r\n    DidYouMean.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            DidYouMean: DidYouMean\r\n        });\r\n    };\r\n    /**\r\n     * The options for the component\r\n     * @componentOptions\r\n     */\r\n    DidYouMean.options = {\r\n        /**\r\n         * Specifies whether the DidYouMean component automatically triggers a new query when a query returns no result and\r\n         * a possible correction is available.\r\n         *\r\n         * Default value is `true`.\r\n         */\r\n        enableAutoCorrection: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true })\r\n    };\r\n    return DidYouMean;\r\n}(Component_1.Component));\r\nexports.DidYouMean = DidYouMean;\r\nInitialization_1.Initialization.registerAutoCreateComponent(DidYouMean);\r\n\n\n/***/ }),\n\n/***/ 601:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// DidYouMean.min__5f3280c404a1ee75a113.js","import 'styling/_DidYouMean';\r\nimport * as _ from 'underscore';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { IBuildingQueryEventArgs, INoResultsEventArgs, IQuerySuccessEventArgs, QueryEvents } from '../../events/QueryEvents';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { QueryStateModel } from '../../models/QueryStateModel';\r\nimport { IQueryCorrection } from '../../rest/QueryCorrection';\r\nimport { l } from '../../strings/Strings';\r\nimport { $$ } from '../../utils/Dom';\r\nimport { StringUtils } from '../../utils/StringUtils';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { IAnalyticsNoMeta, analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\r\nimport { Component } from '../Base/Component';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { Initialization } from '../Base/Initialization';\r\n\r\nexport interface IDidYouMeanOptions {\r\n  enableAutoCorrection?: boolean;\r\n}\r\n\r\n/**\r\n * The DidYouMean component is responsible for displaying query corrections. If this component is in the page and the\r\n * query returns no result but finds a possible query correction, the component either suggests the correction or\r\n * automatically triggers a new query with the suggested term.\r\n */\r\nexport class DidYouMean extends Component {\r\n  static ID = 'DidYouMean';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      DidYouMean: DidYouMean\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the component\r\n   * @componentOptions\r\n   */\r\n  static options: IDidYouMeanOptions = {\r\n    /**\r\n     * Specifies whether the DidYouMean component automatically triggers a new query when a query returns no result and\r\n     * a possible correction is available.\r\n     *\r\n     * Default value is `true`.\r\n     */\r\n    enableAutoCorrection: ComponentOptions.buildBooleanOption({ defaultValue: true })\r\n  };\r\n\r\n  public correctedTerm: string;\r\n\r\n  private hideNext: boolean;\r\n\r\n  /**\r\n   * Creates a new DidYouMean component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the DidYouMean component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   */\r\n  constructor(public element: HTMLElement, public options?: IDidYouMeanOptions, public bindings?: IComponentBindings) {\r\n    super(element, DidYouMean.ID, bindings);\r\n\r\n    this.options = ComponentOptions.initComponentOptions(element, DidYouMean, options);\r\n    Assert.exists(element);\r\n    Assert.exists(this.options);\r\n\r\n    this.hideNext = true;\r\n\r\n    this.correctedTerm = null;\r\n\r\n    this.bind.onRootElement(QueryEvents.buildingQuery, this.handlePrepareQueryBuilder);\r\n    this.bind.onRootElement(QueryEvents.querySuccess, this.handleProcessNewQueryResults);\r\n    this.bind.onRootElement(QueryEvents.noResults, this.handleNoResults);\r\n    this.bind.onRootElement(QueryEvents.newQuery, this.handleNewQuery);\r\n    $$(this.element).hide();\r\n  }\r\n\r\n  /**\r\n   * Executes a query with the corrected term.\r\n   * Throws an exception if the corrected term has not been initialized.\r\n   * If successful, logs a `didyoumeanClick` event in the usage analytics.\r\n   */\r\n  public doQueryWithCorrectedTerm() {\r\n    Assert.exists(this.correctedTerm);\r\n    this.queryStateModel.set(QueryStateModel.attributesEnum.q, this.correctedTerm);\r\n    this.queryController.deferExecuteQuery({\r\n      beforeExecuteQuery: () => this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.didyoumeanClick, {})\r\n    });\r\n  }\r\n\r\n  private handleNewQuery() {\r\n    if (this.hideNext) {\r\n      $$(this.element).empty();\r\n      $$(this.element).hide();\r\n      this.correctedTerm = null;\r\n    } else {\r\n      this.hideNext = true;\r\n    }\r\n  }\r\n\r\n  private handlePrepareQueryBuilder(data: IBuildingQueryEventArgs) {\r\n    Assert.exists(data);\r\n    data.queryBuilder.enableDidYouMean = true;\r\n  }\r\n\r\n  private handleNoResults(data: INoResultsEventArgs) {\r\n    // We do not auto-correct on search-as-you-type queries\r\n    if (Utils.isNonEmptyArray(data.results.queryCorrections) && !data.searchAsYouType && this.options.enableAutoCorrection) {\r\n      let originalQuery = this.queryStateModel.get(QueryStateModel.attributesEnum.q);\r\n      this.correctedTerm = data.results.queryCorrections[0].correctedQuery;\r\n      let correctedSentence = this.buildCorrectedSentence(data.results.queryCorrections[0]);\r\n      this.queryStateModel.set(QueryStateModel.attributesEnum.q, data.results.queryCorrections[0].correctedQuery);\r\n      this.searchInterface.historyManager.replaceState(this.queryStateModel.getAttributes());\r\n      data.retryTheQuery = true;\r\n      this.hideNext = false;\r\n\r\n      let noResultsFor = $$('div', { className: 'coveo-did-you-mean-no-results-for' }).el;\r\n      noResultsFor.innerHTML = l(\r\n        'noResultFor',\r\n        '<span class=\"coveo-highlight coveo-did-you-mean-highlight\">' + StringUtils.htmlEncode(originalQuery) + '</span>'\r\n      );\r\n      this.element.appendChild(noResultsFor);\r\n\r\n      let automaticCorrect = $$('div', { className: 'coveo-did-you-mean-automatic-correct' }).el;\r\n      automaticCorrect.innerHTML = l('autoCorrectedQueryTo', '<span class=\"coveo-highlight\">' + correctedSentence + '</span>');\r\n      this.element.appendChild(automaticCorrect);\r\n\r\n      $$(this.element).show();\r\n      this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.didyoumeanAutomatic, {});\r\n    }\r\n  }\r\n\r\n  private handleProcessNewQueryResults(data: IQuerySuccessEventArgs) {\r\n    Assert.exists(data);\r\n    Assert.exists(data.results);\r\n\r\n    let results = data.results;\r\n    this.logger.trace('Received query results from new query', results);\r\n\r\n    if (Utils.isNonEmptyArray(results.queryCorrections)) {\r\n      const correctedSentence = this.buildCorrectedSentence(results.queryCorrections[0]);\r\n      this.correctedTerm = results.queryCorrections[0].correctedQuery;\r\n\r\n      const correctedWordEl = $$('button', {}, correctedSentence).el;\r\n      const didYouMean = $$('div', { className: 'coveo-did-you-mean-suggestion' }, l('didYouMean', correctedWordEl.outerHTML));\r\n      this.element.appendChild(didYouMean.el);\r\n\r\n      const appendedCorrectedWordEl = didYouMean.find(correctedWordEl.tagName);\r\n      $$(appendedCorrectedWordEl).on('click', () => this.doQueryWithCorrectedTerm());\r\n\r\n      $$(this.element).show();\r\n    }\r\n  }\r\n\r\n  private buildCorrectedSentence(correction: IQueryCorrection) {\r\n    let toReturn = [];\r\n    let tagStart = \"<span class='coveo-did-you-mean-word-correction'>\";\r\n    let tagEnd = '</span>';\r\n    let currentOffset = 0;\r\n    _.each(correction.wordCorrections, wordCorrection => {\r\n      toReturn.push(StringUtils.htmlEncode(correction.correctedQuery.slice(currentOffset, wordCorrection.offset)));\r\n      currentOffset = wordCorrection.offset;\r\n      toReturn.push(tagStart);\r\n      toReturn.push(StringUtils.htmlEncode(correction.correctedQuery.slice(currentOffset, wordCorrection.length + currentOffset)));\r\n      toReturn.push(tagEnd);\r\n      currentOffset = wordCorrection.offset + wordCorrection.length;\r\n    });\r\n    toReturn.push(StringUtils.htmlEncode(correction.correctedQuery.slice(currentOffset)));\r\n    return toReturn.join('');\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(DidYouMean);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DidYouMean/DidYouMean.ts"],"sourceRoot":""}
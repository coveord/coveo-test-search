{"version":3,"sources":["Sort.min__5f3280c404a1ee75a113.js","./src/ui/Sort/Sort.ts","./src/ui/Sort/SortCriteria.ts"],"names":["webpackJsonpCoveo__temporary","192","module","exports","__webpack_require__","__extends","this","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","value","element","options","bindings","Sort","ID","ComponentOptions","initComponentOptions","Assert","isLargerOrEqualsThan","sortCriteria","length","bind","onQueryState","MODEL_EVENTS","CHANGE_ONE","QUERY_STATE_ATTRIBUTES","SORT","handleQueryStateChanged","onRootElement","QueryEvents","querySuccess","args","handleQuerySuccess","buildingQuery","handleBuildingQuery","queryError","handleQueryError","ensureDom","_this","createDom","el","$$","on","selectAndExecuteQuery","innerText","text","empty","findOrCreateRadioGroup","createSortButton","isToggle","createDirectionButton","update","select","direction","currentCriteria","find","criteria","updateQueryStateModel","Utils","exists","selectNextCriteria","selectFirstCriteria","oldCriteria","executeSearchQuery","enable","removeClass","disable","addClass","getCurrentCriteria","match","sortId","any","toString","radioGroup","findRadioGroup","setAttribute","sortButton","caption","AccessibleButton","withElement","withEnterKeyboardAction","withArrowsAction","e","onArrowPressed","withLabel","getDirectionalLabel","initialDirection","getOmnidirectionalLabel","withRole","build","appendChild","directionButton","className","createIcons","withSelectAction","stopPropagation","selectNextCriteriaAndExecuteQuery","VALID_DIRECTION","DESCENDING","ASCENDING","selectNextRadioButton","ArrowDirection","RIGHT","DOWN","iconAscending","SVGIcons","icons","arrowUp","SVGDom","addClassToSVGInContainer","iconDescending","arrowDown","document","body","getAttribute","parentElement","indexToSelect","radioButtons","findAll","currentIndex","findIndex","radio","radioToSelect","focus","click","queryController","deferExecuteQuery","beforeExecuteQuery","logSortEvent","usageAnalytics","sort","indexOfCurrentCriteria","indexOf","queryStateModel","get","QueryStateModel","attributesEnum","isNonEmptyString","criteriaFromModel","SortCriteria","parse","equals","updateAppearance","updateAccessibilityProperties","enumerable","configurable","captionIsDefined","textContent","data","defaultAttributes","isSelected","putInQueryBuilder","queryBuilder","results","toggleClass","currentDirection","resultListsIds","directionIsInitial","searchInterface","getComponents","map","resultList","id","join","localizedCaption","l","displayedSortText","set","doExport","exportGlobally","buildCustomListOption","values","required","buildLocalizedStringOption","Component","Initialization","registerAutoCreateComponent","498","VALID_SORT","SortCriterion","sortIsField","check","isValidSort","sortNeedsDirection","isValidDirection","chain","contains","charAt","sortsNeedingDirection","DATE","rawCriteriaString","split","forEach","criterion","push","first","574"],"mappings":"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","file":"Sort.min__5f3280c404a1ee75a113.js","sourcesContent":["webpackJsonpCoveo__temporary([39],{\n\n/***/ 192:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__webpack_require__(574);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\nvar QueryEvents_1 = __webpack_require__(11);\r\nvar Assert_1 = __webpack_require__(5);\r\nvar Model_1 = __webpack_require__(18);\r\nvar QueryStateModel_1 = __webpack_require__(13);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar SVGDom_1 = __webpack_require__(16);\r\nvar SVGIcons_1 = __webpack_require__(12);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar SharedAnalyticsCalls_1 = __webpack_require__(119);\r\nvar Component_1 = __webpack_require__(7);\r\nvar ComponentOptions_1 = __webpack_require__(8);\r\nvar Initialization_1 = __webpack_require__(2);\r\nvar SortCriteria_1 = __webpack_require__(498);\r\nvar AccessibleButton_1 = __webpack_require__(15);\r\nvar Strings_1 = __webpack_require__(6);\r\nvar underscore_1 = __webpack_require__(0);\r\n/**\r\n * The `Sort` component renders a widget that the end user can interact with to select the criterion to use when sorting query results.\r\n *\r\n * To improve accessibility, it's recommended to group `Sort` components in a container with `role=\"radiogroup\"`.\r\n */\r\nvar Sort = /** @class */ (function (_super) {\r\n    __extends(Sort, _super);\r\n    /**\r\n     * Creates a new `Sort` component instance.\r\n     * @param element The HTMLElement on which to instantiate the component.\r\n     * @param options The options for this component instance.\r\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n     * automatically resolved (with a slower execution time).\r\n     */\r\n    function Sort(element, options, bindings) {\r\n        var _this = _super.call(this, element, Sort.ID, bindings) || this;\r\n        _this.element = element;\r\n        _this.options = options;\r\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, Sort, options);\r\n        Assert_1.Assert.isLargerOrEqualsThan(1, _this.options.sortCriteria.length);\r\n        _this.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE_ONE, QueryStateModel_1.QUERY_STATE_ATTRIBUTES.SORT, function () { return _this.handleQueryStateChanged(); });\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.querySuccess, function (args) { return _this.handleQuerySuccess(args); });\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) { return _this.handleBuildingQuery(args); });\r\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.queryError, function (args) { return _this.handleQueryError(args); });\r\n        _this.ensureDom();\r\n        return _this;\r\n    }\r\n    Sort.prototype.createDom = function () {\r\n        var _this = this;\r\n        var el = Dom_1.$$(this.element);\r\n        el.on('click', function () { return _this.selectAndExecuteQuery(); });\r\n        var innerText = el.text();\r\n        el.empty();\r\n        this.findOrCreateRadioGroup();\r\n        this.createSortButton(innerText);\r\n        if (this.isToggle()) {\r\n            this.createDirectionButton();\r\n        }\r\n        this.update();\r\n    };\r\n    /**\r\n     * Selects this `Sort` component.\r\n     *\r\n     * Updates the state model if selecting this component toggles its current [`sortCriteria`]{@link Sort.options.sortCriteria}.\r\n     *\r\n     * @param direction The sort direction. Can be one of: `ascending`, `descending`.\r\n     */\r\n    Sort.prototype.select = function (direction) {\r\n        if (direction) {\r\n            this.currentCriteria = underscore_1.find(this.options.sortCriteria, function (criteria) {\r\n                return criteria.direction == direction;\r\n            });\r\n            this.updateQueryStateModel();\r\n        }\r\n        else if (Utils_1.Utils.exists(this.currentCriteria)) {\r\n            this.selectNextCriteria();\r\n        }\r\n        else {\r\n            this.selectFirstCriteria();\r\n        }\r\n    };\r\n    /**\r\n     * Selects this `Sort` component, then triggers a query if selecting this component toggles its current [`sortCriteria`]{@link Sort.options.sortCriteria}.\r\n     *\r\n     * Also logs an event in the usage analytics with the new current sort criteria.\r\n     */\r\n    Sort.prototype.selectAndExecuteQuery = function () {\r\n        var oldCriteria = this.currentCriteria;\r\n        this.select();\r\n        if (oldCriteria != this.currentCriteria) {\r\n            this.executeSearchQuery();\r\n        }\r\n    };\r\n    Sort.prototype.enable = function () {\r\n        Dom_1.$$(this.element).removeClass('coveo-tab-disabled');\r\n        this.update();\r\n        _super.prototype.enable.call(this);\r\n    };\r\n    Sort.prototype.disable = function () {\r\n        Dom_1.$$(this.element).addClass('coveo-tab-disabled');\r\n        _super.prototype.disable.call(this);\r\n    };\r\n    /**\r\n     * Gets the current [`sortCriteria`]{@link Sort.options.sortCriteria} of this `Sort` component.\r\n     * @returns {SortCriteria}\r\n     */\r\n    Sort.prototype.getCurrentCriteria = function () {\r\n        return this.currentCriteria;\r\n    };\r\n    /**\r\n     * Indicates whether the name of any of the available [`sortCriteria`]{@link Sort.options.sortCriteria} of this `Sort` component matches the argument.\r\n     * @param sortId The sort criteria name to look for (e.g., `date descending`).\r\n     */\r\n    Sort.prototype.match = function (sortId) {\r\n        return underscore_1.any(this.options.sortCriteria, function (sortCriteria) { return sortId == sortCriteria.toString(); });\r\n    };\r\n    Sort.prototype.findOrCreateRadioGroup = function () {\r\n        this.radioGroup = this.findRadioGroup();\r\n        if (!this.radioGroup) {\r\n            this.element.setAttribute('role', 'radiogroup');\r\n            this.radioGroup = this.element;\r\n        }\r\n    };\r\n    Sort.prototype.createSortButton = function (innerText) {\r\n        var _this = this;\r\n        this.sortButton = Dom_1.$$('span').el;\r\n        this.sortButton.innerText = this.options.caption || innerText;\r\n        new AccessibleButton_1.AccessibleButton()\r\n            .withElement(this.sortButton)\r\n            .withEnterKeyboardAction(function () { return _this.selectAndExecuteQuery(); })\r\n            .withArrowsAction(function (direction, e) { return _this.onArrowPressed(direction, e); })\r\n            .withLabel(this.isToggle() ? this.getDirectionalLabel(this.initialDirection) : this.getOmnidirectionalLabel())\r\n            .withRole('radio')\r\n            .build();\r\n        this.element.appendChild(this.sortButton);\r\n    };\r\n    Sort.prototype.createDirectionButton = function () {\r\n        var _this = this;\r\n        this.directionButton = Dom_1.$$.apply(void 0, ['span', { className: 'coveo-icon' }].concat(this.createIcons())).el;\r\n        new AccessibleButton_1.AccessibleButton()\r\n            .withElement(this.directionButton)\r\n            .withSelectAction(function (e) {\r\n            e.stopPropagation();\r\n            _this.selectNextCriteriaAndExecuteQuery();\r\n        })\r\n            .withArrowsAction(function (direction, e) { return _this.onArrowPressed(direction, e); })\r\n            .withLabel(this.getDirectionalLabel(this.initialDirection === SortCriteria_1.VALID_DIRECTION.DESCENDING ? SortCriteria_1.VALID_DIRECTION.ASCENDING : SortCriteria_1.VALID_DIRECTION.DESCENDING))\r\n            .withRole('radio')\r\n            .build();\r\n        this.element.appendChild(this.directionButton);\r\n    };\r\n    Sort.prototype.onArrowPressed = function (direction, e) {\r\n        this.selectNextRadioButton(direction === AccessibleButton_1.ArrowDirection.RIGHT || direction === AccessibleButton_1.ArrowDirection.DOWN ? 1 : -1);\r\n        e.stopPropagation();\r\n    };\r\n    Sort.prototype.createIcons = function () {\r\n        var iconAscending = Dom_1.$$('span', { className: 'coveo-sort-icon-ascending' }, SVGIcons_1.SVGIcons.icons.arrowUp);\r\n        SVGDom_1.SVGDom.addClassToSVGInContainer(iconAscending.el, 'coveo-sort-icon-ascending-svg');\r\n        var iconDescending = Dom_1.$$('span', { className: 'coveo-sort-icon-descending' }, SVGIcons_1.SVGIcons.icons.arrowDown);\r\n        SVGDom_1.SVGDom.addClassToSVGInContainer(iconDescending.el, 'coveo-sort-icon-descending-svg');\r\n        return [iconAscending, iconDescending];\r\n    };\r\n    Sort.prototype.findRadioGroup = function (element) {\r\n        if (element === void 0) { element = this.element; }\r\n        if (!element || element === document.body) {\r\n            return null;\r\n        }\r\n        if (element.getAttribute('role') === 'radiogroup') {\r\n            return element;\r\n        }\r\n        return this.findRadioGroup(element.parentElement);\r\n    };\r\n    Sort.prototype.selectNextRadioButton = function (direction) {\r\n        if (direction === void 0) { direction = 1; }\r\n        var radioButtons = Dom_1.$$(this.radioGroup).findAll('[role=\"radio\"]');\r\n        var currentIndex = underscore_1.findIndex(radioButtons, function (radio) { return radio.getAttribute('aria-checked') === 'true'; });\r\n        var indexToSelect;\r\n        var isAnythingSelected = currentIndex !== -1;\r\n        if (isAnythingSelected) {\r\n            indexToSelect = (currentIndex + direction + radioButtons.length) % radioButtons.length;\r\n        }\r\n        else {\r\n            if (direction >= 0) {\r\n                indexToSelect = 0;\r\n            }\r\n            else {\r\n                indexToSelect = radioButtons.length - 1;\r\n            }\r\n        }\r\n        var radioToSelect = radioButtons[indexToSelect];\r\n        radioToSelect.focus();\r\n        radioToSelect.click();\r\n    };\r\n    Sort.prototype.executeSearchQuery = function () {\r\n        var _this = this;\r\n        this.queryController.deferExecuteQuery({\r\n            beforeExecuteQuery: function () { return SharedAnalyticsCalls_1.logSortEvent(_this.usageAnalytics, _this.currentCriteria.sort + _this.currentCriteria.direction); }\r\n        });\r\n    };\r\n    Sort.prototype.selectFirstCriteria = function () {\r\n        this.currentCriteria = this.options.sortCriteria[0];\r\n        this.updateQueryStateModel();\r\n    };\r\n    Sort.prototype.selectNextCriteria = function () {\r\n        var indexOfCurrentCriteria = this.currentCriteria ? this.options.sortCriteria.indexOf(this.currentCriteria) : 0;\r\n        this.currentCriteria = this.options.sortCriteria[(indexOfCurrentCriteria + 1) % this.options.sortCriteria.length];\r\n        this.updateQueryStateModel();\r\n    };\r\n    Sort.prototype.selectNextCriteriaAndExecuteQuery = function () {\r\n        var oldCriteria = this.currentCriteria;\r\n        this.selectNextCriteria();\r\n        if (oldCriteria != this.currentCriteria) {\r\n            this.executeSearchQuery();\r\n        }\r\n    };\r\n    Sort.prototype.handleQueryStateChanged = function () {\r\n        this.update();\r\n    };\r\n    Sort.prototype.update = function () {\r\n        // Basically, if the criteria in the model fits with one of ours, it'll become our active criteria\r\n        var sortCriteria = this.queryStateModel.get(QueryStateModel_1.QueryStateModel.attributesEnum.sort);\r\n        if (Utils_1.Utils.isNonEmptyString(sortCriteria)) {\r\n            var criteriaFromModel = SortCriteria_1.SortCriteria.parse(sortCriteria);\r\n            this.currentCriteria = underscore_1.find(this.options.sortCriteria, function (criteria) { return criteriaFromModel.equals(criteria); });\r\n        }\r\n        else {\r\n            this.currentCriteria = null;\r\n        }\r\n        this.updateAppearance();\r\n        this.updateAccessibilityProperties();\r\n    };\r\n    Object.defineProperty(Sort.prototype, \"captionIsDefined\", {\r\n        get: function () {\r\n            return Utils_1.Utils.isNonEmptyString(this.options.caption);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Sort.prototype, \"currentDirection\", {\r\n        get: function () {\r\n            return this.currentCriteria ? this.currentCriteria.direction : this.initialDirection;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Sort.prototype, \"initialDirection\", {\r\n        get: function () {\r\n            return this.options.sortCriteria[0].direction;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Sort.prototype, \"displayedSortText\", {\r\n        get: function () {\r\n            return this.captionIsDefined ? this.options.caption : this.element.textContent;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Sort.prototype.handleBuildingQuery = function (data) {\r\n        Assert_1.Assert.exists(data);\r\n        var sort = this.queryStateModel.get(QueryStateModel_1.QueryStateModel.attributesEnum.sort);\r\n        if (sort == QueryStateModel_1.QueryStateModel.defaultAttributes.sort || this.isSelected()) {\r\n            if (this.currentCriteria) {\r\n                this.currentCriteria.putInQueryBuilder(data.queryBuilder);\r\n            }\r\n        }\r\n    };\r\n    Sort.prototype.handleQuerySuccess = function (data) {\r\n        if (data.results.results.length == 0) {\r\n            Dom_1.$$(this.element).addClass('coveo-sort-hidden');\r\n        }\r\n        else {\r\n            Dom_1.$$(this.element).removeClass('coveo-sort-hidden');\r\n        }\r\n    };\r\n    Sort.prototype.handleQueryError = function (data) {\r\n        Dom_1.$$(this.element).addClass('coveo-sort-hidden');\r\n    };\r\n    Sort.prototype.isToggle = function () {\r\n        return this.options.sortCriteria.length > 1;\r\n    };\r\n    Sort.prototype.isSelected = function () {\r\n        return Utils_1.Utils.exists(this.currentCriteria);\r\n    };\r\n    Sort.prototype.updateAppearance = function () {\r\n        Dom_1.$$(this.element).toggleClass('coveo-selected', this.isSelected());\r\n        if (this.isToggle()) {\r\n            Dom_1.$$(this.element).removeClass('coveo-ascending');\r\n            Dom_1.$$(this.element).removeClass('coveo-descending');\r\n            if (this.isSelected()) {\r\n                Dom_1.$$(this.element).addClass(this.currentDirection === 'ascending' ? 'coveo-ascending' : 'coveo-descending');\r\n            }\r\n        }\r\n    };\r\n    Sort.prototype.updateAccessibilityProperties = function () {\r\n        this.sortButton.setAttribute('aria-controls', this.resultListsIds);\r\n        var directionIsInitial = this.currentDirection === this.initialDirection;\r\n        this.sortButton.setAttribute('aria-checked', \"\" + (this.isSelected() && directionIsInitial));\r\n        if (this.isToggle()) {\r\n            this.directionButton.setAttribute('aria-controls', this.resultListsIds);\r\n            this.directionButton.setAttribute('aria-checked', \"\" + (this.isSelected() && !directionIsInitial));\r\n        }\r\n    };\r\n    Object.defineProperty(Sort.prototype, \"resultListsIds\", {\r\n        get: function () {\r\n            var resultLists = this.searchInterface.getComponents('ResultList');\r\n            return resultLists.map(function (resultList) { return resultList.element.id; }).join(' ');\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Sort.prototype.getDirectionalLabel = function (direction) {\r\n        var localizedCaption = Strings_1.l(this.displayedSortText);\r\n        return direction === SortCriteria_1.VALID_DIRECTION.DESCENDING\r\n            ? Strings_1.l('SortResultsByDescending', localizedCaption)\r\n            : Strings_1.l('SortResultsByAscending', localizedCaption);\r\n    };\r\n    Sort.prototype.getOmnidirectionalLabel = function () {\r\n        var localizedCaption = Strings_1.l(this.displayedSortText);\r\n        return Strings_1.l('SortResultsBy', localizedCaption);\r\n    };\r\n    Sort.prototype.updateQueryStateModel = function () {\r\n        this.queryStateModel.set(QueryStateModel_1.QueryStateModel.attributesEnum.sort, this.currentCriteria.toString());\r\n    };\r\n    Sort.ID = 'Sort';\r\n    Sort.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            Sort: Sort,\r\n            SortCriteria: SortCriteria_1.SortCriteria\r\n        });\r\n    };\r\n    /**\r\n     * Options for the component\r\n     * @componentOptions\r\n     */\r\n    Sort.options = {\r\n        /**\r\n         * The sort criterion/criteria the end user can select/toggle between when interacting with this component instance.\r\n         *\r\n         * The available sort criteria are:\r\n         * - `relevancy`\r\n         * - `date ascending`/`date descending`\r\n         * - `qre`\r\n         * - `@field ascending`/`@field descending`, where you must replace `field` with the name of a sortable field in your index (e.g., `data-sort-criteria=\"@size ascending\"`).\r\n         *\r\n         * You can specify a comma separated list of sort criteria to toggle between when interacting with this component instance (e.g., `data-sort-criteria=\"date descending,date ascending\"`).\r\n         *\r\n         * You can specify multiple sort criteria to be used in the same request by separating them with a semicolon (e.g., `data-sort-criteria=\"@size ascending;date ascending\"` ).\r\n         *\r\n         * Interacting with this component instance will cycle through those criteria in the order they are listed in.\r\n         * Typically, you should only specify a list of sort criteria when you want the end user to be able to to toggle the direction of a `date` or `@field` sort criteria.\r\n         * Otherwise, you should configure a distinct `Sort` component instance for each sort criterion you want to make available in your search page.\r\n         *\r\n         * You must specify a valid value for this option in order for this component instance to work correctly.\r\n         *\r\n         * Examples:\r\n         *\r\n         * - `data-sort-criteria=\"date ascending\"` createes a Sort component that allows to sort on `date ascending`, without being able to toggle the order.\r\n         * - `data-sort-criteria=\"date ascending, date descending\"` creates a Sort component that allows end users to toggle between `date ascending` and `date descending` on click.\r\n         * - `data-sort-criteria=\"@size ascending; date descending\"` creates a Sort component that only allows end users to sort on `@size ascending`. The index then applies a second sort on `date descending` when two items are of equal value.\r\n         * - `data-sort-criteria=\"@size ascending; date descending, @size descending; date descending\"` creates a Sort component that allows end users to toggle between `@size ascending` and `@size descending`. For each value, the index applies a second sort on `date descending` when two items are of equal value.\r\n         */\r\n        sortCriteria: ComponentOptions_1.ComponentOptions.buildCustomListOption(function (values) {\r\n            return values.map(function (criteria) {\r\n                // 'any' because Underscore won't accept the union type as an argument.\r\n                if (typeof criteria === 'string') {\r\n                    return new SortCriteria_1.SortCriteria(criteria);\r\n                }\r\n                else {\r\n                    return criteria;\r\n                }\r\n            });\r\n        }, { required: true }),\r\n        /**\r\n         * The caption to display on this component instance.\r\n         *\r\n         * By default, the component uses the text content of the element it is instanciated on.\r\n         */\r\n        caption: ComponentOptions_1.ComponentOptions.buildLocalizedStringOption({ required: true })\r\n    };\r\n    return Sort;\r\n}(Component_1.Component));\r\nexports.Sort = Sort;\r\nInitialization_1.Initialization.registerAutoCreateComponent(Sort);\r\n\n\n/***/ }),\n\n/***/ 498:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar underscore_1 = __webpack_require__(0);\r\nvar Assert_1 = __webpack_require__(5);\r\nvar VALID_SORT;\r\n(function (VALID_SORT) {\r\n    VALID_SORT[\"RELEVANCY\"] = \"relevancy\";\r\n    VALID_SORT[\"DATE\"] = \"date\";\r\n    VALID_SORT[\"QRE\"] = \"qre\";\r\n})(VALID_SORT = exports.VALID_SORT || (exports.VALID_SORT = {}));\r\nvar VALID_DIRECTION;\r\n(function (VALID_DIRECTION) {\r\n    VALID_DIRECTION[\"ASCENDING\"] = \"ascending\";\r\n    VALID_DIRECTION[\"DESCENDING\"] = \"descending\";\r\n})(VALID_DIRECTION = exports.VALID_DIRECTION || (exports.VALID_DIRECTION = {}));\r\nvar SortCriterion = /** @class */ (function () {\r\n    /**\r\n     * Create a new SortCriteria\r\n     * @param sort The sort criteria (e.g.: relevancy, date)\r\n     * @param direction The direction by which to sort (e.g.: ascending, descending)\r\n     */\r\n    function SortCriterion(sort, direction) {\r\n        if (direction === void 0) { direction = ''; }\r\n        this.sort = sort;\r\n        this.direction = direction;\r\n        if (!SortCriterion.sortIsField(sort)) {\r\n            Assert_1.Assert.check(this.isValidSort(sort), sort + \" is not a valid sort criteria. Valid values are \" + underscore_1.values(VALID_SORT) + \" or a valid index sortable index field.\");\r\n        }\r\n        if (SortCriterion.sortNeedsDirection(sort)) {\r\n            Assert_1.Assert.check(this.isValidDirection(direction), direction + \" is not a valid sort criteria direction. Valid values are \" + underscore_1.values(VALID_DIRECTION));\r\n        }\r\n        else {\r\n            Assert_1.Assert.check(direction == '');\r\n        }\r\n    }\r\n    SortCriterion.prototype.isValidDirection = function (direction) {\r\n        return underscore_1.chain(VALID_DIRECTION)\r\n            .values()\r\n            .contains(direction)\r\n            .value();\r\n    };\r\n    SortCriterion.prototype.isValidSort = function (sort) {\r\n        return underscore_1.chain(VALID_SORT)\r\n            .values()\r\n            .contains(sort)\r\n            .value();\r\n    };\r\n    SortCriterion.sortIsField = function (criteria) {\r\n        return criteria.charAt(0) == '@';\r\n    };\r\n    SortCriterion.sortNeedsDirection = function (sort) {\r\n        return underscore_1.contains(SortCriterion.sortsNeedingDirection, sort) || SortCriterion.sortIsField(sort);\r\n    };\r\n    SortCriterion.sortsNeedingDirection = [VALID_SORT.DATE];\r\n    return SortCriterion;\r\n}());\r\nexports.SortCriterion = SortCriterion;\r\nvar SortCriteria = /** @class */ (function () {\r\n    function SortCriteria(rawCriteriaString) {\r\n        var _this = this;\r\n        this.criteria = [];\r\n        var criteria = rawCriteriaString.split(';');\r\n        criteria.forEach(function (criterion) {\r\n            var split = criterion.match(/\\S+/g);\r\n            _this.criteria.push(new SortCriterion(split[0], split[1]));\r\n        });\r\n    }\r\n    Object.defineProperty(SortCriteria.prototype, \"direction\", {\r\n        get: function () {\r\n            return underscore_1.first(this.criteria).direction;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(SortCriteria.prototype, \"sort\", {\r\n        get: function () {\r\n            return underscore_1.first(this.criteria).sort;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Return a new SortCriteria from a string\r\n     * @param criteria The string from which to create the SortCriteria\r\n     */\r\n    SortCriteria.parse = function (criteria) {\r\n        return new SortCriteria(criteria);\r\n    };\r\n    /**\r\n     * Put the sort criteria in the passed queryBuilder\r\n     * @param queryBuilder The queryBuilder in which to put the sort criteria.\r\n     */\r\n    SortCriteria.prototype.putInQueryBuilder = function (queryBuilder) {\r\n        Assert_1.Assert.exists(queryBuilder);\r\n        queryBuilder.sortCriteria = this.toString()\r\n            .split(';')\r\n            .join(',');\r\n    };\r\n    /**\r\n     * Returns a string representation of the sort criteria (e.g.: 'date ascending').\r\n     */\r\n    SortCriteria.prototype.toString = function () {\r\n        return this.criteria\r\n            .map(function (criterion) {\r\n            return criterion.direction ? criterion.sort + \" \" + criterion.direction : \"\" + criterion.sort;\r\n        })\r\n            .join(';');\r\n    };\r\n    /**\r\n     * Checks if the SortCriteria is equal to another.\r\n     * @param criteria The SortCriteria to compare with\r\n     */\r\n    SortCriteria.prototype.equals = function (criteria) {\r\n        return criteria.toString() == this.toString();\r\n    };\r\n    return SortCriteria;\r\n}());\r\nexports.SortCriteria = SortCriteria;\r\n\n\n/***/ }),\n\n/***/ 574:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// Sort.min__5f3280c404a1ee75a113.js","import 'styling/_Sort';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { IBuildingQueryEventArgs, IQueryErrorEventArgs, IQuerySuccessEventArgs, QueryEvents } from '../../events/QueryEvents';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { MODEL_EVENTS } from '../../models/Model';\r\nimport { QUERY_STATE_ATTRIBUTES, QueryStateModel } from '../../models/QueryStateModel';\r\nimport { $$ } from '../../utils/Dom';\r\nimport { SVGDom } from '../../utils/SVGDom';\r\nimport { SVGIcons } from '../../utils/SVGIcons';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { logSortEvent } from '../Analytics/SharedAnalyticsCalls';\r\nimport { Component } from '../Base/Component';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { Initialization } from '../Base/Initialization';\r\nimport { SortCriteria, VALID_DIRECTION } from './SortCriteria';\r\nimport { AccessibleButton, ArrowDirection } from '../../utils/AccessibleButton';\r\nimport { l } from '../../strings/Strings';\r\nimport { findIndex, find, any } from 'underscore';\r\n\r\nexport interface ISortOptions {\r\n  sortCriteria?: SortCriteria[];\r\n  caption?: string;\r\n}\r\n/**\r\n * The `Sort` component renders a widget that the end user can interact with to select the criterion to use when sorting query results.\r\n *\r\n * To improve accessibility, it's recommended to group `Sort` components in a container with `role=\"radiogroup\"`.\r\n */\r\nexport class Sort extends Component {\r\n  static ID = 'Sort';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      Sort: Sort,\r\n      SortCriteria: SortCriteria\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Options for the component\r\n   * @componentOptions\r\n   */\r\n  static options: ISortOptions = {\r\n    /**\r\n     * The sort criterion/criteria the end user can select/toggle between when interacting with this component instance.\r\n     *\r\n     * The available sort criteria are:\r\n     * - `relevancy`\r\n     * - `date ascending`/`date descending`\r\n     * - `qre`\r\n     * - `@field ascending`/`@field descending`, where you must replace `field` with the name of a sortable field in your index (e.g., `data-sort-criteria=\"@size ascending\"`).\r\n     *\r\n     * You can specify a comma separated list of sort criteria to toggle between when interacting with this component instance (e.g., `data-sort-criteria=\"date descending,date ascending\"`).\r\n     *\r\n     * You can specify multiple sort criteria to be used in the same request by separating them with a semicolon (e.g., `data-sort-criteria=\"@size ascending;date ascending\"` ).\r\n     *\r\n     * Interacting with this component instance will cycle through those criteria in the order they are listed in.\r\n     * Typically, you should only specify a list of sort criteria when you want the end user to be able to to toggle the direction of a `date` or `@field` sort criteria.\r\n     * Otherwise, you should configure a distinct `Sort` component instance for each sort criterion you want to make available in your search page.\r\n     *\r\n     * You must specify a valid value for this option in order for this component instance to work correctly.\r\n     *\r\n     * Examples:\r\n     *\r\n     * - `data-sort-criteria=\"date ascending\"` createes a Sort component that allows to sort on `date ascending`, without being able to toggle the order.\r\n     * - `data-sort-criteria=\"date ascending, date descending\"` creates a Sort component that allows end users to toggle between `date ascending` and `date descending` on click.\r\n     * - `data-sort-criteria=\"@size ascending; date descending\"` creates a Sort component that only allows end users to sort on `@size ascending`. The index then applies a second sort on `date descending` when two items are of equal value.\r\n     * - `data-sort-criteria=\"@size ascending; date descending, @size descending; date descending\"` creates a Sort component that allows end users to toggle between `@size ascending` and `@size descending`. For each value, the index applies a second sort on `date descending` when two items are of equal value.\r\n     */\r\n    sortCriteria: ComponentOptions.buildCustomListOption(\r\n      values => {\r\n        return values.map(criteria => {\r\n          // 'any' because Underscore won't accept the union type as an argument.\r\n          if (typeof criteria === 'string') {\r\n            return new SortCriteria(criteria);\r\n          } else {\r\n            return criteria as SortCriteria;\r\n          }\r\n        });\r\n      },\r\n      { required: true }\r\n    ),\r\n\r\n    /**\r\n     * The caption to display on this component instance.\r\n     *\r\n     * By default, the component uses the text content of the element it is instanciated on.\r\n     */\r\n    caption: ComponentOptions.buildLocalizedStringOption({ required: true })\r\n  };\r\n\r\n  private currentCriteria: SortCriteria;\r\n\r\n  private sortButton: HTMLElement;\r\n  private directionButton: HTMLElement;\r\n  private radioGroup: HTMLElement;\r\n\r\n  /**\r\n   * Creates a new `Sort` component instance.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for this component instance.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   */\r\n  constructor(public element: HTMLElement, public options?: ISortOptions, bindings?: IComponentBindings) {\r\n    super(element, Sort.ID, bindings);\r\n\r\n    this.options = ComponentOptions.initComponentOptions(element, Sort, options);\r\n\r\n    Assert.isLargerOrEqualsThan(1, this.options.sortCriteria.length);\r\n\r\n    this.bind.onQueryState(MODEL_EVENTS.CHANGE_ONE, QUERY_STATE_ATTRIBUTES.SORT, () => this.handleQueryStateChanged());\r\n    this.bind.onRootElement(QueryEvents.querySuccess, (args: IQuerySuccessEventArgs) => this.handleQuerySuccess(args));\r\n    this.bind.onRootElement(QueryEvents.buildingQuery, (args: IBuildingQueryEventArgs) => this.handleBuildingQuery(args));\r\n    this.bind.onRootElement(QueryEvents.queryError, (args: IQueryErrorEventArgs) => this.handleQueryError(args));\r\n    this.ensureDom();\r\n  }\r\n\r\n  public createDom() {\r\n    const el = $$(this.element);\r\n    el.on('click', () => this.selectAndExecuteQuery());\r\n    const innerText = el.text();\r\n    el.empty();\r\n\r\n    this.findOrCreateRadioGroup();\r\n    this.createSortButton(innerText);\r\n    if (this.isToggle()) {\r\n      this.createDirectionButton();\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * Selects this `Sort` component.\r\n   *\r\n   * Updates the state model if selecting this component toggles its current [`sortCriteria`]{@link Sort.options.sortCriteria}.\r\n   *\r\n   * @param direction The sort direction. Can be one of: `ascending`, `descending`.\r\n   */\r\n  public select(direction?: string) {\r\n    if (direction) {\r\n      this.currentCriteria = find(this.options.sortCriteria, (criteria: SortCriteria) => {\r\n        return criteria.direction == direction;\r\n      });\r\n      this.updateQueryStateModel();\r\n    } else if (Utils.exists(this.currentCriteria)) {\r\n      this.selectNextCriteria();\r\n    } else {\r\n      this.selectFirstCriteria();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Selects this `Sort` component, then triggers a query if selecting this component toggles its current [`sortCriteria`]{@link Sort.options.sortCriteria}.\r\n   *\r\n   * Also logs an event in the usage analytics with the new current sort criteria.\r\n   */\r\n\r\n  public selectAndExecuteQuery() {\r\n    var oldCriteria = this.currentCriteria;\r\n    this.select();\r\n    if (oldCriteria != this.currentCriteria) {\r\n      this.executeSearchQuery();\r\n    }\r\n  }\r\n\r\n  public enable() {\r\n    $$(this.element).removeClass('coveo-tab-disabled');\r\n    this.update();\r\n    super.enable();\r\n  }\r\n\r\n  public disable() {\r\n    $$(this.element).addClass('coveo-tab-disabled');\r\n    super.disable();\r\n  }\r\n\r\n  /**\r\n   * Gets the current [`sortCriteria`]{@link Sort.options.sortCriteria} of this `Sort` component.\r\n   * @returns {SortCriteria}\r\n   */\r\n  public getCurrentCriteria(): SortCriteria {\r\n    return this.currentCriteria;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the name of any of the available [`sortCriteria`]{@link Sort.options.sortCriteria} of this `Sort` component matches the argument.\r\n   * @param sortId The sort criteria name to look for (e.g., `date descending`).\r\n   */\r\n  public match(sortId: string) {\r\n    return any(this.options.sortCriteria, (sortCriteria: SortCriteria) => sortId == sortCriteria.toString());\r\n  }\r\n\r\n  private findOrCreateRadioGroup() {\r\n    this.radioGroup = this.findRadioGroup();\r\n    if (!this.radioGroup) {\r\n      this.element.setAttribute('role', 'radiogroup');\r\n      this.radioGroup = this.element;\r\n    }\r\n  }\r\n\r\n  private createSortButton(innerText?: string) {\r\n    this.sortButton = $$('span').el;\r\n    this.sortButton.innerText = this.options.caption || innerText;\r\n    new AccessibleButton()\r\n      .withElement(this.sortButton)\r\n      .withEnterKeyboardAction(() => this.selectAndExecuteQuery())\r\n      .withArrowsAction((direction, e) => this.onArrowPressed(direction, e))\r\n      .withLabel(this.isToggle() ? this.getDirectionalLabel(this.initialDirection as VALID_DIRECTION) : this.getOmnidirectionalLabel())\r\n      .withRole('radio')\r\n      .build();\r\n    this.element.appendChild(this.sortButton);\r\n  }\r\n\r\n  private createDirectionButton() {\r\n    this.directionButton = $$('span', { className: 'coveo-icon' }, ...this.createIcons()).el;\r\n    new AccessibleButton()\r\n      .withElement(this.directionButton)\r\n      .withSelectAction(e => {\r\n        e.stopPropagation();\r\n        this.selectNextCriteriaAndExecuteQuery();\r\n      })\r\n      .withArrowsAction((direction, e) => this.onArrowPressed(direction, e))\r\n      .withLabel(\r\n        this.getDirectionalLabel(\r\n          this.initialDirection === VALID_DIRECTION.DESCENDING ? VALID_DIRECTION.ASCENDING : VALID_DIRECTION.DESCENDING\r\n        )\r\n      )\r\n      .withRole('radio')\r\n      .build();\r\n    this.element.appendChild(this.directionButton);\r\n  }\r\n\r\n  private onArrowPressed(direction: ArrowDirection, e: Event) {\r\n    this.selectNextRadioButton(direction === ArrowDirection.RIGHT || direction === ArrowDirection.DOWN ? 1 : -1);\r\n    e.stopPropagation();\r\n  }\r\n\r\n  private createIcons() {\r\n    const iconAscending = $$('span', { className: 'coveo-sort-icon-ascending' }, SVGIcons.icons.arrowUp);\r\n    SVGDom.addClassToSVGInContainer(iconAscending.el, 'coveo-sort-icon-ascending-svg');\r\n    const iconDescending = $$('span', { className: 'coveo-sort-icon-descending' }, SVGIcons.icons.arrowDown);\r\n    SVGDom.addClassToSVGInContainer(iconDescending.el, 'coveo-sort-icon-descending-svg');\r\n    return [iconAscending, iconDescending];\r\n  }\r\n\r\n  private findRadioGroup(element = this.element) {\r\n    if (!element || element === document.body) {\r\n      return null;\r\n    }\r\n    if (element.getAttribute('role') === 'radiogroup') {\r\n      return element;\r\n    }\r\n    return this.findRadioGroup(element.parentElement);\r\n  }\r\n\r\n  private selectNextRadioButton(direction = 1) {\r\n    const radioButtons = $$(this.radioGroup).findAll('[role=\"radio\"]');\r\n    const currentIndex = findIndex(radioButtons, radio => radio.getAttribute('aria-checked') === 'true');\r\n    let indexToSelect: number;\r\n    const isAnythingSelected = currentIndex !== -1;\r\n    if (isAnythingSelected) {\r\n      indexToSelect = (currentIndex + direction + radioButtons.length) % radioButtons.length;\r\n    } else {\r\n      if (direction >= 0) {\r\n        indexToSelect = 0;\r\n      } else {\r\n        indexToSelect = radioButtons.length - 1;\r\n      }\r\n    }\r\n    const radioToSelect = radioButtons[indexToSelect];\r\n    radioToSelect.focus();\r\n    radioToSelect.click();\r\n  }\r\n\r\n  private executeSearchQuery() {\r\n    this.queryController.deferExecuteQuery({\r\n      beforeExecuteQuery: () => logSortEvent(this.usageAnalytics, this.currentCriteria.sort + this.currentCriteria.direction)\r\n    });\r\n  }\r\n\r\n  private selectFirstCriteria() {\r\n    this.currentCriteria = this.options.sortCriteria[0];\r\n    this.updateQueryStateModel();\r\n  }\r\n\r\n  private selectNextCriteria() {\r\n    const indexOfCurrentCriteria = this.currentCriteria ? this.options.sortCriteria.indexOf(this.currentCriteria) : 0;\r\n    this.currentCriteria = this.options.sortCriteria[(indexOfCurrentCriteria + 1) % this.options.sortCriteria.length];\r\n    this.updateQueryStateModel();\r\n  }\r\n\r\n  private selectNextCriteriaAndExecuteQuery() {\r\n    const oldCriteria = this.currentCriteria;\r\n    this.selectNextCriteria();\r\n    if (oldCriteria != this.currentCriteria) {\r\n      this.executeSearchQuery();\r\n    }\r\n  }\r\n\r\n  private handleQueryStateChanged() {\r\n    this.update();\r\n  }\r\n\r\n  private update() {\r\n    // Basically, if the criteria in the model fits with one of ours, it'll become our active criteria\r\n    var sortCriteria = <string>this.queryStateModel.get(QueryStateModel.attributesEnum.sort);\r\n    if (Utils.isNonEmptyString(sortCriteria)) {\r\n      var criteriaFromModel = SortCriteria.parse(sortCriteria);\r\n      this.currentCriteria = find(this.options.sortCriteria, (criteria: SortCriteria) => criteriaFromModel.equals(criteria));\r\n    } else {\r\n      this.currentCriteria = null;\r\n    }\r\n    this.updateAppearance();\r\n    this.updateAccessibilityProperties();\r\n  }\r\n\r\n  private get captionIsDefined() {\r\n    return Utils.isNonEmptyString(this.options.caption);\r\n  }\r\n\r\n  private get currentDirection() {\r\n    return this.currentCriteria ? this.currentCriteria.direction : this.initialDirection;\r\n  }\r\n\r\n  private get initialDirection() {\r\n    return this.options.sortCriteria[0].direction;\r\n  }\r\n\r\n  private get displayedSortText() {\r\n    return this.captionIsDefined ? this.options.caption : this.element.textContent;\r\n  }\r\n\r\n  private handleBuildingQuery(data: IBuildingQueryEventArgs) {\r\n    Assert.exists(data);\r\n\r\n    var sort = this.queryStateModel.get(QueryStateModel.attributesEnum.sort);\r\n    if (sort == QueryStateModel.defaultAttributes.sort || this.isSelected()) {\r\n      if (this.currentCriteria) {\r\n        this.currentCriteria.putInQueryBuilder(data.queryBuilder);\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\r\n    if (data.results.results.length == 0) {\r\n      $$(this.element).addClass('coveo-sort-hidden');\r\n    } else {\r\n      $$(this.element).removeClass('coveo-sort-hidden');\r\n    }\r\n  }\r\n\r\n  private handleQueryError(data: IQueryErrorEventArgs) {\r\n    $$(this.element).addClass('coveo-sort-hidden');\r\n  }\r\n\r\n  private isToggle(): boolean {\r\n    return this.options.sortCriteria.length > 1;\r\n  }\r\n\r\n  private isSelected(): boolean {\r\n    return Utils.exists(this.currentCriteria);\r\n  }\r\n\r\n  private updateAppearance() {\r\n    $$(this.element).toggleClass('coveo-selected', this.isSelected());\r\n    if (this.isToggle()) {\r\n      $$(this.element).removeClass('coveo-ascending');\r\n      $$(this.element).removeClass('coveo-descending');\r\n      if (this.isSelected()) {\r\n        $$(this.element).addClass(this.currentDirection === 'ascending' ? 'coveo-ascending' : 'coveo-descending');\r\n      }\r\n    }\r\n  }\r\n\r\n  private updateAccessibilityProperties() {\r\n    this.sortButton.setAttribute('aria-controls', this.resultListsIds);\r\n    const directionIsInitial = this.currentDirection === this.initialDirection;\r\n    this.sortButton.setAttribute('aria-checked', `${this.isSelected() && directionIsInitial}`);\r\n    if (this.isToggle()) {\r\n      this.directionButton.setAttribute('aria-controls', this.resultListsIds);\r\n      this.directionButton.setAttribute('aria-checked', `${this.isSelected() && !directionIsInitial}`);\r\n    }\r\n  }\r\n\r\n  private get resultListsIds() {\r\n    const resultLists = this.searchInterface.getComponents('ResultList') as Component[];\r\n    return resultLists.map(resultList => resultList.element.id).join(' ');\r\n  }\r\n\r\n  private getDirectionalLabel(direction: VALID_DIRECTION) {\r\n    const localizedCaption = l(this.displayedSortText);\r\n    return direction === VALID_DIRECTION.DESCENDING\r\n      ? l('SortResultsByDescending', localizedCaption)\r\n      : l('SortResultsByAscending', localizedCaption);\r\n  }\r\n\r\n  private getOmnidirectionalLabel(): string {\r\n    const localizedCaption = l(this.displayedSortText);\r\n    return l('SortResultsBy', localizedCaption);\r\n  }\r\n\r\n  private updateQueryStateModel() {\r\n    this.queryStateModel.set(QueryStateModel.attributesEnum.sort, this.currentCriteria.toString());\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(Sort);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Sort/Sort.ts","import { chain, contains, first, values } from 'underscore';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { QueryBuilder } from '../../ui/Base/QueryBuilder';\r\n\r\nexport enum VALID_SORT {\r\n  RELEVANCY = 'relevancy',\r\n  DATE = 'date',\r\n  QRE = 'qre'\r\n}\r\n\r\nexport enum VALID_DIRECTION {\r\n  ASCENDING = 'ascending',\r\n  DESCENDING = 'descending'\r\n}\r\n\r\nexport class SortCriterion {\r\n  private static sortsNeedingDirection = [VALID_SORT.DATE];\r\n\r\n  /**\r\n   * Create a new SortCriteria\r\n   * @param sort The sort criteria (e.g.: relevancy, date)\r\n   * @param direction The direction by which to sort (e.g.: ascending, descending)\r\n   */\r\n  constructor(public sort: VALID_SORT, public direction: VALID_DIRECTION | '' = '') {\r\n    if (!SortCriterion.sortIsField(sort)) {\r\n      Assert.check(\r\n        this.isValidSort(sort),\r\n        `${sort} is not a valid sort criteria. Valid values are ${values(VALID_SORT)} or a valid index sortable index field.`\r\n      );\r\n    }\r\n    if (SortCriterion.sortNeedsDirection(sort)) {\r\n      Assert.check(\r\n        this.isValidDirection(direction),\r\n        `${direction} is not a valid sort criteria direction. Valid values are ${values(VALID_DIRECTION)}`\r\n      );\r\n    } else {\r\n      Assert.check(direction == '');\r\n    }\r\n  }\r\n\r\n  private isValidDirection(direction: string): direction is VALID_DIRECTION {\r\n    return chain(VALID_DIRECTION)\r\n      .values()\r\n      .contains(direction as any)\r\n      .value();\r\n  }\r\n\r\n  private isValidSort(sort: string): sort is VALID_SORT {\r\n    return chain(VALID_SORT)\r\n      .values()\r\n      .contains(sort as any)\r\n      .value();\r\n  }\r\n\r\n  private static sortIsField(criteria: string) {\r\n    return criteria.charAt(0) == '@';\r\n  }\r\n\r\n  private static sortNeedsDirection(sort: string) {\r\n    return contains(SortCriterion.sortsNeedingDirection, sort) || SortCriterion.sortIsField(sort);\r\n  }\r\n}\r\n\r\nexport class SortCriteria {\r\n  private criteria: SortCriterion[] = [];\r\n\r\n  constructor(rawCriteriaString: string) {\r\n    const criteria = rawCriteriaString.split(';');\r\n    criteria.forEach(criterion => {\r\n      const split = criterion.match(/\\S+/g);\r\n      this.criteria.push(new SortCriterion(split[0] as VALID_SORT, split[1] as VALID_DIRECTION));\r\n    });\r\n  }\r\n\r\n  public get direction() {\r\n    return first(this.criteria).direction;\r\n  }\r\n\r\n  public get sort() {\r\n    return first(this.criteria).sort;\r\n  }\r\n\r\n  /**\r\n   * Return a new SortCriteria from a string\r\n   * @param criteria The string from which to create the SortCriteria\r\n   */\r\n  static parse(criteria: string): SortCriteria {\r\n    return new SortCriteria(criteria);\r\n  }\r\n\r\n  /**\r\n   * Put the sort criteria in the passed queryBuilder\r\n   * @param queryBuilder The queryBuilder in which to put the sort criteria.\r\n   */\r\n  public putInQueryBuilder(queryBuilder: QueryBuilder) {\r\n    Assert.exists(queryBuilder);\r\n    queryBuilder.sortCriteria = this.toString()\r\n      .split(';')\r\n      .join(',');\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the sort criteria (e.g.: 'date ascending').\r\n   */\r\n  public toString(): string {\r\n    return this.criteria\r\n      .map(criterion => {\r\n        return criterion.direction ? `${criterion.sort} ${criterion.direction}` : `${criterion.sort}`;\r\n      })\r\n      .join(';');\r\n  }\r\n\r\n  /**\r\n   * Checks if the SortCriteria is equal to another.\r\n   * @param criteria The SortCriteria to compare with\r\n   */\r\n  public equals(criteria: SortCriteria): boolean {\r\n    return criteria.toString() == this.toString();\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Sort/SortCriteria.ts"],"sourceRoot":""}
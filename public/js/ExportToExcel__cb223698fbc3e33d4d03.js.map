{"version":3,"sources":["./src/ui/ExportToExcel/ExportToExcel.ts","./sass/_ExportToExcel.scss"],"names":[],"mappings":"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","file":"ExportToExcel__cb223698fbc3e33d4d03.js","sourcesContent":["import { Component } from '../Base/Component';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { IFieldOption } from '../Base/IComponentOptions';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { SettingsEvents } from '../../events/SettingsEvents';\r\nimport { ISettingsPopulateMenuArgs } from '../Settings/Settings';\r\nimport { IAnalyticsNoMeta, analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\r\nimport { Initialization } from '../Base/Initialization';\r\nimport { l } from '../../strings/Strings';\r\nimport * as _ from 'underscore';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport 'styling/_ExportToExcel';\r\nimport { SVGIcons } from '../../utils/SVGIcons';\r\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\r\nimport { get } from '../Base/RegisteredNamedMethods';\r\nimport * as moment from 'moment';\r\nimport { IQuery } from '../../rest/Query';\r\n\r\nlet createAnchor = () => document.createElement('a');\r\n\r\nexport function setCreateAnchor(fn: () => HTMLAnchorElement) {\r\n  createAnchor = fn;\r\n}\r\n\r\nexport interface IExportToExcelOptions {\r\n  numberOfResults?: number;\r\n  fieldsToInclude?: IFieldOption[];\r\n}\r\n\r\n/**\r\n * The ExportToExcel component renders an item in the {@link Settings} menu to allow the end user to export the current\r\n * search results to the Microsoft Excel format (.xlsx).\r\n *\r\n * @availablesince [November 2015 Release (v1.0.139)](https://docs.coveo.com/en/289/#november-2015-release-v10139)\r\n */\r\nexport class ExportToExcel extends Component {\r\n  static ID = 'ExportToExcel';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      ExportToExcel: ExportToExcel\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the ExportToExcel\r\n   * @componentOptions\r\n   */\r\n  static options: IExportToExcelOptions = {\r\n    /**\r\n     * Specifies the number of results to include in the resulting Excel file.\r\n     *\r\n     * Generating and downloading the Excel file should take a reasonably short amount of time when using the default\r\n     * value. However, this amount of time will increase exponentially as you set the value higher.\r\n     *\r\n     * Consequently, you should avoid setting this value above the default index limit of 1000 search results.\r\n     *\r\n     * Default value is `100`. Minimum value is `1`.\r\n     *\r\n     * @availablesince [February 2016 Release (v1.0.318)](https://docs.coveo.com/en/309/#february-2016-release-v10318)\r\n     */\r\n    numberOfResults: ComponentOptions.buildNumberOption({ defaultValue: 100, min: 1 }),\r\n    /**\r\n     * Specifies the fields to include in the CSV output.\r\n     *\r\n     * Note that this does not affect top level properties such as the title, clickUri, printableUri and sysUri, for example.\r\n     *\r\n     * Default value is `undefined`, meaning all fields will be exported.\r\n     */\r\n    fieldsToInclude: ComponentOptions.buildFieldsOption()\r\n  };\r\n\r\n  /**\r\n   * Creates a new ExportToExcel component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the ExportToExcel component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   * @param _window The global Window object (used to download the Excel link).\r\n   */\r\n  constructor(\r\n    public element: HTMLElement,\r\n    public options: IExportToExcelOptions,\r\n    public bindings?: IComponentBindings,\r\n    public _window?: Window\r\n  ) {\r\n    super(element, ExportToExcel.ID, bindings);\r\n    this._window = this._window || window;\r\n    this.options = ComponentOptions.initComponentOptions(element, ExportToExcel, options);\r\n    this.bind.onRootElement(SettingsEvents.settingsPopulateMenu, (args: ISettingsPopulateMenuArgs) => {\r\n      args.menuData.push({\r\n        text: l('ExportToExcel'),\r\n        className: 'coveo-export-to-excel',\r\n        tooltip: l('ExportToExcelDescription'),\r\n        onOpen: () => this.download(),\r\n        svgIcon: SVGIcons.icons.dropdownExport,\r\n        svgIconClassName: 'coveo-export-to-excel-svg'\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Downloads the Excel representation of the current query.\r\n   *\r\n   * Also logs an `exportToExcel` event in the usage analytics.\r\n   */\r\n  public download() {\r\n    const query = this.buildExcelQuery();\r\n    this.logger.debug(\"Performing query following 'Export to Excel' click\");\r\n\r\n    const endpoint = this.queryController.getEndpoint();\r\n    this.usageAnalytics.logCustomEvent<IAnalyticsNoMeta>(analyticsActionCauseList.exportToExcel, {}, this.element);\r\n\r\n    endpoint.fetchBinary(query).then(content => this.downloadExcelFile(content));\r\n  }\r\n\r\n  private buildExcelQuery(): IQuery {\r\n    let query = this.queryController.getLastQuery();\r\n    query = _.omit(query, ['numberOfResults', 'fieldsToInclude']);\r\n\r\n    if (this.options.fieldsToInclude) {\r\n      query.fieldsToInclude = <string[]>this.options.fieldsToInclude;\r\n    }\r\n\r\n    return {\r\n      ...query,\r\n      format: 'xlsx',\r\n      numberOfResults: this.options.numberOfResults\r\n    };\r\n  }\r\n\r\n  private downloadExcelFile(content: ArrayBuffer) {\r\n    const blob = new Blob([content], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const a = createAnchor();\r\n    a.href = url;\r\n    a.download = this.buildExcelFileName();\r\n    a.click();\r\n\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  private buildExcelFileName() {\r\n    const utc = moment().utc();\r\n    const year = utc.format('YYYY');\r\n    const month = utc.format('MM');\r\n    const day = utc.format('DD');\r\n    const hour = utc.format('HH');\r\n    const minute = utc.format('mm');\r\n    const second = utc.format('ss');\r\n\r\n    return `query--${year}-${month}-${day}--${hour}-${minute}-${second}.xlsx`;\r\n  }\r\n\r\n  static create(element: HTMLElement, options?: IExportToExcelOptions, root?: HTMLElement): ExportToExcel {\r\n    return new ExportToExcel(element, options, (<SearchInterface>get(root, SearchInterface)).getBindings());\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(ExportToExcel);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ExportToExcel/ExportToExcel.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_ExportToExcel.scss\n// module id = 607\n// module chunks = 70 88"],"sourceRoot":""}
{"version":3,"sources":["./src/rest/Subscription.ts","./src/ui/FollowItem/FollowItem.ts"],"names":[],"mappings":"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","file":"FollowItem__93518d21988b4536d33d.js","sourcesContent":["import { IQuery } from './Query';\r\n\r\nexport const SUBSCRIPTION_TYPE = {\r\n  followQuery: 'followQuery',\r\n  followDocument: 'followDocument'\r\n};\r\n\r\nexport interface ISearchAlertsEndpointOptions {\r\n  restUri: string;\r\n  accessToken?: string;\r\n  errorsAsSuccess?: boolean;\r\n}\r\n\r\nexport interface ISearchAlertsEndpointCallOptions {\r\n  type?: string;\r\n  page?: number;\r\n}\r\n\r\nexport interface ISearchAlertsEndpointSearchCallOptions {\r\n  documentIds: string[];\r\n}\r\n\r\n/**\r\n * Describe a subscription to the Coveo Search alerts service\r\n */\r\nexport interface ISubscription extends ISubscriptionRequest {\r\n  /**\r\n   * The id of the subscription\r\n   */\r\n  id: string;\r\n\r\n  /**\r\n   * The user associated with the subscription\r\n   */\r\n  user: ISubscriptionUser;\r\n}\r\n\r\n/**\r\n * Describe a user associated with a subscription to the Coveo Search alerts service\r\n */\r\nexport interface ISubscriptionUser {\r\n  /**\r\n   * The email of the user\r\n   */\r\n  email: string;\r\n\r\n  /**\r\n   * The token used to manage the alerts via email.\r\n   */\r\n  manageToken: string;\r\n}\r\n\r\n/**\r\n * Describe a request to subscribe to the Coveo Search alerts service\r\n */\r\nexport interface ISubscriptionRequest {\r\n  /**\r\n   * Type of subscription.<br/>\r\n   * Can be 'followQuery' or 'followDocument'\r\n   */\r\n  type: string;\r\n  /**\r\n   * Config of the subscription\r\n   */\r\n  typeConfig: ISubscriptionQueryRequest | ISubscriptionItemRequest;\r\n  /**\r\n   * Frequency of the alerts\r\n   */\r\n  frequency?: string;\r\n  /**\r\n   * The name that should be used by the API to identify this subscription\r\n   */\r\n  name: string;\r\n}\r\n\r\n/**\r\n * Describe a subscription to a single query\r\n */\r\nexport interface ISubscriptionQueryRequest {\r\n  /**\r\n   * Query to subscribe to\r\n   */\r\n  query: IQuery;\r\n  /**\r\n   * Which field on the result set represent the modification date for which you wish to receive alerts\r\n   */\r\n  modifiedDateField?: string;\r\n}\r\n\r\n/**\r\n * The `ISubscriptionItemRequest` interface describes a subscription to a single item (a result).\r\n */\r\nexport interface ISubscriptionItemRequest {\r\n  /**\r\n   * Contains the unique ID of the item to subscribe to.\r\n   */\r\n  id: string;\r\n\r\n  /**\r\n   * Contains the title of the item to subscribe to.\r\n   */\r\n  title: string;\r\n\r\n  /**\r\n   * Indicates which field contains the modification date of the item to subscribe to.\r\n   */\r\n  modifiedDateField?: string;\r\n\r\n  /**\r\n   * Contains a list of fields to monitor for the item to subscribe to.\r\n   */\r\n  watchedFields?: string[];\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/rest/Subscription.ts","import * as _ from 'underscore';\r\nimport { ISearchAlertsEventArgs, ISearchAlertsFailEventArgs, SearchAlertsEvents } from '../../events/SearchAlertEvents';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { ISubscription, ISubscriptionItemRequest, ISubscriptionRequest, SUBSCRIPTION_TYPE } from '../../rest/Subscription';\r\nimport { l } from '../../strings/Strings';\r\nimport { $$, Dom } from '../../utils/Dom';\r\nimport { KEYBOARD, KeyboardUtils } from '../../utils/KeyboardUtils';\r\nimport { QueryUtils } from '../../utils/QueryUtils';\r\nimport { SVGDom } from '../../utils/SVGDom';\r\nimport { SVGIcons } from '../../utils/SVGIcons';\r\nimport { Utils } from '../../utils/Utils';\r\nimport {\r\n  analyticsActionCauseList,\r\n  IAnalyticsActionCause,\r\n  IAnalyticsSearchAlertsFollowDocumentMeta\r\n} from '../Analytics/AnalyticsActionListMeta';\r\nimport { Component } from '../Base/Component';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { IFieldOption } from '../Base/IComponentOptions';\r\nimport { Initialization } from '../Base/Initialization';\r\nimport { IResultsComponentBindings } from '../Base/ResultsComponentBindings';\r\n\r\nexport interface IFollowItemOptions {\r\n  watchedFields?: IFieldOption[];\r\n  modifiedDateField?: string;\r\n}\r\n\r\n/**\r\n * The FollowItem component renders a widget that the end user can click to follow a particular item. A user following\r\n * an item receives email notifications when the item changes.\r\n *\r\n * **Note:**\r\n * > A {@link SearchAlerts} component must be present in the page for this component to work. It is also necessary to\r\n * > meet certain requirements to be able to use this component (see\r\n * > [Deploying Search Alerts on a Coveo JS Search Page](https://docs.coveo.com/en/1932/)).\r\n *\r\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\r\n */\r\nexport class FollowItem extends Component {\r\n  static ID = 'FollowItem';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      FollowItem: FollowItem\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the follow item component\r\n   * @componentOptions\r\n   */\r\n  static options: IFollowItemOptions = {\r\n    /**\r\n     * Specifies the {@link ISubscriptionItemRequest.watchedFields} to use when sending the\r\n     * {@link ISubscriptionItemRequest}.\r\n     *\r\n     * Default value is `undefined`.\r\n     */\r\n    watchedFields: ComponentOptions.buildFieldsOption(),\r\n\r\n    /**\r\n     * Specifies the {@link ISubscriptionItemRequest.modifiedDateField} to use when sending the\r\n     * {@link ISubscriptionItemRequest}.\r\n     *\r\n     * Default value is `undefined`.\r\n     */\r\n    modifiedDateField: ComponentOptions.buildStringOption()\r\n  };\r\n\r\n  private container: Dom;\r\n  private text: Dom;\r\n  private subscription: ISubscription;\r\n\r\n  /**\r\n   * Creates a new FollowItem component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the FollowItem component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time)\r\n   * @param result The result to associate the component with.\r\n   */\r\n  constructor(\r\n    public element: HTMLElement,\r\n    public options?: IFollowItemOptions,\r\n    public bindings?: IResultsComponentBindings,\r\n    public result?: IQueryResult\r\n  ) {\r\n    super(element, FollowItem.ID, bindings);\r\n\r\n    this.options = ComponentOptions.initComponentOptions(element, FollowItem, options);\r\n\r\n    Assert.exists(this.result);\r\n\r\n    this.container = $$(this.element);\r\n    this.text = $$('span');\r\n    const icon = this.buildIcon();\r\n    const loadingIcon = this.buildLoadingIcon();\r\n    this.container.append(icon);\r\n    this.container.append(loadingIcon);\r\n    this.container.append(this.text.el);\r\n    this.container.on('click', () => this.toggleFollow());\r\n    this.container.setAttribute('tabindex', '0');\r\n    this.bind.on(this.container, 'keyup', KeyboardUtils.keypressAction(KEYBOARD.ENTER, () => this.toggleFollow()));\r\n\r\n    this.bind.onRootElement(SearchAlertsEvents.searchAlertsDeleted, (args: ISearchAlertsEventArgs) => this.handleSubscriptionDeleted(args));\r\n    this.bind.onRootElement(SearchAlertsEvents.searchAlertsCreated, (args: ISearchAlertsEventArgs) => this.handleSubscriptionCreated(args));\r\n\r\n    this.container.addClass('coveo-follow-item-loading');\r\n\r\n    this.updateIsFollowed();\r\n  }\r\n\r\n  public setFollowed(subscription: ISubscription) {\r\n    this.container.removeClass('coveo-follow-item-loading');\r\n    this.subscription = subscription;\r\n    this.container.addClass('coveo-follow-item-followed');\r\n    this.text.text(l('SearchAlerts_unFollowing'));\r\n  }\r\n\r\n  public setNotFollowed() {\r\n    this.container.removeClass('coveo-follow-item-loading');\r\n    this.subscription = <ISubscription>FollowItem.buildFollowRequest(this.getId(), this.result.title, this.options);\r\n    this.container.removeClass('coveo-follow-item-followed');\r\n    this.text.text(l('SearchAlerts_follow'));\r\n  }\r\n\r\n  /**\r\n   * Follows the item if not already following it. Stops following the item otherwise.\r\n   *\r\n   * Also logs the appropriate event in the usage analytics (either `searchAlertsFollowDocument` or\r\n   * `searchAlertsUnfollowDocument`).\r\n   */\r\n  public toggleFollow() {\r\n    if (!this.container.hasClass('coveo-follow-item-loading')) {\r\n      this.container.removeClass('coveo-follow-item-followed');\r\n      this.container.addClass('coveo-follow-item-loading');\r\n      if (this.subscription.id) {\r\n        this.logAnalyticsEvent(analyticsActionCauseList.searchAlertsUnfollowDocument);\r\n        this.queryController\r\n          .getEndpoint()\r\n          .deleteSubscription(this.subscription)\r\n          .then(() => {\r\n            const eventArgs: ISearchAlertsEventArgs = {\r\n              subscription: this.subscription,\r\n              dom: this.element\r\n            };\r\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsDeleted, eventArgs);\r\n          })\r\n          .catch(() => {\r\n            this.container.removeClass('coveo-follow-item-loading');\r\n            const eventArgs: ISearchAlertsFailEventArgs = {\r\n              dom: this.element\r\n            };\r\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsFail, eventArgs);\r\n          });\r\n      } else {\r\n        this.logAnalyticsEvent(analyticsActionCauseList.searchAlertsFollowDocument);\r\n        this.queryController\r\n          .getEndpoint()\r\n          .follow(this.subscription)\r\n          .then((subscription: ISubscription) => {\r\n            const eventArgs: ISearchAlertsEventArgs = {\r\n              subscription: subscription,\r\n              dom: this.element\r\n            };\r\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsCreated, eventArgs);\r\n          })\r\n          .catch(() => {\r\n            this.container.removeClass('coveo-follow-item-loading');\r\n            const eventArgs: ISearchAlertsFailEventArgs = {\r\n              dom: this.element\r\n            };\r\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsFail, eventArgs);\r\n          });\r\n      }\r\n    }\r\n  }\r\n\r\n  protected getText(): string {\r\n    return this.text.text();\r\n  }\r\n\r\n  private updateIsFollowed() {\r\n    this.queryController\r\n      .getEndpoint()\r\n      .listSubscriptions()\r\n      .then((subscriptions: ISubscription[]) => {\r\n        if (_.isArray(subscriptions)) {\r\n          const subscription: ISubscription = _.find(subscriptions, (subscription: ISubscription) => {\r\n            const typeConfig = <ISubscriptionItemRequest>subscription.typeConfig;\r\n            return typeConfig && typeConfig.id != null && typeConfig.id == this.getId();\r\n          });\r\n          if (subscription != null) {\r\n            this.setFollowed(subscription);\r\n          } else {\r\n            this.setNotFollowed();\r\n          }\r\n        } else {\r\n          this.remove();\r\n        }\r\n      })\r\n      .catch(() => {\r\n        this.remove();\r\n      });\r\n  }\r\n  private buildIcon(): HTMLElement {\r\n    const icon = $$('span', { className: 'coveo-follow-item-icon' }, SVGIcons.icons.dropdownFollowQuery);\r\n    SVGDom.addClassToSVGInContainer(icon.el, 'coveo-follow-item-icon-svg');\r\n    return icon.el;\r\n  }\r\n\r\n  private buildLoadingIcon(): HTMLElement {\r\n    const loadingIcon = $$('span', { className: 'coveo-follow-item-icon-loading' }, SVGIcons.icons.loading);\r\n    SVGDom.addClassToSVGInContainer(loadingIcon.el, 'coveo-follow-item-icon-loading-svg');\r\n    return loadingIcon.el;\r\n  }\r\n\r\n  private handleSubscriptionDeleted(args: ISearchAlertsEventArgs) {\r\n    if (args.subscription && args.subscription.type == SUBSCRIPTION_TYPE.followDocument) {\r\n      const typeConfig = <ISubscriptionItemRequest>args.subscription.typeConfig;\r\n      if (typeConfig.id == this.getId()) {\r\n        this.setNotFollowed();\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleSubscriptionCreated(args: ISearchAlertsEventArgs) {\r\n    if (args.subscription && args.subscription.type == SUBSCRIPTION_TYPE.followDocument) {\r\n      const typeConfig = <ISubscriptionItemRequest>args.subscription.typeConfig;\r\n      if (typeConfig.id == this.getId()) {\r\n        this.setFollowed(args.subscription);\r\n      }\r\n    }\r\n  }\r\n\r\n  private remove() {\r\n    this.element.parentElement && this.element.parentElement.removeChild(this.element);\r\n  }\r\n\r\n  private getId() {\r\n    return Utils.getFieldValue(this.result, 'sysurihash') || Utils.getFieldValue(this.result, 'urihash');\r\n  }\r\n\r\n  private static buildFollowRequest(id: string, title: string, options: IFollowItemOptions): ISubscriptionRequest {\r\n    const typeCofig: ISubscriptionItemRequest = {\r\n      id: id,\r\n      title: title\r\n    };\r\n\r\n    if (options.modifiedDateField) {\r\n      typeCofig.modifiedDateField = options.modifiedDateField;\r\n    }\r\n\r\n    if (options.watchedFields) {\r\n      typeCofig.watchedFields = <string[]>options.watchedFields;\r\n    }\r\n\r\n    return {\r\n      type: SUBSCRIPTION_TYPE.followDocument,\r\n      typeConfig: typeCofig,\r\n      name: title\r\n    };\r\n  }\r\n\r\n  private logAnalyticsEvent(type: IAnalyticsActionCause) {\r\n    this.usageAnalytics.logCustomEvent<IAnalyticsSearchAlertsFollowDocumentMeta>(\r\n      type,\r\n      {\r\n        author: QueryUtils.getAuthor(this.result),\r\n        documentLanguage: QueryUtils.getLanguage(this.result),\r\n        documentSource: QueryUtils.getSource(this.result),\r\n        documentTitle: this.result.title,\r\n        contentIDValue: QueryUtils.getPermanentId(this.result).fieldValue,\r\n        contentIDKey: QueryUtils.getPermanentId(this.result).fieldUsed\r\n      },\r\n      this.element\r\n    );\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(FollowItem);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/FollowItem/FollowItem.ts"],"sourceRoot":""}
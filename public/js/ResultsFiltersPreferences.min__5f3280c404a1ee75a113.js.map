{"version":3,"sources":["ResultsFiltersPreferences.min__5f3280c404a1ee75a113.js","./src/ui/FormWidgets/FormGroup.ts","./src/ui/FormWidgets/MultiSelect.ts","./src/ui/ResultsFiltersPreferences/ResultsFiltersPreferences.ts"],"names":["webpackJsonpCoveo__temporary","136","module","exports","__webpack_require__","Object","defineProperty","value","contents","label","this","labelElement","$$","className","text","element","_","each","content","append","build","doExport","exportGlobally","FormGroup","el","190","onChange","options","multiSelect","buildContent","MultiSelect","getElement","getValue","chain","toArray","filter","opt","selected","map","getUnselectedValues","setValue","values","currentlySelected","currentStateSplit","partition","contains","newStateToApplySplit","toSelect","toUnSelect","hasChanged","Utils","arrayEqual","trigger","reset","selectedIndex","isEmptyArray","multiple","size","length","toString","optgroup","l","appendChild","on","272","__extends","extendStatics","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","bindings","ResultsFiltersPreferences","ID","preferencePanelCheckboxInput","ComponentOptions","initComponentOptions","preferencePanel","closest","Component","computeCssClassNameForType","preferencePanelLocalStorage","LocalStorageUtils","mergeLocalPreferencesWithStaticPreferences","bindPreferencePanelEvent","bindBreadcrumbEvent","bindQueryEvent","bind","oneRootElement","InitializationEvents","afterComponentsInitialization","createDom","oneQueryState","MODEL_EVENTS","CHANGE_ONE","QUERY_STATE_ATTRIBUTES","T","fromPreferencesToCheckboxInput","_this","logger","warn","container","buildCheckboxesInput","showAdvancedFilters","buildAdvancedFilters","save","fromCheckboxInputToPreferences","toSave","omit","preferences","info","exitWithoutSave","hideAdvancedFilterBuilder","PreferencesPanelEvents","savePreferences","exitPreferencesWithoutSave","includeInBreadcrumb","onRootElement","BreadcrumbEvents","populateBreadcrumb","args","handlePopulateBreadcrumb","clearBreadcrumb","handleClearBreadcrumb","QueryEvents","buildingQuery","handleBuildingQuery","getActiveFilters","isNonEmptyString","expression","queryBuilder","advancedExpression","add","actives","isNonEmptyArray","title","valuesContainer","i","buildBreadcrumb","breadcrumbs","push","isFullBreadcrumbClear","advancedFilters","buildAdvancedFilterInput","buildAdvancedFilterFormValidate","advancedFiltersBuilder","advancedFilterFormValidate","openAdvancedFilterSectionOrSaveFilters","onlineHelp","href","find","insertAfter","advancedFiltersTextInputCaption","TextInput","getInput","setAttribute","advancedFiltersTextInputExpression","advancedFiltersTabSelect","getAllTabs","formSubmit","type","saveFormButton","SVGIcons","icons","checkboxHookExclusionMore","SVGDom","addClassToSVGInContainer","closeFormButton","saveAndCloseContainer","inputCaption","addClass","filtersTabSelect","filtersExpression","click","e","validateAndSaveAdvancedFilter","tabRef","getComponentRef","tabsElement","root","findAll","computeCssClassName","tabElement","get","id","getPreferencesBoxInputToBuild","caption","tab","undefined","preferenceContainer","remove","toBuild","filterToBuild","checkbox","Checkbox","queryController","firstQuery","fromFilterToAnalyticsEvent","executeQuery","closeModalBox","choiceContainer","buildEditAdvancedFilter","buildDeleteAdvancedFilter","custom","deleteElement","getFilterElementByCaption","confirmDelete","editElement","edit","elem","clear","mainClear","onSelectAction","AccessibleButton","withElement","withLabel","withSelectAction","filterElement","confirm","isSelected","deleteFilterPreference","oldCaption","oldTab","oldExpression","populateEditSection","toPopulate","detach","hasClass","showAdvancedFilterBuilder","preventDefault","tabs","queryStateModel","set","QueryStateModel","attributesEnum","t","getActiveTab","select","getInactiveFilters","getDormantFilters","activeTab","filterIsInActiveTab","compact","parentElement","fromResultsFilterOptionToResultsPreferenceInterface","ret","filters","staticPreferences","localPreferences","load","localPreferencesWithoutRemoved","preference","isCustom","existsInStatic","staticPreference","localToMerge","extendDeep","usageAnalytics","logSearchEvent","analyticsActionCauseList","customfiltersChange","customFilterName","customFilterExpression","customFilterType","enlargeModalBox","modalBoxContainer","document","body","shrinkModalBox","removeClass","buildBooleanOption","defaultValue","buildJsonOption","Initialization","registerAutoCreateComponent","561","573","659"],"mappings":"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","file":"ResultsFiltersPreferences.min__5f3280c404a1ee75a113.js","sourcesContent":["webpackJsonpCoveo__temporary([24,54,55],{\n\n/***/ 136:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Dom_1 = __webpack_require__(1);\r\nvar _ = __webpack_require__(0);\r\n__webpack_require__(561);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\n/**\r\n * A simple `fieldset` HTMLElement containing multiple form widgets.\r\n */\r\nvar FormGroup = /** @class */ (function () {\r\n    /**\r\n     * Creates a new `FormGroup`.\r\n     * @param contents The form widgets to include in the form group.\r\n     * @param label The label to display for the form group.\r\n     */\r\n    function FormGroup(contents, label) {\r\n        var _this = this;\r\n        this.labelElement = Dom_1.$$('span', { className: 'coveo-form-group-label' });\r\n        this.labelElement.text(label);\r\n        this.element = Dom_1.$$('fieldset', { className: 'coveo-form-group' }, this.labelElement);\r\n        _.each(contents, function (content) {\r\n            _this.element.append(content.build());\r\n        });\r\n    }\r\n    FormGroup.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            FormGroup: FormGroup\r\n        });\r\n    };\r\n    /**\r\n     * Gets the element on which the form group is bound.\r\n     * @returns {HTMLElement} The form group element.\r\n     */\r\n    FormGroup.prototype.build = function () {\r\n        return this.element.el;\r\n    };\r\n    return FormGroup;\r\n}());\r\nexports.FormGroup = FormGroup;\r\n\n\n/***/ }),\n\n/***/ 190:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Dom_1 = __webpack_require__(1);\r\nvar _ = __webpack_require__(0);\r\nvar Strings_1 = __webpack_require__(6);\r\n__webpack_require__(573);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\n/**\r\n * A multi select widget with standard styling.\r\n */\r\nvar MultiSelect = /** @class */ (function () {\r\n    /**\r\n     * Creates a new `MultiSelect`.\r\n     * @param onChange The function to call when the widget selected values change. This function takes the current\r\n     * `MultiSelect` instance as an argument.\r\n     * @param options The values which can be selected with the multi select.\r\n     * @param label The label to display for the multi select.\r\n     */\r\n    function MultiSelect(onChange, options, label) {\r\n        if (onChange === void 0) { onChange = function (multiSelect) { }; }\r\n        this.onChange = onChange;\r\n        this.options = options;\r\n        this.label = label;\r\n        this.buildContent();\r\n    }\r\n    MultiSelect.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            MultiSelect: MultiSelect\r\n        });\r\n    };\r\n    /**\r\n     * Gets the element on which the multi select is bound.\r\n     * @returns {HTMLSelectElement} The multi select element.\r\n     */\r\n    MultiSelect.prototype.build = function () {\r\n        return this.element;\r\n    };\r\n    /**\r\n     * Gets the element on which the multi select is bound.\r\n     * @returns {HTMLSelectElement} The multi select element.\r\n     */\r\n    MultiSelect.prototype.getElement = function () {\r\n        return this.element;\r\n    };\r\n    /**\r\n     * Gets the currently selected values.\r\n     * @returns {string[]} The array of selected multi select values.\r\n     */\r\n    MultiSelect.prototype.getValue = function () {\r\n        return _.chain(this.element.options)\r\n            .toArray()\r\n            .filter(function (opt) { return opt.selected; })\r\n            .map(function (selected) { return selected.value; })\r\n            .value();\r\n    };\r\n    /**\r\n     * Gets the currently un-selected values.\r\n     * @returns {string[]} The array of un-selected multi select values.\r\n     */\r\n    MultiSelect.prototype.getUnselectedValues = function () {\r\n        return _.chain(this.element.options)\r\n            .toArray()\r\n            .filter(function (opt) { return !opt.selected; })\r\n            .map(function (selected) { return selected.value; })\r\n            .value();\r\n    };\r\n    /**\r\n     * Sets the currently selected values.\r\n     * @param values The values to select.\r\n     */\r\n    MultiSelect.prototype.setValue = function (values) {\r\n        var currentlySelected = this.getValue();\r\n        var currentStateSplit = _.partition(_.toArray(this.element.options), function (opt) {\r\n            return _.contains(currentlySelected, opt.value);\r\n        });\r\n        var newStateToApplySplit = _.partition(_.toArray(this.element.options), function (opt) { return _.contains(values, opt.value); });\r\n        _.each(newStateToApplySplit[0], function (toSelect) { return (toSelect.selected = true); });\r\n        _.each(newStateToApplySplit[1], function (toUnSelect) { return (toUnSelect.selected = false); });\r\n        var hasChanged = false;\r\n        if (!Utils_1.Utils.arrayEqual(currentStateSplit[0], newStateToApplySplit[0], false)) {\r\n            hasChanged = true;\r\n        }\r\n        if (!Utils_1.Utils.arrayEqual(currentStateSplit[1], newStateToApplySplit[1], false)) {\r\n            hasChanged = true;\r\n        }\r\n        if (hasChanged) {\r\n            Dom_1.$$(this.element).trigger('change');\r\n        }\r\n    };\r\n    /**\r\n     * Resets the multi select.\r\n     */\r\n    MultiSelect.prototype.reset = function () {\r\n        var currentlySelected = this.getValue();\r\n        this.element.selectedIndex = -1;\r\n        if (!Utils_1.Utils.isEmptyArray(currentlySelected)) {\r\n            Dom_1.$$(this.element).trigger('change');\r\n        }\r\n    };\r\n    MultiSelect.prototype.buildContent = function () {\r\n        var _this = this;\r\n        this.element = Dom_1.$$('select', {\r\n            className: 'coveo-multi-select',\r\n            multiple: '',\r\n            size: this.options.length.toString()\r\n        }).el;\r\n        var optgroup = Dom_1.$$('optgroup', {\r\n            className: 'coveo-list-group',\r\n            label: this.label\r\n        });\r\n        var options = _.map(this.options, function (opt) {\r\n            return Dom_1.$$('option', { value: opt, className: 'coveo-list-item' }, Strings_1.l(opt));\r\n        });\r\n        _.each(options, function (opt) { return optgroup.append(opt.el); });\r\n        this.element.appendChild(optgroup.el);\r\n        Dom_1.$$(this.element).on('change', function () { return _this.onChange(_this); });\r\n    };\r\n    return MultiSelect;\r\n}());\r\nexports.MultiSelect = MultiSelect;\r\n\n\n/***/ }),\n\n/***/ 272:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__webpack_require__(659);\r\nvar _ = __webpack_require__(0);\r\nvar BreadcrumbEvents_1 = __webpack_require__(34);\r\nvar InitializationEvents_1 = __webpack_require__(17);\r\nvar PreferencesPanelEvents_1 = __webpack_require__(96);\r\nvar QueryEvents_1 = __webpack_require__(11);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\nvar Model_1 = __webpack_require__(18);\r\nvar QueryStateModel_1 = __webpack_require__(13);\r\nvar Strings_1 = __webpack_require__(6);\r\nvar AccessibleButton_1 = __webpack_require__(15);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar LocalStorageUtils_1 = __webpack_require__(55);\r\nvar SVGDom_1 = __webpack_require__(16);\r\nvar SVGIcons_1 = __webpack_require__(12);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\r\nvar Component_1 = __webpack_require__(7);\r\nvar ComponentOptions_1 = __webpack_require__(8);\r\nvar Initialization_1 = __webpack_require__(2);\r\nvar Checkbox_1 = __webpack_require__(64);\r\nvar FormGroup_1 = __webpack_require__(136);\r\nvar MultiSelect_1 = __webpack_require__(190);\r\nvar TextInput_1 = __webpack_require__(54);\r\n/**\r\n * The `ResultFiltersPreferences` component allows end users to create custom filters to apply to queries. These filters\r\n * are saved to local storage.\r\n *\r\n * Only advanced end users who understand the Coveo query syntax should use this feature (see\r\n * [Coveo Query Syntax Reference](https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10005)).\r\n *\r\n * This component is normally accessible through the [`Settings`]{@link Settings} menu. Its usual location in the DOM is\r\n * inside the [`PreferencesPanel`]{@link PreferencesPanel} element.\r\n *\r\n * See also the {@link ResultsPreferences} component.\r\n */\r\nvar ResultsFiltersPreferences = /** @class */ (function (_super) {\r\n    __extends(ResultsFiltersPreferences, _super);\r\n    /**\r\n     * Creates a new `ResultsFiltersPreferences` component.\r\n     * @param element The HTMLElement on which to instantiate the component.\r\n     * @param options The options for the `ResultsFiltersPreferences` component.\r\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n     * automatically resolved (with a slower execution time).\r\n     */\r\n    function ResultsFiltersPreferences(element, options, bindings) {\r\n        var _this = _super.call(this, element, ResultsFiltersPreferences.ID, bindings) || this;\r\n        _this.element = element;\r\n        _this.options = options;\r\n        _this.bindings = bindings;\r\n        _this.preferencePanelCheckboxInput = {};\r\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, ResultsFiltersPreferences, options);\r\n        _this.preferencePanel = Dom_1.$$(_this.element).closest(Component_1.Component.computeCssClassNameForType('PreferencesPanel'));\r\n        if (!_this.preferencePanel) {\r\n            _this.logger.warn(\"Cannot instantiate ResultsFilterPreferences, as there is no \\\"CoveoPreferencesPanel\\\" in your page !\");\r\n            return _this;\r\n        }\r\n        _this.preferencePanelLocalStorage = new LocalStorageUtils_1.LocalStorageUtils(ResultsFiltersPreferences.ID);\r\n        _this.mergeLocalPreferencesWithStaticPreferences();\r\n        _this.bindPreferencePanelEvent();\r\n        _this.bindBreadcrumbEvent();\r\n        _this.bindQueryEvent();\r\n        // We need to wait after all components are initialized before building the dom, because this component interacts with Tab\r\n        // And we don't know if Tab(s) are initialized before or after this component.\r\n        _this.bind.oneRootElement(InitializationEvents_1.InitializationEvents.afterComponentsInitialization, function () { return _this.createDom(); });\r\n        _this.bind.oneQueryState(Model_1.MODEL_EVENTS.CHANGE_ONE, QueryStateModel_1.QUERY_STATE_ATTRIBUTES.T, function () { return _this.fromPreferencesToCheckboxInput(); });\r\n        return _this;\r\n    }\r\n    ResultsFiltersPreferences.prototype.createDom = function () {\r\n        this.container = new FormGroup_1.FormGroup([], Strings_1.l('ResultsFilteringExpression')).build();\r\n        this.element.appendChild(this.container);\r\n        this.buildCheckboxesInput();\r\n        if (this.options.showAdvancedFilters) {\r\n            this.buildAdvancedFilters();\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.save = function () {\r\n        this.fromCheckboxInputToPreferences();\r\n        var toSave = _.omit(this.preferences, 'tab');\r\n        this.logger.info('Saving preferences', toSave);\r\n        this.preferencePanelLocalStorage.save(toSave);\r\n    };\r\n    ResultsFiltersPreferences.prototype.exitWithoutSave = function () {\r\n        this.fromPreferencesToCheckboxInput();\r\n        this.hideAdvancedFilterBuilder();\r\n    };\r\n    ResultsFiltersPreferences.prototype.bindPreferencePanelEvent = function () {\r\n        var _this = this;\r\n        this.bind.on(this.preferencePanel, PreferencesPanelEvents_1.PreferencesPanelEvents.savePreferences, function () { return _this.save(); });\r\n        this.bind.on(this.preferencePanel, PreferencesPanelEvents_1.PreferencesPanelEvents.exitPreferencesWithoutSave, function () { return _this.exitWithoutSave(); });\r\n    };\r\n    ResultsFiltersPreferences.prototype.bindBreadcrumbEvent = function () {\r\n        var _this = this;\r\n        if (this.options.includeInBreadcrumb) {\r\n            this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.populateBreadcrumb, function (args) {\r\n                return _this.handlePopulateBreadcrumb(args);\r\n            });\r\n            this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.clearBreadcrumb, function () { return _this.handleClearBreadcrumb(); });\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.bindQueryEvent = function () {\r\n        var _this = this;\r\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) { return _this.handleBuildingQuery(args); });\r\n    };\r\n    ResultsFiltersPreferences.prototype.handleBuildingQuery = function (args) {\r\n        _.each(this.getActiveFilters(), function (filter) {\r\n            if (Utils_1.Utils.isNonEmptyString(filter.expression)) {\r\n                args.queryBuilder.advancedExpression.add(filter.expression);\r\n            }\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.handlePopulateBreadcrumb = function (args) {\r\n        var actives = this.getActiveFilters();\r\n        if (Utils_1.Utils.isNonEmptyArray(actives)) {\r\n            var container = Dom_1.$$('div', { className: 'coveo-results-filter-preferences-breadcrumb' });\r\n            var title = Dom_1.$$('span', { className: 'coveo-title' });\r\n            title.text(Strings_1.l('FiltersInYourPreferences') + ':');\r\n            container.el.appendChild(title.el);\r\n            var valuesContainer = Dom_1.$$('span', { className: 'coveo-values' });\r\n            container.el.appendChild(valuesContainer.el);\r\n            for (var i = 0; i < actives.length; i++) {\r\n                valuesContainer.el.appendChild(this.buildBreadcrumb(actives[i]));\r\n            }\r\n            args.breadcrumbs.push({ element: container.el });\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.handleClearBreadcrumb = function () {\r\n        this.isFullBreadcrumbClear = true;\r\n        _.each(this.getActiveFilters(), function (filter) {\r\n            filter.selected = false;\r\n        });\r\n        this.fromPreferencesToCheckboxInput();\r\n        this.isFullBreadcrumbClear = false;\r\n    };\r\n    ResultsFiltersPreferences.prototype.buildAdvancedFilters = function () {\r\n        var _this = this;\r\n        this.advancedFilters = Dom_1.$$('div', { className: 'coveo-advanced-filters' }, Strings_1.l('Create')).el;\r\n        this.buildAdvancedFilterInput();\r\n        this.buildAdvancedFilterFormValidate();\r\n        this.advancedFiltersBuilder = Dom_1.$$('div', { className: 'coveo-advanced-filters-builder' }).el;\r\n        this.advancedFiltersBuilder.appendChild(this.advancedFilterFormValidate);\r\n        Dom_1.$$(this.advancedFilters).on('click', function () { return _this.openAdvancedFilterSectionOrSaveFilters(); });\r\n        var onlineHelp = Dom_1.$$('a', {\r\n            href: 'https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10006',\r\n            className: 'coveo-online-help'\r\n        }, '?');\r\n        var title = Dom_1.$$(this.container).find('.coveo-form-group-label');\r\n        onlineHelp.insertAfter(title);\r\n        Dom_1.$$(this.advancedFilters).insertAfter(title);\r\n        this.container.appendChild(this.advancedFiltersBuilder);\r\n    };\r\n    ResultsFiltersPreferences.prototype.buildAdvancedFilterInput = function () {\r\n        this.advancedFiltersTextInputCaption = new TextInput_1.TextInput(function () { }, Strings_1.l('Caption'));\r\n        this.advancedFiltersTextInputCaption.getInput().setAttribute('required', '');\r\n        this.advancedFiltersTextInputExpression = new TextInput_1.TextInput(function () { }, Strings_1.l('Expression'));\r\n        this.advancedFiltersTextInputExpression.getInput().setAttribute('required', '');\r\n        this.advancedFiltersTabSelect = new MultiSelect_1.MultiSelect(function () { }, this.getAllTabs(), Strings_1.l('Tab'));\r\n    };\r\n    ResultsFiltersPreferences.prototype.buildAdvancedFilterFormValidate = function () {\r\n        var _this = this;\r\n        this.advancedFilterFormValidate = Dom_1.$$('form').el;\r\n        var formSubmit = Dom_1.$$('input', {\r\n            type: 'submit'\r\n        });\r\n        var saveFormButton = Dom_1.$$('span', {\r\n            className: 'coveo-save'\r\n        }, SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore);\r\n        SVGDom_1.SVGDom.addClassToSVGInContainer(saveFormButton.el, 'coveo-save-svg');\r\n        var closeFormButton = Dom_1.$$('span', {\r\n            className: 'coveo-close'\r\n        }, SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore);\r\n        SVGDom_1.SVGDom.addClassToSVGInContainer(closeFormButton.el, 'coveo-close-svg');\r\n        var saveAndCloseContainer = Dom_1.$$('div', {\r\n            className: 'coveo-choice-container coveo-close-and-save'\r\n        });\r\n        saveAndCloseContainer.el.appendChild(saveFormButton.el);\r\n        saveAndCloseContainer.el.appendChild(closeFormButton.el);\r\n        var inputCaption = this.advancedFiltersTextInputCaption.build();\r\n        Dom_1.$$(inputCaption).addClass('coveo-caption');\r\n        var filtersTabSelect = this.advancedFiltersTabSelect.build();\r\n        Dom_1.$$(filtersTabSelect).addClass('coveo-tab');\r\n        var filtersExpression = this.advancedFiltersTextInputExpression.build();\r\n        Dom_1.$$(filtersExpression).addClass('coveo-expression');\r\n        _.each([inputCaption, filtersExpression, filtersTabSelect, saveAndCloseContainer.el, formSubmit.el], function (el) {\r\n            _this.advancedFilterFormValidate.appendChild(el);\r\n        });\r\n        saveFormButton.on('click', function () {\r\n            formSubmit.el.click();\r\n        });\r\n        closeFormButton.on('click', function () {\r\n            _this.hideAdvancedFilterBuilder();\r\n        });\r\n        Dom_1.$$(this.advancedFilterFormValidate).on('submit', function (e) { return _this.validateAndSaveAdvancedFilter(e); });\r\n    };\r\n    ResultsFiltersPreferences.prototype.getAllTabs = function () {\r\n        var tabRef = Component_1.Component.getComponentRef('Tab');\r\n        if (tabRef) {\r\n            var tabsElement = Dom_1.$$(this.root).findAll('.' + Component_1.Component.computeCssClassName(tabRef));\r\n            return _.map(tabsElement, function (tabElement) {\r\n                var tab = Component_1.Component.get(tabElement);\r\n                return tab.options.id;\r\n            });\r\n        }\r\n        else {\r\n            return [];\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.getPreferencesBoxInputToBuild = function () {\r\n        return _.map(this.preferences, function (filter) {\r\n            return {\r\n                label: filter.caption,\r\n                tab: filter.tab,\r\n                expression: filter.expression\r\n            };\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.buildCheckboxesInput = function () {\r\n        var _this = this;\r\n        if (this.preferenceContainer != undefined) {\r\n            this.preferenceContainer.remove();\r\n        }\r\n        var toBuild = this.getPreferencesBoxInputToBuild();\r\n        if (Utils_1.Utils.isNonEmptyArray(toBuild)) {\r\n            this.preferenceContainer = Dom_1.$$('div', {\r\n                className: 'coveo-choices-container'\r\n            }).el;\r\n            _.each(toBuild, function (filterToBuild) {\r\n                var checkbox = new Checkbox_1.Checkbox(function (checkbox) {\r\n                    _this.save();\r\n                    var filter = _this.preferences[checkbox.getValue()];\r\n                    if (!_this.queryController.firstQuery && !_this.isFullBreadcrumbClear) {\r\n                        _this.fromFilterToAnalyticsEvent(filter, filter.selected ? 'selected' : 'unselected');\r\n                        _this.queryController.executeQuery({\r\n                            closeModalBox: false\r\n                        });\r\n                    }\r\n                }, filterToBuild.label);\r\n                Dom_1.$$(checkbox.build()).addClass('coveo-choice-container');\r\n                _this.preferencePanelCheckboxInput[filterToBuild.label] = checkbox;\r\n                _this.preferenceContainer.appendChild(checkbox.getElement());\r\n            });\r\n            _.each(Dom_1.$$(this.preferenceContainer).findAll('.coveo-choice-container'), function (choiceContainer) {\r\n                choiceContainer.appendChild(Dom_1.$$('div', { className: 'coveo-section coveo-section-edit-delete' }).el);\r\n            });\r\n            Dom_1.$$(this.container).append(this.preferenceContainer);\r\n            this.buildEditAdvancedFilter();\r\n            this.buildDeleteAdvancedFilter();\r\n            this.fromPreferencesToCheckboxInput();\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.buildDeleteAdvancedFilter = function () {\r\n        var _this = this;\r\n        _.each(this.preferences, function (filter) {\r\n            if (filter.custom) {\r\n                var deleteElement = Dom_1.$$('span', {\r\n                    className: 'coveo-delete'\r\n                }, SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore).el;\r\n                SVGDom_1.SVGDom.addClassToSVGInContainer(deleteElement, 'coveo-delete-svg');\r\n                var filterElement_1 = _this.getFilterElementByCaption(filter.caption);\r\n                var insertInto = Dom_1.$$(filterElement_1).find('.coveo-section-edit-delete');\r\n                insertInto.appendChild(deleteElement);\r\n                Dom_1.$$(deleteElement).on('click', function () { return _this.confirmDelete(filter, filterElement_1); });\r\n            }\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.buildEditAdvancedFilter = function () {\r\n        var _this = this;\r\n        _.each(this.preferences, function (filter) {\r\n            if (filter.custom) {\r\n                var editElement = Dom_1.$$('span', {\r\n                    className: 'coveo-edit'\r\n                }, SVGIcons_1.SVGIcons.icons.edit);\r\n                SVGDom_1.SVGDom.addClassToSVGInContainer(editElement.el, 'coveo-edit-svg');\r\n                var filterElement_2 = _this.getFilterElementByCaption(filter.caption);\r\n                var insertInto = Dom_1.$$(filterElement_2).find('.coveo-section-edit-delete');\r\n                insertInto.appendChild(editElement.el);\r\n                editElement.on('click', function () { return _this.editElement(filter, filterElement_2); });\r\n            }\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.buildBreadcrumb = function (filter) {\r\n        var _this = this;\r\n        var elem = Dom_1.$$('span', { className: 'coveo-value' });\r\n        var caption = Dom_1.$$('span', { className: 'coveo-caption' });\r\n        caption.text(filter.caption);\r\n        elem.el.appendChild(caption.el);\r\n        var clear = Dom_1.$$('span', { className: 'coveo-clear' }, SVGIcons_1.SVGIcons.icons.mainClear);\r\n        elem.el.appendChild(clear.el);\r\n        var onSelectAction = function () {\r\n            filter.selected = false;\r\n            _this.fromFilterToAnalyticsEvent(filter, 'cleared from breadcrumb');\r\n            _this.fromPreferencesToCheckboxInput();\r\n        };\r\n        new AccessibleButton_1.AccessibleButton()\r\n            .withElement(elem)\r\n            .withLabel(Strings_1.l('RemoveFilterOn', filter.caption))\r\n            .withSelectAction(onSelectAction)\r\n            .build();\r\n        return elem.el;\r\n    };\r\n    ResultsFiltersPreferences.prototype.confirmDelete = function (filter, filterElement) {\r\n        if (confirm(Strings_1.l('AreYouSureDeleteFilter', filter.caption, filter.expression))) {\r\n            var isSelected = filter.selected;\r\n            this.deleteFilterPreference(filter, filterElement);\r\n            if (isSelected) {\r\n                this.fromFilterToAnalyticsEvent(filter, 'deleted');\r\n                this.queryController.executeQuery({\r\n                    closeModalBox: false\r\n                });\r\n            }\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.editElement = function (filter, filterElement) {\r\n        var oldCaption = this.preferences[filter.caption].caption;\r\n        var oldTab = this.preferences[filter.caption].tab;\r\n        var oldExpression = this.preferences[filter.caption].expression;\r\n        this.deleteFilterPreference(filter, filterElement);\r\n        this.openAdvancedFilterSectionOrSaveFilters();\r\n        this.populateEditSection({ tab: oldTab, caption: oldCaption, expression: oldExpression });\r\n    };\r\n    ResultsFiltersPreferences.prototype.populateEditSection = function (toPopulate) {\r\n        if (toPopulate === void 0) { toPopulate = { tab: [''], caption: '', expression: '' }; }\r\n        this.advancedFiltersTextInputCaption.setValue(toPopulate.caption);\r\n        this.advancedFiltersTextInputExpression.setValue(toPopulate.expression);\r\n        this.advancedFiltersTabSelect.setValue(toPopulate.tab);\r\n    };\r\n    ResultsFiltersPreferences.prototype.deleteFilterPreference = function (filter, filterElement) {\r\n        this.preferencePanelLocalStorage.remove(filter.caption);\r\n        delete this.preferences[filter.caption];\r\n        Dom_1.$$(Dom_1.$$(filterElement).closest('.coveo-choice-container')).detach();\r\n    };\r\n    ResultsFiltersPreferences.prototype.openAdvancedFilterSectionOrSaveFilters = function () {\r\n        if (Dom_1.$$(this.advancedFiltersBuilder).hasClass('coveo-active')) {\r\n            Dom_1.$$(Dom_1.$$(this.advancedFilterFormValidate).find('input[type=submit]')).trigger('click');\r\n            this.hideAdvancedFilterBuilder();\r\n        }\r\n        else {\r\n            this.populateEditSection();\r\n            this.showAdvancedFilterBuilder();\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.validateAndSaveAdvancedFilter = function (e) {\r\n        e.preventDefault();\r\n        this.hideAdvancedFilterBuilder();\r\n        var caption = this.advancedFiltersTextInputCaption.getValue();\r\n        var expression = this.advancedFiltersTextInputExpression.getValue();\r\n        var tabs = this.advancedFiltersTabSelect.getValue();\r\n        this.preferences[caption] = {\r\n            caption: caption,\r\n            custom: true,\r\n            expression: expression,\r\n            tab: tabs,\r\n            selected: true\r\n        };\r\n        this.buildCheckboxesInput();\r\n        this.save();\r\n        this.queryStateModel.set(QueryStateModel_1.QueryStateModel.attributesEnum.t, this.getActiveTab());\r\n        this.advancedFiltersTextInputCaption.reset();\r\n        this.advancedFiltersTextInputExpression.reset();\r\n        this.advancedFiltersTabSelect.reset();\r\n        this.container.appendChild(this.advancedFiltersBuilder);\r\n        this.fromFilterToAnalyticsEvent(this.preferences[caption], 'saved');\r\n        this.queryController.executeQuery({\r\n            closeModalBox: false\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.fromPreferencesToCheckboxInput = function () {\r\n        var _this = this;\r\n        _.each(this.getActiveFilters(), function (filter) {\r\n            _this.preferencePanelCheckboxInput[filter.caption].select();\r\n        });\r\n        _.each(this.getInactiveFilters(), function (filter) {\r\n            _this.preferencePanelCheckboxInput[filter.caption].reset();\r\n        });\r\n        _.each(this.getDormantFilters(), function (filter) {\r\n            _this.preferencePanelCheckboxInput[filter.caption].select();\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.fromCheckboxInputToPreferences = function () {\r\n        if (this.preferencePanelCheckboxInput) {\r\n            var selecteds_1 = _.map(_.filter(this.preferencePanelCheckboxInput, function (checkbox) { return checkbox.isSelected(); }), function (selected) { return selected.getValue(); });\r\n            _.each(this.preferences, function (filter) {\r\n                if (_.contains(selecteds_1, filter.caption)) {\r\n                    filter.selected = true;\r\n                }\r\n                else {\r\n                    filter.selected = false;\r\n                }\r\n            });\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.getDormantFilters = function () {\r\n        var _this = this;\r\n        var activeTab = this.getActiveTab();\r\n        return _.filter(this.preferences, function (filter) {\r\n            return filter.selected && !_this.filterIsInActiveTab(filter, activeTab);\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.getActiveFilters = function () {\r\n        var _this = this;\r\n        var activeTab = this.getActiveTab();\r\n        return _.filter(this.preferences, function (filter) {\r\n            return filter.selected && _this.filterIsInActiveTab(filter, activeTab);\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.getInactiveFilters = function () {\r\n        var _this = this;\r\n        var activeTab = this.getActiveTab();\r\n        return _.filter(this.preferences, function (filter) {\r\n            return !filter.selected || !_this.filterIsInActiveTab(filter, activeTab);\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.getActiveTab = function () {\r\n        return this.queryStateModel.get(QueryStateModel_1.QueryStateModel.attributesEnum.t);\r\n    };\r\n    ResultsFiltersPreferences.prototype.filterIsInActiveTab = function (filter, tab) {\r\n        filter.tab = _.compact(filter.tab);\r\n        return _.contains(filter.tab, tab) || Utils_1.Utils.isEmptyArray(filter.tab);\r\n    };\r\n    ResultsFiltersPreferences.prototype.getFilterElementByCaption = function (caption) {\r\n        return Dom_1.$$(this.preferenceContainer).find(\"input[value='\" + caption + \"']\").parentElement;\r\n    };\r\n    ResultsFiltersPreferences.prototype.fromResultsFilterOptionToResultsPreferenceInterface = function () {\r\n        var ret = {};\r\n        _.each(this.options.filters, function (filter, caption) {\r\n            ret[caption] = {\r\n                expression: filter.expression,\r\n                tab: filter.tab,\r\n                selected: filter.selected ? filter.selected : false,\r\n                custom: false,\r\n                caption: caption\r\n            };\r\n        });\r\n        return ret;\r\n    };\r\n    ResultsFiltersPreferences.prototype.mergeLocalPreferencesWithStaticPreferences = function () {\r\n        var staticPreferences = this.fromResultsFilterOptionToResultsPreferenceInterface();\r\n        var localPreferences = this.preferencePanelLocalStorage.load();\r\n        var localPreferencesWithoutRemoved = _.filter(localPreferences, function (preference) {\r\n            var isCustom = preference.custom;\r\n            var existsInStatic = _.find(staticPreferences, function (staticPreference) {\r\n                return staticPreference.caption == preference.caption;\r\n            });\r\n            return isCustom || existsInStatic != undefined;\r\n        });\r\n        var localToMerge = {};\r\n        _.each(localPreferencesWithoutRemoved, function (filter) {\r\n            localToMerge[filter.caption] = {\r\n                expression: filter.expression,\r\n                tab: filter.tab,\r\n                selected: filter.selected,\r\n                custom: filter.custom,\r\n                caption: filter.caption\r\n            };\r\n        });\r\n        this.preferences = Utils_1.Utils.extendDeep(staticPreferences, localToMerge);\r\n    };\r\n    ResultsFiltersPreferences.prototype.fromFilterToAnalyticsEvent = function (filter, type) {\r\n        this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.customfiltersChange, {\r\n            customFilterName: filter.caption,\r\n            customFilterExpression: filter.expression,\r\n            customFilterType: type\r\n        });\r\n    };\r\n    ResultsFiltersPreferences.prototype.enlargeModalBox = function () {\r\n        var modalBoxContainer = Dom_1.$$(document.body).find('.coveo-modal-container');\r\n        if (modalBoxContainer) {\r\n            Dom_1.$$(modalBoxContainer).addClass('coveo-mod-big');\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.shrinkModalBox = function () {\r\n        var modalBoxContainer = Dom_1.$$(document.body).find('.coveo-modal-container');\r\n        if (modalBoxContainer) {\r\n            Dom_1.$$(modalBoxContainer).removeClass('coveo-mod-big');\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.showAdvancedFilterBuilder = function () {\r\n        if (this.advancedFiltersBuilder) {\r\n            Dom_1.$$(this.advancedFiltersBuilder).addClass('coveo-active');\r\n            this.enlargeModalBox();\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.prototype.hideAdvancedFilterBuilder = function () {\r\n        if (this.advancedFiltersBuilder) {\r\n            Dom_1.$$(this.advancedFiltersBuilder).removeClass('coveo-active');\r\n            this.shrinkModalBox();\r\n        }\r\n    };\r\n    ResultsFiltersPreferences.ID = 'ResultsFiltersPreferences';\r\n    ResultsFiltersPreferences.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            ResultsFiltersPreferences: ResultsFiltersPreferences\r\n        });\r\n    };\r\n    /**\r\n     * The options for the component\r\n     * @componentOptions\r\n     */\r\n    ResultsFiltersPreferences.options = {\r\n        /**\r\n         * Specifies whether to display the active filter(s) in the [`Breadcrumb`]{@link Breadcrumb}.\r\n         *\r\n         * Default value is `true`.\r\n         */\r\n        includeInBreadcrumb: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }),\r\n        /**\r\n         * Specifies whether to show the **Create** button that allows the end user to create filters.\r\n         *\r\n         * If you set this option to `false`, only the pre-populated\r\n         * [`filters`]{@link ResultsFiltersPreferences.options.filters} are available to the end user.\r\n         *\r\n         * Default value is `true`.\r\n         */\r\n        showAdvancedFilters: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }),\r\n        /**\r\n         * Specifies the default filters which all end users can apply.\r\n         *\r\n         * End users cannot modify or delete these filters. These filters do not count as \"user-made\" filters, but rather as\r\n         * \"built-in\" filters created by the developer of the search page.\r\n         *\r\n         * **Note:**\r\n         * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\r\n         * > [`init`]{@link init} call of your search interface (see\r\n         * > [Passing Component Options in the init Call](https://docs.coveo.com/en/346/#passing-component-options-in-the-init-call)),\r\n         * > or before the `init` call, using the `options` top-level function (see\r\n         * > [Passing Component Options Before the init Call](https://docs.coveo.com/en/346/#passing-component-options-before-the-init-call)).\r\n         *\r\n         * Filters should follow this definition:\r\n         *\r\n         * `filters : { [caption : string] : { expression : string, tab? : string[] } }`;\r\n         *\r\n         * **Example:**\r\n         *\r\n         * var myFilters = {\r\n         *   \"Only Google Drive Items\" : {\r\n         *     expression : \"@connectortype == 'GoogleDriveCrawler'\",\r\n         *     tab : [\"Tab1\", \"Tab2\"]\r\n         *   },\r\n         *\r\n         *   \"Another Filter\" : {\r\n         *     expression : [ ... another expression ... ]\r\n         *   },\r\n         *\r\n         *   [ ... ]\r\n         * };\r\n         *\r\n         * ```javascript\r\n         * // You can set the option in the 'init' call:\r\n         * Coveo.init(document.querySelector(\"#search\"), {\r\n         *   ResultsFiltersPreferences : {\r\n         *     filters : myFilters\r\n         *   }\r\n         * });\r\n         *\r\n         * // Or before the 'init' call, using the 'options' top-level function:\r\n         * // Coveo.options(document.querySelector(\"#search\"), {\r\n         * //   ResultsFiltersPreferences : {\r\n         *        filters : myFilters\r\n         *      }\r\n         * // });\r\n         * ```\r\n         *\r\n         * Default value is `undefined`.\r\n         */\r\n        filters: ComponentOptions_1.ComponentOptions.buildJsonOption()\r\n    };\r\n    return ResultsFiltersPreferences;\r\n}(Component_1.Component));\r\nexports.ResultsFiltersPreferences = ResultsFiltersPreferences;\r\nInitialization_1.Initialization.registerAutoCreateComponent(ResultsFiltersPreferences);\r\n\n\n/***/ }),\n\n/***/ 561:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 573:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 659:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// ResultsFiltersPreferences.min__5f3280c404a1ee75a113.js","import { IFormWidget } from './FormWidgets';\r\nimport { Dom, $$ } from '../../utils/Dom';\r\nimport * as _ from 'underscore';\r\n\r\nimport 'styling/vapor/_FormGroup';\r\nimport { exportGlobally } from '../../GlobalExports';\r\n\r\n/**\r\n * A simple `fieldset` HTMLElement containing multiple form widgets.\r\n */\r\nexport class FormGroup {\r\n  private element: Dom;\r\n  public labelElement: Dom;\r\n\r\n  static doExport() {\r\n    exportGlobally({\r\n      FormGroup: FormGroup\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new `FormGroup`.\r\n   * @param contents The form widgets to include in the form group.\r\n   * @param label The label to display for the form group.\r\n   */\r\n  constructor(contents: IFormWidget[], label: string) {\r\n    this.labelElement = $$('span', { className: 'coveo-form-group-label' });\r\n    this.labelElement.text(label);\r\n    this.element = $$('fieldset', { className: 'coveo-form-group' }, this.labelElement);\r\n    _.each(contents, (content: IFormWidget) => {\r\n      this.element.append(content.build());\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Gets the element on which the form group is bound.\r\n   * @returns {HTMLElement} The form group element.\r\n   */\r\n  public build(): HTMLElement {\r\n    return this.element.el;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/FormWidgets/FormGroup.ts","import { IFormWidget, IFormWidgetSettable } from './FormWidgets';\r\nimport { $$ } from '../../utils/Dom';\r\nimport * as _ from 'underscore';\r\nimport { l } from '../../strings/Strings';\r\nimport 'styling/vapor/_MultiSelect';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { exportGlobally } from '../../GlobalExports';\r\n\r\n/**\r\n * A multi select widget with standard styling.\r\n */\r\nexport class MultiSelect implements IFormWidget, IFormWidgetSettable {\r\n  private element: HTMLSelectElement;\r\n\r\n  static doExport() {\r\n    exportGlobally({\r\n      MultiSelect: MultiSelect\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new `MultiSelect`.\r\n   * @param onChange The function to call when the widget selected values change. This function takes the current\r\n   * `MultiSelect` instance as an argument.\r\n   * @param options The values which can be selected with the multi select.\r\n   * @param label The label to display for the multi select.\r\n   */\r\n  constructor(\r\n    public onChange: (multiSelect: MultiSelect) => void = (multiSelect: MultiSelect) => {},\r\n    public options: string[],\r\n    public label: string\r\n  ) {\r\n    this.buildContent();\r\n  }\r\n\r\n  /**\r\n   * Gets the element on which the multi select is bound.\r\n   * @returns {HTMLSelectElement} The multi select element.\r\n   */\r\n  public build(): HTMLElement {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Gets the element on which the multi select is bound.\r\n   * @returns {HTMLSelectElement} The multi select element.\r\n   */\r\n  public getElement(): HTMLElement {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Gets the currently selected values.\r\n   * @returns {string[]} The array of selected multi select values.\r\n   */\r\n  public getValue(): string[] {\r\n    return _.chain(<any>this.element.options)\r\n      .toArray()\r\n      .filter((opt: HTMLOptionElement) => opt.selected)\r\n      .map((selected: HTMLOptionElement) => selected.value)\r\n      .value();\r\n  }\r\n\r\n  /**\r\n   * Gets the currently un-selected values.\r\n   * @returns {string[]} The array of un-selected multi select values.\r\n   */\r\n  public getUnselectedValues(): string[] {\r\n    return _.chain(<any>this.element.options)\r\n      .toArray()\r\n      .filter((opt: HTMLOptionElement) => !opt.selected)\r\n      .map((selected: HTMLOptionElement) => selected.value)\r\n      .value();\r\n  }\r\n\r\n  /**\r\n   * Sets the currently selected values.\r\n   * @param values The values to select.\r\n   */\r\n  public setValue(values: string[]) {\r\n    const currentlySelected = this.getValue();\r\n\r\n    const currentStateSplit = _.partition(_.toArray(this.element.options), (opt: HTMLOptionElement) =>\r\n      _.contains(currentlySelected, opt.value)\r\n    );\r\n    const newStateToApplySplit = _.partition(_.toArray(this.element.options), (opt: HTMLOptionElement) => _.contains(values, opt.value));\r\n\r\n    _.each(newStateToApplySplit[0], (toSelect: HTMLOptionElement) => (toSelect.selected = true));\r\n    _.each(newStateToApplySplit[1], (toUnSelect: HTMLOptionElement) => (toUnSelect.selected = false));\r\n\r\n    let hasChanged = false;\r\n    if (!Utils.arrayEqual(currentStateSplit[0], newStateToApplySplit[0], false)) {\r\n      hasChanged = true;\r\n    }\r\n    if (!Utils.arrayEqual(currentStateSplit[1], newStateToApplySplit[1], false)) {\r\n      hasChanged = true;\r\n    }\r\n\r\n    if (hasChanged) {\r\n      $$(this.element).trigger('change');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the multi select.\r\n   */\r\n  public reset() {\r\n    const currentlySelected = this.getValue();\r\n    this.element.selectedIndex = -1;\r\n    if (!Utils.isEmptyArray(currentlySelected)) {\r\n      $$(this.element).trigger('change');\r\n    }\r\n  }\r\n\r\n  private buildContent() {\r\n    this.element = <HTMLSelectElement>$$('select', {\r\n      className: 'coveo-multi-select',\r\n      multiple: '',\r\n      size: this.options.length.toString()\r\n    }).el;\r\n    const optgroup = $$('optgroup', {\r\n      className: 'coveo-list-group',\r\n      label: this.label\r\n    });\r\n    const options = _.map(this.options, opt => {\r\n      return $$('option', { value: opt, className: 'coveo-list-item' }, l(opt));\r\n    });\r\n    _.each(options, opt => optgroup.append(opt.el));\r\n    this.element.appendChild(optgroup.el);\r\n    $$(this.element).on('change', () => this.onChange(this));\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/FormWidgets/MultiSelect.ts","import 'styling/_ResultsFiltersPreferences';\r\nimport * as _ from 'underscore';\r\nimport { BreadcrumbEvents, IPopulateBreadcrumbEventArgs } from '../../events/BreadcrumbEvents';\r\nimport { InitializationEvents } from '../../events/InitializationEvents';\r\nimport { PreferencesPanelEvents } from '../../events/PreferencesPanelEvents';\r\nimport { IBuildingQueryEventArgs, QueryEvents } from '../../events/QueryEvents';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { MODEL_EVENTS } from '../../models/Model';\r\nimport { QueryStateModel, QUERY_STATE_ATTRIBUTES } from '../../models/QueryStateModel';\r\nimport { l } from '../../strings/Strings';\r\nimport { AccessibleButton } from '../../utils/AccessibleButton';\r\nimport { $$ } from '../../utils/Dom';\r\nimport { LocalStorageUtils } from '../../utils/LocalStorageUtils';\r\nimport { SVGDom } from '../../utils/SVGDom';\r\nimport { SVGIcons } from '../../utils/SVGIcons';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { analyticsActionCauseList, IAnalyticsCustomFiltersChangeMeta } from '../Analytics/AnalyticsActionListMeta';\r\nimport { Component } from '../Base/Component';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { Initialization } from '../Base/Initialization';\r\nimport { Checkbox } from '../FormWidgets/Checkbox';\r\nimport { FormGroup } from '../FormWidgets/FormGroup';\r\nimport { MultiSelect } from '../FormWidgets/MultiSelect';\r\nimport { TextInput } from '../FormWidgets/TextInput';\r\nimport { Tab } from '../Tab/Tab';\r\n\r\nexport interface IResultFilterPreference {\r\n  selected?: boolean;\r\n  custom?: boolean;\r\n  tab?: string[];\r\n  caption: string;\r\n  expression: string;\r\n}\r\n\r\nexport interface IResultsFiltersPreferencesOptions {\r\n  filters?: {\r\n    [caption: string]: { expression: string; tab?: string[] };\r\n  };\r\n  includeInBreadcrumb?: boolean;\r\n  showAdvancedFilters?: boolean;\r\n}\r\n\r\n/**\r\n * The `ResultFiltersPreferences` component allows end users to create custom filters to apply to queries. These filters\r\n * are saved to local storage.\r\n *\r\n * Only advanced end users who understand the Coveo query syntax should use this feature (see\r\n * [Coveo Query Syntax Reference](https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10005)).\r\n *\r\n * This component is normally accessible through the [`Settings`]{@link Settings} menu. Its usual location in the DOM is\r\n * inside the [`PreferencesPanel`]{@link PreferencesPanel} element.\r\n *\r\n * See also the {@link ResultsPreferences} component.\r\n */\r\nexport class ResultsFiltersPreferences extends Component {\r\n  static ID = 'ResultsFiltersPreferences';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      ResultsFiltersPreferences: ResultsFiltersPreferences\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the component\r\n   * @componentOptions\r\n   */\r\n  static options: IResultsFiltersPreferencesOptions = {\r\n    /**\r\n     * Specifies whether to display the active filter(s) in the [`Breadcrumb`]{@link Breadcrumb}.\r\n     *\r\n     * Default value is `true`.\r\n     */\r\n    includeInBreadcrumb: ComponentOptions.buildBooleanOption({ defaultValue: true }),\r\n\r\n    /**\r\n     * Specifies whether to show the **Create** button that allows the end user to create filters.\r\n     *\r\n     * If you set this option to `false`, only the pre-populated\r\n     * [`filters`]{@link ResultsFiltersPreferences.options.filters} are available to the end user.\r\n     *\r\n     * Default value is `true`.\r\n     */\r\n    showAdvancedFilters: ComponentOptions.buildBooleanOption({ defaultValue: true }),\r\n\r\n    /**\r\n     * Specifies the default filters which all end users can apply.\r\n     *\r\n     * End users cannot modify or delete these filters. These filters do not count as \"user-made\" filters, but rather as\r\n     * \"built-in\" filters created by the developer of the search page.\r\n     *\r\n     * **Note:**\r\n     * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\r\n     * > [`init`]{@link init} call of your search interface (see\r\n     * > [Passing Component Options in the init Call](https://docs.coveo.com/en/346/#passing-component-options-in-the-init-call)),\r\n     * > or before the `init` call, using the `options` top-level function (see\r\n     * > [Passing Component Options Before the init Call](https://docs.coveo.com/en/346/#passing-component-options-before-the-init-call)).\r\n     *\r\n     * Filters should follow this definition:\r\n     *\r\n     * `filters : { [caption : string] : { expression : string, tab? : string[] } }`;\r\n     *\r\n     * **Example:**\r\n     *\r\n     * var myFilters = {\r\n     *   \"Only Google Drive Items\" : {\r\n     *     expression : \"@connectortype == 'GoogleDriveCrawler'\",\r\n     *     tab : [\"Tab1\", \"Tab2\"]\r\n     *   },\r\n     *\r\n     *   \"Another Filter\" : {\r\n     *     expression : [ ... another expression ... ]\r\n     *   },\r\n     *\r\n     *   [ ... ]\r\n     * };\r\n     *\r\n     * ```javascript\r\n     * // You can set the option in the 'init' call:\r\n     * Coveo.init(document.querySelector(\"#search\"), {\r\n     *   ResultsFiltersPreferences : {\r\n     *     filters : myFilters\r\n     *   }\r\n     * });\r\n     *\r\n     * // Or before the 'init' call, using the 'options' top-level function:\r\n     * // Coveo.options(document.querySelector(\"#search\"), {\r\n     * //   ResultsFiltersPreferences : {\r\n     *        filters : myFilters\r\n     *      }\r\n     * // });\r\n     * ```\r\n     *\r\n     * Default value is `undefined`.\r\n     */\r\n    filters: <any>ComponentOptions.buildJsonOption()\r\n  };\r\n\r\n  public preferences: { [caption: string]: IResultFilterPreference };\r\n  public container: HTMLFieldSetElement;\r\n  private preferencePanelLocalStorage: LocalStorageUtils<{ [caption: string]: IResultFilterPreference }>;\r\n  private preferencePanel: HTMLElement;\r\n  private preferenceContainer: HTMLElement;\r\n  private preferencePanelCheckboxInput: { [caption: string]: Checkbox } = {};\r\n  private advancedFilters: HTMLElement;\r\n  private advancedFiltersBuilder: HTMLElement;\r\n  private advancedFiltersTextInputCaption: TextInput;\r\n  private advancedFiltersTextInputExpression: TextInput;\r\n  private advancedFiltersTabSelect: MultiSelect;\r\n  private advancedFilterFormValidate: HTMLFormElement;\r\n  private isFullBreadcrumbClear: boolean;\r\n\r\n  /**\r\n   * Creates a new `ResultsFiltersPreferences` component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the `ResultsFiltersPreferences` component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   */\r\n  constructor(public element: HTMLElement, public options: IResultsFiltersPreferencesOptions, public bindings: IComponentBindings) {\r\n    super(element, ResultsFiltersPreferences.ID, bindings);\r\n\r\n    this.options = ComponentOptions.initComponentOptions(element, ResultsFiltersPreferences, options);\r\n\r\n    this.preferencePanel = $$(this.element).closest(Component.computeCssClassNameForType('PreferencesPanel'));\r\n    if (!this.preferencePanel) {\r\n      this.logger.warn(`Cannot instantiate ResultsFilterPreferences, as there is no \"CoveoPreferencesPanel\" in your page !`);\r\n      return;\r\n    }\r\n    this.preferencePanelLocalStorage = new LocalStorageUtils<{ [caption: string]: IResultFilterPreference }>(ResultsFiltersPreferences.ID);\r\n    this.mergeLocalPreferencesWithStaticPreferences();\r\n\r\n    this.bindPreferencePanelEvent();\r\n    this.bindBreadcrumbEvent();\r\n    this.bindQueryEvent();\r\n\r\n    // We need to wait after all components are initialized before building the dom, because this component interacts with Tab\r\n    // And we don't know if Tab(s) are initialized before or after this component.\r\n    this.bind.oneRootElement(InitializationEvents.afterComponentsInitialization, () => this.createDom());\r\n\r\n    this.bind.oneQueryState(MODEL_EVENTS.CHANGE_ONE, QUERY_STATE_ATTRIBUTES.T, () => this.fromPreferencesToCheckboxInput());\r\n  }\r\n\r\n  public createDom() {\r\n    this.container = <HTMLFieldSetElement>new FormGroup([], l('ResultsFilteringExpression')).build();\r\n    this.element.appendChild(this.container);\r\n    this.buildCheckboxesInput();\r\n    if (this.options.showAdvancedFilters) {\r\n      this.buildAdvancedFilters();\r\n    }\r\n  }\r\n\r\n  public save() {\r\n    this.fromCheckboxInputToPreferences();\r\n    const toSave = _.omit(this.preferences, 'tab');\r\n    this.logger.info('Saving preferences', toSave);\r\n    this.preferencePanelLocalStorage.save(toSave);\r\n  }\r\n\r\n  public exitWithoutSave() {\r\n    this.fromPreferencesToCheckboxInput();\r\n    this.hideAdvancedFilterBuilder();\r\n  }\r\n\r\n  private bindPreferencePanelEvent() {\r\n    this.bind.on(this.preferencePanel, PreferencesPanelEvents.savePreferences, () => this.save());\r\n    this.bind.on(this.preferencePanel, PreferencesPanelEvents.exitPreferencesWithoutSave, () => this.exitWithoutSave());\r\n  }\r\n\r\n  private bindBreadcrumbEvent() {\r\n    if (this.options.includeInBreadcrumb) {\r\n      this.bind.onRootElement(BreadcrumbEvents.populateBreadcrumb, (args: IPopulateBreadcrumbEventArgs) =>\r\n        this.handlePopulateBreadcrumb(args)\r\n      );\r\n      this.bind.onRootElement(BreadcrumbEvents.clearBreadcrumb, () => this.handleClearBreadcrumb());\r\n    }\r\n  }\r\n\r\n  private bindQueryEvent() {\r\n    this.bind.onRootElement(QueryEvents.buildingQuery, (args: IBuildingQueryEventArgs) => this.handleBuildingQuery(args));\r\n  }\r\n\r\n  private handleBuildingQuery(args: IBuildingQueryEventArgs) {\r\n    _.each(this.getActiveFilters(), filter => {\r\n      if (Utils.isNonEmptyString(filter.expression)) {\r\n        args.queryBuilder.advancedExpression.add(filter.expression);\r\n      }\r\n    });\r\n  }\r\n\r\n  private handlePopulateBreadcrumb(args: IPopulateBreadcrumbEventArgs) {\r\n    const actives = this.getActiveFilters();\r\n    if (Utils.isNonEmptyArray(actives)) {\r\n      const container = $$('div', { className: 'coveo-results-filter-preferences-breadcrumb' });\r\n      const title = $$('span', { className: 'coveo-title' });\r\n      title.text(l('FiltersInYourPreferences') + ':');\r\n      container.el.appendChild(title.el);\r\n\r\n      const valuesContainer = $$('span', { className: 'coveo-values' });\r\n      container.el.appendChild(valuesContainer.el);\r\n\r\n      for (var i = 0; i < actives.length; i++) {\r\n        valuesContainer.el.appendChild(this.buildBreadcrumb(actives[i]));\r\n      }\r\n      args.breadcrumbs.push({ element: container.el });\r\n    }\r\n  }\r\n\r\n  private handleClearBreadcrumb() {\r\n    this.isFullBreadcrumbClear = true;\r\n    _.each(this.getActiveFilters(), filter => {\r\n      filter.selected = false;\r\n    });\r\n    this.fromPreferencesToCheckboxInput();\r\n    this.isFullBreadcrumbClear = false;\r\n  }\r\n\r\n  private buildAdvancedFilters() {\r\n    this.advancedFilters = $$('div', { className: 'coveo-advanced-filters' }, l('Create')).el;\r\n    this.buildAdvancedFilterInput();\r\n    this.buildAdvancedFilterFormValidate();\r\n    this.advancedFiltersBuilder = $$('div', { className: 'coveo-advanced-filters-builder' }).el;\r\n    this.advancedFiltersBuilder.appendChild(this.advancedFilterFormValidate);\r\n    $$(this.advancedFilters).on('click', () => this.openAdvancedFilterSectionOrSaveFilters());\r\n    const onlineHelp = $$(\r\n      'a',\r\n      {\r\n        href: 'https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10006',\r\n        className: 'coveo-online-help'\r\n      },\r\n      '?'\r\n    );\r\n\r\n    const title = $$(this.container).find('.coveo-form-group-label');\r\n\r\n    onlineHelp.insertAfter(title);\r\n    $$(this.advancedFilters).insertAfter(title);\r\n    this.container.appendChild(this.advancedFiltersBuilder);\r\n  }\r\n\r\n  private buildAdvancedFilterInput() {\r\n    this.advancedFiltersTextInputCaption = new TextInput(() => {}, l('Caption'));\r\n\r\n    this.advancedFiltersTextInputCaption.getInput().setAttribute('required', '');\r\n\r\n    this.advancedFiltersTextInputExpression = new TextInput(() => {}, l('Expression'));\r\n\r\n    this.advancedFiltersTextInputExpression.getInput().setAttribute('required', '');\r\n\r\n    this.advancedFiltersTabSelect = new MultiSelect(() => {}, this.getAllTabs(), l('Tab'));\r\n  }\r\n\r\n  private buildAdvancedFilterFormValidate() {\r\n    this.advancedFilterFormValidate = <HTMLFormElement>$$('form').el;\r\n\r\n    const formSubmit = $$('input', {\r\n      type: 'submit'\r\n    });\r\n\r\n    const saveFormButton = $$(\r\n      'span',\r\n      {\r\n        className: 'coveo-save'\r\n      },\r\n      SVGIcons.icons.checkboxHookExclusionMore\r\n    );\r\n    SVGDom.addClassToSVGInContainer(saveFormButton.el, 'coveo-save-svg');\r\n\r\n    const closeFormButton = $$(\r\n      'span',\r\n      {\r\n        className: 'coveo-close'\r\n      },\r\n      SVGIcons.icons.checkboxHookExclusionMore\r\n    );\r\n    SVGDom.addClassToSVGInContainer(closeFormButton.el, 'coveo-close-svg');\r\n\r\n    const saveAndCloseContainer = $$('div', {\r\n      className: 'coveo-choice-container coveo-close-and-save'\r\n    });\r\n\r\n    saveAndCloseContainer.el.appendChild(saveFormButton.el);\r\n    saveAndCloseContainer.el.appendChild(closeFormButton.el);\r\n\r\n    const inputCaption = this.advancedFiltersTextInputCaption.build();\r\n    $$(inputCaption).addClass('coveo-caption');\r\n\r\n    const filtersTabSelect = this.advancedFiltersTabSelect.build();\r\n    $$(filtersTabSelect).addClass('coveo-tab');\r\n\r\n    const filtersExpression = this.advancedFiltersTextInputExpression.build();\r\n    $$(filtersExpression).addClass('coveo-expression');\r\n\r\n    _.each([inputCaption, filtersExpression, filtersTabSelect, saveAndCloseContainer.el, formSubmit.el], (el: HTMLElement) => {\r\n      this.advancedFilterFormValidate.appendChild(el);\r\n    });\r\n\r\n    saveFormButton.on('click', () => {\r\n      formSubmit.el.click();\r\n    });\r\n    closeFormButton.on('click', () => {\r\n      this.hideAdvancedFilterBuilder();\r\n    });\r\n\r\n    $$(this.advancedFilterFormValidate).on('submit', (e: Event) => this.validateAndSaveAdvancedFilter(e));\r\n  }\r\n\r\n  private getAllTabs() {\r\n    const tabRef = Component.getComponentRef('Tab');\r\n    if (tabRef) {\r\n      const tabsElement = $$(this.root).findAll('.' + Component.computeCssClassName(tabRef));\r\n      return _.map(tabsElement, (tabElement: HTMLElement) => {\r\n        let tab = <Tab>Component.get(tabElement);\r\n        return tab.options.id;\r\n      });\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  private getPreferencesBoxInputToBuild() {\r\n    return _.map(this.preferences, (filter: IResultFilterPreference) => {\r\n      return {\r\n        label: filter.caption,\r\n        tab: filter.tab,\r\n        expression: filter.expression\r\n      };\r\n    });\r\n  }\r\n\r\n  private buildCheckboxesInput() {\r\n    if (this.preferenceContainer != undefined) {\r\n      this.preferenceContainer.remove();\r\n    }\r\n    const toBuild = this.getPreferencesBoxInputToBuild();\r\n    if (Utils.isNonEmptyArray(toBuild)) {\r\n      this.preferenceContainer = $$('div', {\r\n        className: 'coveo-choices-container'\r\n      }).el;\r\n\r\n      _.each(toBuild, filterToBuild => {\r\n        const checkbox = new Checkbox((checkbox: Checkbox) => {\r\n          this.save();\r\n          const filter = this.preferences[checkbox.getValue()];\r\n\r\n          if (!this.queryController.firstQuery && !this.isFullBreadcrumbClear) {\r\n            this.fromFilterToAnalyticsEvent(filter, filter.selected ? 'selected' : 'unselected');\r\n            this.queryController.executeQuery({\r\n              closeModalBox: false\r\n            });\r\n          }\r\n        }, filterToBuild.label);\r\n        $$(checkbox.build()).addClass('coveo-choice-container');\r\n        this.preferencePanelCheckboxInput[filterToBuild.label] = checkbox;\r\n        this.preferenceContainer.appendChild(checkbox.getElement());\r\n      });\r\n\r\n      _.each($$(this.preferenceContainer).findAll('.coveo-choice-container'), (choiceContainer: HTMLElement) => {\r\n        choiceContainer.appendChild($$('div', { className: 'coveo-section coveo-section-edit-delete' }).el);\r\n      });\r\n\r\n      $$(this.container).append(this.preferenceContainer);\r\n      this.buildEditAdvancedFilter();\r\n      this.buildDeleteAdvancedFilter();\r\n      this.fromPreferencesToCheckboxInput();\r\n    }\r\n  }\r\n\r\n  private buildDeleteAdvancedFilter() {\r\n    _.each(this.preferences, filter => {\r\n      if (filter.custom) {\r\n        const deleteElement = $$(\r\n          'span',\r\n          {\r\n            className: 'coveo-delete'\r\n          },\r\n          SVGIcons.icons.checkboxHookExclusionMore\r\n        ).el;\r\n        SVGDom.addClassToSVGInContainer(deleteElement, 'coveo-delete-svg');\r\n        const filterElement = this.getFilterElementByCaption(filter.caption);\r\n        const insertInto = $$(filterElement).find('.coveo-section-edit-delete');\r\n        insertInto.appendChild(deleteElement);\r\n        $$(deleteElement).on('click', () => this.confirmDelete(filter, filterElement));\r\n      }\r\n    });\r\n  }\r\n\r\n  private buildEditAdvancedFilter() {\r\n    _.each(this.preferences, filter => {\r\n      if (filter.custom) {\r\n        const editElement = $$(\r\n          'span',\r\n          {\r\n            className: 'coveo-edit'\r\n          },\r\n          SVGIcons.icons.edit\r\n        );\r\n        SVGDom.addClassToSVGInContainer(editElement.el, 'coveo-edit-svg');\r\n        const filterElement = this.getFilterElementByCaption(filter.caption);\r\n        const insertInto = $$(filterElement).find('.coveo-section-edit-delete');\r\n        insertInto.appendChild(editElement.el);\r\n        editElement.on('click', () => this.editElement(filter, filterElement));\r\n      }\r\n    });\r\n  }\r\n\r\n  private buildBreadcrumb(filter: IResultFilterPreference): HTMLElement {\r\n    const elem = $$('span', { className: 'coveo-value' });\r\n\r\n    const caption = $$('span', { className: 'coveo-caption' });\r\n    caption.text(filter.caption);\r\n    elem.el.appendChild(caption.el);\r\n\r\n    const clear = $$('span', { className: 'coveo-clear' }, SVGIcons.icons.mainClear);\r\n    elem.el.appendChild(clear.el);\r\n\r\n    const onSelectAction = () => {\r\n      filter.selected = false;\r\n      this.fromFilterToAnalyticsEvent(filter, 'cleared from breadcrumb');\r\n      this.fromPreferencesToCheckboxInput();\r\n    };\r\n\r\n    new AccessibleButton()\r\n      .withElement(elem)\r\n      .withLabel(l('RemoveFilterOn', filter.caption))\r\n      .withSelectAction(onSelectAction)\r\n      .build();\r\n\r\n    return elem.el;\r\n  }\r\n\r\n  private confirmDelete(filter: IResultFilterPreference, filterElement: HTMLElement) {\r\n    if (confirm(l('AreYouSureDeleteFilter', filter.caption, filter.expression))) {\r\n      const isSelected = filter.selected;\r\n      this.deleteFilterPreference(filter, filterElement);\r\n      if (isSelected) {\r\n        this.fromFilterToAnalyticsEvent(filter, 'deleted');\r\n        this.queryController.executeQuery({\r\n          closeModalBox: false\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  private editElement(filter: IResultFilterPreference, filterElement: HTMLElement) {\r\n    const oldCaption = this.preferences[filter.caption].caption;\r\n    const oldTab = this.preferences[filter.caption].tab;\r\n    const oldExpression = this.preferences[filter.caption].expression;\r\n    this.deleteFilterPreference(filter, filterElement);\r\n    this.openAdvancedFilterSectionOrSaveFilters();\r\n    this.populateEditSection({ tab: oldTab, caption: oldCaption, expression: oldExpression });\r\n  }\r\n\r\n  private populateEditSection(toPopulate = { tab: [''], caption: '', expression: '' }) {\r\n    this.advancedFiltersTextInputCaption.setValue(toPopulate.caption);\r\n    this.advancedFiltersTextInputExpression.setValue(toPopulate.expression);\r\n    this.advancedFiltersTabSelect.setValue(toPopulate.tab);\r\n  }\r\n\r\n  private deleteFilterPreference(filter: IResultFilterPreference, filterElement: HTMLElement) {\r\n    this.preferencePanelLocalStorage.remove(filter.caption);\r\n    delete this.preferences[filter.caption];\r\n    $$($$(filterElement).closest('.coveo-choice-container')).detach();\r\n  }\r\n\r\n  private openAdvancedFilterSectionOrSaveFilters() {\r\n    if ($$(this.advancedFiltersBuilder).hasClass('coveo-active')) {\r\n      $$($$(this.advancedFilterFormValidate).find('input[type=submit]')).trigger('click');\r\n      this.hideAdvancedFilterBuilder();\r\n    } else {\r\n      this.populateEditSection();\r\n      this.showAdvancedFilterBuilder();\r\n    }\r\n  }\r\n\r\n  private validateAndSaveAdvancedFilter(e: Event) {\r\n    e.preventDefault();\r\n    this.hideAdvancedFilterBuilder();\r\n    const caption = this.advancedFiltersTextInputCaption.getValue();\r\n    const expression = this.advancedFiltersTextInputExpression.getValue();\r\n    const tabs = this.advancedFiltersTabSelect.getValue();\r\n    this.preferences[caption] = {\r\n      caption: caption,\r\n      custom: true,\r\n      expression: expression,\r\n      tab: tabs,\r\n      selected: true\r\n    };\r\n    this.buildCheckboxesInput();\r\n    this.save();\r\n    this.queryStateModel.set(QueryStateModel.attributesEnum.t, this.getActiveTab());\r\n    this.advancedFiltersTextInputCaption.reset();\r\n    this.advancedFiltersTextInputExpression.reset();\r\n    this.advancedFiltersTabSelect.reset();\r\n    this.container.appendChild(this.advancedFiltersBuilder);\r\n    this.fromFilterToAnalyticsEvent(this.preferences[caption], 'saved');\r\n    this.queryController.executeQuery({\r\n      closeModalBox: false\r\n    });\r\n  }\r\n\r\n  private fromPreferencesToCheckboxInput() {\r\n    _.each(this.getActiveFilters(), (filter: IResultFilterPreference) => {\r\n      this.preferencePanelCheckboxInput[filter.caption].select();\r\n    });\r\n    _.each(this.getInactiveFilters(), (filter: IResultFilterPreference) => {\r\n      this.preferencePanelCheckboxInput[filter.caption].reset();\r\n    });\r\n    _.each(this.getDormantFilters(), (filter: IResultFilterPreference) => {\r\n      this.preferencePanelCheckboxInput[filter.caption].select();\r\n    });\r\n  }\r\n\r\n  private fromCheckboxInputToPreferences() {\r\n    if (this.preferencePanelCheckboxInput) {\r\n      const selecteds = _.map(\r\n        _.filter(this.preferencePanelCheckboxInput, (checkbox: Checkbox) => checkbox.isSelected()),\r\n        (selected: Checkbox) => selected.getValue()\r\n      );\r\n      _.each(this.preferences, (filter: IResultFilterPreference) => {\r\n        if (_.contains(selecteds, filter.caption)) {\r\n          filter.selected = true;\r\n        } else {\r\n          filter.selected = false;\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private getDormantFilters() {\r\n    const activeTab = this.getActiveTab();\r\n    return _.filter(this.preferences, (filter: IResultFilterPreference) => {\r\n      return filter.selected && !this.filterIsInActiveTab(filter, activeTab);\r\n    });\r\n  }\r\n\r\n  private getActiveFilters() {\r\n    const activeTab = this.getActiveTab();\r\n    return _.filter(this.preferences, (filter: IResultFilterPreference) => {\r\n      return filter.selected && this.filterIsInActiveTab(filter, activeTab);\r\n    });\r\n  }\r\n\r\n  private getInactiveFilters() {\r\n    const activeTab = this.getActiveTab();\r\n    return _.filter(this.preferences, (filter: IResultFilterPreference) => {\r\n      return !filter.selected || !this.filterIsInActiveTab(filter, activeTab);\r\n    });\r\n  }\r\n\r\n  private getActiveTab() {\r\n    return this.queryStateModel.get(QueryStateModel.attributesEnum.t);\r\n  }\r\n\r\n  private filterIsInActiveTab(filter: IResultFilterPreference, tab: string) {\r\n    filter.tab = _.compact(filter.tab);\r\n    return _.contains(filter.tab, tab) || Utils.isEmptyArray(filter.tab);\r\n  }\r\n\r\n  private getFilterElementByCaption(caption: string): HTMLElement {\r\n    return $$(this.preferenceContainer).find(\"input[value='\" + caption + \"']\").parentElement;\r\n  }\r\n\r\n  private fromResultsFilterOptionToResultsPreferenceInterface() {\r\n    const ret: { [key: string]: IResultFilterPreference } = {};\r\n    _.each(<any>this.options.filters, (filter: { expression: string; tab?: string[]; selected?: boolean }, caption: string) => {\r\n      ret[caption] = {\r\n        expression: filter.expression,\r\n        tab: filter.tab,\r\n        selected: filter.selected ? filter.selected : false,\r\n        custom: false,\r\n        caption: caption\r\n      };\r\n    });\r\n    return ret;\r\n  }\r\n\r\n  private mergeLocalPreferencesWithStaticPreferences() {\r\n    const staticPreferences = this.fromResultsFilterOptionToResultsPreferenceInterface();\r\n    const localPreferences = this.preferencePanelLocalStorage.load();\r\n    const localPreferencesWithoutRemoved = _.filter<IResultFilterPreference>(localPreferences, preference => {\r\n      const isCustom = preference.custom;\r\n      const existsInStatic = _.find<IResultFilterPreference>(staticPreferences, staticPreference => {\r\n        return staticPreference.caption == preference.caption;\r\n      });\r\n      return isCustom || existsInStatic != undefined;\r\n    });\r\n\r\n    const localToMerge = {};\r\n    _.each(localPreferencesWithoutRemoved, (filter: IResultFilterPreference) => {\r\n      localToMerge[filter.caption] = {\r\n        expression: filter.expression,\r\n        tab: filter.tab,\r\n        selected: filter.selected,\r\n        custom: filter.custom,\r\n        caption: filter.caption\r\n      };\r\n    });\r\n    this.preferences = <{ [caption: string]: IResultFilterPreference }>Utils.extendDeep(staticPreferences, localToMerge);\r\n  }\r\n\r\n  private fromFilterToAnalyticsEvent(filter: IResultFilterPreference, type: string) {\r\n    this.usageAnalytics.logSearchEvent<IAnalyticsCustomFiltersChangeMeta>(analyticsActionCauseList.customfiltersChange, {\r\n      customFilterName: filter.caption,\r\n      customFilterExpression: filter.expression,\r\n      customFilterType: type\r\n    });\r\n  }\r\n\r\n  private enlargeModalBox() {\r\n    const modalBoxContainer = $$(document.body).find('.coveo-modal-container');\r\n    if (modalBoxContainer) {\r\n      $$(modalBoxContainer).addClass('coveo-mod-big');\r\n    }\r\n  }\r\n\r\n  private shrinkModalBox() {\r\n    const modalBoxContainer = $$(document.body).find('.coveo-modal-container');\r\n    if (modalBoxContainer) {\r\n      $$(modalBoxContainer).removeClass('coveo-mod-big');\r\n    }\r\n  }\r\n\r\n  private showAdvancedFilterBuilder() {\r\n    if (this.advancedFiltersBuilder) {\r\n      $$(this.advancedFiltersBuilder).addClass('coveo-active');\r\n      this.enlargeModalBox();\r\n    }\r\n  }\r\n\r\n  private hideAdvancedFilterBuilder() {\r\n    if (this.advancedFiltersBuilder) {\r\n      $$(this.advancedFiltersBuilder).removeClass('coveo-active');\r\n      this.shrinkModalBox();\r\n    }\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(ResultsFiltersPreferences);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultsFiltersPreferences/ResultsFiltersPreferences.ts"],"sourceRoot":""}
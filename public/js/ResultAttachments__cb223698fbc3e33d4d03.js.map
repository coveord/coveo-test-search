{"version":3,"sources":["./src/ui/ResultAttachments/ResultAttachments.ts","./src/ui/ResultAttachments/DefaultResultAttachmentTemplate.ts","./sass/_ResultAttachments.scss"],"names":[],"mappings":"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","file":"ResultAttachments__cb223698fbc3e33d4d03.js","sourcesContent":["import { Template } from '../Templates/Template';\r\nimport { Component } from '../Base/Component';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { DefaultResultAttachmentTemplate } from './DefaultResultAttachmentTemplate';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { QueryUtils } from '../../utils/QueryUtils';\r\nimport { Initialization, IInitializationParameters } from '../Base/Initialization';\r\nimport { Assert } from '../../misc/Assert';\r\nimport { $$ } from '../../utils/Dom';\r\nimport * as _ from 'underscore';\r\nimport { exportGlobally } from '../../GlobalExports';\r\n\r\nimport 'styling/_ResultAttachments';\r\nimport { TemplateComponentOptions } from '../Base/TemplateComponentOptions';\r\n\r\nexport interface IResultAttachmentsOptions {\r\n  resultTemplate?: Template;\r\n  subResultTemplate?: Template;\r\n  maximumAttachmentLevel?: number;\r\n}\r\n\r\n/**\r\n * The `ResultAttachments` component renders attachments in a result set, for example when displaying emails. This\r\n * component is usable inside a result template when there is an active [`Folding`]{@link Folding} component in the\r\n * page.\r\n *\r\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\r\n * @notSupportedIn salesforcefree\r\n */\r\nexport class ResultAttachments extends Component {\r\n  static ID = 'ResultAttachments';\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      ResultAttachments: ResultAttachments,\r\n      DefaultResultAttachmentTemplate: DefaultResultAttachmentTemplate\r\n    });\r\n  };\r\n\r\n  /**\r\n   * The options for the component\r\n   * @componentOptions\r\n   */\r\n  static options: IResultAttachmentsOptions = {\r\n    /**\r\n     * Specifies the template to use to render each attachment for a top result.\r\n     *\r\n     * You can specify a previously registered template to use either by referring to its HTML `id` attribute or to a\r\n     * CSS selector (see {@link TemplateCache}).\r\n     *\r\n     * **Examples:**\r\n     *\r\n     * Specifying a previously registered template by referring to its HTML `id` attribute:\r\n     *\r\n     * ```html\r\n     * <div class=\"CoveoResultAttachments\" data-result-template-id=\"Foo\"></div>\r\n     * ```\r\n     *\r\n     * Specifying a previously registered template by referring to a CSS selector:\r\n     *\r\n     * ```html\r\n     * <div class='CoveoResultAttachments' data-result-template-selector=\".Foo\"></div>\r\n     * ```\r\n     *\r\n     * If you do not specify a custom folding template, the component uses the default result attachment template.\r\n     */\r\n    resultTemplate: TemplateComponentOptions.buildTemplateOption({\r\n      defaultFunction: e => new DefaultResultAttachmentTemplate()\r\n    }),\r\n\r\n    /**\r\n     * Specifies the template to use to render sub-attachments, which are attachments within attachments, for example\r\n     * when multiple files are embedded within a `.zip` attachment.\r\n     *\r\n     * Sub-attachments can themselves contain sub-attachments, and so on up to a certain level (see the\r\n     * [`maximumAttachmentLevel`]{@link ResultAttachments.options.maximumAttachmentLevel} option).\r\n     *\r\n     * You can specify a previously registered template to use either by referring to its HTML `id` attribute or to a\r\n     * CSS selector (see {@link TemplateCache}).\r\n     *\r\n     * **Example:**\r\n     *\r\n     * Specifying a previously registered template by referring to its HTML `id` attribute:\r\n     *\r\n     * ```html\r\n     * <div class=\"CoveoResultAttachments\" data-sub-result-template-id=\"Foo\"></div>\r\n     * ```\r\n     *\r\n     * Specifying a previously registered template by referring to a CSS selector:\r\n     *\r\n     * ```html\r\n     * <div class=\"CoveoResultAttachments\" data-sub-result-template-selector=\".Foo\"></div>\r\n     * ```\r\n     *\r\n     * By default, this option uses the same template you specify for the\r\n     * [`resultTemplate`]{@link ResultAttachments.options.resultTemplate} option.\r\n     */\r\n    subResultTemplate: TemplateComponentOptions.buildTemplateOption({\r\n      postProcessing: (value: Template, options: IResultAttachmentsOptions) => (value != null ? value : options.resultTemplate)\r\n    }),\r\n\r\n    /**\r\n     * Specifies the maximum nesting depth. Beyond this depth, the component stops rendering sub-attachments.\r\n     *\r\n     * Default value is `5`. Minimum value is `0`.\r\n     */\r\n    maximumAttachmentLevel: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0 })\r\n  };\r\n\r\n  private attachments: IQueryResult[];\r\n\r\n  /**\r\n   * Creates a new `ResultAttachments` component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the `ResultAttachments` component.\r\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\r\n   * automatically resolved (with a slower execution time).\r\n   * @param result The result to associate the component with.\r\n   * @param attachmentLevel The nesting depth.\r\n   */\r\n  constructor(\r\n    public element: HTMLElement,\r\n    public options?: IResultAttachmentsOptions,\r\n    public bindings?: IComponentBindings,\r\n    result?: IQueryResult,\r\n    public attachmentLevel = 0\r\n  ) {\r\n    super(element, ResultAttachments.ID, bindings);\r\n\r\n    this.options = ComponentOptions.initComponentOptions(element, ResultAttachments, options);\r\n\r\n    this.attachments = result.attachments;\r\n    if (Utils.isNonEmptyArray(this.attachments)) {\r\n      this.renderAttachments();\r\n    }\r\n  }\r\n\r\n  private renderAttachments() {\r\n    _.each(this.attachments, attachment => {\r\n      QueryUtils.setStateObjectOnQueryResult(this.queryStateModel.get(), attachment);\r\n      QueryUtils.setSearchInterfaceObjectOnQueryResult(this.searchInterface, attachment);\r\n      let subTemplatePromise =\r\n        this.attachmentLevel > 0\r\n          ? this.options.subResultTemplate.instantiateToElement(attachment)\r\n          : this.options.resultTemplate.instantiateToElement(attachment);\r\n\r\n      subTemplatePromise.then((container: HTMLElement) => {\r\n        this.autoCreateComponentsInsideResult(container, _.extend({}, attachment, { attachments: [] }));\r\n\r\n        $$(container).addClass('coveo-result-attachments-container');\r\n        this.element.appendChild(container);\r\n\r\n        if (this.attachmentHasSubAttachment(attachment) && this.attachmentLevel < this.options.maximumAttachmentLevel) {\r\n          var childAttachmentContainer = $$('div').el;\r\n          container.appendChild(childAttachmentContainer);\r\n          new ResultAttachments(childAttachmentContainer, this.options, this.bindings, attachment, this.attachmentLevel + 1);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private attachmentHasSubAttachment(attachment: IQueryResult) {\r\n    if (Utils.isNonEmptyArray(attachment.attachments)) {\r\n      return true;\r\n    } else if (Utils.isNonEmptyArray(attachment.childResults)) {\r\n      attachment.attachments = attachment.childResults;\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private autoCreateComponentsInsideResult(element: HTMLElement, result: IQueryResult) {\r\n    Assert.exists(element);\r\n    var initOptions = this.searchInterface.options;\r\n    var initParameters: IInitializationParameters = {\r\n      options: initOptions,\r\n      bindings: this.getBindings(),\r\n      result: result\r\n    };\r\n    Initialization.automaticallyCreateComponentsInside(element, initParameters, [ResultAttachments.ID]);\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(ResultAttachments);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultAttachments/ResultAttachments.ts","import { Template } from '../Templates/Template';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\n\r\nexport class DefaultResultAttachmentTemplate extends Template {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  instantiateToString(queryResult?: IQueryResult): string {\r\n    return '<div><span class=\"CoveoIcon\"></span> <a class=\"CoveoResultLink\"></a> <span class=\"CoveoQuickview\"></span></div>';\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultAttachments/DefaultResultAttachmentTemplate.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_ResultAttachments.scss\n// module id = 652\n// module chunks = 42 88"],"sourceRoot":""}
{"version":3,"sources":["StarRating.min__5f3280c404a1ee75a113.js","./src/ui/StarRating/StarRating.ts"],"names":["webpackJsonpCoveo__temporary","271","module","exports","__webpack_require__","__extends","this","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","value","element","options","bindings","result","StarRating","ID","ComponentOptions","initComponentOptions","renderComponent","_this","logger","error","get","rawRating","Utils","getFieldValue","ratingField","rawNumberOfRatings","numberOfRatingsField","undefined","numberOfRatings","Number","rating","scale","ratingScale","Math","round","enumerable","configurable","configuredFieldsAreValid","makeAccessible","starNumber","renderStar","renderNumberOfReviews","setDefaultTabIndex","setAttribute","getAriaLabel","isNullOrUndefined","getAttribute","tabIndex","numberOfRatingsIsKnown","wasRated","l","label","isChecked","star","$$","className","SVGIcons","icons","toggleClass","appendChild","el","numberString","text","doExport","exportGlobally","buildFieldOption","required","buildNumberOption","defaultValue","min","max","Component","Initialization","registerAutoCreateComponent","658"],"mappings":"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","file":"StarRating.min__5f3280c404a1ee75a113.js","sourcesContent":["webpackJsonpCoveo__temporary([58],{\n\n/***/ 271:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__webpack_require__(658);\r\nvar Dom_1 = __webpack_require__(1);\r\nvar Utils_1 = __webpack_require__(4);\r\nvar Strings_1 = __webpack_require__(6);\r\nvar Component_1 = __webpack_require__(7);\r\nvar SVGIcons_1 = __webpack_require__(12);\r\nvar GlobalExports_1 = __webpack_require__(3);\r\nvar Initialization_1 = __webpack_require__(2);\r\nvar ComponentOptions_1 = __webpack_require__(8);\r\nvar DEFAULT_SCALE = 5;\r\n/**\r\n * The `StarRating` component renders a five-star rating widget for use in commerce result templates.\r\n *\r\n * @isresulttemplatecomponent\r\n *\r\n * @availablesince [January 2020 Release (v2.7968)](https://docs.coveo.com/en/3163/)\r\n */\r\nvar StarRating = /** @class */ (function (_super) {\r\n    __extends(StarRating, _super);\r\n    /**\r\n     * Creates a new `StarRating` component.\r\n     * @param element The HTMLElement on which to instantiate the component.\r\n     * @param options The options for the `StarRating` component.\r\n     * @param bindings The bindings that the component requires to function normally.\r\n     */\r\n    function StarRating(element, options, bindings, result) {\r\n        var _this = _super.call(this, element, StarRating.ID) || this;\r\n        _this.element = element;\r\n        _this.options = options;\r\n        _this.bindings = bindings;\r\n        _this.result = result;\r\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, StarRating, options);\r\n        if (!result) {\r\n            _this.logger.error('No result passed to Star Rating component.');\r\n            return _this;\r\n        }\r\n        _this.renderComponent();\r\n        return _this;\r\n    }\r\n    Object.defineProperty(StarRating.prototype, \"configuredFieldsAreValid\", {\r\n        get: function () {\r\n            var rawRating = Utils_1.Utils.getFieldValue(this.result, this.options.ratingField);\r\n            var rawNumberOfRatings = Utils_1.Utils.getFieldValue(this.result, this.options.numberOfRatingsField);\r\n            if (rawNumberOfRatings !== undefined) {\r\n                this.numberOfRatings = Number(rawNumberOfRatings) < 0 ? 0 : Number(rawNumberOfRatings) || 0;\r\n            }\r\n            this.rating = Number(rawRating) < 0 ? 0 : Number(rawRating) || 0;\r\n            var scale = this.options.ratingScale;\r\n            if (scale < this.rating || scale <= 0) {\r\n                this.logger.error(\"The rating scale property is either missing or invalid.\");\r\n                return false;\r\n            }\r\n            this.rating = Math.round(this.rating * (DEFAULT_SCALE / scale));\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    StarRating.prototype.renderComponent = function () {\r\n        if (this.configuredFieldsAreValid) {\r\n            this.makeAccessible();\r\n            for (var starNumber = 1; starNumber <= DEFAULT_SCALE; starNumber++) {\r\n                this.renderStar(starNumber <= this.rating);\r\n            }\r\n            if (this.numberOfRatings !== undefined) {\r\n                this.renderNumberOfReviews(this.numberOfRatings);\r\n            }\r\n        }\r\n    };\r\n    StarRating.prototype.makeAccessible = function () {\r\n        this.setDefaultTabIndex();\r\n        this.element.setAttribute('aria-label', this.getAriaLabel());\r\n    };\r\n    StarRating.prototype.setDefaultTabIndex = function () {\r\n        if (Utils_1.Utils.isNullOrUndefined(this.element.getAttribute('tabindex'))) {\r\n            this.element.tabIndex = 0;\r\n        }\r\n    };\r\n    StarRating.prototype.getAriaLabel = function () {\r\n        var numberOfRatingsIsKnown = !Utils_1.Utils.isNullOrUndefined(this.numberOfRatings);\r\n        var wasRated = !!this.numberOfRatings;\r\n        if (numberOfRatingsIsKnown && !wasRated) {\r\n            return Strings_1.l('NoRatings');\r\n        }\r\n        var label = Strings_1.l('Rated', this.rating, this.options.ratingScale, this.options.ratingScale);\r\n        if (numberOfRatingsIsKnown) {\r\n            return label + ' ' + Strings_1.l('RatedBy', this.numberOfRatings, this.numberOfRatings);\r\n        }\r\n        return label;\r\n    };\r\n    StarRating.prototype.renderStar = function (isChecked) {\r\n        var star = Dom_1.$$('span', { className: 'coveo-star-rating-star' }, SVGIcons_1.SVGIcons.icons.star);\r\n        star.toggleClass('coveo-star-rating-star-active', isChecked);\r\n        this.element.appendChild(star.el);\r\n    };\r\n    StarRating.prototype.renderNumberOfReviews = function (value) {\r\n        var numberString = Dom_1.$$('span', { className: 'coveo-star-rating-label' });\r\n        numberString.text(value > 0 ? \"(\" + value + \")\" : Strings_1.l('NoRatings'));\r\n        this.element.appendChild(numberString.el);\r\n    };\r\n    StarRating.ID = 'StarRating';\r\n    StarRating.doExport = function () {\r\n        GlobalExports_1.exportGlobally({\r\n            StarRating: StarRating\r\n        });\r\n    };\r\n    /**\r\n     * @componentOptions\r\n     */\r\n    StarRating.options = {\r\n        /**\r\n         * Specifies the rating to be displayed as stars. If the rating is on a different scale than 0-5, a `ratingScale` value must be provided.\r\n         */\r\n        ratingField: ComponentOptions_1.ComponentOptions.buildFieldOption({ required: true }),\r\n        /**\r\n         * A numeric field whose value should be used to display the total number of ratings label for the result item.\r\n         *\r\n         * If unspecified, no number of ratings label is displayed. If the `numberOfRatingsField`'s value is `0` or less, a `(No Ratings)` label is displayed.\r\n         */\r\n        numberOfRatingsField: ComponentOptions_1.ComponentOptions.buildFieldOption(),\r\n        /**\r\n         * The scale to apply to the [`ratingField`]{@link StarRating.options.ratingField}'s value. Must be smaller than or equal to the highest possible `ratingField`'s value.\r\n         *\r\n         * **Example:** If the `ratingScale` is `100` and the current `ratingField`'s value is `75`, the component will render 3 stars (i.e., `75 * (5 / 100)`, rounded down).\r\n         */\r\n        ratingScale: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 5, min: 1, max: 100000 })\r\n    };\r\n    return StarRating;\r\n}(Component_1.Component));\r\nexports.StarRating = StarRating;\r\nInitialization_1.Initialization.registerAutoCreateComponent(StarRating);\r\n\n\n/***/ }),\n\n/***/ 658:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// StarRating.min__5f3280c404a1ee75a113.js","import 'styling/_StarRating';\r\nimport { $$ } from '../../utils/Dom';\r\nimport { Utils } from '../../utils/Utils';\r\nimport { l } from '../../strings/Strings';\r\nimport { Component } from '../Base/Component';\r\nimport { SVGIcons } from '../../utils/SVGIcons';\r\nimport { exportGlobally } from '../../GlobalExports';\r\nimport { IQueryResult } from '../../rest/QueryResult';\r\nimport { Initialization } from '../Base/Initialization';\r\nimport { IComponentBindings } from '../Base/ComponentBindings';\r\nimport { ComponentOptions } from '../Base/ComponentOptions';\r\nimport { IFieldOption } from '../Base/IComponentOptions';\r\n\r\nconst DEFAULT_SCALE = 5;\r\n\r\nexport interface IStarRatingOptions {\r\n  ratingField?: IFieldOption;\r\n  numberOfRatingsField?: IFieldOption;\r\n  ratingScale?: number;\r\n}\r\n/**\r\n * The `StarRating` component renders a five-star rating widget for use in commerce result templates.\r\n *\r\n * @isresulttemplatecomponent\r\n *\r\n * @availablesince [January 2020 Release (v2.7968)](https://docs.coveo.com/en/3163/)\r\n */\r\nexport class StarRating extends Component {\r\n  static ID = 'StarRating';\r\n  private rating: number;\r\n  private numberOfRatings: number;\r\n\r\n  static doExport = () => {\r\n    exportGlobally({\r\n      StarRating: StarRating\r\n    });\r\n  };\r\n\r\n  /**\r\n   * @componentOptions\r\n   */\r\n  static options: IStarRatingOptions = {\r\n    /**\r\n     * Specifies the rating to be displayed as stars. If the rating is on a different scale than 0-5, a `ratingScale` value must be provided.\r\n     */\r\n    ratingField: ComponentOptions.buildFieldOption({ required: true }),\r\n\r\n    /**\r\n     * A numeric field whose value should be used to display the total number of ratings label for the result item.\r\n     *\r\n     * If unspecified, no number of ratings label is displayed. If the `numberOfRatingsField`'s value is `0` or less, a `(No Ratings)` label is displayed.\r\n     */\r\n    numberOfRatingsField: ComponentOptions.buildFieldOption(),\r\n\r\n    /**\r\n     * The scale to apply to the [`ratingField`]{@link StarRating.options.ratingField}'s value. Must be smaller than or equal to the highest possible `ratingField`'s value.\r\n     *\r\n     * **Example:** If the `ratingScale` is `100` and the current `ratingField`'s value is `75`, the component will render 3 stars (i.e., `75 * (5 / 100)`, rounded down).\r\n     */\r\n    ratingScale: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 1, max: 100000 })\r\n  };\r\n\r\n  /**\r\n   * Creates a new `StarRating` component.\r\n   * @param element The HTMLElement on which to instantiate the component.\r\n   * @param options The options for the `StarRating` component.\r\n   * @param bindings The bindings that the component requires to function normally.\r\n   */\r\n  constructor(\r\n    public element: HTMLElement,\r\n    public options: IStarRatingOptions,\r\n    public bindings?: IComponentBindings,\r\n    private result?: IQueryResult\r\n  ) {\r\n    super(element, StarRating.ID);\r\n    this.options = ComponentOptions.initComponentOptions(element, StarRating, options);\r\n\r\n    if (!result) {\r\n      this.logger.error('No result passed to Star Rating component.');\r\n      return;\r\n    }\r\n    this.renderComponent();\r\n  }\r\n\r\n  private get configuredFieldsAreValid(): boolean {\r\n    const rawRating = Utils.getFieldValue(this.result, <string>this.options.ratingField);\r\n    const rawNumberOfRatings = Utils.getFieldValue(this.result, <string>this.options.numberOfRatingsField);\r\n\r\n    if (rawNumberOfRatings !== undefined) {\r\n      this.numberOfRatings = Number(rawNumberOfRatings) < 0 ? 0 : Number(rawNumberOfRatings) || 0;\r\n    }\r\n\r\n    this.rating = Number(rawRating) < 0 ? 0 : Number(rawRating) || 0;\r\n    const scale = this.options.ratingScale;\r\n\r\n    if (scale < this.rating || scale <= 0) {\r\n      this.logger.error(`The rating scale property is either missing or invalid.`);\r\n      return false;\r\n    }\r\n\r\n    this.rating = Math.round(this.rating * (DEFAULT_SCALE / scale));\r\n    return true;\r\n  }\r\n\r\n  private renderComponent() {\r\n    if (this.configuredFieldsAreValid) {\r\n      this.makeAccessible();\r\n      for (let starNumber = 1; starNumber <= DEFAULT_SCALE; starNumber++) {\r\n        this.renderStar(starNumber <= this.rating);\r\n      }\r\n      if (this.numberOfRatings !== undefined) {\r\n        this.renderNumberOfReviews(this.numberOfRatings);\r\n      }\r\n    }\r\n  }\r\n\r\n  private makeAccessible() {\r\n    this.setDefaultTabIndex();\r\n    this.element.setAttribute('aria-label', this.getAriaLabel());\r\n  }\r\n\r\n  private setDefaultTabIndex() {\r\n    if (Utils.isNullOrUndefined(this.element.getAttribute('tabindex'))) {\r\n      this.element.tabIndex = 0;\r\n    }\r\n  }\r\n\r\n  private getAriaLabel() {\r\n    const numberOfRatingsIsKnown = !Utils.isNullOrUndefined(this.numberOfRatings);\r\n    const wasRated = !!this.numberOfRatings;\r\n    if (numberOfRatingsIsKnown && !wasRated) {\r\n      return l('NoRatings');\r\n    }\r\n    const label = l('Rated', this.rating, this.options.ratingScale, this.options.ratingScale);\r\n    if (numberOfRatingsIsKnown) {\r\n      return label + ' ' + l('RatedBy', this.numberOfRatings, this.numberOfRatings);\r\n    }\r\n    return label;\r\n  }\r\n\r\n  private renderStar(isChecked: boolean) {\r\n    const star = $$('span', { className: 'coveo-star-rating-star' }, SVGIcons.icons.star);\r\n    star.toggleClass('coveo-star-rating-star-active', isChecked);\r\n    this.element.appendChild(star.el);\r\n  }\r\n\r\n  private renderNumberOfReviews(value: number) {\r\n    const numberString = $$('span', { className: 'coveo-star-rating-label' });\r\n    numberString.text(value > 0 ? `(${value})` : l('NoRatings'));\r\n    this.element.appendChild(numberString.el);\r\n  }\r\n}\r\n\r\nInitialization.registerAutoCreateComponent(StarRating);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/StarRating/StarRating.ts"],"sourceRoot":""}
webpackJsonpCoveo__temporary([47],{129:function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(6),o=i(320),s=i(7),l=i(4),u=i(5),d=i(10),a=i(1),p=i(2),c=i(45),h=i(0),f=i(3),g=function(t){function e(i,n,r){var o=t.call(this,i,e.ID,r)||this;return o.element=i,o.options=n,o.options=s.ComponentOptions.initComponentOptions(i,e,n),u.Assert.check(l.Utils.isCoveoField(o.options.field),o.options.field+" is not a valid field"),u.Assert.exists(o.options.maximumExpandedResults),o.swapParentChildFoldingFields(),o.bind.onRootElement(d.QueryEvents.buildingQuery,o.handleBuildingQuery),o.bind.onRootElement(d.QueryEvents.preprocessResults,o.handlepreprocessResults),o}return n(e,t),e.foldWithParent=function(t){var i={score:Number.NEGATIVE_INFINITY,children:[],result:{raw:!1}};h.each(t,function(t,n){var r=e.findUniqueId(i.children,t.uniqueId);if(null==t.parentResult||t.parentResult.uniqueId==t.uniqueId)null==r&&(r={result:t,score:n,children:[]},i.children.push(r),r.parent=i);else{null!=r?(r.score=Math.min(n,r.score),r.parent.children=h.without(r.parent.children,r)):r={result:t,score:n,children:[]};var o=e.findUniqueId(i.children,t.parentResult.uniqueId);null==o&&(o={result:t.parentResult,score:Number.POSITIVE_INFINITY,children:[]},i.children.push(o),o.parent=i),o.children.push(r),r.parent=o;for(var s=o;null!=s&&r.score<s.score;)s.score=r.score,s=s.parent}});var n=e.resultNodeToQueryResult(i);return h.each(n.attachments,function(t){return t.parentResult=null}),n.attachments},e.defaultGetResult=function(t){var i=t.childResults||[];i.unshift(t),t.childResults=[],i=e.foldWithParent(i);var n=i.shift();return n.childResults=i,n},e.defaultGetMoreResults=function(t){return e.foldWithParent(t)},e.resultNodeToQueryResult=function(t){var i=t.result;return i.attachments=h.map(h.sortBy(t.children,"score"),e.resultNodeToQueryResult),i.parentResult=null!=t.parent?t.parent.result:null,i},e.findUniqueId=function(t,i){for(var n=0;n<t.length;n++){if(t[n].result.uniqueId==i)return t[n];var r=e.findUniqueId(t[n].children,i);if(null!=r)return r}return null},e.prototype.swapParentChildFoldingFields=function(){null!=this.options.childField&&(this.logger.warn('Detecting usage of deprecated option "childField". Assigning it automatically to the "parent" option instead.'),this.logger.warn("The option definition was changed to support universal folding across all sources."),this.logger.warn('To remove this warning, rename the "childField" option (data-child-field) to "parent" (data-parent).'),this.options.parent=this.options.childField),null!=this.options.parentField&&(this.logger.warn('Detecting usage of deprecated option "parentField". Assigning it automatically to the "child" option instead.'),this.logger.warn("The option definition was changed to support universal folding across all sources."),this.logger.warn('To remove this warning, rename the "parentField" option (data-parent-field) to "child" (data-child).'),this.options.child=this.options.parentField)},e.prototype.handleBuildingQuery=function(t){u.Assert.exists(t),this.disabled||(t.queryBuilder.childField=this.options.parent,t.queryBuilder.parentField=this.options.child,t.queryBuilder.filterField=this.options.field,t.queryBuilder.filterFieldRange=this.options.range,t.queryBuilder.requiredFields.push(this.options.field),null!=this.options.parent&&t.queryBuilder.requiredFields.push(this.options.parent),null!=this.options.child&&t.queryBuilder.requiredFields.push(this.options.child))},e.prototype.handlepreprocessResults=function(t){u.Assert.exists(t),u.Assert.check(!t.results._folded,"Two or more Folding components are active at the same time for the same Tab. Cannot process the results."),t.results._folded=!0;var i=t.results,n=this.options.getResult||e.defaultGetResult;i.results=h.map(i.results,n),this.addLoadMoreHandler(i.results,t.query)},e.prototype.addLoadMoreHandler=function(t,e){var i=this;return h.map(t,function(t){return i.options.enableExpand&&!l.Utils.isNullOrUndefined(l.Utils.getFieldValue(t,i.options.field))&&(t.moreResults=function(){return i.moreResults(t,e)}),t})},e.prototype.moreResults=function(t,e){var i=this,n=h.clone(e),r=new c.QueryBuilder;n.numberOfResults=this.options.maximumExpandedResults;var o=l.Utils.getFieldValue(t,this.options.field);return l.Utils.isNonEmptyString(o)&&(r.advancedExpression.addFieldExpression(this.options.field,"=",[o]),n.aq=r.build().aq),l.Utils.isNonEmptyString(e.q)&&(e.enableQuerySyntax?n.q="( "+e.q+" ) OR @uri":(n.enableQuerySyntax=!0,n.q="( <@- "+e.q+" -@> ) OR @uri")),l.Utils.isNonEmptyString(this.options.expandExpression)&&(n.cq=this.options.expandExpression),null!=this.options.child&&(n.parentField=this.options.child),null!=this.options.parent&&(n.childField=this.options.parent),n.filterField=null,n.filterFieldRange=null,n.firstResult=0,this.options.rearrange?(this.options.rearrange.putInQueryBuilder(r),n.sortCriteria=r.sortCriteria,n.sortField=r.sortField):(n.sortCriteria=e.sortCriteria,n.sortField=e.sortField),this.queryController.getEndpoint().search(n).then(function(t){return i.handlePreprocessMoreResults(t),t.results})},e.prototype.handlePreprocessMoreResults=function(t){var i=this.options.getMoreResults||e.defaultGetMoreResults;t.results=i(t.results),p.$$(this.element).trigger(d.QueryEvents.preprocessMoreResults,{results:t})},e.ID="Folding",e.doExport=function(){f.exportGlobally({Folding:e})},e.options={field:s.ComponentOptions.buildFieldOption({defaultValue:"@foldingcollection"}),child:s.ComponentOptions.buildFieldOption({defaultValue:"@foldingchild"}),parent:s.ComponentOptions.buildFieldOption({defaultValue:"@foldingparent"}),childField:s.ComponentOptions.buildFieldOption({deprecated:"This option is deprecated. Instead, use the data-parent option."}),parentField:s.ComponentOptions.buildFieldOption({deprecated:"This option is deprecated. Instead, use the data-child option."}),range:s.ComponentOptions.buildNumberOption({defaultValue:2,min:0}),rearrange:s.ComponentOptions.buildCustomOption(function(t){return l.Utils.isNonEmptyString(t)?o.SortCriteria.parse(t):null}),enableExpand:s.ComponentOptions.buildBooleanOption({defaultValue:!0}),expandExpression:s.ComponentOptions.buildStringOption({depend:"enableExpand"}),maximumExpandedResults:s.ComponentOptions.buildNumberOption({defaultValue:100,min:1,depend:"enableExpand"}),getResult:s.ComponentOptions.buildCustomOption(function(){return null}),getMoreResults:s.ComponentOptions.buildCustomOption(function(){return null})},e}(r.Component);e.Folding=g,a.Initialization.registerAutoCreateComponent(g)},320:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),r=i(4),o=i(0),s=function(){function t(e,i){void 0===i&&(i=""),this.sort=e,this.direction=i,n.Assert.isNonEmptyString(e),n.Assert.check(o.contains(t.validSorts,e)||t.sortIsField(e)),t.sortNeedsDirection(e)?n.Assert.check(o.contains(t.validDirections,i)):n.Assert.check(""==i)}return t.parse=function(e){n.Assert.isNonEmptyString(e);var i=e.match(/\S+/g);return new t(i[0],i[1])},t.prototype.putInQueryBuilder=function(e){n.Assert.exists(e),t.sortIsField(this.sort)?(e.sortCriteria="field"+this.direction,e.sortField=this.sort):""!=this.direction?e.sortCriteria=this.sort+this.direction:e.sortCriteria=this.sort},t.prototype.getValueFromResult=function(e){return n.Assert.exists(e),t.sortIsField(this.sort)?r.Utils.getFieldValue(e,this.sort):"date"==this.sort?e.raw.date:void n.Assert.fail("Cannot retrieve value: "+this.sort)},t.prototype.toString=function(){return r.Utils.isNonEmptyString(this.direction)?this.sort+" "+this.direction:this.sort},t.prototype.equals=function(t){return n.Assert.exists(t),t.sort==this.sort&&t.direction==this.direction},t.sortIsField=function(t){return"@"==t.charAt(0)},t.sortNeedsDirection=function(e){return o.contains(t.sortsNeedingDirection,e)||t.sortIsField(e)},t.validSorts=["relevancy","date","qre"],t.sortsNeedingDirection=["date"],t.validDirections=["ascending","descending"],t}();e.SortCriteria=s}});
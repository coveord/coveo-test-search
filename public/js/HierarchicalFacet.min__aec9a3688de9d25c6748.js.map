{"version":3,"sources":["HierarchicalFacet.min__aec9a3688de9d25c6748.js","./src/utils/ResultListUtils.ts","./src/ui/Facet/FacetValue.ts","./src/ui/ResponsiveComponents/ResponsiveComponentsUtils.ts","./src/ui/Facet/FacetValueElement.ts","./src/ui/Facet/FacetSearchParameters.ts","./src/utils/DependsOnManager.ts","./src/ui/ResponsiveComponents/ResponsiveFacets.ts","./src/ui/FacetsMobileMode/FacetsMobileMode.ts","./node_modules/popper.js/dist/esm/popper.js","./src/ui/ResultList/ResultListRenderer.ts","./src/ui/ResponsiveComponents/ResponsiveFacetColumn.ts","./src/controllers/FacetQueryController.ts","./src/ui/HierarchicalFacet/HierarchicalFacet.ts","./src/ui/Facet/FacetUtils.ts","./src/ui/Templates/TableTemplate.ts","./src/ui/Templates/DefaultRecommendationTemplate.ts","./src/ui/Templates/TemplateToHtml.ts","./src/ui/Templates/CoreHelpers.ts","./src/rest/AllowedValuesPatternType.ts","./src/ui/Facet/ValueElement.ts","./src/ui/Facet/ValueElementRenderer.ts","./src/ui/Facet/FacetValuesOrder.ts","./src/ui/Facet/FacetSearchElement.ts","./src/ui/Facet/FacetSearchDropdownNavigation/DefaultSearchDropdownNavigator.ts","./src/ui/CategoryFacet/CategoryValueChildrenRenderer.ts","./src/ui/Facet/FacetSettings.ts","./src/ui/Facet/FacetSort.ts","./src/ui/Facet/FacetHeader.ts","./src/utils/EventsUtils.ts","./src/ui/Facet/BreadcrumbValueElement.ts","./src/ui/Facet/BreadcrumbValuesList.ts","./src/ui/Facet/FacetSearch.ts","./src/ui/Facet/FacetSearchValuesList.ts","./src/ui/Facet/FacetValuesList.ts","./src/ui/Facet/OmniboxValueElement.ts","./src/ui/Facet/OmniboxValuesList.ts","./src/ui/ResponsiveComponents/ResponsiveDefaultResultTemplate.ts","./src/ui/ResultList/ResultContainer.ts","./src/ui/ResultList/ResultListCardRenderer.ts","./src/ui/ResultList/ResultListTableRenderer.ts","./src/ui/ResponsiveComponents/ResponsiveDropdown/ResponsiveDropdownModalContent.ts","./src/events/FacetsMobileModeEvents.ts","./src/ui/Facet/FacetSearchUserInputHandler.ts","./src/ui/Facet/FacetSearchDropdownNavigation/SearchDropdownNavigatorFactory.ts","./src/ui/Facet/FacetSearchDropdownNavigation/FacetSearchDropdownNavigator.ts","./src/ui/CategoryFacet/CategoryFacetTemplates.ts","./src/ui/CategoryFacet/CategoryValueRoot.ts","./src/ui/CategoryFacet/CategoryValue.ts","./src/controllers/CategoryFacetQueryController.ts","./src/ui/CategoryFacet/CategoryFacetSearch.ts","./src/ui/CategoryFacet/CategoryFacetBreadcrumb.ts","./src/ui/CategoryFacet/CategoryFacetDebug.ts","./src/ui/CategoryFacet/CategoryFacetHeader.ts","./src/ui/CategoryFacet/CategoryFacetValuesTree.ts","./src/ui/Facet/FacetValues.ts","./src/ui/HierarchicalFacet/HierarchicalFacetValuesList.ts","./src/controllers/HierarchicalFacetQueryController.ts","./src/ui/HierarchicalFacet/HierarchicalFacetSearchValuesList.ts","./src/ui/HierarchicalFacet/HierarchicalFacetSearchValueElement.ts","./src/ui/HierarchicalFacet/HierarchicalFacetSearch.ts","./src/ui/HierarchicalFacet/HierarchicalBreadcrumbValuesList.ts","./src/ui/HierarchicalFacet/HierarchicalBreadcrumbValueElement.ts","./src/ui/HierarchicalFacet/OmniboxHierarchicalValuesList.ts","./src/ui/HierarchicalFacet/OmniboxHierarchicalValueElement.ts","./src/ui/HierarchicalFacet/HierarchicalFacetValueElement.ts","./src/ui/Facet/Facet.ts","./src/ui/ResponsiveComponents/ResponsiveFacetOptions.ts","./src/ui/ResultList/ResultList.ts","./src/ui/CategoryFacet/CategoryFacet.ts"],"names":["webpackJsonpCoveo__temporary","113","module","exports","__webpack_require__","Object","defineProperty","value","hideIfInfiniteScrollEnabled","cmp","ResultListUtils","isInfiniteScrollEnabled","searchInterface","element","disable","$$","hide","warnIfComponentNotNeeded","enable","unhide","root","resultList","getActiveResultList","options","enableInfiniteScroll","scrollToTop","Logger","this","warn","window","scrollTo","searchInterfacePosition","getBoundingClientRect","top","pageYOffset","resultLists","getResultLists","find","disabled","findAll","cssClass","map","el","Component","get","ResultList","computeCssClassName","allResultListsUseInfiniteScroll","notNeededComponentWarning","filter","length","cmpCssClass","computeCssClassNameForType","type","message","114","selected","excluded","waitingForDelta","reset","updateCountsFromNewValue","newValue","Assert","exists","occurrences","delta","computedField","clone","undefined","cloneWithZeroOccurrences","cloneWithDelta","count","isLargerOrEqualsThan","getFormattedCount","Utils","Globalize","format","getFormattedComputedField","create","isString","FacetValue","createFromValue","isObject","createFromGroupByValue","createFromFieldValue","Error","isNonEmptyString","facetValue","lookupValue","groupByValue","numberOfResults","isNonEmptyArray","computedFieldResults","score","fieldValue","127","shouldDrawFacetSlider","facetSliderElement","ResponsiveDropdownContent","isTargetInsideOpenedDropdown","isSmallFacetActivated","isSmallTabsActivated","hasClass","smallTabsClassName","smallFacetClassName","isSmallRecommendationActivated","smallRecommendationClassName","activateSmallTabs","addClass","deactivateSmallTabs","removeClass","activateSmallFacet","deactivateSmallFacet","activateSmallRecommendation","deactivateSmallRecommendation","ResponsiveComponentsUtils","128","__extends","extendStatics","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","facet","keepDisplayedValueNextTime","_this","bindEvent","displayNextTime","pinFacet","preservePosition","ValueElement","FacetValueElement","169","valueToSearch","alwaysInclude","alwaysExclude","sortCriteria","fetchMore","completeFacetWithStandardValues","nbResults","numberOfValuesInFacetSearch","ignoreAccents","facetSearchIgnoreAccents","setValueToSearch","trim","concat","FacetUtils","getValuesToUseForSearchInFacet","excludeCurrentlyDisplayedValuesInSearch","searchResults","_","each","getCurrentlyShowedValueInSearch","v","expandedValues","expanded","push","getDisplayedFacetValues","getGroupByRequest","lowerCaseAll","typedByUser","allowedValues","compact","lookupField","request","allowedValuesPatternType","useWildcardsInFacetSearch","AllowedValuesPatternType","Wildcards","Legacy","maximumNumberOfValues","field","injectionDepth","computedFields","operation","computedFieldOperation","getQuery","lastQuery","queryController","getLastQuery","QueryBuilder","build","enableQuerySyntax","q","facetQueryController","basicExpressionToUseForFacetSearch","cq","constantExpressionToUseForFacetSearch","aq","advancedExpressionToUseForFacetSearch","enableDidYouMean","firstResult","fieldsToInclude","groupBy","val","getAttribute","text","chain","toLowerCase","uniq","FacetSearchParameters","170","ref","on","QueryEvents","buildingQuery","handleBuildingQuery","getDependsOn","bind","onRootElement","InitializationEvents","afterComponentsInitialization","setupDependentFacet","parentFacetRef","getParentFacet","onQueryState","MODEL_EVENTS","CHANGE","resetIfConditionUnfullfiled","getDependsOnCondition","getId","component","id","dependsOn","conditionOption","dependsOnCondition","isFunction","parentHasSelectedValues","parent","valuesExistForFacetWithId","facetId","values","queryStateModel","QueryStateModel","getFacetId","ComponentsTypes","getAllFacetsFromSearchInterface","enumerable","configurable","allFacetsInInterface","potentialParentFacet","logger","potentialDependentFacet","dependentFacets","forEach","dependentFacet","some","DependsOnManager","171","_super","apply","arguments","init","ResponsiveFacetColumn","ResponsiveFacets","Facet","ID","172","bindings","FacetsMobileMode","ComponentOptions","initComponentOptions","preventScrolling","scrollContainer","findParentScrollLockable","breakpoint","buildNumberOption","isModal","buildBooleanOption","defaultValue","displayOverlayWhileOpen","postProcessing","isNullOrUndefined","buildChildHtmlElementOption","depend","doExport","exportGlobally","Initialization","registerAutoCreateComponent","173","__webpack_exports__","microtaskDebounce","fn","called","Promise","resolve","then","taskDebounce","scheduled","setTimeout","timeoutDuration","functionToCheck","getType","toString","call","getStyleComputedProperty","property","nodeType","css","getComputedStyle","getParentNode","nodeName","parentNode","host","getScrollParent","document","body","ownerDocument","_getStyleComputedProp","overflow","overflowX","test","overflowY","isIE","version","isIE11","isIE10","getOffsetParent","documentElement","noOffsetParent","offsetParent","nextElementSibling","indexOf","isOffsetContainer","firstElementChild","getRoot","node","findCommonOffsetParent","element1","element2","order","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","start","end","range","createRange","setStart","setEnd","commonAncestorContainer","contains","element1root","getScroll","side","upperSide","html","scrollingElement","includeScroll","rect","subtract","scrollTop","scrollLeft","modifier","bottom","left","right","getBordersSize","styles","axis","sideA","sideB","parseFloat","getSize","computedStyle","Math","max","getWindowSizes","height","width","getClientRect","offsets","_extends","e","result","sizes","clientWidth","clientHeight","horizScrollbar","offsetWidth","vertScrollbar","offsetHeight","getOffsetRectRelativeToArbitraryNode","children","fixedPosition","isHTML","childrenRect","parentRect","scrollParent","borderTopWidth","borderLeftWidth","marginTop","marginLeft","getViewportOffsetRectRelativeToArtbitraryNode","excludeScroll","relativeOffset","innerWidth","innerHeight","isFixed","getFixedPositionOffsetParent","parentElement","getBoundaries","popper","reference","padding","boundariesElement","boundaries","boundariesNode","_getWindowSizes","getArea","_ref","computeAutoPlacement","placement","refRect","rects","sortedAreas","keys","key","area","sort","a","filteredAreas","_ref2","computedPlacement","variation","split","getReferenceOffsets","state","getOuterSizes","x","marginBottom","y","marginRight","getOppositePlacement","hash","replace","matched","getPopperOffsets","referenceOffsets","popperRect","popperOffsets","isHoriz","mainSide","secondarySide","measurement","secondaryMeasurement","arr","check","findIndex","prop","cur","match","obj","runModifiers","modifiers","data","ends","slice","console","enabled","update","isDestroyed","instance","arrowStyles","attributes","flipped","positionFixed","flip","originalPlacement","position","isCreated","onUpdate","onCreate","isModifierEnabled","modifierName","name","getSupportedPropertyName","prefixes","upperProp","charAt","toUpperCase","i","prefix","toCheck","style","destroy","removeAttribute","willChange","disableEventListeners","removeOnDestroy","removeChild","getWindow","defaultView","attachToScrollParents","event","callback","scrollParents","isBody","target","addEventListener","passive","setupEventListeners","updateBound","scrollElement","eventsEnabled","enableEventListeners","scheduleUpdate","removeEventListeners","removeEventListener","cancelAnimationFrame","isNumeric","n","isNaN","isFinite","setStyles","unit","setAttributes","setAttribute","applyStyle","arrowElement","applyStyleOnLoad","modifierOptions","computeStyle","legacyGpuAccelerationOption","gpuAcceleration","offsetParentRect","floor","round","prefixedProperty","invertTop","invertLeft","arrow","isModifierRequired","requestingName","requestedName","requesting","isRequired","_requesting","requested","_data$offsets$arrow","querySelector","_data$offsets","isVertical","len","sideCapitalized","altSide","opSide","arrowElementSize","center","popperMarginSide","popperBorderSide","sideValue","min","getOppositeVariation","clockwise","counter","index","validPlacements","reverse","placementOpposite","flipOrder","behavior","BEHAVIORS","FLIP","CLOCKWISE","COUNTERCLOCKWISE","step","refOffsets","overlapsRef","overflowsLeft","overflowsRight","overflowsTop","overflowsBottom","overflowsBoundaries","flippedVariation","flipVariations","keepTogether","toValue","str","parseOffset","offset","basePlacement","useHeight","fragments","frag","divider","search","splitRegex","ops","op","mergeWithPrevious","reduce","index2","preventOverflow","transformProp","popperStyles","transform","priority","primary","escapeWithReference","secondary","shift","shiftvariation","shiftOffsets","bound","inner","subtractLength","isBrowser","longerTimeoutBrowsers","navigator","userAgent","supportsMicroTasks","debounce","MSInputMethodContext","documentMode","classCallCheck","Constructor","TypeError","createClass","defineProperties","props","descriptor","writable","protoProps","staticProps","assign","source","placements","onLoad","Defaults","Popper","requestAnimationFrame","jquery","global","PopperUtils","213","resultListOptions","autoCreateComponentsFn","renderResults","resultElements","append","resultDisplayedCallback","all","getStartFragment","getEndFragment","startFrag","endFrag","resultsFragment","createDocumentFragment","appendChild","resultElement","getResult","resultsContainer","ResultListRenderer","214","coveoRoot","responsiveDropdown","componentsInFacetColumn","preservePositionOriginalValues","SearchInterface","dropdownHeaderLabel","getDropdownHeaderLabel","dropdown","buildDropdown","bindDropdownContentEvents","bindFacetsMobileModeEvents","registerOnCloseHandler","registerQueryEvents","initializeBreakpoint","responsiveBreakpoint","responsiveComponentConstructor","findColumn","ResponsiveComponentsManager","register","column","info","getComponents","facetsMobileModeComponent","registerComponent","accept","needDropdownWrapper","needSmallMode","handleResizeEvent","changeToSmallMode","changeToLargeMode","isOpened","dropdownContent","positionDropdown","dismissFacetSearches","facetSearch","currentlyDisplayedResults","dismissSearchResults","ResponsiveComponents","getMediumScreenWidth","responsiveComponents","getResponsiveMode","close","disableFacetPreservePosition","DROPDOWN_HEADER_WRAPPER_CSS_CLASS","dropdownHeader","restoreFacetPreservePositionValue","cleanUp","buildDropdownContent","buildDropdownHeader","ResponsiveDropdown","dropdownContentElement","filterByContainer","className","filterBy","l","prepend","facetsMobileModeOptions","ResponsiveDropdownModalContent","dropdownHeaderElement","content","ResponsiveDropdownHeader","defaultBreakpoint","facetsMobileModeBreakpoint","noResults","handleNoResults","querySuccess","handleQuerySuccess","queryError","handleQueryError","isFacetSearchScrolledIntoView","positionSearchResults","DEBOUNCE_SCROLL_WAIT","registerOnOpenHandler","trigger","FacetsMobileModeEvents","popupOpened","popupClosed","facetSearchElement","facetTop","facetBottom","dropdownTop","dropdownBottom","getAllFacetInstancesFromElement","DROPDOWN_HEADER_LABEL_DEFAULT_VALUE","results","totalCount","show","215","prepareForNewQuery","lastGroupByRequestIndex","expressionToUseForFacetSearch","computeOurFilterExpression","builder","ExpressionBuilder","getSelected","useAnd","addFieldExpression","getExcluded","addFieldNotEqualExpression","additionalFilter","add","putGroupByIntoQueryBuilder","queryBuilder","createGroupByAllowedValues","groupByRequest","createBasicGroupByRequest","queryOverrideObject","createGroupByQueryOverride","QueryBuilderExpression","isEmpty","parts","computeCompleteExpressionParts","withoutConstant","basic","advanced","constant","queryOverride","advancedQueryOverride","constantQueryOverride","groupByRequests","lastGroupByRequest","params","oldLength","reject","onResult","fieldValues","newLength","checkForFacetSearchValuesToRemove","needAnotherFacetSearch","searchPromise","getEndpoint","currentSearchPromise","queryResults","groupByResults","first","catch","error","numberOfValuesToFetch","pluck","getAll","filterByAllowedValueOption","searchInFacetToUpdateDelta","facetValues","query","customSort","getUnionWithCustomSortLowercase","getAllowedValuesFromSelected","addComputedField","nbOfRequestedValues","numberOfValues","usedValues","enableMoreLess","keepDisplayedValuesNextTime","toCompare","filtered","queryBuilderExpression","queryOverrideIsNeededForMultiSelection","processQueryOverrideForMultiSelection","queryOverrideIsNeededForAdditionalFilter","processQueryOverrideForAdditionalFilter","processQueryOverrideForEmptyValues","hasSelectedOrExcludedValues","mergeWith","ourExpression","computeCompleteExpressionPartsExcept","isEmptyString","expression","addExistingConstantExpressionIfNotEmpty","constantExpression","getFilterExpressionWithoutOurFilterExpression","advancedExpression","getParts","part","currentFacetAdvancedExpression","remove","withoutEmptyValues","valueToCheckAgainst","regex","getRegexToUseForFacetSearch","isAllowed","isValueAllowedByAllowedValueOption","getValueCaption","allowedValue","regexContent","replaceWildcardsWithRegexEquivalent","escapeMostRegexCharacters","RegExp","FacetQueryController","257","__assign","t","s","HierarchicalFacet","shouldReshuffleFacetValuesClientSide","correctLevels","numberOfValuesToShow","originalNumberOfValuesToShow","selectValue","selectChildren","ensureDom","ensureValueHierarchyExists","valueHierarchy","getValueFromHierarchy","selectChilds","childs","flagParentForSelection","selectMultipleValues","child","deselectValue","deselectChildren","activeChilds","valueToCompare","getFacetValueFromHierarchy","hasChildSelected","deselectChilds","deselectParent","unflagParentForSelection","excludeValue","excludeChildren","excludeChilds","unexcludeValue","unexludeChildren","unexcludeChilds","deselectMultipleValues","toggleSelectValue","toggleExcludeValue","stringValue","getSelf","ret","valueCaption","getDisplayedValues","displayed","elem","getElementFromFacetValueList","updateSort","criteria","open","getter","getValueHierarchy","showChilds","keepOpened","hideChilds","getAllValueHierarchy","allChildShouldBeSelected","processFacetSearchAllResultsSelected","triggerNewQuery","triggerUpdateDeltaQuery","updateSearchElement","moreValuesAvailable","facetValueHasChanged","updateQueryStateModel","Defer","defer","updateAppearanceDependingOnState","initFacetQueryController","HierarchicalFacetQueryController","initFacetSearch","HierarchicalFacetSearch","HierarchicalFacetSearchValuesList","handleDeferredQuerySuccess","handlePopulateSearchAlerts","args","HierarchicalBreadcrumbValuesList","buildAsString","handlePopulateBreadcrumb","breadcrumbs","handleOmniboxWithStaticValue","eventArg","completeQueryExpression","existingValue","numberOfValuesInOmnibox","gotAMatch","fromList","getFromFacetValueList","OmniboxHierarchicalValuesList","rows","zIndex","omniboxZIndex","rebuildValueElements","processHierarchy","setValueListContent","buildParentChildRelationship","checkForOrphans","checkForNewUnselectedChild","crop","initFacetValuesList","facetValuesList","HierarchicalFacetValuesList","HierarchicalFacetValueElement","updateMoreLess","topLevelHierarchy","lessIsShown","handleClickMore","size","handleClickLess","updateNumberOfValues","atLeastOneDoesNotExists","partition","hierarchy","numberOfValuesLeft","last","toHide","hideFacetValue","toShow","showFacetValue","placeChildsUnderTheirParent","hierarchyElement","toIterateOver","toIterateOverSorted","sortFacetValues","childFromHierarchy","childElement","insertAfter","addCssClassToParentAndChilds","expandChilds","SVGIcons","icons","facetExpand","collapseChilds","facetCollapse","SVGDom","addClassToSVGInContainer","openAndCloseChilds","fragment","valueContainer","sorted","marginByLevel","level","levelStart","headerElement","hierarchyFacetValues","createHierarchy","valuesToBuildWith","flatHierarchy","getParent","self","getLevel","setInHierarchy","deleteValueHierarchy","getLookupOrValue","isCorrectMinimumLevel","isCorrectMaximumLevel","levelEnd","possibleChild","possibleParent","hierarchyThatAlreadyExists","hierarchyThatAlreadyExistsAtParent","setValueHierarchy","originalPosition","fromHierarchy","lastIndexOfDelimiting","lastIndexOf","delimitingCharacter","substring","indexOfParent","excludeMultipleValues","unexcludeMultipleValues","current","parentInHierarchy","found","childInHierarchy","renderer","listItem","deferExecuteQuery","buildStringOption","ResponsiveFacetOptions","40","ignoreAccent","StringUtils","stringToRegex","getDisplayValueFromValueCaption","returnValue","tryToGetTranslatedCaption","original","pairs","pair","QueryUtils","isStratusAgnosticField","FileTypes","getFileTypeCaptions","month","DateUtils","monthToString","substr","buildFacetSearchPattern","escapeRegexCharacter","join","currentSearchLength","newSearchLength","oldSearchLength","desiredSearchLength","addNoStateCssClassToFacetValues","container","noStates","noState","fallbackOnLocalization","getFileType","caption","getObjectType","isMonthFieldValue","parseInt","asInt","468","defaultTemplate","defaultRoledTemplates","instantiateRoleToString","role","roledTemplate","templates","instantiateToString","instantiateRoleToElement","instantiateToElement","tmpl","Template","layout","getFallbackTemplate","hasTemplateWithRole","TemplateList","TableTemplate","469","object","div","createElement","innerHTML","DefaultRecommendationTemplate","470","__awaiter","thisArg","_arguments","P","generator","fulfilled","next","rejected","done","__generator","verb","f","label","pop","trys","g","sent","throw","return","Symbol","iterator","buildResults","res","resultsPromises","_a","buildResult","idx","resultCurrentlyBeingRendered","sortBy","setStateObjectOnQueryResult","setSearchInterfaceObjectOnQueryResult","createHtmlElement","bindResultToElement","autoCreateComponentsInsideResult","initResult","verifyChildren","automaticallyCreateComponentsInsideResult","resultTemplate","wrapInDiv","checkCondition","currentLayout","TemplateToHtml","471","resolveQueryResult","getComponentRef","quickview","resolveTermsToHighlight","currentQueryResult","termsToHighlight","resolvePhrasesToHighlight","phrasesToHighlight","termsToHighlightAreDefined","exportAllHelpersGlobally","scope","TemplateHelpers","getHelpers","helper","CoreHelpers","registerFieldHelper","javascriptEncode","executeShorten","strAndHoles","StringAndHoles","shortenString","highlights","HighlightUtils","highlightString","holes","registerTemplateHelper","executeShortenPath","shortenPath","executeShortenUri","shortenUri","executeHighlight","executeHighlightStreamText","StreamHighlightUtils","highlightStreamText","opts","mergedOptions","executeHighlightStreamHTML","highlightStreamHTML","numberValue","Number","htmlEncode","dateToString","convertFromJsonDateIfNeeded","timeToString","dateTimeToString","defaultOptions","includeTimeIfThisWeek","optionsToUse","extend","CurrencyUtils","currencyToString","isMilliseconds","TimeSpan","getHHMMSS","companyDomain","me","lengthLimit","truncateName","listOfAddresses","EmailUtils","splitSemicolonSeparatedListOfEmailAddresses","emailAddressesToHyperlinks","isArray","siblings","sibling","href","AnchorUtils","buildAnchor","src","srcTemplate","ImageUtils","buildImage","buildStringTemplateFromResult","alt","endpoint","hasThumbnail","buildImageFromResult","SearchEndpoint","endpoints","icon","createIcon","outerHTML","templatesToLoad","once","defaultTmpl","atLeastOneWasLoaded","toLoad","omit","condition","getHelper","byteMeasure","precision","base","pow","TemplateCache","getTemplate","encodeCarriageReturn","DeviceUtils","isMobileDevice","getDeviceName","472","473","onSelect","onExclude","ValueElementRenderer","eventBindings","omniboxObject","isOmnibox","handleEventForCheckboxChange","handleEventForExcludedValueElement","handleEventForValueElement","select","setCssClassOnListValueElement","unselect","exclude","unexclude","toggleExcludeWithUA","actionCause","analyticsActionCauseList","omniboxFacetUnexclude","facetUnexclude","omniboxFacetExclude","facetExclude","usageAnalytics","logSearchEvent","getAnalyticsFacetMeta","handleSelectValue","omniboxFacetDeselect","facetDeselect","omniboxFacetSelect","facetSelect","handleExcludeClick","handleSelectEventForExcludedValueElement","clickEvent","pinFacetPosition","omniboxCloseEvent","tryDismissSearchResults","stopPropagation","stylishCheckbox","KeyboardUtils","keypressAction","KEYBOARD","SPACEBAR","ENTER","handleExcludeEventForValueElement","excludeAction","preventDefault","excludeIcon","handleSelectEventForValueElement","selectAction","checkbox","closeOmnibox","clear","facetField","facetTitle","title","474","withNo","detach","buildListItem","initAndAppendLabel","initAndAppendExcludeIcon","addAccessibilityAttributesToTargetElement","toggleClass","buildExcludeIcon","isExcluded","ariaLabel","tabindex","ariaPressed","addFocusAndBlurEventListeners","plus","checkboxHookExclusionMore","addAttributesToSVGInContainer","buildValueComputedField","computedFieldFormat","buildValueCheckbox","ariaHidden","pointElementsToDummyForm","buildValueStylishCheckbox","buildValueIcon","getValueIcon","buildValueIconFromSprite","valueIcon","buildValueCaption","buildValueCount","countElement","canHandleEvent","tryToInitAndAppendComputedField","initAndAppendFacetValueLabelWrapper","attachExcludeIconEventHandlers","facetValueLabelWrapper","initAndAppendCheckbox","initAndAppendStylishCheckbox","initAndAppendValueCaption","initAndAppendValueCount","valueCount","accessibleElement","resultCount","475","facetSort","reorderValues","activeSort","usingCustomSort","reorderValuesWithCustomOrder","usingAlphabeticalSort","reorderValuesWithCustomCaption","reorderValuesIfUsingCustomSort","reorderValuesIfUsingAlphabeticalSort","customSortsLowercase","valueIndexPair","equalsCaseInsensitive","customSortDirection","firstValue","secondValue","localeCompare","String","sensitivity","FacetValuesOrder","476","searchBarIsAnimating","triggeredScroll","facetSearchId","uniqueId","facetValueNotFoundId","facetSearchUserInputHandler","FacetSearchUserInputHandler","initSearchResults","handleFacetSearchClear","magnifier","buildMagnifierIcon","wait","buildWaitIcon","hideFacetSearchWaitingAnimation","display","combobox","buildCombobox","input","buildInputElement","handleKeyboardEvent","handleFacetSearchFocus","onInputBlur","detectSearchBarAnimation","initSearchDropdownNavigator","handleScrollEvent","which","ESCAPE","onSearchResultsFocusOut","relatedTarget","isUsingKeyboard","focusedOnSearchResult","focusedOnInput","config","setScrollTrigger","searchDropdownNavigator","SearchDropdownNavigatorFactory","ariaHaspopup","ariaExpanded","showFacetSearchWaitingAnimation","getValueInInputForFacetSearch","EventsUtils","addPrefixedEvent","animationName","removePrefixedEvent","addAriaAttributes","setAsCurrentResult","toSet","currentResult","moveCurrentResultDown","focusNextElement","moveCurrentResultUp","focusPreviousElement","highlightCurrentQueryInSearchResults","getCaptions","appendToSearchResults","setupFacetSearchResultsEvents","emptyAndShowNoResults","empty","ariaSelected","updateAriaLiveWithResults","inputValue","moreValuesToFetch","ariaLiveText","updateAriaLive","focus","displayNewValues","touchDragging","mouseDragging","hideSearchResultsElement","removeAriaAttributes","clearSearchInput","loading","autocapitalize","autocorrect","ariaAutocomplete","handleFacetSearchResultsScroll","setExpandedFacetSearchAccessibilityAttributes","setCollapsedFacetSearchAccessibilityAttributes","FacetSearchElement","477","updateSelectedOption","nextResult","highlightAndShowCurrentResultWithKeyboard","previousResult","previousElementSibling","offsetTop","option","previouslySelectedOption","DefaultSearchDropdownNavigator","478","categoryFacetTemplates","categoryValue","categoryFacet","clearChildren","renderChildren","renderValue","makeSelectable","renderAsParent","isChild","path","categoryValueDescriptor","CategoryValue","listRoot","render","CategoryChildrenValueRenderer","479","sorts","customSortDirectionChange","onDocumentClick","enabledSortsIgnoreRenderBecauseOfPairs","filterDuplicateForRendering","settingsButton","set","settingsPopup","tabIndex","buildSettingsButton","buildSettingsPopup","enabledSorts","sortSection","buildSortSection","enabledSortsAllowDirection","directionSection","buildDirectionSection","enableSettingsFacetState","saveStateSection","buildSaveStateSection","clearStateSection","buildClearStateSection","enableCollapse","hideSection","buildHideSection","showSection","buildShowSection","appendCommon","appendIfNotUndefined","addOnDocumentClickHandler","addOnNukeHandler","loadSavedState","facetStateLocalStorage","load","currentStateIncluded","includedStateAttribute","currentStateExcluded","excludedStateAttribute","currentStateOperator","operatorStateAttribute","isEmptyArray","included","operator","setMultiple","loadedFromSettings","saveState","save","isExpanded","toggle","selectItem","getSortItem","unselectItem","elementToFocus","firstFocusablePopupElement","sortName","sortItems","sortItem","more","hideElementOnMouseEnterLeave","AccessibleButton","withElement","withLabel","withClickAction","handleSettingsButtonClick","withEnterKeyboardAction","mouseLeave","closeTimeout","mouseEnter","clearTimeout","handleKeyboardClose","buildSection","sortSectionIcon","buildIcon","sortSectionItems","buildItems","sortTitle","buildSortSectionItems","elems","enabledSort","buildItem","description","withSelectAction","handleClickSortButton","closePopupAndUpdateSort","executeQuery","allEnabledSortsWithPossibleDirectionToggle","facetSortDescription","directionToggle","possibleDirectionToggle","findWhere","relatedSort","directionAscendingSection","buildAscendingOrDescendingSection","iconAscending","ascending","iconDescending","descending","directionItemsAscending","buildAscendingOrDescending","withoutLabelOrTitle","handleDirectionClick","unselectSection","directionDescendingSection","directionItemsDescending","getItems","dropdownMore","saveStateItems","LocalStorageUtils","getFacetOperator","saveStateItem","handleSaveStateClick","dropdownLess","clearStateItems","clearStateItem","handleClearStateClick","hideItems","hideItem","facetHeader","collapseFacet","showItems","showItem","expandFacet","iconClass","svgIcon","direction","escape","section","FacetSettings","availableSorts","activateDirectionSection","disableDirectionSection","item","facetClearAll","nuke","handleNuke","getCurrentDirectionItem","j","toAppend","FacetSort","480","sortToActivate","newSortToEnable","removeEnabledSortsBasedOnFacetType","Coveo","FacetRange","alphaascending","alphadescending","computedfieldascending","computedfielddescending","chisquare","nosort","custom","481","titleSection","iconElement","buildTitle","waitElement","buildWaitAnimation","settingsSection","eraserElement","buildEraser","operatorElement","buildOperatorToggle","enableTogglingOperator","settingsKlass","settings","sortKlass","switchToAnd","rebuildOperatorToggle","updateOperatorQueryStateModel","switchToOr","collapseElement","expandElement","facetElement","valueToSet","getSelectedValues","getExcludedValues","operatorAttributeId","newElement","replaceWith","cssClassForIcon","visibility","orAnd","handleOperatorClick","facetToggle","facetOperatorBefore","facetOperatorAfter","eraser","mainClear","onEraserClick","facetSlider","FacetHeader","482","pascalCaseEventName","483","listContainer","getBreadcrumbTooltip","tooltipParts","buildElements","buildContainer","buildClear","buildCaption","buildListContainer","labelString","breadcrumbFacet","focusOnContainer","breadcrumb","BreadcrumbValueElement","484","breadcrumbValueElementKlass","setExpandedAndCollapsed","buildExpanded","collapsed","buildCollapsed","elementBreadcrumb","numberOfSelected","numberOfExcluded","nMoreElement","nMoreContainer","collapsedBreadcrumbs","toolTip","withTitle","numberOfValuesInBreadcrumb","rest","BreadcrumbValueList","485","facetSearchValuesListKlass","lastSearchWasEmpty","onResize","shouldPositionSearchResults","handleClickElsewhere","buildBaseSearch","fetchMoreValues","triggerNewFacetSearch","buildParamsForFetchingMore","cancelAnyPendingSearchOperation","unfadeInactiveValuesInMainList","facetSearchPromise","logCustomEvent","debug","processNewFacetSearchResults","searchResultsElement","keyboardEventDefaultHandler","highlightCurrentQueryWithinSearchResults","inputIsEmpty","buildParamsForNormalSearch","keyboardNavigationEnterPressed","shiftKey","performActionOnCurrentSearchResult","is","selectAllValuesMatchingSearch","keyboardNavigationDeletePressed","performExcludeActionOnCurrentSearchResult","buildParamsForExcludingCurrentlyDisplayedValues","facetSearchTimeout","facetSearchDelay","ariaLive","updateText","showOrHideClearElement","facetSearchParameters","fadeInactiveValuesInMainList","rebuildSearchResults","showSearchResultsElement","makeFirstSearchResultTheCurrentOne","appendSelectAllResultsButton","listElement","selectAll","wildcardsToRegex","getSelectables","click","checked","showWaitingAnimation","searchParameters","ModalBox","FacetSearch","486","facetValueElementKlass","valueAlreadyInFacet","valueElement","FacetSearchValuesList","487","valueList","currentlyDisplayed","getAllCurrentlyDisplayed","toArray","getAllFacetValue","anyTypeToString","ensureFacetValueIsInList","unExclude","toggleSelect","toggleExclude","rebuild","allValues","getValuesToBuildWith","docFragment","list","facetValueShouldBeRemoved","valueListElement","FacetValuesList","488","OmniboxValueElement","489","omniboxValueElementKlass","buildOmniboxForOneRow","buildFinalOmniboxElement","selectCallback","cause","logAnalyticsEvent","excludeCallback","omniboxValueElement","omniboxRowContent","word","highlightOmniboxMatch","omniboxRow","header","buildOmniboxHeader","r","orignalStr","firstChar","lastChar","strippedFacetValues","suggestions","suggestionRanking","OmniboxValuesList","527","528","529","530","currentMode","trace","ResponsiveDefaultResultTemplate","lastResults","getLastResults","elements","getSmallScreenWidth","531","resultContainer","resultContainerElement","detachComponentsInside","classToAdd","hideChildren","getResultElements","ResultContainer","532","needToBeRemoved","toRemove","times","ResultListCardRenderer","533","shouldDisplayHeader","shouldDisplayFooter","renderRoledTemplate","ResultListTableRenderer","535","536","componentName","closeButtonLabel","shouldHide","classList","DEFAULT_CSS_CLASS_NAME","hidden","ensureCloseButton","ensureFocusTrap","hideDropdown","removeCloseButton","removeFocusTrap","closeButton","focusTrap","FocusTrap","focusableSelector","537","538","540","541","542","543","544","DELETE","DOWN_ARROW","UP_ARROW","elementHeight","scrollHeight","545","facetType","FacetSearchDropdownNavigator","CategoryFacet","546","defaultDropdownNavigator","dom","toggleCanExcludeCurrentResult","willExcludeCurrentResult","announceCurrentResultCanBeExcluded","moveResultUp","isCurrentResultNotAFacetValue","547","collapseArrow","arrowDown","buildListRoot","buildListElement","createListElement","firstChild","buildAllCategoriesButton","allCategoriesCaption","buildCollapseArrow","buildEllipsis","ellipsisCaption","CategoryFacetTemplates","548","categoryChildrenValueRenderer","appendListRoot","CategoryValueRoot","549","isActive","captionedValueDescriptorValue","pastMaximumDepth","getDescriptor","countLabel","showCollapseArrow","getCaption","categoryFacetSelect","changeActivePath","basePath","maximumDepth","550","putCategoryFacetInQueryBuilder","positionInQuery","categoryFacets","addQueryFilter","addCategoryFacetRequest","searchFacetValues","sortByNumberOfResultsThenPathLength","getAllowedValuesPattern","splice","firstGroupByValue","secondGroupByValue","addDebugGroupBy","Regex","shouldAddFilterToQuery","arrayEqual","categoryFacetsRequest","delimiter","CategoryFacetQueryController","551","552","displayButton","getDisplayNewValuesFunction","numberOfResultsInFacetSearch","searchResultsElements","buildButton","buildfacetSearchPlaceholder","removeNoResultsCssClasses","selectCurrentResult","currentResultPathData","dataset","closestContainer","closest","isSelfContainer","placeholder","categoryFacetValues","categoryFacetQueryController","noFacetSearchResults","setFacetSearchResults","searchResult","buildFacetSearchValue","categoryFacetValue","pathParents","number","pathParentsCaption","pathToValueCaption","firstRow","secondRow","categoryFacetSearch","categoryFacetId","categoryFacetField","categoryFacetTitle","CategoryFacetSearch","553","554","onClickHandler","pathToRender","without","captionLabel","pathPart","breadcrumbTitle","valuesContainer","CategoryFacetBreadcrumb","555","firstPositionInQuery","activePath","addGroupByForEmptyPath","addGroupByForEachPathElement","groupByResult","CategoryFacetDebug","analyzeResults","pathElement","treeRoot","Map","orphans","paths","buildPathsFromGroupByValues","addFirstNodeToTree","pathIsValid","parentsOnly","currentNode","processOrphan","addValidNodeToTree","formattedOrphan","556","WAIT_ELEMENT_CLASS","onClearClick","CategoryFacetHeader","557","seenValues","getValueForLastPartInPath","nullCategoryFacetValue","nodesToSearch","findNodeWithValue","storeNewValues","categoryFacetResult","currentNodes","parentValues","newNode","nodes","CategoryFacetValuesTree","558","559","at","isSmallerThan","hasSelectedAndExcludedValues","hasOnlyExcludedValues","hasOnlySelectedValues","importActiveValuesFromOtherList","other","otherValue","myValue","updateCountsFromNewValues","newValues","updateDeltaWithFilteredFacetValues","isMultiValueField","unfilteredValue","filteredValue","mergeWithUnfilteredFacetValues","unfiltered","facetValuesOrder","sortValuesDependingOnStatus","numOfDisplayedValues","ensureExcludedValuesAreDisplayed","nbExclude","excludedValues","FacetValues","621","sortArray","second","firstInTopLevel","secondInTopLevel","compared","firstFromHierarchy","secondFromHierarchy","622","toExclude","623","HierarchicalFacetSearchValueElement","624","_handleSelectValue","_handleExcludeClick","625","getFacetValues","createFacetValuesFromHierarchy","flatten","childHierarchy","626","HierarchicalBreadcrumbValueElement","separator","627","628","OmniboxHierarchicalValueElement","629","630","631","69","facetClassId","currentPage","firstQuery","isFieldValueCompatible","canFetchMore","showingWaitAnimation","listenToQueryStateChange","omniboxIndex","checkForComputedFieldAndSort","checkForValueCaptionType","checkForCustomSort","initDependsOnManager","initQueryEvents","initQueryStateEvents","initComponentStateEvents","initOmniboxEvents","initBreadCrumbEvents","initSearchAlertEvents","oneRootElement","searchContainer","isCurrentlyDisplayed","isVisible","createDom","initBottomAndTopSpacer","buildFacetContent","facetSettings","loadOnce","newQuery","hasSelectedValue","facetUpdateSort","delay","hideWaitingAnimation","valuesForAnalytics","valuesThatStays","difference","facetSelectAll","pinnedViewportPosition","fv","valueFromList","getCaptionForStringValue","showMore","pageSize","nbAvailableValues","triggerMoreQuery","showLess","lessElement","moreElement","logAnalyticsFacetShowMoreLess","facetShowLess","collapse","expand","beforeExecuteQuery","ignoreWarningSearchEvent","lastGroupByResult","processNewGroupByResults","updateValues","selectedValues","lineThrough","isAnyValueCurrentlyDisplayed","duringQuery","handleDuringQuery","doneBuildingQuery","handleDoneBuildingQuery","deferredQuerySuccess","includedAttributeId","excludedAttributeId","lookupValueAttributeId","getFacetLookupValue","registerNewAttribute","handleQueryStateChanged","componentStateId","componentStateModel","includeInOmnibox","OmniboxEvents","populateOmnibox","handlePopulateOmnibox","includeInBreadcrumb","BreadcrumbEvents","populateBreadcrumb","clearBreadcrumb","handleClearBreadcrumb","SearchAlertsEvents","searchAlertsPopulateMessage","displayedValue","newFacetValues","ensurePinnedFacetHasntMoved","updateExcludedQueryStateModel","updateIncludedQueryStateModel","updateLookupValueQueryStateModel","shouldRenderMoreLess","shouldRenderFacetSearch","toggleSearchMenu","lessElementIsShown","getMinimumNumberOfValuesToDisplay","footerElement","searchButton","enableFacetSearch","unshift","facetInfo","dependsOnManager","dependsOnUpdateParentDisplayValue","masterFacetComponent","bottomSpace","paddingContainer","topSpace","unpinFacetPosition","pinnedTopSpace","pinnedBottomSpace","insertBefore","handleQueryStateChangedOperator","handleQueryStateChangedIncluded","includedChanged","toUnSelect","handleQueryStateChangedExcluded","excludedChanged","toUnExclude","handleLookupvalueChanged","lookupFieldChanged","lookupvalue","decodeURIComponent","trimValuesFromModel","queryStateAttributes","lookupValueChanged","isNullOrEmptyString","ensureCreatedQueryBuilder","handleOmniboxWithSearchInFacet","promise","deferred","consolidateAndSortNewFacetValues","optionsToSortFacetValues","buildHeader","buildMore","buildLess","buildFooter","headerIcon","enableClearElement","enableCollapseElement","enableSettings","built","shouldFacetUnpin","unpinnedViewportPosition","isFacetPinned","currentViewportPosition","Window","Win","scrollY","svgContainer","arrowUp","less","facetShowMore","cleanupDeltaValuesForMultiValueField","minValue","debugInfo","buildLocalizedStringOption","localizedString","buildFieldOption","required","groupByField","deprecated","modified","buildListOption","showIcon","alias","defaultFunction","computedFieldCaption","buildSelectorOption","standardColumn","buildQueryExpressionOption","buildCustomOption","buildJsonOption","82","enableResponsiveMode","90","elementClassId","reachedTheEndOfResults","disableLayoutChange","successiveScrollCount","infiniteScrollContainer","showOrHideElementsDependingOnState","addListeners","initResultContainer","initWaitAnimationContainer","waitAnimationContainer","setupTemplatesVersusLayouts","ResultLayoutEvents","populateResultLayout","layouts","setupRenderer","makeElementFocusable","ensureHasId","getDefaultTemplate","template","loadTemplatesFromCache","DefaultResultTemplate","pageTemplateNames","getResultListTemplateNames","templateName","handleNewQuery","ResultListEvents","changeLayout","handleChangeLayout","addInfiniteScrollListeners","addPagerListeners","handleScrollOfResultList","scrollToTopIfEnabled","CHANGE_ONE","QUERY_STATE_ATTRIBUTES","FIRST","getAutoSelectedFieldsToInclude","getFields","getMinimalFieldsToInclude","unique","layoutClassToAdd","triggerNewResultDisplayed","triggerNewResultsDisplayed","templateToHtml","displayMoreResults","isCurrentlyFetchingMoreResults","hasPotentiallyMoreResultsToDisplay","enableInfiniteScrollWaitingAnimation","showWaitingAnimationForInfiniteScrolling","fetchAndRenderMoreResults","templateToHtmlArgs","getDisplayedResults","getDisplayedResultsElements","resultLayoutSelectors","enableBasedOnActiveLayouts","otherLayoutsStillActive","otherResultLists","otherResultList","resultLayoutSelector","disableLayouts","newResultDisplayed","newResultsDisplayed","e_1","fetchingMoreResults","pagerScrolling","renderNewResults","resetStateAfterFetchingMoreResults","_b","hideWaitingAnimationForInfiniteScrolling","MAX_AMOUNT_OF_SUCESSIVE_REQUESTS","cancelFetchingMoreResultsIfNeeded","mobileScrollContainer","isScrollingOfResultListAlmostAtTheBottom","infiniteScrollPageSize","enableScrollToTop","allResultLists","addFieldsToInclude","autoSelectFieldsToInclude","otherFields","addRequiredFields","includeRequiredFields","InitializationPlaceholder","withVisibleRootElement","withPlaceholderForResultList","isWindow","isScrollAtBottomForWindowElement","isScrollAtBottomForHtmlElement","win","windowHeight","Doc","hasQuery","hasResults","showIfQuery","showIfNoQuery","showIfResults","showIfNoResults","waitAnimation","DomUtils","getBasicLoadingAnimation","spinner","getLoadingSpinner","previousSpinnerContainer","previousSpinner","spinnerContainer","spinners","containers","elemType","initResultContainerAddToDom","initParameters","originalOptionsObject","automaticallyCreateComponentsInside","activeLayouts","activeLayout","activeLayoutKey","enableLayouts","TemplateComponentOptions","buildTemplateOption","findParentScrolling","buildFieldsOption","includeInResults","91","numberOfChildValuesCurrentlyDisplayed","categoryValueRoot","categoryFacetValuesTree","tryToInitFacetSearch","addFading","handlePopulateBreadCrumb","buildFacetHeader","queryStateAttribute","newPath","isFacetSearchAvailable","logDisabledFacetSearchWarning","displaySearchButton","isEnableFacetSearchFalsy","valueCaptionAttributeName","getOptionAttributeName","enableFacetSearchAttributeName","optionName","attrNameFromName","areValueCaptionsSpecified","valueCaptions","updateAppearance","isCategoryEmpty","notImplementedError","numberOfRequestedValues","notImplemented","renderValues","displaySearchOnTop","moreLessContainer","renderMoreLess","isPristine","reload","categoryFacetReload","getVisibleParentValues","getVisibleParentCategoryValues","currentParentvalue","getAvailableValues","activeCategoryValue","deselectCurrentValue","resetPath","categoryFacetClear","debugValue","eventName","categoryFacetPath","pathOfLastTruncatedParentValue","sortedParentValues","sortParentValues","currentParentValue","needToTruncate","numberOfItemsInFirstSlice","NUMBER_OF_VALUES_TO_KEEP_AFTER_TRUNCATING","numberOfItemsInSecondSlice","ceil","hideBasePathInParentValues","shouldTruncate","findPathOfLastTruncatedParentValue","addAllCategoriesButton","addEllipsis","childrenValuesToRender","MAXIMUM_NUMBER_OF_VALUES_BEFORE_TRUNCATING","indexOfLastTruncatedParentValue","parentValue","allCategories","dependsOnReset","removeFading","sortedParentvalues","this_1","state_1","buildLessButton","buildMoreButton","lastParentValue","resetFacet","categoryFacetBreadcrumbBuilder","MAX_VALUE"],"mappings":"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","file":"HierarchicalFacet.min__aec9a3688de9d25c6748.js","sourcesContent":["webpackJsonpCoveo__temporary([4,1,17,84],{\n\n/***/ 113:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar ResultList_1 = __webpack_require__(90);\nvar Dom_1 = __webpack_require__(1);\nvar underscore_1 = __webpack_require__(0);\nvar Logger_1 = __webpack_require__(9);\nvar ResultListUtils = /** @class */ (function () {\n    function ResultListUtils() {\n    }\n    ResultListUtils.hideIfInfiniteScrollEnabled = function (cmp) {\n        var infiniteScrollEnabled = ResultListUtils.isInfiniteScrollEnabled(cmp.searchInterface.element);\n        if (infiniteScrollEnabled) {\n            cmp.disable();\n            Dom_1.$$(cmp.element).hide();\n            ResultListUtils.warnIfComponentNotNeeded(cmp);\n        }\n        else {\n            cmp.enable();\n            Dom_1.$$(cmp.element).unhide();\n        }\n    };\n    ResultListUtils.isInfiniteScrollEnabled = function (root) {\n        var resultList = ResultListUtils.getActiveResultList(root);\n        return resultList ? !!resultList.options.enableInfiniteScroll : false;\n    };\n    ResultListUtils.scrollToTop = function (root) {\n        var resultList = ResultListUtils.getActiveResultList(root);\n        if (!resultList) {\n            new Logger_1.Logger(this).warn('No active ResultList, scrolling to the top of the Window');\n            return window.scrollTo(0, 0);\n        }\n        var searchInterfacePosition = resultList.searchInterface.element.getBoundingClientRect().top;\n        if (searchInterfacePosition > 0) {\n            return;\n        }\n        window.scrollTo(0, window.pageYOffset + searchInterfacePosition);\n    };\n    ResultListUtils.getActiveResultList = function (root) {\n        var resultLists = ResultListUtils.getResultLists(root);\n        return underscore_1.find(resultLists, function (resultList) { return !resultList.disabled; });\n    };\n    ResultListUtils.getResultLists = function (root) {\n        return Dom_1.$$(root)\n            .findAll(\".\" + ResultListUtils.cssClass())\n            .map(function (el) { return Component_1.Component.get(el, ResultList_1.ResultList); });\n    };\n    ResultListUtils.cssClass = function () {\n        return Component_1.Component.computeCssClassName(ResultList_1.ResultList);\n    };\n    ResultListUtils.warnIfComponentNotNeeded = function (cmp) {\n        var root = cmp.searchInterface.root;\n        var allListsUseInfiniteScroll = ResultListUtils.allResultListsUseInfiniteScroll(root);\n        allListsUseInfiniteScroll && ResultListUtils.notNeededComponentWarning(cmp);\n    };\n    ResultListUtils.allResultListsUseInfiniteScroll = function (root) {\n        var listsWithInfiniteScrollDisabled = ResultListUtils.getResultLists(root).filter(function (resultList) { return !resultList.options.enableInfiniteScroll; });\n        return listsWithInfiniteScrollDisabled.length === 0;\n    };\n    ResultListUtils.notNeededComponentWarning = function (cmp) {\n        var cmpCssClass = Component_1.Component.computeCssClassNameForType(cmp.type);\n        var message = \"The \" + cmpCssClass + \" component is not needed because all \" + ResultListUtils.cssClass() + \" components have enableInfiniteScroll set to 'true'.\\n    For the best performance, remove the \" + cmpCssClass + \" component from your search page.\";\n        new Logger_1.Logger(cmp).warn(message);\n    };\n    return ResultListUtils;\n}());\nexports.ResultListUtils = ResultListUtils;\n\n\n/***/ }),\n\n/***/ 114:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Assert_1 = __webpack_require__(5);\nvar Utils_1 = __webpack_require__(4);\nvar Globalize = __webpack_require__(23);\nvar underscore_1 = __webpack_require__(0);\n/**\n * A class which holds information and operation available on a single facet value returned by a {@link IGroupByRequest}.<br/>\n * This class is used extensively in the {@link Facet} component.\n */\nvar FacetValue = /** @class */ (function () {\n    function FacetValue() {\n        this.selected = false;\n        this.excluded = false;\n        this.waitingForDelta = false;\n    }\n    FacetValue.prototype.reset = function () {\n        this.selected = false;\n        this.excluded = false;\n    };\n    FacetValue.prototype.updateCountsFromNewValue = function (newValue) {\n        Assert_1.Assert.exists(newValue);\n        this.occurrences = newValue.occurrences;\n        this.delta = newValue.delta;\n        this.computedField = newValue.computedField;\n    };\n    FacetValue.prototype.clone = function () {\n        this.computedField = undefined;\n        this.delta = undefined;\n        return this;\n    };\n    FacetValue.prototype.cloneWithZeroOccurrences = function () {\n        this.occurrences = 0;\n        return this.clone();\n    };\n    FacetValue.prototype.cloneWithDelta = function (count, delta) {\n        Assert_1.Assert.isLargerOrEqualsThan(0, count);\n        var clone = this.cloneWithZeroOccurrences();\n        clone.delta = delta;\n        clone.occurrences = count;\n        return clone;\n    };\n    FacetValue.prototype.getFormattedCount = function () {\n        var count = undefined;\n        if (Utils_1.Utils.exists(this.delta) && this.delta > 0) {\n            count = '+' + Globalize.format(this.delta, 'n0');\n        }\n        else {\n            if (this.occurrences > 0) {\n                count = Globalize.format(this.occurrences, 'n0');\n            }\n        }\n        return count;\n    };\n    FacetValue.prototype.getFormattedComputedField = function (format) {\n        if (this.computedField != 0) {\n            return Globalize.format(this.computedField, format);\n        }\n        else {\n            return undefined;\n        }\n    };\n    FacetValue.create = function (value) {\n        if (underscore_1.isString(value)) {\n            return FacetValue.createFromValue(value);\n        }\n        else if (underscore_1.isObject(value)) {\n            if ('computedFieldResults' in value) {\n                return FacetValue.createFromGroupByValue(value);\n            }\n            else {\n                return FacetValue.createFromFieldValue(value);\n            }\n        }\n        else {\n            throw new Error(\"Can't create value from \" + value);\n        }\n    };\n    FacetValue.createFromValue = function (value) {\n        Assert_1.Assert.isNonEmptyString(value);\n        var facetValue = new FacetValue();\n        facetValue.value = value;\n        facetValue.lookupValue = value;\n        return facetValue;\n    };\n    FacetValue.createFromGroupByValue = function (groupByValue) {\n        Assert_1.Assert.exists(groupByValue);\n        Assert_1.Assert.exists(groupByValue);\n        var facetValue = new FacetValue();\n        facetValue.value = groupByValue.value;\n        facetValue.lookupValue = Utils_1.Utils.exists(groupByValue.lookupValue) ? groupByValue.lookupValue : groupByValue.value;\n        facetValue.occurrences = groupByValue.numberOfResults;\n        facetValue.computedField = Utils_1.Utils.isNonEmptyArray(groupByValue.computedFieldResults) ? groupByValue.computedFieldResults[0] : undefined;\n        facetValue.score = groupByValue.score;\n        return facetValue;\n    };\n    FacetValue.createFromFieldValue = function (fieldValue) {\n        Assert_1.Assert.exists(fieldValue);\n        var facetValue = new FacetValue();\n        facetValue.value = fieldValue.value;\n        facetValue.lookupValue = fieldValue.lookupValue;\n        facetValue.occurrences = fieldValue.numberOfResults;\n        return facetValue;\n    };\n    return FacetValue;\n}());\nexports.FacetValue = FacetValue;\n\n\n/***/ }),\n\n/***/ 127:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveDropdownContent_1 = __webpack_require__(66);\nvar ResponsiveComponentsUtils = /** @class */ (function () {\n    function ResponsiveComponentsUtils() {\n    }\n    ResponsiveComponentsUtils.shouldDrawFacetSlider = function (root, facetSliderElement) {\n        return ResponsiveDropdownContent_1.ResponsiveDropdownContent.isTargetInsideOpenedDropdown(facetSliderElement) || !this.isSmallFacetActivated(root);\n    };\n    ResponsiveComponentsUtils.isSmallTabsActivated = function (root) {\n        return root.hasClass(this.smallTabsClassName);\n    };\n    ResponsiveComponentsUtils.isSmallFacetActivated = function (root) {\n        return root.hasClass(this.smallFacetClassName);\n    };\n    ResponsiveComponentsUtils.isSmallRecommendationActivated = function (root) {\n        return root.hasClass(this.smallRecommendationClassName);\n    };\n    ResponsiveComponentsUtils.activateSmallTabs = function (root) {\n        root.addClass(this.smallTabsClassName);\n    };\n    ResponsiveComponentsUtils.deactivateSmallTabs = function (root) {\n        root.removeClass(this.smallTabsClassName);\n    };\n    ResponsiveComponentsUtils.activateSmallFacet = function (root) {\n        root.addClass(this.smallFacetClassName);\n    };\n    ResponsiveComponentsUtils.deactivateSmallFacet = function (root) {\n        root.removeClass(this.smallFacetClassName);\n    };\n    ResponsiveComponentsUtils.activateSmallRecommendation = function (root) {\n        root.addClass(this.smallRecommendationClassName);\n    };\n    ResponsiveComponentsUtils.deactivateSmallRecommendation = function (root) {\n        root.removeClass(this.smallRecommendationClassName);\n    };\n    ResponsiveComponentsUtils.smallTabsClassName = 'coveo-small-tabs';\n    ResponsiveComponentsUtils.smallFacetClassName = 'coveo-small-facets';\n    ResponsiveComponentsUtils.smallRecommendationClassName = 'coveo-small-recommendation';\n    return ResponsiveComponentsUtils;\n}());\nexports.ResponsiveComponentsUtils = ResponsiveComponentsUtils;\n\n\n/***/ }),\n\n/***/ 128:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"Facet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ValueElement_1 = __webpack_require__(473);\nvar FacetValueElement = /** @class */ (function (_super) {\n    __extends(FacetValueElement, _super);\n    function FacetValueElement(facet, facetValue, keepDisplayedValueNextTime) {\n        var _this = _super.call(this, facet, facetValue) || this;\n        _this.facet = facet;\n        _this.facetValue = facetValue;\n        _this.keepDisplayedValueNextTime = keepDisplayedValueNextTime;\n        return _this;\n    }\n    FacetValueElement.prototype.bindEvent = function () {\n        _super.prototype.bindEvent.call(this, {\n            displayNextTime: this.keepDisplayedValueNextTime,\n            pinFacet: this.facet.options.preservePosition\n        });\n    };\n    return FacetValueElement;\n}(ValueElement_1.ValueElement));\nexports.FacetValueElement = FacetValueElement;\n\n\n/***/ }),\n\n/***/ 169:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"Facet.ts\" />\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Utils_1 = __webpack_require__(4);\nvar FacetUtils_1 = __webpack_require__(40);\nvar QueryBuilder_1 = __webpack_require__(48);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar AllowedValuesPatternType_1 = __webpack_require__(472);\nvar FacetSearchParameters = /** @class */ (function () {\n    function FacetSearchParameters(facet) {\n        this.facet = facet;\n        this.valueToSearch = '';\n        this.alwaysInclude = [];\n        this.alwaysExclude = [];\n        this.sortCriteria = 'occurrences';\n        this.fetchMore = false;\n        this.completeFacetWithStandardValues = true;\n        this.nbResults = facet.options.numberOfValuesInFacetSearch;\n        this.ignoreAccents = facet.options.facetSearchIgnoreAccents;\n    }\n    FacetSearchParameters.prototype.setValueToSearch = function (value) {\n        this.valueToSearch = value;\n        if (Utils_1.Utils.isNonEmptyString(value)) {\n            this.valueToSearch = this.valueToSearch.trim();\n            this.alwaysInclude = this.alwaysInclude.concat(FacetUtils_1.FacetUtils.getValuesToUseForSearchInFacet(this.valueToSearch, this.facet));\n        }\n        return this;\n    };\n    FacetSearchParameters.prototype.excludeCurrentlyDisplayedValuesInSearch = function (searchResults) {\n        var _this = this;\n        _.each(this.getCurrentlyShowedValueInSearch(searchResults), function (v) {\n            var expandedValues = FacetUtils_1.FacetUtils.getValuesToUseForSearchInFacet(v, _this.facet);\n            _.each(expandedValues, function (expanded) {\n                _this.alwaysExclude.push(expanded);\n            });\n        });\n        _.each(this.facet.getDisplayedFacetValues(), function (v) {\n            _this.alwaysExclude.push(v.value);\n        });\n    };\n    FacetSearchParameters.prototype.getGroupByRequest = function () {\n        this.lowerCaseAll();\n        var nbResults = this.nbResults;\n        nbResults += this.alwaysExclude.length;\n        var typedByUser = [];\n        if (this.valueToSearch) {\n            typedByUser = ['*' + this.valueToSearch + '*'];\n        }\n        var allowedValues;\n        if (this.valueToSearch) {\n            allowedValues = typedByUser.concat(this.alwaysInclude).concat(this.alwaysExclude);\n        }\n        else {\n            allowedValues = _.compact(typedByUser.concat(this.alwaysInclude).concat(this.facet.options.allowedValues));\n        }\n        var completeFacetWithStandardValues = this.completeFacetWithStandardValues;\n        if (this.facet.options.lookupField != null) {\n            completeFacetWithStandardValues = false;\n        }\n        var request = {\n            allowedValues: allowedValues,\n            allowedValuesPatternType: this.facet.options.useWildcardsInFacetSearch\n                ? AllowedValuesPatternType_1.AllowedValuesPatternType.Wildcards\n                : AllowedValuesPatternType_1.AllowedValuesPatternType.Legacy,\n            maximumNumberOfValues: nbResults,\n            completeFacetWithStandardValues: completeFacetWithStandardValues,\n            field: this.facet.options.field,\n            sortCriteria: this.facet.options.sortCriteria || this.sortCriteria,\n            injectionDepth: this.facet.options.injectionDepth\n        };\n        if (this.facet.options.lookupField) {\n            request.lookupField = this.facet.options.lookupField;\n        }\n        if (this.facet.options.computedField) {\n            request.computedFields = [\n                {\n                    field: this.facet.options.computedField,\n                    operation: this.facet.options.computedFieldOperation\n                }\n            ];\n        }\n        return request;\n    };\n    FacetSearchParameters.prototype.getQuery = function () {\n        var lastQuery = _.clone(this.facet.queryController.getLastQuery());\n        if (!lastQuery) {\n            // There should normally always be a last query available\n            // If not, just create an empty one.\n            lastQuery = new QueryBuilder_1.QueryBuilder().build();\n        }\n        // We want to always force query syntax to true for a facet search,\n        // but arrange for the basic expression to adapt itself with no syntax block\n        if (lastQuery.enableQuerySyntax) {\n            lastQuery.q = this.facet.facetQueryController.basicExpressionToUseForFacetSearch;\n        }\n        else if (Utils_1.Utils.isNonEmptyString(this.facet.facetQueryController.basicExpressionToUseForFacetSearch)) {\n            lastQuery.q = \"<@- \" + this.facet.facetQueryController.basicExpressionToUseForFacetSearch + \" -@>\";\n        }\n        else {\n            lastQuery.q = '';\n        }\n        lastQuery.enableQuerySyntax = true;\n        lastQuery.cq = this.facet.facetQueryController.constantExpressionToUseForFacetSearch;\n        lastQuery.aq = this.facet.facetQueryController.advancedExpressionToUseForFacetSearch;\n        lastQuery.enableDidYouMean = false;\n        lastQuery.firstResult = 0;\n        lastQuery.numberOfResults = 0;\n        lastQuery.fieldsToInclude = [];\n        lastQuery.groupBy = [this.getGroupByRequest()];\n        return lastQuery;\n    };\n    FacetSearchParameters.prototype.getCurrentlyShowedValueInSearch = function (searchResults) {\n        return _.map(Dom_1.$$(searchResults).findAll('.coveo-facet-value-caption'), function (val) {\n            return Dom_1.$$(val).getAttribute('data-original-value') || Dom_1.$$(val).text();\n        });\n    };\n    FacetSearchParameters.prototype.lowerCaseAll = function () {\n        this.alwaysExclude = _.chain(this.alwaysExclude)\n            .map(function (v) {\n            return v.toLowerCase();\n        })\n            .uniq()\n            .value();\n        this.alwaysInclude = _.chain(this.alwaysInclude)\n            .map(function (v) {\n            return v.toLowerCase();\n        })\n            .uniq()\n            .value();\n    };\n    return FacetSearchParameters;\n}());\nexports.FacetSearchParameters = FacetSearchParameters;\n\n\n/***/ }),\n\n/***/ 170:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar underscore_1 = __webpack_require__(0);\nvar Core_1 = __webpack_require__(19);\nvar Model_1 = __webpack_require__(18);\nvar ComponentsTypes_1 = __webpack_require__(47);\nvar Dom_1 = __webpack_require__(1);\nvar InitializationEvents_1 = __webpack_require__(17);\nvar DependsOnManager = /** @class */ (function () {\n    function DependsOnManager(facet) {\n        var _this = this;\n        this.facet = facet;\n        Dom_1.$$(this.facet.ref.searchInterface.element).on(Core_1.QueryEvents.buildingQuery, function () { return _this.handleBuildingQuery(); });\n        if (this.getDependsOn(this.facet.ref)) {\n            this.facet.ref.bind.onRootElement(InitializationEvents_1.InitializationEvents.afterComponentsInitialization, function () { return _this.setupDependentFacet(); });\n        }\n    }\n    DependsOnManager.prototype.setupDependentFacet = function () {\n        var _this = this;\n        Dom_1.$$(this.facet.ref.element).addClass('coveo-hidden-dependant-facet');\n        this.parentFacetRef = this.getParentFacet(this.facet.ref);\n        if (this.parentFacetRef) {\n            this.facet.ref.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE, undefined, function () { return _this.resetIfConditionUnfullfiled(); });\n        }\n    };\n    DependsOnManager.prototype.resetIfConditionUnfullfiled = function () {\n        var condition = this.getDependsOnCondition(this.facet.ref);\n        if (!condition(this.parentFacetRef)) {\n            this.facet.reset();\n        }\n    };\n    DependsOnManager.prototype.getId = function (component) {\n        var id = component.options.id;\n        return id ? \"\" + id : null;\n    };\n    DependsOnManager.prototype.getDependsOn = function (component) {\n        var dependsOn = component.options.dependsOn;\n        return dependsOn ? \"\" + dependsOn : null;\n    };\n    DependsOnManager.prototype.getDependsOnCondition = function (component) {\n        var _this = this;\n        var conditionOption = component.options.dependsOnCondition;\n        return conditionOption && underscore_1.isFunction(conditionOption) ? conditionOption : function () { return _this.parentHasSelectedValues(component); };\n    };\n    DependsOnManager.prototype.parentHasSelectedValues = function (component) {\n        var parent = this.getParentFacet(component);\n        return parent && this.valuesExistForFacetWithId(this.getId(parent));\n    };\n    DependsOnManager.prototype.valuesExistForFacetWithId = function (facetId) {\n        var values = this.facet.ref.queryStateModel.get(Core_1.QueryStateModel.getFacetId(facetId));\n        return !!values && !!values.length;\n    };\n    Object.defineProperty(DependsOnManager.prototype, \"allFacetsInInterface\", {\n        get: function () {\n            return ComponentsTypes_1.ComponentsTypes.getAllFacetsFromSearchInterface(this.facet.ref.searchInterface);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DependsOnManager.prototype.getParentFacet = function (component) {\n        var _this = this;\n        var parent = this.allFacetsInInterface.filter(function (potentialParentFacet) { return _this.getId(potentialParentFacet) === _this.getDependsOn(component); });\n        if (!parent.length) {\n            component.logger.warn('DependsOn reference does not exist', this.getDependsOn(this.facet.ref));\n            return null;\n        }\n        return parent[0];\n    };\n    Object.defineProperty(DependsOnManager.prototype, \"dependentFacets\", {\n        get: function () {\n            var _this = this;\n            return this.allFacetsInInterface.filter(function (potentialDependentFacet) { return _this.getId(_this.facet.ref) === _this.getDependsOn(potentialDependentFacet); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DependsOnManager.prototype.handleBuildingQuery = function () {\n        var _this = this;\n        this.dependentFacets.forEach(function (dependentFacet) {\n            var condition = _this.getDependsOnCondition(dependentFacet);\n            if (condition(_this.facet.ref)) {\n                Dom_1.$$(dependentFacet.element).removeClass('coveo-hidden-dependant-facet');\n                return dependentFacet.enable();\n            }\n            dependentFacet.disable();\n            Dom_1.$$(dependentFacet.element).addClass('coveo-hidden-dependant-facet');\n        });\n    };\n    Object.defineProperty(DependsOnManager.prototype, \"hasDependentFacets\", {\n        get: function () {\n            return !!this.dependentFacets.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DependsOnManager.prototype, \"dependentFacetsHaveSelectedValues\", {\n        get: function () {\n            var _this = this;\n            return this.dependentFacets.some(function (dependentFacet) { return _this.valuesExistForFacetWithId(_this.getId(dependentFacet)); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return DependsOnManager;\n}());\nexports.DependsOnManager = DependsOnManager;\n\n\n/***/ }),\n\n/***/ 171:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveFacetColumn_1 = __webpack_require__(214);\nvar Facet_1 = __webpack_require__(69);\nvar ResponsiveFacets = /** @class */ (function (_super) {\n    __extends(ResponsiveFacets, _super);\n    function ResponsiveFacets() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ResponsiveFacets.init = function (root, component, options) {\n        ResponsiveFacetColumn_1.ResponsiveFacetColumn.init(ResponsiveFacets, root, component, options, Facet_1.Facet.ID);\n    };\n    return ResponsiveFacets;\n}(ResponsiveFacetColumn_1.ResponsiveFacetColumn));\nexports.ResponsiveFacets = ResponsiveFacets;\n\n\n/***/ }),\n\n/***/ 172:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Core_1 = __webpack_require__(19);\nvar Initialization_1 = __webpack_require__(2);\n/**\n * This component lets you customize the mobile responsive behavior of facets in your search interface.\n *\n * **Notes:**\n * - You can include this component anywhere under the root element of your search interface.\n * - You should only include this component once in your search interface.\n * - If you do not include this component in your search interface, facets will still have a default mobile responsive behavior.\n */\nvar FacetsMobileMode = /** @class */ (function (_super) {\n    __extends(FacetsMobileMode, _super);\n    function FacetsMobileMode(element, options, bindings) {\n        var _this = _super.call(this, element, FacetsMobileMode.ID, bindings) || this;\n        _this.element = element;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, FacetsMobileMode, options);\n        if (_this.options.preventScrolling) {\n            var scrollContainer = _this.options.scrollContainer || _this.searchInterface.element;\n            _this.options.scrollContainer = ComponentOptions_1.ComponentOptions.findParentScrollLockable(scrollContainer);\n        }\n        return _this;\n    }\n    FacetsMobileMode.ID = 'FacetsMobileMode';\n    /**\n     * @componentOptions\n     */\n    FacetsMobileMode.options = {\n        /**\n         * The screen width (in number of pixels) at which facets should enter mobile responsive mode and be collapsed under a single button.\n         *\n         * **Default:** `800`\n         */\n        breakpoint: ComponentOptions_1.ComponentOptions.buildNumberOption(),\n        /**\n         * Whether to display the facets in a modal instead of a pop-up when the end user expands them in mobile responsive mode.\n         */\n        isModal: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\n        /**\n         * Whether to display an overlay behind the facets when the end user expands them in mobile responsive mode.\n         *\n         * By default, the following behavior applies:\n         * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n         * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n         */\n        displayOverlayWhileOpen: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            postProcessing: function (value, options) { return (Core_1.Utils.isNullOrUndefined(value) ? !options.isModal : value); }\n        }),\n        /**\n         * Whether to disable vertical scrolling on the specified or resolved [`scrollContainer`]{@link FacetsMobileMode.options.scrollContainer} while facets are expanded in mobile responsive mode.\n         *\n         * By default, the following behavior applies:\n         * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n         * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n         */\n        preventScrolling: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            postProcessing: function (value, options) { return (Core_1.Utils.isNullOrUndefined(value) ? options.isModal : value); }\n        }),\n        /**\n         * The HTML element whose vertical scrolling should be locked while facets are expanded in mobile responsive mode.\n         *\n         * By default, the component tries to detect and use the first ancestor element whose CSS `overflow-y` attribute is set to `scroll`, starting from the `FacetsMobileMode`'s element itself. If no such element is found, the `document.body` element is used.\n         *\n         * Since this heuristic is not perfect, we strongly recommend that you manually set this option by explicitly specifying the desired CSS selector.\n         *\n         * **Example:** `data-scroll-container-selector='#someCssSelector'`\n         */\n        scrollContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({ depend: 'preventScrolling' })\n    };\n    FacetsMobileMode.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            FacetsMobileMode: FacetsMobileMode\n        });\n    };\n    return FacetsMobileMode;\n}(Component_1.Component));\nexports.FacetsMobileMode = FacetsMobileMode;\nInitialization_1.Initialization.registerAutoCreateComponent(FacetsMobileMode);\n\n\n/***/ }),\n\n/***/ 173:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* WEBPACK VAR INJECTION */(function(global) {/**!\n * @fileOverview Kickass library to create and place poppers near their reference elements.\n * @version 1.14.3\n * @license\n * Copyright (c) 2016 Federico Zivolo and contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\n\nvar longerTimeoutBrowsers = ['Edge', 'Trident', 'Firefox'];\nvar timeoutDuration = 0;\nfor (var i = 0; i < longerTimeoutBrowsers.length; i += 1) {\n  if (isBrowser && navigator.userAgent.indexOf(longerTimeoutBrowsers[i]) >= 0) {\n    timeoutDuration = 1;\n    break;\n  }\n}\n\nfunction microtaskDebounce(fn) {\n  var called = false;\n  return function () {\n    if (called) {\n      return;\n    }\n    called = true;\n    window.Promise.resolve().then(function () {\n      called = false;\n      fn();\n    });\n  };\n}\n\nfunction taskDebounce(fn) {\n  var scheduled = false;\n  return function () {\n    if (!scheduled) {\n      scheduled = true;\n      setTimeout(function () {\n        scheduled = false;\n        fn();\n      }, timeoutDuration);\n    }\n  };\n}\n\nvar supportsMicroTasks = isBrowser && window.Promise;\n\n/**\n* Create a debounced version of a method, that's asynchronously deferred\n* but called in the minimum time possible.\n*\n* @method\n* @memberof Popper.Utils\n* @argument {Function} fn\n* @returns {Function}\n*/\nvar debounce = supportsMicroTasks ? microtaskDebounce : taskDebounce;\n\n/**\n * Check if the given variable is a function\n * @method\n * @memberof Popper.Utils\n * @argument {Any} functionToCheck - variable to check\n * @returns {Boolean} answer to: is a function?\n */\nfunction isFunction(functionToCheck) {\n  var getType = {};\n  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n}\n\n/**\n * Get CSS computed property of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Eement} element\n * @argument {String} property\n */\nfunction getStyleComputedProperty(element, property) {\n  if (element.nodeType !== 1) {\n    return [];\n  }\n  // NOTE: 1 DOM access here\n  var css = getComputedStyle(element, null);\n  return property ? css[property] : css;\n}\n\n/**\n * Returns the parentNode or the host of the element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} parent\n */\nfunction getParentNode(element) {\n  if (element.nodeName === 'HTML') {\n    return element;\n  }\n  return element.parentNode || element.host;\n}\n\n/**\n * Returns the scrolling parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} scroll parent\n */\nfunction getScrollParent(element) {\n  // Return body, `getScroll` will take care to get the correct `scrollTop` from it\n  if (!element) {\n    return document.body;\n  }\n\n  switch (element.nodeName) {\n    case 'HTML':\n    case 'BODY':\n      return element.ownerDocument.body;\n    case '#document':\n      return element.body;\n  }\n\n  // Firefox want us to check `-x` and `-y` variations as well\n\n  var _getStyleComputedProp = getStyleComputedProperty(element),\n      overflow = _getStyleComputedProp.overflow,\n      overflowX = _getStyleComputedProp.overflowX,\n      overflowY = _getStyleComputedProp.overflowY;\n\n  if (/(auto|scroll|overlay)/.test(overflow + overflowY + overflowX)) {\n    return element;\n  }\n\n  return getScrollParent(getParentNode(element));\n}\n\nvar isIE11 = isBrowser && !!(window.MSInputMethodContext && document.documentMode);\nvar isIE10 = isBrowser && /MSIE 10/.test(navigator.userAgent);\n\n/**\n * Determines if the browser is Internet Explorer\n * @method\n * @memberof Popper.Utils\n * @param {Number} version to check\n * @returns {Boolean} isIE\n */\nfunction isIE(version) {\n  if (version === 11) {\n    return isIE11;\n  }\n  if (version === 10) {\n    return isIE10;\n  }\n  return isIE11 || isIE10;\n}\n\n/**\n * Returns the offset parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} offset parent\n */\nfunction getOffsetParent(element) {\n  if (!element) {\n    return document.documentElement;\n  }\n\n  var noOffsetParent = isIE(10) ? document.body : null;\n\n  // NOTE: 1 DOM access here\n  var offsetParent = element.offsetParent;\n  // Skip hidden elements which don't have an offsetParent\n  while (offsetParent === noOffsetParent && element.nextElementSibling) {\n    offsetParent = (element = element.nextElementSibling).offsetParent;\n  }\n\n  var nodeName = offsetParent && offsetParent.nodeName;\n\n  if (!nodeName || nodeName === 'BODY' || nodeName === 'HTML') {\n    return element ? element.ownerDocument.documentElement : document.documentElement;\n  }\n\n  // .offsetParent will return the closest TD or TABLE in case\n  // no offsetParent is present, I hate this job...\n  if (['TD', 'TABLE'].indexOf(offsetParent.nodeName) !== -1 && getStyleComputedProperty(offsetParent, 'position') === 'static') {\n    return getOffsetParent(offsetParent);\n  }\n\n  return offsetParent;\n}\n\nfunction isOffsetContainer(element) {\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY') {\n    return false;\n  }\n  return nodeName === 'HTML' || getOffsetParent(element.firstElementChild) === element;\n}\n\n/**\n * Finds the root node (document, shadowDOM root) of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} node\n * @returns {Element} root node\n */\nfunction getRoot(node) {\n  if (node.parentNode !== null) {\n    return getRoot(node.parentNode);\n  }\n\n  return node;\n}\n\n/**\n * Finds the offset parent common to the two provided nodes\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element1\n * @argument {Element} element2\n * @returns {Element} common offset parent\n */\nfunction findCommonOffsetParent(element1, element2) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element1 || !element1.nodeType || !element2 || !element2.nodeType) {\n    return document.documentElement;\n  }\n\n  // Here we make sure to give as \"start\" the element that comes first in the DOM\n  var order = element1.compareDocumentPosition(element2) & Node.DOCUMENT_POSITION_FOLLOWING;\n  var start = order ? element1 : element2;\n  var end = order ? element2 : element1;\n\n  // Get common ancestor container\n  var range = document.createRange();\n  range.setStart(start, 0);\n  range.setEnd(end, 0);\n  var commonAncestorContainer = range.commonAncestorContainer;\n\n  // Both nodes are inside #document\n\n  if (element1 !== commonAncestorContainer && element2 !== commonAncestorContainer || start.contains(end)) {\n    if (isOffsetContainer(commonAncestorContainer)) {\n      return commonAncestorContainer;\n    }\n\n    return getOffsetParent(commonAncestorContainer);\n  }\n\n  // one of the nodes is inside shadowDOM, find which one\n  var element1root = getRoot(element1);\n  if (element1root.host) {\n    return findCommonOffsetParent(element1root.host, element2);\n  } else {\n    return findCommonOffsetParent(element1, getRoot(element2).host);\n  }\n}\n\n/**\n * Gets the scroll value of the given element in the given side (top and left)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {String} side `top` or `left`\n * @returns {number} amount of scrolled pixels\n */\nfunction getScroll(element) {\n  var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n  var upperSide = side === 'top' ? 'scrollTop' : 'scrollLeft';\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    var html = element.ownerDocument.documentElement;\n    var scrollingElement = element.ownerDocument.scrollingElement || html;\n    return scrollingElement[upperSide];\n  }\n\n  return element[upperSide];\n}\n\n/*\n * Sum or subtract the element scroll values (left and top) from a given rect object\n * @method\n * @memberof Popper.Utils\n * @param {Object} rect - Rect object you want to change\n * @param {HTMLElement} element - The element from the function reads the scroll values\n * @param {Boolean} subtract - set to true if you want to subtract the scroll values\n * @return {Object} rect - The modifier rect object\n */\nfunction includeScroll(rect, element) {\n  var subtract = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var scrollTop = getScroll(element, 'top');\n  var scrollLeft = getScroll(element, 'left');\n  var modifier = subtract ? -1 : 1;\n  rect.top += scrollTop * modifier;\n  rect.bottom += scrollTop * modifier;\n  rect.left += scrollLeft * modifier;\n  rect.right += scrollLeft * modifier;\n  return rect;\n}\n\n/*\n * Helper to detect borders of a given element\n * @method\n * @memberof Popper.Utils\n * @param {CSSStyleDeclaration} styles\n * Result of `getStyleComputedProperty` on the given element\n * @param {String} axis - `x` or `y`\n * @return {number} borders - The borders size of the given axis\n */\n\nfunction getBordersSize(styles, axis) {\n  var sideA = axis === 'x' ? 'Left' : 'Top';\n  var sideB = sideA === 'Left' ? 'Right' : 'Bottom';\n\n  return parseFloat(styles['border' + sideA + 'Width'], 10) + parseFloat(styles['border' + sideB + 'Width'], 10);\n}\n\nfunction getSize(axis, body, html, computedStyle) {\n  return Math.max(body['offset' + axis], body['scroll' + axis], html['client' + axis], html['offset' + axis], html['scroll' + axis], isIE(10) ? html['offset' + axis] + computedStyle['margin' + (axis === 'Height' ? 'Top' : 'Left')] + computedStyle['margin' + (axis === 'Height' ? 'Bottom' : 'Right')] : 0);\n}\n\nfunction getWindowSizes() {\n  var body = document.body;\n  var html = document.documentElement;\n  var computedStyle = isIE(10) && getComputedStyle(html);\n\n  return {\n    height: getSize('Height', body, html, computedStyle),\n    width: getSize('Width', body, html, computedStyle)\n  };\n}\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\nvar defineProperty = function (obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n/**\n * Given element offsets, generate an output similar to getBoundingClientRect\n * @method\n * @memberof Popper.Utils\n * @argument {Object} offsets\n * @returns {Object} ClientRect like output\n */\nfunction getClientRect(offsets) {\n  return _extends({}, offsets, {\n    right: offsets.left + offsets.width,\n    bottom: offsets.top + offsets.height\n  });\n}\n\n/**\n * Get bounding client rect of given element\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} element\n * @return {Object} client rect\n */\nfunction getBoundingClientRect(element) {\n  var rect = {};\n\n  // IE10 10 FIX: Please, don't ask, the element isn't\n  // considered in DOM in some circumstances...\n  // This isn't reproducible in IE10 compatibility mode of IE11\n  try {\n    if (isIE(10)) {\n      rect = element.getBoundingClientRect();\n      var scrollTop = getScroll(element, 'top');\n      var scrollLeft = getScroll(element, 'left');\n      rect.top += scrollTop;\n      rect.left += scrollLeft;\n      rect.bottom += scrollTop;\n      rect.right += scrollLeft;\n    } else {\n      rect = element.getBoundingClientRect();\n    }\n  } catch (e) {}\n\n  var result = {\n    left: rect.left,\n    top: rect.top,\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top\n  };\n\n  // subtract scrollbar size from sizes\n  var sizes = element.nodeName === 'HTML' ? getWindowSizes() : {};\n  var width = sizes.width || element.clientWidth || result.right - result.left;\n  var height = sizes.height || element.clientHeight || result.bottom - result.top;\n\n  var horizScrollbar = element.offsetWidth - width;\n  var vertScrollbar = element.offsetHeight - height;\n\n  // if an hypothetical scrollbar is detected, we must be sure it's not a `border`\n  // we make this check conditional for performance reasons\n  if (horizScrollbar || vertScrollbar) {\n    var styles = getStyleComputedProperty(element);\n    horizScrollbar -= getBordersSize(styles, 'x');\n    vertScrollbar -= getBordersSize(styles, 'y');\n\n    result.width -= horizScrollbar;\n    result.height -= vertScrollbar;\n  }\n\n  return getClientRect(result);\n}\n\nfunction getOffsetRectRelativeToArbitraryNode(children, parent) {\n  var fixedPosition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var isIE10 = isIE(10);\n  var isHTML = parent.nodeName === 'HTML';\n  var childrenRect = getBoundingClientRect(children);\n  var parentRect = getBoundingClientRect(parent);\n  var scrollParent = getScrollParent(children);\n\n  var styles = getStyleComputedProperty(parent);\n  var borderTopWidth = parseFloat(styles.borderTopWidth, 10);\n  var borderLeftWidth = parseFloat(styles.borderLeftWidth, 10);\n\n  // In cases where the parent is fixed, we must ignore negative scroll in offset calc\n  if (fixedPosition && parent.nodeName === 'HTML') {\n    parentRect.top = Math.max(parentRect.top, 0);\n    parentRect.left = Math.max(parentRect.left, 0);\n  }\n  var offsets = getClientRect({\n    top: childrenRect.top - parentRect.top - borderTopWidth,\n    left: childrenRect.left - parentRect.left - borderLeftWidth,\n    width: childrenRect.width,\n    height: childrenRect.height\n  });\n  offsets.marginTop = 0;\n  offsets.marginLeft = 0;\n\n  // Subtract margins of documentElement in case it's being used as parent\n  // we do this only on HTML because it's the only element that behaves\n  // differently when margins are applied to it. The margins are included in\n  // the box of the documentElement, in the other cases not.\n  if (!isIE10 && isHTML) {\n    var marginTop = parseFloat(styles.marginTop, 10);\n    var marginLeft = parseFloat(styles.marginLeft, 10);\n\n    offsets.top -= borderTopWidth - marginTop;\n    offsets.bottom -= borderTopWidth - marginTop;\n    offsets.left -= borderLeftWidth - marginLeft;\n    offsets.right -= borderLeftWidth - marginLeft;\n\n    // Attach marginTop and marginLeft because in some circumstances we may need them\n    offsets.marginTop = marginTop;\n    offsets.marginLeft = marginLeft;\n  }\n\n  if (isIE10 && !fixedPosition ? parent.contains(scrollParent) : parent === scrollParent && scrollParent.nodeName !== 'BODY') {\n    offsets = includeScroll(offsets, parent);\n  }\n\n  return offsets;\n}\n\nfunction getViewportOffsetRectRelativeToArtbitraryNode(element) {\n  var excludeScroll = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var html = element.ownerDocument.documentElement;\n  var relativeOffset = getOffsetRectRelativeToArbitraryNode(element, html);\n  var width = Math.max(html.clientWidth, window.innerWidth || 0);\n  var height = Math.max(html.clientHeight, window.innerHeight || 0);\n\n  var scrollTop = !excludeScroll ? getScroll(html) : 0;\n  var scrollLeft = !excludeScroll ? getScroll(html, 'left') : 0;\n\n  var offset = {\n    top: scrollTop - relativeOffset.top + relativeOffset.marginTop,\n    left: scrollLeft - relativeOffset.left + relativeOffset.marginLeft,\n    width: width,\n    height: height\n  };\n\n  return getClientRect(offset);\n}\n\n/**\n * Check if the given element is fixed or is inside a fixed parent\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {Element} customContainer\n * @returns {Boolean} answer to \"isFixed?\"\n */\nfunction isFixed(element) {\n  var nodeName = element.nodeName;\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    return false;\n  }\n  if (getStyleComputedProperty(element, 'position') === 'fixed') {\n    return true;\n  }\n  return isFixed(getParentNode(element));\n}\n\n/**\n * Finds the first parent of an element that has a transformed property defined\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} first transformed parent or documentElement\n */\n\nfunction getFixedPositionOffsetParent(element) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element || !element.parentElement || isIE()) {\n    return document.documentElement;\n  }\n  var el = element.parentElement;\n  while (el && getStyleComputedProperty(el, 'transform') === 'none') {\n    el = el.parentElement;\n  }\n  return el || document.documentElement;\n}\n\n/**\n * Computed the boundaries limits and return them\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} popper\n * @param {HTMLElement} reference\n * @param {number} padding\n * @param {HTMLElement} boundariesElement - Element used to define the boundaries\n * @param {Boolean} fixedPosition - Is in fixed position mode\n * @returns {Object} Coordinates of the boundaries\n */\nfunction getBoundaries(popper, reference, padding, boundariesElement) {\n  var fixedPosition = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n  // NOTE: 1 DOM access here\n\n  var boundaries = { top: 0, left: 0 };\n  var offsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n\n  // Handle viewport case\n  if (boundariesElement === 'viewport') {\n    boundaries = getViewportOffsetRectRelativeToArtbitraryNode(offsetParent, fixedPosition);\n  } else {\n    // Handle other cases based on DOM element used as boundaries\n    var boundariesNode = void 0;\n    if (boundariesElement === 'scrollParent') {\n      boundariesNode = getScrollParent(getParentNode(reference));\n      if (boundariesNode.nodeName === 'BODY') {\n        boundariesNode = popper.ownerDocument.documentElement;\n      }\n    } else if (boundariesElement === 'window') {\n      boundariesNode = popper.ownerDocument.documentElement;\n    } else {\n      boundariesNode = boundariesElement;\n    }\n\n    var offsets = getOffsetRectRelativeToArbitraryNode(boundariesNode, offsetParent, fixedPosition);\n\n    // In case of HTML, we need a different computation\n    if (boundariesNode.nodeName === 'HTML' && !isFixed(offsetParent)) {\n      var _getWindowSizes = getWindowSizes(),\n          height = _getWindowSizes.height,\n          width = _getWindowSizes.width;\n\n      boundaries.top += offsets.top - offsets.marginTop;\n      boundaries.bottom = height + offsets.top;\n      boundaries.left += offsets.left - offsets.marginLeft;\n      boundaries.right = width + offsets.left;\n    } else {\n      // for all the other DOM elements, this one is good\n      boundaries = offsets;\n    }\n  }\n\n  // Add paddings\n  boundaries.left += padding;\n  boundaries.top += padding;\n  boundaries.right -= padding;\n  boundaries.bottom -= padding;\n\n  return boundaries;\n}\n\nfunction getArea(_ref) {\n  var width = _ref.width,\n      height = _ref.height;\n\n  return width * height;\n}\n\n/**\n * Utility used to transform the `auto` placement to the placement with more\n * available space.\n * @method\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeAutoPlacement(placement, refRect, popper, reference, boundariesElement) {\n  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n  if (placement.indexOf('auto') === -1) {\n    return placement;\n  }\n\n  var boundaries = getBoundaries(popper, reference, padding, boundariesElement);\n\n  var rects = {\n    top: {\n      width: boundaries.width,\n      height: refRect.top - boundaries.top\n    },\n    right: {\n      width: boundaries.right - refRect.right,\n      height: boundaries.height\n    },\n    bottom: {\n      width: boundaries.width,\n      height: boundaries.bottom - refRect.bottom\n    },\n    left: {\n      width: refRect.left - boundaries.left,\n      height: boundaries.height\n    }\n  };\n\n  var sortedAreas = Object.keys(rects).map(function (key) {\n    return _extends({\n      key: key\n    }, rects[key], {\n      area: getArea(rects[key])\n    });\n  }).sort(function (a, b) {\n    return b.area - a.area;\n  });\n\n  var filteredAreas = sortedAreas.filter(function (_ref2) {\n    var width = _ref2.width,\n        height = _ref2.height;\n    return width >= popper.clientWidth && height >= popper.clientHeight;\n  });\n\n  var computedPlacement = filteredAreas.length > 0 ? filteredAreas[0].key : sortedAreas[0].key;\n\n  var variation = placement.split('-')[1];\n\n  return computedPlacement + (variation ? '-' + variation : '');\n}\n\n/**\n * Get offsets to the reference element\n * @method\n * @memberof Popper.Utils\n * @param {Object} state\n * @param {Element} popper - the popper element\n * @param {Element} reference - the reference element (the popper will be relative to this)\n * @param {Element} fixedPosition - is in fixed position mode\n * @returns {Object} An object containing the offsets which will be applied to the popper\n */\nfunction getReferenceOffsets(state, popper, reference) {\n  var fixedPosition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var commonOffsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n  return getOffsetRectRelativeToArbitraryNode(reference, commonOffsetParent, fixedPosition);\n}\n\n/**\n * Get the outer sizes of the given element (offset size + margins)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Object} object containing width and height properties\n */\nfunction getOuterSizes(element) {\n  var styles = getComputedStyle(element);\n  var x = parseFloat(styles.marginTop) + parseFloat(styles.marginBottom);\n  var y = parseFloat(styles.marginLeft) + parseFloat(styles.marginRight);\n  var result = {\n    width: element.offsetWidth + y,\n    height: element.offsetHeight + x\n  };\n  return result;\n}\n\n/**\n * Get the opposite placement of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement\n * @returns {String} flipped placement\n */\nfunction getOppositePlacement(placement) {\n  var hash = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' };\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}\n\n/**\n * Get offsets to the popper\n * @method\n * @memberof Popper.Utils\n * @param {Object} position - CSS position the Popper will get applied\n * @param {HTMLElement} popper - the popper element\n * @param {Object} referenceOffsets - the reference offsets (the popper will be relative to this)\n * @param {String} placement - one of the valid placement options\n * @returns {Object} popperOffsets - An object containing the offsets which will be applied to the popper\n */\nfunction getPopperOffsets(popper, referenceOffsets, placement) {\n  placement = placement.split('-')[0];\n\n  // Get popper node sizes\n  var popperRect = getOuterSizes(popper);\n\n  // Add position, width and height to our offsets object\n  var popperOffsets = {\n    width: popperRect.width,\n    height: popperRect.height\n  };\n\n  // depending by the popper placement we have to compute its offsets slightly differently\n  var isHoriz = ['right', 'left'].indexOf(placement) !== -1;\n  var mainSide = isHoriz ? 'top' : 'left';\n  var secondarySide = isHoriz ? 'left' : 'top';\n  var measurement = isHoriz ? 'height' : 'width';\n  var secondaryMeasurement = !isHoriz ? 'height' : 'width';\n\n  popperOffsets[mainSide] = referenceOffsets[mainSide] + referenceOffsets[measurement] / 2 - popperRect[measurement] / 2;\n  if (placement === secondarySide) {\n    popperOffsets[secondarySide] = referenceOffsets[secondarySide] - popperRect[secondaryMeasurement];\n  } else {\n    popperOffsets[secondarySide] = referenceOffsets[getOppositePlacement(secondarySide)];\n  }\n\n  return popperOffsets;\n}\n\n/**\n * Mimics the `find` method of Array\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction find(arr, check) {\n  // use native find if supported\n  if (Array.prototype.find) {\n    return arr.find(check);\n  }\n\n  // use `filter` to obtain the same behavior of `find`\n  return arr.filter(check)[0];\n}\n\n/**\n * Return the index of the matching object\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction findIndex(arr, prop, value) {\n  // use native findIndex if supported\n  if (Array.prototype.findIndex) {\n    return arr.findIndex(function (cur) {\n      return cur[prop] === value;\n    });\n  }\n\n  // use `find` + `indexOf` if `findIndex` isn't supported\n  var match = find(arr, function (obj) {\n    return obj[prop] === value;\n  });\n  return arr.indexOf(match);\n}\n\n/**\n * Loop trough the list of modifiers and run them in order,\n * each of them will then edit the data object.\n * @method\n * @memberof Popper.Utils\n * @param {dataObject} data\n * @param {Array} modifiers\n * @param {String} ends - Optional modifier name used as stopper\n * @returns {dataObject}\n */\nfunction runModifiers(modifiers, data, ends) {\n  var modifiersToRun = ends === undefined ? modifiers : modifiers.slice(0, findIndex(modifiers, 'name', ends));\n\n  modifiersToRun.forEach(function (modifier) {\n    if (modifier['function']) {\n      // eslint-disable-line dot-notation\n      console.warn('`modifier.function` is deprecated, use `modifier.fn`!');\n    }\n    var fn = modifier['function'] || modifier.fn; // eslint-disable-line dot-notation\n    if (modifier.enabled && isFunction(fn)) {\n      // Add properties to offsets to make them a complete clientRect object\n      // we do this before each modifier to make sure the previous one doesn't\n      // mess with these values\n      data.offsets.popper = getClientRect(data.offsets.popper);\n      data.offsets.reference = getClientRect(data.offsets.reference);\n\n      data = fn(data, modifier);\n    }\n  });\n\n  return data;\n}\n\n/**\n * Updates the position of the popper, computing the new offsets and applying\n * the new style.<br />\n * Prefer `scheduleUpdate` over `update` because of performance reasons.\n * @method\n * @memberof Popper\n */\nfunction update() {\n  // if popper is destroyed, don't perform any further update\n  if (this.state.isDestroyed) {\n    return;\n  }\n\n  var data = {\n    instance: this,\n    styles: {},\n    arrowStyles: {},\n    attributes: {},\n    flipped: false,\n    offsets: {}\n  };\n\n  // compute reference element offsets\n  data.offsets.reference = getReferenceOffsets(this.state, this.popper, this.reference, this.options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  data.placement = computeAutoPlacement(this.options.placement, data.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding);\n\n  // store the computed placement inside `originalPlacement`\n  data.originalPlacement = data.placement;\n\n  data.positionFixed = this.options.positionFixed;\n\n  // compute the popper offsets\n  data.offsets.popper = getPopperOffsets(this.popper, data.offsets.reference, data.placement);\n\n  data.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute';\n\n  // run the modifiers\n  data = runModifiers(this.modifiers, data);\n\n  // the first `update` will call `onCreate` callback\n  // the other ones will call `onUpdate` callback\n  if (!this.state.isCreated) {\n    this.state.isCreated = true;\n    this.options.onCreate(data);\n  } else {\n    this.options.onUpdate(data);\n  }\n}\n\n/**\n * Helper used to know if the given modifier is enabled.\n * @method\n * @memberof Popper.Utils\n * @returns {Boolean}\n */\nfunction isModifierEnabled(modifiers, modifierName) {\n  return modifiers.some(function (_ref) {\n    var name = _ref.name,\n        enabled = _ref.enabled;\n    return enabled && name === modifierName;\n  });\n}\n\n/**\n * Get the prefixed supported property name\n * @method\n * @memberof Popper.Utils\n * @argument {String} property (camelCase)\n * @returns {String} prefixed property (camelCase or PascalCase, depending on the vendor prefix)\n */\nfunction getSupportedPropertyName(property) {\n  var prefixes = [false, 'ms', 'Webkit', 'Moz', 'O'];\n  var upperProp = property.charAt(0).toUpperCase() + property.slice(1);\n\n  for (var i = 0; i < prefixes.length; i++) {\n    var prefix = prefixes[i];\n    var toCheck = prefix ? '' + prefix + upperProp : property;\n    if (typeof document.body.style[toCheck] !== 'undefined') {\n      return toCheck;\n    }\n  }\n  return null;\n}\n\n/**\n * Destroy the popper\n * @method\n * @memberof Popper\n */\nfunction destroy() {\n  this.state.isDestroyed = true;\n\n  // touch DOM only if `applyStyle` modifier is enabled\n  if (isModifierEnabled(this.modifiers, 'applyStyle')) {\n    this.popper.removeAttribute('x-placement');\n    this.popper.style.position = '';\n    this.popper.style.top = '';\n    this.popper.style.left = '';\n    this.popper.style.right = '';\n    this.popper.style.bottom = '';\n    this.popper.style.willChange = '';\n    this.popper.style[getSupportedPropertyName('transform')] = '';\n  }\n\n  this.disableEventListeners();\n\n  // remove the popper if user explicity asked for the deletion on destroy\n  // do not use `remove` because IE11 doesn't support it\n  if (this.options.removeOnDestroy) {\n    this.popper.parentNode.removeChild(this.popper);\n  }\n  return this;\n}\n\n/**\n * Get the window associated with the element\n * @argument {Element} element\n * @returns {Window}\n */\nfunction getWindow(element) {\n  var ownerDocument = element.ownerDocument;\n  return ownerDocument ? ownerDocument.defaultView : window;\n}\n\nfunction attachToScrollParents(scrollParent, event, callback, scrollParents) {\n  var isBody = scrollParent.nodeName === 'BODY';\n  var target = isBody ? scrollParent.ownerDocument.defaultView : scrollParent;\n  target.addEventListener(event, callback, { passive: true });\n\n  if (!isBody) {\n    attachToScrollParents(getScrollParent(target.parentNode), event, callback, scrollParents);\n  }\n  scrollParents.push(target);\n}\n\n/**\n * Setup needed event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction setupEventListeners(reference, options, state, updateBound) {\n  // Resize event listener on window\n  state.updateBound = updateBound;\n  getWindow(reference).addEventListener('resize', state.updateBound, { passive: true });\n\n  // Scroll event listener on scroll parents\n  var scrollElement = getScrollParent(reference);\n  attachToScrollParents(scrollElement, 'scroll', state.updateBound, state.scrollParents);\n  state.scrollElement = scrollElement;\n  state.eventsEnabled = true;\n\n  return state;\n}\n\n/**\n * It will add resize/scroll events and start recalculating\n * position of the popper element when they are triggered.\n * @method\n * @memberof Popper\n */\nfunction enableEventListeners() {\n  if (!this.state.eventsEnabled) {\n    this.state = setupEventListeners(this.reference, this.options, this.state, this.scheduleUpdate);\n  }\n}\n\n/**\n * Remove event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction removeEventListeners(reference, state) {\n  // Remove resize event listener on window\n  getWindow(reference).removeEventListener('resize', state.updateBound);\n\n  // Remove scroll event listener on scroll parents\n  state.scrollParents.forEach(function (target) {\n    target.removeEventListener('scroll', state.updateBound);\n  });\n\n  // Reset state\n  state.updateBound = null;\n  state.scrollParents = [];\n  state.scrollElement = null;\n  state.eventsEnabled = false;\n  return state;\n}\n\n/**\n * It will remove resize/scroll events and won't recalculate popper position\n * when they are triggered. It also won't trigger onUpdate callback anymore,\n * unless you call `update` method manually.\n * @method\n * @memberof Popper\n */\nfunction disableEventListeners() {\n  if (this.state.eventsEnabled) {\n    cancelAnimationFrame(this.scheduleUpdate);\n    this.state = removeEventListeners(this.reference, this.state);\n  }\n}\n\n/**\n * Tells if a given input is a number\n * @method\n * @memberof Popper.Utils\n * @param {*} input to check\n * @return {Boolean}\n */\nfunction isNumeric(n) {\n  return n !== '' && !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * Set the style to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the style to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setStyles(element, styles) {\n  Object.keys(styles).forEach(function (prop) {\n    var unit = '';\n    // add unit if the value is numeric and is one of the following\n    if (['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(prop) !== -1 && isNumeric(styles[prop])) {\n      unit = 'px';\n    }\n    element.style[prop] = styles[prop] + unit;\n  });\n}\n\n/**\n * Set the attributes to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the attributes to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setAttributes(element, attributes) {\n  Object.keys(attributes).forEach(function (prop) {\n    var value = attributes[prop];\n    if (value !== false) {\n      element.setAttribute(prop, attributes[prop]);\n    } else {\n      element.removeAttribute(prop);\n    }\n  });\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} data.styles - List of style properties - values to apply to popper element\n * @argument {Object} data.attributes - List of attribute properties - values to apply to popper element\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The same data object\n */\nfunction applyStyle(data) {\n  // any property present in `data.styles` will be applied to the popper,\n  // in this way we can make the 3rd party modifiers add custom styles to it\n  // Be aware, modifiers could override the properties defined in the previous\n  // lines of this modifier!\n  setStyles(data.instance.popper, data.styles);\n\n  // any property present in `data.attributes` will be applied to the popper,\n  // they will be set as HTML attributes of the element\n  setAttributes(data.instance.popper, data.attributes);\n\n  // if arrowElement is defined and arrowStyles has some properties\n  if (data.arrowElement && Object.keys(data.arrowStyles).length) {\n    setStyles(data.arrowElement, data.arrowStyles);\n  }\n\n  return data;\n}\n\n/**\n * Set the x-placement attribute before everything else because it could be used\n * to add margins to the popper margins needs to be calculated to get the\n * correct popper offsets.\n * @method\n * @memberof Popper.modifiers\n * @param {HTMLElement} reference - The reference element used to position the popper\n * @param {HTMLElement} popper - The HTML element used as popper\n * @param {Object} options - Popper.js options\n */\nfunction applyStyleOnLoad(reference, popper, options, modifierOptions, state) {\n  // compute reference element offsets\n  var referenceOffsets = getReferenceOffsets(state, popper, reference, options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  var placement = computeAutoPlacement(options.placement, referenceOffsets, popper, reference, options.modifiers.flip.boundariesElement, options.modifiers.flip.padding);\n\n  popper.setAttribute('x-placement', placement);\n\n  // Apply `position` to popper before anything else because\n  // without the position applied we can't guarantee correct computations\n  setStyles(popper, { position: options.positionFixed ? 'fixed' : 'absolute' });\n\n  return options;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeStyle(data, options) {\n  var x = options.x,\n      y = options.y;\n  var popper = data.offsets.popper;\n\n  // Remove this legacy support in Popper.js v2\n\n  var legacyGpuAccelerationOption = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'applyStyle';\n  }).gpuAcceleration;\n  if (legacyGpuAccelerationOption !== undefined) {\n    console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');\n  }\n  var gpuAcceleration = legacyGpuAccelerationOption !== undefined ? legacyGpuAccelerationOption : options.gpuAcceleration;\n\n  var offsetParent = getOffsetParent(data.instance.popper);\n  var offsetParentRect = getBoundingClientRect(offsetParent);\n\n  // Styles\n  var styles = {\n    position: popper.position\n  };\n\n  // Avoid blurry text by using full pixel integers.\n  // For pixel-perfect positioning, top/bottom prefers rounded\n  // values, while left/right prefers floored values.\n  var offsets = {\n    left: Math.floor(popper.left),\n    top: Math.round(popper.top),\n    bottom: Math.round(popper.bottom),\n    right: Math.floor(popper.right)\n  };\n\n  var sideA = x === 'bottom' ? 'top' : 'bottom';\n  var sideB = y === 'right' ? 'left' : 'right';\n\n  // if gpuAcceleration is set to `true` and transform is supported,\n  //  we use `translate3d` to apply the position to the popper we\n  // automatically use the supported prefixed version if needed\n  var prefixedProperty = getSupportedPropertyName('transform');\n\n  // now, let's make a step back and look at this code closely (wtf?)\n  // If the content of the popper grows once it's been positioned, it\n  // may happen that the popper gets misplaced because of the new content\n  // overflowing its reference element\n  // To avoid this problem, we provide two options (x and y), which allow\n  // the consumer to define the offset origin.\n  // If we position a popper on top of a reference element, we can set\n  // `x` to `top` to make the popper grow towards its top instead of\n  // its bottom.\n  var left = void 0,\n      top = void 0;\n  if (sideA === 'bottom') {\n    top = -offsetParentRect.height + offsets.bottom;\n  } else {\n    top = offsets.top;\n  }\n  if (sideB === 'right') {\n    left = -offsetParentRect.width + offsets.right;\n  } else {\n    left = offsets.left;\n  }\n  if (gpuAcceleration && prefixedProperty) {\n    styles[prefixedProperty] = 'translate3d(' + left + 'px, ' + top + 'px, 0)';\n    styles[sideA] = 0;\n    styles[sideB] = 0;\n    styles.willChange = 'transform';\n  } else {\n    // othwerise, we use the standard `top`, `left`, `bottom` and `right` properties\n    var invertTop = sideA === 'bottom' ? -1 : 1;\n    var invertLeft = sideB === 'right' ? -1 : 1;\n    styles[sideA] = top * invertTop;\n    styles[sideB] = left * invertLeft;\n    styles.willChange = sideA + ', ' + sideB;\n  }\n\n  // Attributes\n  var attributes = {\n    'x-placement': data.placement\n  };\n\n  // Update `data` attributes, styles and arrowStyles\n  data.attributes = _extends({}, attributes, data.attributes);\n  data.styles = _extends({}, styles, data.styles);\n  data.arrowStyles = _extends({}, data.offsets.arrow, data.arrowStyles);\n\n  return data;\n}\n\n/**\n * Helper used to know if the given modifier depends from another one.<br />\n * It checks if the needed modifier is listed and enabled.\n * @method\n * @memberof Popper.Utils\n * @param {Array} modifiers - list of modifiers\n * @param {String} requestingName - name of requesting modifier\n * @param {String} requestedName - name of requested modifier\n * @returns {Boolean}\n */\nfunction isModifierRequired(modifiers, requestingName, requestedName) {\n  var requesting = find(modifiers, function (_ref) {\n    var name = _ref.name;\n    return name === requestingName;\n  });\n\n  var isRequired = !!requesting && modifiers.some(function (modifier) {\n    return modifier.name === requestedName && modifier.enabled && modifier.order < requesting.order;\n  });\n\n  if (!isRequired) {\n    var _requesting = '`' + requestingName + '`';\n    var requested = '`' + requestedName + '`';\n    console.warn(requested + ' modifier is required by ' + _requesting + ' modifier in order to work, be sure to include it before ' + _requesting + '!');\n  }\n  return isRequired;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction arrow(data, options) {\n  var _data$offsets$arrow;\n\n  // arrow depends on keepTogether in order to work\n  if (!isModifierRequired(data.instance.modifiers, 'arrow', 'keepTogether')) {\n    return data;\n  }\n\n  var arrowElement = options.element;\n\n  // if arrowElement is a string, suppose it's a CSS selector\n  if (typeof arrowElement === 'string') {\n    arrowElement = data.instance.popper.querySelector(arrowElement);\n\n    // if arrowElement is not found, don't run the modifier\n    if (!arrowElement) {\n      return data;\n    }\n  } else {\n    // if the arrowElement isn't a query selector we must check that the\n    // provided DOM node is child of its popper node\n    if (!data.instance.popper.contains(arrowElement)) {\n      console.warn('WARNING: `arrow.element` must be child of its popper element!');\n      return data;\n    }\n  }\n\n  var placement = data.placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isVertical = ['left', 'right'].indexOf(placement) !== -1;\n\n  var len = isVertical ? 'height' : 'width';\n  var sideCapitalized = isVertical ? 'Top' : 'Left';\n  var side = sideCapitalized.toLowerCase();\n  var altSide = isVertical ? 'left' : 'top';\n  var opSide = isVertical ? 'bottom' : 'right';\n  var arrowElementSize = getOuterSizes(arrowElement)[len];\n\n  //\n  // extends keepTogether behavior making sure the popper and its\n  // reference have enough pixels in conjuction\n  //\n\n  // top/left side\n  if (reference[opSide] - arrowElementSize < popper[side]) {\n    data.offsets.popper[side] -= popper[side] - (reference[opSide] - arrowElementSize);\n  }\n  // bottom/right side\n  if (reference[side] + arrowElementSize > popper[opSide]) {\n    data.offsets.popper[side] += reference[side] + arrowElementSize - popper[opSide];\n  }\n  data.offsets.popper = getClientRect(data.offsets.popper);\n\n  // compute center of the popper\n  var center = reference[side] + reference[len] / 2 - arrowElementSize / 2;\n\n  // Compute the sideValue using the updated popper offsets\n  // take popper margin in account because we don't have this info available\n  var css = getStyleComputedProperty(data.instance.popper);\n  var popperMarginSide = parseFloat(css['margin' + sideCapitalized], 10);\n  var popperBorderSide = parseFloat(css['border' + sideCapitalized + 'Width'], 10);\n  var sideValue = center - data.offsets.popper[side] - popperMarginSide - popperBorderSide;\n\n  // prevent arrowElement from being placed not contiguously to its popper\n  sideValue = Math.max(Math.min(popper[len] - arrowElementSize, sideValue), 0);\n\n  data.arrowElement = arrowElement;\n  data.offsets.arrow = (_data$offsets$arrow = {}, defineProperty(_data$offsets$arrow, side, Math.round(sideValue)), defineProperty(_data$offsets$arrow, altSide, ''), _data$offsets$arrow);\n\n  return data;\n}\n\n/**\n * Get the opposite placement variation of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement variation\n * @returns {String} flipped placement variation\n */\nfunction getOppositeVariation(variation) {\n  if (variation === 'end') {\n    return 'start';\n  } else if (variation === 'start') {\n    return 'end';\n  }\n  return variation;\n}\n\n/**\n * List of accepted placements to use as values of the `placement` option.<br />\n * Valid placements are:\n * - `auto`\n * - `top`\n * - `right`\n * - `bottom`\n * - `left`\n *\n * Each placement can have a variation from this list:\n * - `-start`\n * - `-end`\n *\n * Variations are interpreted easily if you think of them as the left to right\n * written languages. Horizontally (`top` and `bottom`), `start` is left and `end`\n * is right.<br />\n * Vertically (`left` and `right`), `start` is top and `end` is bottom.\n *\n * Some valid examples are:\n * - `top-end` (on top of reference, right aligned)\n * - `right-start` (on right of reference, top aligned)\n * - `bottom` (on bottom, centered)\n * - `auto-right` (on the side with more space available, alignment depends by placement)\n *\n * @static\n * @type {Array}\n * @enum {String}\n * @readonly\n * @method placements\n * @memberof Popper\n */\nvar placements = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'];\n\n// Get rid of `auto` `auto-start` and `auto-end`\nvar validPlacements = placements.slice(3);\n\n/**\n * Given an initial placement, returns all the subsequent placements\n * clockwise (or counter-clockwise).\n *\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement - A valid placement (it accepts variations)\n * @argument {Boolean} counter - Set to true to walk the placements counterclockwise\n * @returns {Array} placements including their variations\n */\nfunction clockwise(placement) {\n  var counter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var index = validPlacements.indexOf(placement);\n  var arr = validPlacements.slice(index + 1).concat(validPlacements.slice(0, index));\n  return counter ? arr.reverse() : arr;\n}\n\nvar BEHAVIORS = {\n  FLIP: 'flip',\n  CLOCKWISE: 'clockwise',\n  COUNTERCLOCKWISE: 'counterclockwise'\n};\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction flip(data, options) {\n  // if `inner` modifier is enabled, we can't use the `flip` modifier\n  if (isModifierEnabled(data.instance.modifiers, 'inner')) {\n    return data;\n  }\n\n  if (data.flipped && data.placement === data.originalPlacement) {\n    // seems like flip is trying to loop, probably there's not enough space on any of the flippable sides\n    return data;\n  }\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, options.boundariesElement, data.positionFixed);\n\n  var placement = data.placement.split('-')[0];\n  var placementOpposite = getOppositePlacement(placement);\n  var variation = data.placement.split('-')[1] || '';\n\n  var flipOrder = [];\n\n  switch (options.behavior) {\n    case BEHAVIORS.FLIP:\n      flipOrder = [placement, placementOpposite];\n      break;\n    case BEHAVIORS.CLOCKWISE:\n      flipOrder = clockwise(placement);\n      break;\n    case BEHAVIORS.COUNTERCLOCKWISE:\n      flipOrder = clockwise(placement, true);\n      break;\n    default:\n      flipOrder = options.behavior;\n  }\n\n  flipOrder.forEach(function (step, index) {\n    if (placement !== step || flipOrder.length === index + 1) {\n      return data;\n    }\n\n    placement = data.placement.split('-')[0];\n    placementOpposite = getOppositePlacement(placement);\n\n    var popperOffsets = data.offsets.popper;\n    var refOffsets = data.offsets.reference;\n\n    // using floor because the reference offsets may contain decimals we are not going to consider here\n    var floor = Math.floor;\n    var overlapsRef = placement === 'left' && floor(popperOffsets.right) > floor(refOffsets.left) || placement === 'right' && floor(popperOffsets.left) < floor(refOffsets.right) || placement === 'top' && floor(popperOffsets.bottom) > floor(refOffsets.top) || placement === 'bottom' && floor(popperOffsets.top) < floor(refOffsets.bottom);\n\n    var overflowsLeft = floor(popperOffsets.left) < floor(boundaries.left);\n    var overflowsRight = floor(popperOffsets.right) > floor(boundaries.right);\n    var overflowsTop = floor(popperOffsets.top) < floor(boundaries.top);\n    var overflowsBottom = floor(popperOffsets.bottom) > floor(boundaries.bottom);\n\n    var overflowsBoundaries = placement === 'left' && overflowsLeft || placement === 'right' && overflowsRight || placement === 'top' && overflowsTop || placement === 'bottom' && overflowsBottom;\n\n    // flip the variation if required\n    var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n    var flippedVariation = !!options.flipVariations && (isVertical && variation === 'start' && overflowsLeft || isVertical && variation === 'end' && overflowsRight || !isVertical && variation === 'start' && overflowsTop || !isVertical && variation === 'end' && overflowsBottom);\n\n    if (overlapsRef || overflowsBoundaries || flippedVariation) {\n      // this boolean to detect any flip loop\n      data.flipped = true;\n\n      if (overlapsRef || overflowsBoundaries) {\n        placement = flipOrder[index + 1];\n      }\n\n      if (flippedVariation) {\n        variation = getOppositeVariation(variation);\n      }\n\n      data.placement = placement + (variation ? '-' + variation : '');\n\n      // this object contains `position`, we want to preserve it along with\n      // any additional property we may add in the future\n      data.offsets.popper = _extends({}, data.offsets.popper, getPopperOffsets(data.instance.popper, data.offsets.reference, data.placement));\n\n      data = runModifiers(data.instance.modifiers, data, 'flip');\n    }\n  });\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction keepTogether(data) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var placement = data.placement.split('-')[0];\n  var floor = Math.floor;\n  var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n  var side = isVertical ? 'right' : 'bottom';\n  var opSide = isVertical ? 'left' : 'top';\n  var measurement = isVertical ? 'width' : 'height';\n\n  if (popper[side] < floor(reference[opSide])) {\n    data.offsets.popper[opSide] = floor(reference[opSide]) - popper[measurement];\n  }\n  if (popper[opSide] > floor(reference[side])) {\n    data.offsets.popper[opSide] = floor(reference[side]);\n  }\n\n  return data;\n}\n\n/**\n * Converts a string containing value + unit into a px value number\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} str - Value + unit string\n * @argument {String} measurement - `height` or `width`\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @returns {Number|String}\n * Value in pixels, or original string if no values were extracted\n */\nfunction toValue(str, measurement, popperOffsets, referenceOffsets) {\n  // separate value from unit\n  var split = str.match(/((?:\\-|\\+)?\\d*\\.?\\d*)(.*)/);\n  var value = +split[1];\n  var unit = split[2];\n\n  // If it's not a number it's an operator, I guess\n  if (!value) {\n    return str;\n  }\n\n  if (unit.indexOf('%') === 0) {\n    var element = void 0;\n    switch (unit) {\n      case '%p':\n        element = popperOffsets;\n        break;\n      case '%':\n      case '%r':\n      default:\n        element = referenceOffsets;\n    }\n\n    var rect = getClientRect(element);\n    return rect[measurement] / 100 * value;\n  } else if (unit === 'vh' || unit === 'vw') {\n    // if is a vh or vw, we calculate the size based on the viewport\n    var size = void 0;\n    if (unit === 'vh') {\n      size = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    } else {\n      size = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n    }\n    return size / 100 * value;\n  } else {\n    // if is an explicit pixel unit, we get rid of the unit and keep the value\n    // if is an implicit unit, it's px, and we return just the value\n    return value;\n  }\n}\n\n/**\n * Parse an `offset` string to extrapolate `x` and `y` numeric offsets.\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} offset\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @argument {String} basePlacement\n * @returns {Array} a two cells array with x and y offsets in numbers\n */\nfunction parseOffset(offset, popperOffsets, referenceOffsets, basePlacement) {\n  var offsets = [0, 0];\n\n  // Use height if placement is left or right and index is 0 otherwise use width\n  // in this way the first offset will use an axis and the second one\n  // will use the other one\n  var useHeight = ['right', 'left'].indexOf(basePlacement) !== -1;\n\n  // Split the offset string to obtain a list of values and operands\n  // The regex addresses values with the plus or minus sign in front (+10, -20, etc)\n  var fragments = offset.split(/(\\+|\\-)/).map(function (frag) {\n    return frag.trim();\n  });\n\n  // Detect if the offset string contains a pair of values or a single one\n  // they could be separated by comma or space\n  var divider = fragments.indexOf(find(fragments, function (frag) {\n    return frag.search(/,|\\s/) !== -1;\n  }));\n\n  if (fragments[divider] && fragments[divider].indexOf(',') === -1) {\n    console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');\n  }\n\n  // If divider is found, we divide the list of values and operands to divide\n  // them by ofset X and Y.\n  var splitRegex = /\\s*,\\s*|\\s+/;\n  var ops = divider !== -1 ? [fragments.slice(0, divider).concat([fragments[divider].split(splitRegex)[0]]), [fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider + 1))] : [fragments];\n\n  // Convert the values with units to absolute pixels to allow our computations\n  ops = ops.map(function (op, index) {\n    // Most of the units rely on the orientation of the popper\n    var measurement = (index === 1 ? !useHeight : useHeight) ? 'height' : 'width';\n    var mergeWithPrevious = false;\n    return op\n    // This aggregates any `+` or `-` sign that aren't considered operators\n    // e.g.: 10 + +5 => [10, +, +5]\n    .reduce(function (a, b) {\n      if (a[a.length - 1] === '' && ['+', '-'].indexOf(b) !== -1) {\n        a[a.length - 1] = b;\n        mergeWithPrevious = true;\n        return a;\n      } else if (mergeWithPrevious) {\n        a[a.length - 1] += b;\n        mergeWithPrevious = false;\n        return a;\n      } else {\n        return a.concat(b);\n      }\n    }, [])\n    // Here we convert the string values into number values (in px)\n    .map(function (str) {\n      return toValue(str, measurement, popperOffsets, referenceOffsets);\n    });\n  });\n\n  // Loop trough the offsets arrays and execute the operations\n  ops.forEach(function (op, index) {\n    op.forEach(function (frag, index2) {\n      if (isNumeric(frag)) {\n        offsets[index] += frag * (op[index2 - 1] === '-' ? -1 : 1);\n      }\n    });\n  });\n  return offsets;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @argument {Number|String} options.offset=0\n * The offset value as described in the modifier description\n * @returns {Object} The data object, properly modified\n */\nfunction offset(data, _ref) {\n  var offset = _ref.offset;\n  var placement = data.placement,\n      _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var basePlacement = placement.split('-')[0];\n\n  var offsets = void 0;\n  if (isNumeric(+offset)) {\n    offsets = [+offset, 0];\n  } else {\n    offsets = parseOffset(offset, popper, reference, basePlacement);\n  }\n\n  if (basePlacement === 'left') {\n    popper.top += offsets[0];\n    popper.left -= offsets[1];\n  } else if (basePlacement === 'right') {\n    popper.top += offsets[0];\n    popper.left += offsets[1];\n  } else if (basePlacement === 'top') {\n    popper.left += offsets[0];\n    popper.top -= offsets[1];\n  } else if (basePlacement === 'bottom') {\n    popper.left += offsets[0];\n    popper.top += offsets[1];\n  }\n\n  data.popper = popper;\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction preventOverflow(data, options) {\n  var boundariesElement = options.boundariesElement || getOffsetParent(data.instance.popper);\n\n  // If offsetParent is the reference element, we really want to\n  // go one step up and use the next offsetParent as reference to\n  // avoid to make this modifier completely useless and look like broken\n  if (data.instance.reference === boundariesElement) {\n    boundariesElement = getOffsetParent(boundariesElement);\n  }\n\n  // NOTE: DOM access here\n  // resets the popper's position so that the document size can be calculated excluding\n  // the size of the popper element itself\n  var transformProp = getSupportedPropertyName('transform');\n  var popperStyles = data.instance.popper.style; // assignment to help minification\n  var top = popperStyles.top,\n      left = popperStyles.left,\n      transform = popperStyles[transformProp];\n\n  popperStyles.top = '';\n  popperStyles.left = '';\n  popperStyles[transformProp] = '';\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, boundariesElement, data.positionFixed);\n\n  // NOTE: DOM access here\n  // restores the original style properties after the offsets have been computed\n  popperStyles.top = top;\n  popperStyles.left = left;\n  popperStyles[transformProp] = transform;\n\n  options.boundaries = boundaries;\n\n  var order = options.priority;\n  var popper = data.offsets.popper;\n\n  var check = {\n    primary: function primary(placement) {\n      var value = popper[placement];\n      if (popper[placement] < boundaries[placement] && !options.escapeWithReference) {\n        value = Math.max(popper[placement], boundaries[placement]);\n      }\n      return defineProperty({}, placement, value);\n    },\n    secondary: function secondary(placement) {\n      var mainSide = placement === 'right' ? 'left' : 'top';\n      var value = popper[mainSide];\n      if (popper[placement] > boundaries[placement] && !options.escapeWithReference) {\n        value = Math.min(popper[mainSide], boundaries[placement] - (placement === 'right' ? popper.width : popper.height));\n      }\n      return defineProperty({}, mainSide, value);\n    }\n  };\n\n  order.forEach(function (placement) {\n    var side = ['left', 'top'].indexOf(placement) !== -1 ? 'primary' : 'secondary';\n    popper = _extends({}, popper, check[side](placement));\n  });\n\n  data.offsets.popper = popper;\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction shift(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var shiftvariation = placement.split('-')[1];\n\n  // if shift shiftvariation is specified, run the modifier\n  if (shiftvariation) {\n    var _data$offsets = data.offsets,\n        reference = _data$offsets.reference,\n        popper = _data$offsets.popper;\n\n    var isVertical = ['bottom', 'top'].indexOf(basePlacement) !== -1;\n    var side = isVertical ? 'left' : 'top';\n    var measurement = isVertical ? 'width' : 'height';\n\n    var shiftOffsets = {\n      start: defineProperty({}, side, reference[side]),\n      end: defineProperty({}, side, reference[side] + reference[measurement] - popper[measurement])\n    };\n\n    data.offsets.popper = _extends({}, popper, shiftOffsets[shiftvariation]);\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction hide(data) {\n  if (!isModifierRequired(data.instance.modifiers, 'hide', 'preventOverflow')) {\n    return data;\n  }\n\n  var refRect = data.offsets.reference;\n  var bound = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'preventOverflow';\n  }).boundaries;\n\n  if (refRect.bottom < bound.top || refRect.left > bound.right || refRect.top > bound.bottom || refRect.right < bound.left) {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === true) {\n      return data;\n    }\n\n    data.hide = true;\n    data.attributes['x-out-of-boundaries'] = '';\n  } else {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === false) {\n      return data;\n    }\n\n    data.hide = false;\n    data.attributes['x-out-of-boundaries'] = false;\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction inner(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isHoriz = ['left', 'right'].indexOf(basePlacement) !== -1;\n\n  var subtractLength = ['top', 'left'].indexOf(basePlacement) === -1;\n\n  popper[isHoriz ? 'left' : 'top'] = reference[basePlacement] - (subtractLength ? popper[isHoriz ? 'width' : 'height'] : 0);\n\n  data.placement = getOppositePlacement(placement);\n  data.offsets.popper = getClientRect(popper);\n\n  return data;\n}\n\n/**\n * Modifier function, each modifier can have a function of this type assigned\n * to its `fn` property.<br />\n * These functions will be called on each update, this means that you must\n * make sure they are performant enough to avoid performance bottlenecks.\n *\n * @function ModifierFn\n * @argument {dataObject} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {dataObject} The data object, properly modified\n */\n\n/**\n * Modifiers are plugins used to alter the behavior of your poppers.<br />\n * Popper.js uses a set of 9 modifiers to provide all the basic functionalities\n * needed by the library.\n *\n * Usually you don't want to override the `order`, `fn` and `onLoad` props.\n * All the other properties are configurations that could be tweaked.\n * @namespace modifiers\n */\nvar modifiers = {\n  /**\n   * Modifier used to shift the popper on the start or end of its reference\n   * element.<br />\n   * It will read the variation of the `placement` property.<br />\n   * It can be one either `-end` or `-start`.\n   * @memberof modifiers\n   * @inner\n   */\n  shift: {\n    /** @prop {number} order=100 - Index used to define the order of execution */\n    order: 100,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: shift\n  },\n\n  /**\n   * The `offset` modifier can shift your popper on both its axis.\n   *\n   * It accepts the following units:\n   * - `px` or unitless, interpreted as pixels\n   * - `%` or `%r`, percentage relative to the length of the reference element\n   * - `%p`, percentage relative to the length of the popper element\n   * - `vw`, CSS viewport width unit\n   * - `vh`, CSS viewport height unit\n   *\n   * For length is intended the main axis relative to the placement of the popper.<br />\n   * This means that if the placement is `top` or `bottom`, the length will be the\n   * `width`. In case of `left` or `right`, it will be the height.\n   *\n   * You can provide a single value (as `Number` or `String`), or a pair of values\n   * as `String` divided by a comma or one (or more) white spaces.<br />\n   * The latter is a deprecated method because it leads to confusion and will be\n   * removed in v2.<br />\n   * Additionally, it accepts additions and subtractions between different units.\n   * Note that multiplications and divisions aren't supported.\n   *\n   * Valid examples are:\n   * ```\n   * 10\n   * '10%'\n   * '10, 10'\n   * '10%, 10'\n   * '10 + 10%'\n   * '10 - 5vh + 3%'\n   * '-10px + 5vh, 5px - 6%'\n   * ```\n   * > **NB**: If you desire to apply offsets to your poppers in a way that may make them overlap\n   * > with their reference element, unfortunately, you will have to disable the `flip` modifier.\n   * > More on this [reading this issue](https://github.com/FezVrasta/popper.js/issues/373)\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  offset: {\n    /** @prop {number} order=200 - Index used to define the order of execution */\n    order: 200,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: offset,\n    /** @prop {Number|String} offset=0\n     * The offset value as described in the modifier description\n     */\n    offset: 0\n  },\n\n  /**\n   * Modifier used to prevent the popper from being positioned outside the boundary.\n   *\n   * An scenario exists where the reference itself is not within the boundaries.<br />\n   * We can say it has \"escaped the boundaries\" — or just \"escaped\".<br />\n   * In this case we need to decide whether the popper should either:\n   *\n   * - detach from the reference and remain \"trapped\" in the boundaries, or\n   * - if it should ignore the boundary and \"escape with its reference\"\n   *\n   * When `escapeWithReference` is set to`true` and reference is completely\n   * outside its boundaries, the popper will overflow (or completely leave)\n   * the boundaries in order to remain attached to the edge of the reference.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  preventOverflow: {\n    /** @prop {number} order=300 - Index used to define the order of execution */\n    order: 300,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: preventOverflow,\n    /**\n     * @prop {Array} [priority=['left','right','top','bottom']]\n     * Popper will try to prevent overflow following these priorities by default,\n     * then, it could overflow on the left and on top of the `boundariesElement`\n     */\n    priority: ['left', 'right', 'top', 'bottom'],\n    /**\n     * @prop {number} padding=5\n     * Amount of pixel used to define a minimum distance between the boundaries\n     * and the popper this makes sure the popper has always a little padding\n     * between the edges of its container\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='scrollParent'\n     * Boundaries used by the modifier, can be `scrollParent`, `window`,\n     * `viewport` or any DOM element.\n     */\n    boundariesElement: 'scrollParent'\n  },\n\n  /**\n   * Modifier used to make sure the reference and its popper stay near eachothers\n   * without leaving any gap between the two. Expecially useful when the arrow is\n   * enabled and you want to assure it to point to its reference element.\n   * It cares only about the first axis, you can still have poppers with margin\n   * between the popper and its reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  keepTogether: {\n    /** @prop {number} order=400 - Index used to define the order of execution */\n    order: 400,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: keepTogether\n  },\n\n  /**\n   * This modifier is used to move the `arrowElement` of the popper to make\n   * sure it is positioned between the reference element and its popper element.\n   * It will read the outer size of the `arrowElement` node to detect how many\n   * pixels of conjuction are needed.\n   *\n   * It has no effect if no `arrowElement` is provided.\n   * @memberof modifiers\n   * @inner\n   */\n  arrow: {\n    /** @prop {number} order=500 - Index used to define the order of execution */\n    order: 500,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: arrow,\n    /** @prop {String|HTMLElement} element='[x-arrow]' - Selector or node used as arrow */\n    element: '[x-arrow]'\n  },\n\n  /**\n   * Modifier used to flip the popper's placement when it starts to overlap its\n   * reference element.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   *\n   * **NOTE:** this modifier will interrupt the current update cycle and will\n   * restart it if it detects the need to flip the placement.\n   * @memberof modifiers\n   * @inner\n   */\n  flip: {\n    /** @prop {number} order=600 - Index used to define the order of execution */\n    order: 600,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: flip,\n    /**\n     * @prop {String|Array} behavior='flip'\n     * The behavior used to change the popper's placement. It can be one of\n     * `flip`, `clockwise`, `counterclockwise` or an array with a list of valid\n     * placements (with optional variations).\n     */\n    behavior: 'flip',\n    /**\n     * @prop {number} padding=5\n     * The popper will flip if it hits the edges of the `boundariesElement`\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='viewport'\n     * The element which will define the boundaries of the popper position,\n     * the popper will never be placed outside of the defined boundaries\n     * (except if keepTogether is enabled)\n     */\n    boundariesElement: 'viewport'\n  },\n\n  /**\n   * Modifier used to make the popper flow toward the inner of the reference element.\n   * By default, when this modifier is disabled, the popper will be placed outside\n   * the reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  inner: {\n    /** @prop {number} order=700 - Index used to define the order of execution */\n    order: 700,\n    /** @prop {Boolean} enabled=false - Whether the modifier is enabled or not */\n    enabled: false,\n    /** @prop {ModifierFn} */\n    fn: inner\n  },\n\n  /**\n   * Modifier used to hide the popper when its reference element is outside of the\n   * popper boundaries. It will set a `x-out-of-boundaries` attribute which can\n   * be used to hide with a CSS selector the popper when its reference is\n   * out of boundaries.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   * @memberof modifiers\n   * @inner\n   */\n  hide: {\n    /** @prop {number} order=800 - Index used to define the order of execution */\n    order: 800,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: hide\n  },\n\n  /**\n   * Computes the style that will be applied to the popper element to gets\n   * properly positioned.\n   *\n   * Note that this modifier will not touch the DOM, it just prepares the styles\n   * so that `applyStyle` modifier can apply it. This separation is useful\n   * in case you need to replace `applyStyle` with a custom implementation.\n   *\n   * This modifier has `850` as `order` value to maintain backward compatibility\n   * with previous versions of Popper.js. Expect the modifiers ordering method\n   * to change in future major versions of the library.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  computeStyle: {\n    /** @prop {number} order=850 - Index used to define the order of execution */\n    order: 850,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: computeStyle,\n    /**\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3d transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties.\n     */\n    gpuAcceleration: true,\n    /**\n     * @prop {string} [x='bottom']\n     * Where to anchor the X axis (`bottom` or `top`). AKA X offset origin.\n     * Change this if your popper should grow in a direction different from `bottom`\n     */\n    x: 'bottom',\n    /**\n     * @prop {string} [x='left']\n     * Where to anchor the Y axis (`left` or `right`). AKA Y offset origin.\n     * Change this if your popper should grow in a direction different from `right`\n     */\n    y: 'right'\n  },\n\n  /**\n   * Applies the computed styles to the popper element.\n   *\n   * All the DOM manipulations are limited to this modifier. This is useful in case\n   * you want to integrate Popper.js inside a framework or view library and you\n   * want to delegate all the DOM manipulations to it.\n   *\n   * Note that if you disable this modifier, you must make sure the popper element\n   * has its position set to `absolute` before Popper.js can do its work!\n   *\n   * Just disable this modifier and define you own to achieve the desired effect.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  applyStyle: {\n    /** @prop {number} order=900 - Index used to define the order of execution */\n    order: 900,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: applyStyle,\n    /** @prop {Function} */\n    onLoad: applyStyleOnLoad,\n    /**\n     * @deprecated since version 1.10.0, the property moved to `computeStyle` modifier\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3d transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties.\n     */\n    gpuAcceleration: undefined\n  }\n};\n\n/**\n * The `dataObject` is an object containing all the informations used by Popper.js\n * this object get passed to modifiers and to the `onCreate` and `onUpdate` callbacks.\n * @name dataObject\n * @property {Object} data.instance The Popper.js instance\n * @property {String} data.placement Placement applied to popper\n * @property {String} data.originalPlacement Placement originally defined on init\n * @property {Boolean} data.flipped True if popper has been flipped by flip modifier\n * @property {Boolean} data.hide True if the reference element is out of boundaries, useful to know when to hide the popper.\n * @property {HTMLElement} data.arrowElement Node used as arrow by arrow modifier\n * @property {Object} data.styles Any CSS property defined here will be applied to the popper, it expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.arrowStyles Any CSS property defined here will be applied to the popper arrow, it expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.boundaries Offsets of the popper boundaries\n * @property {Object} data.offsets The measurements of popper, reference and arrow elements.\n * @property {Object} data.offsets.popper `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.reference `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.arrow] `top` and `left` offsets, only one of them will be different from 0\n */\n\n/**\n * Default options provided to Popper.js constructor.<br />\n * These can be overriden using the `options` argument of Popper.js.<br />\n * To override an option, simply pass as 3rd argument an object with the same\n * structure of this object, example:\n * ```\n * new Popper(ref, pop, {\n *   modifiers: {\n *     preventOverflow: { enabled: false }\n *   }\n * })\n * ```\n * @type {Object}\n * @static\n * @memberof Popper\n */\nvar Defaults = {\n  /**\n   * Popper's placement\n   * @prop {Popper.placements} placement='bottom'\n   */\n  placement: 'bottom',\n\n  /**\n   * Set this to true if you want popper to position it self in 'fixed' mode\n   * @prop {Boolean} positionFixed=false\n   */\n  positionFixed: false,\n\n  /**\n   * Whether events (resize, scroll) are initially enabled\n   * @prop {Boolean} eventsEnabled=true\n   */\n  eventsEnabled: true,\n\n  /**\n   * Set to true if you want to automatically remove the popper when\n   * you call the `destroy` method.\n   * @prop {Boolean} removeOnDestroy=false\n   */\n  removeOnDestroy: false,\n\n  /**\n   * Callback called when the popper is created.<br />\n   * By default, is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onCreate}\n   */\n  onCreate: function onCreate() {},\n\n  /**\n   * Callback called when the popper is updated, this callback is not called\n   * on the initialization/creation of the popper, but only on subsequent\n   * updates.<br />\n   * By default, is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onUpdate}\n   */\n  onUpdate: function onUpdate() {},\n\n  /**\n   * List of modifiers used to modify the offsets before they are applied to the popper.\n   * They provide most of the functionalities of Popper.js\n   * @prop {modifiers}\n   */\n  modifiers: modifiers\n};\n\n/**\n * @callback onCreate\n * @param {dataObject} data\n */\n\n/**\n * @callback onUpdate\n * @param {dataObject} data\n */\n\n// Utils\n// Methods\nvar Popper = function () {\n  /**\n   * Create a new Popper.js instance\n   * @class Popper\n   * @param {HTMLElement|referenceObject} reference - The reference element used to position the popper\n   * @param {HTMLElement} popper - The HTML element used as popper.\n   * @param {Object} options - Your custom options to override the ones defined in [Defaults](#defaults)\n   * @return {Object} instance - The generated Popper.js instance\n   */\n  function Popper(reference, popper) {\n    var _this = this;\n\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    classCallCheck(this, Popper);\n\n    this.scheduleUpdate = function () {\n      return requestAnimationFrame(_this.update);\n    };\n\n    // make update() debounced, so that it only runs at most once-per-tick\n    this.update = debounce(this.update.bind(this));\n\n    // with {} we create a new object with the options inside it\n    this.options = _extends({}, Popper.Defaults, options);\n\n    // init state\n    this.state = {\n      isDestroyed: false,\n      isCreated: false,\n      scrollParents: []\n    };\n\n    // get reference and popper elements (allow jQuery wrappers)\n    this.reference = reference && reference.jquery ? reference[0] : reference;\n    this.popper = popper && popper.jquery ? popper[0] : popper;\n\n    // Deep merge modifiers options\n    this.options.modifiers = {};\n    Object.keys(_extends({}, Popper.Defaults.modifiers, options.modifiers)).forEach(function (name) {\n      _this.options.modifiers[name] = _extends({}, Popper.Defaults.modifiers[name] || {}, options.modifiers ? options.modifiers[name] : {});\n    });\n\n    // Refactoring modifiers' list (Object => Array)\n    this.modifiers = Object.keys(this.options.modifiers).map(function (name) {\n      return _extends({\n        name: name\n      }, _this.options.modifiers[name]);\n    })\n    // sort the modifiers by order\n    .sort(function (a, b) {\n      return a.order - b.order;\n    });\n\n    // modifiers have the ability to execute arbitrary code when Popper.js get inited\n    // such code is executed in the same order of its modifier\n    // they could add new properties to their options configuration\n    // BE AWARE: don't add options to `options.modifiers.name` but to `modifierOptions`!\n    this.modifiers.forEach(function (modifierOptions) {\n      if (modifierOptions.enabled && isFunction(modifierOptions.onLoad)) {\n        modifierOptions.onLoad(_this.reference, _this.popper, _this.options, modifierOptions, _this.state);\n      }\n    });\n\n    // fire the first update to position the popper in the right place\n    this.update();\n\n    var eventsEnabled = this.options.eventsEnabled;\n    if (eventsEnabled) {\n      // setup event listeners, they will take care of update the position in specific situations\n      this.enableEventListeners();\n    }\n\n    this.state.eventsEnabled = eventsEnabled;\n  }\n\n  // We can't use class properties because they don't get listed in the\n  // class prototype and break stuff like Sinon stubs\n\n\n  createClass(Popper, [{\n    key: 'update',\n    value: function update$$1() {\n      return update.call(this);\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy$$1() {\n      return destroy.call(this);\n    }\n  }, {\n    key: 'enableEventListeners',\n    value: function enableEventListeners$$1() {\n      return enableEventListeners.call(this);\n    }\n  }, {\n    key: 'disableEventListeners',\n    value: function disableEventListeners$$1() {\n      return disableEventListeners.call(this);\n    }\n\n    /**\n     * Schedule an update, it will run on the next UI update available\n     * @method scheduleUpdate\n     * @memberof Popper\n     */\n\n\n    /**\n     * Collection of utilities useful when writing custom modifiers.\n     * Starting from version 1.7, this method is available only if you\n     * include `popper-utils.js` before `popper.js`.\n     *\n     * **DEPRECATION**: This way to access PopperUtils is deprecated\n     * and will be removed in v2! Use the PopperUtils module directly instead.\n     * Due to the high instability of the methods contained in Utils, we can't\n     * guarantee them to follow semver. Use them at your own risk!\n     * @static\n     * @private\n     * @type {Object}\n     * @deprecated since version 1.8\n     * @member Utils\n     * @memberof Popper\n     */\n\n  }]);\n  return Popper;\n}();\n\n/**\n * The `referenceObject` is an object that provides an interface compatible with Popper.js\n * and lets you use it as replacement of a real DOM node.<br />\n * You can use this method to position a popper relatively to a set of coordinates\n * in case you don't have a DOM node to use as reference.\n *\n * ```\n * new Popper(referenceObject, popperNode);\n * ```\n *\n * NB: This feature isn't supported in Internet Explorer 10\n * @name referenceObject\n * @property {Function} data.getBoundingClientRect\n * A function that returns a set of coordinates compatible with the native `getBoundingClientRect` method.\n * @property {number} data.clientWidth\n * An ES6 getter that will return the width of the virtual reference element.\n * @property {number} data.clientHeight\n * An ES6 getter that will return the height of the virtual reference element.\n */\n\n\nPopper.Utils = (typeof window !== 'undefined' ? window : global).PopperUtils;\nPopper.placements = placements;\nPopper.Defaults = Defaults;\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Popper);\n//# sourceMappingURL=popper.js.map\n\n/* WEBPACK VAR INJECTION */}.call(__webpack_exports__, __webpack_require__(85)))\n\n/***/ }),\n\n/***/ 213:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar _ = __webpack_require__(0);\nvar ResultListRenderer = /** @class */ (function () {\n    function ResultListRenderer(resultListOptions, autoCreateComponentsFn) {\n        this.resultListOptions = resultListOptions;\n        this.autoCreateComponentsFn = autoCreateComponentsFn;\n    }\n    ResultListRenderer.prototype.renderResults = function (resultElements, append, resultDisplayedCallback) {\n        var _this = this;\n        if (append === void 0) { append = false; }\n        return Promise.all([this.getStartFragment(resultElements, append), this.getEndFragment(resultElements, append)]).then(function (_a) {\n            var startFrag = _a[0], endFrag = _a[1];\n            var resultsFragment = document.createDocumentFragment();\n            if (startFrag) {\n                resultsFragment.appendChild(startFrag);\n            }\n            _.each(resultElements, function (resultElement) {\n                resultsFragment.appendChild(resultElement);\n                resultDisplayedCallback(Component_1.Component.getResult(resultElement), resultElement);\n            });\n            if (endFrag) {\n                resultsFragment.appendChild(endFrag);\n            }\n            _this.resultListOptions.resultsContainer.appendChild(resultsFragment);\n        });\n    };\n    ResultListRenderer.prototype.getStartFragment = function (resultElements, append) {\n        return Promise.resolve(document.createDocumentFragment());\n    };\n    ResultListRenderer.prototype.getEndFragment = function (resultElements, append) {\n        return Promise.resolve(document.createDocumentFragment());\n    };\n    return ResultListRenderer;\n}());\nexports.ResultListRenderer = ResultListRenderer;\n\n\n/***/ }),\n\n/***/ 214:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(535);\nvar QueryEvents_1 = __webpack_require__(11);\nvar Logger_1 = __webpack_require__(9);\nvar Strings_1 = __webpack_require__(6);\nvar Dom_1 = __webpack_require__(1);\nvar Utils_1 = __webpack_require__(4);\nvar Component_1 = __webpack_require__(7);\nvar SearchInterface_1 = __webpack_require__(20);\nvar ResponsiveComponents_1 = __webpack_require__(53);\nvar ResponsiveComponentsManager_1 = __webpack_require__(83);\nvar ResponsiveComponentsUtils_1 = __webpack_require__(127);\nvar ResponsiveDropdown_1 = __webpack_require__(119);\nvar ResponsiveDropdownContent_1 = __webpack_require__(66);\nvar ResponsiveDropdownHeader_1 = __webpack_require__(132);\nvar underscore_1 = __webpack_require__(0);\nvar ComponentsTypes_1 = __webpack_require__(47);\nvar ResponsiveDropdownModalContent_1 = __webpack_require__(536);\nvar FacetsMobileMode_1 = __webpack_require__(172);\nvar FacetsMobileModeEvents_1 = __webpack_require__(537);\nvar ResponsiveFacetColumn = /** @class */ (function () {\n    function ResponsiveFacetColumn(coveoRoot, ID, options, responsiveDropdown) {\n        this.coveoRoot = coveoRoot;\n        this.ID = ID;\n        this.componentsInFacetColumn = [];\n        this.preservePositionOriginalValues = [];\n        this.searchInterface = Component_1.Component.get(this.coveoRoot.el, SearchInterface_1.SearchInterface, false);\n        this.dropdownHeaderLabel = this.getDropdownHeaderLabel();\n        this.dropdown = this.buildDropdown(responsiveDropdown);\n        this.bindDropdownContentEvents();\n        this.bindFacetsMobileModeEvents();\n        this.registerOnCloseHandler();\n        this.registerQueryEvents();\n        this.initializeBreakpoint(options.responsiveBreakpoint);\n    }\n    ResponsiveFacetColumn.init = function (responsiveComponentConstructor, root, component, options, ID) {\n        var column = this.findColumn(root);\n        if (!column) {\n            return;\n        }\n        ResponsiveComponentsManager_1.ResponsiveComponentsManager.register(ResponsiveFacetColumn, Dom_1.$$(root), 'ResponsiveFacetColumn', component, options);\n        ResponsiveComponentsManager_1.ResponsiveComponentsManager.register(responsiveComponentConstructor, Dom_1.$$(root), ID, component, options);\n    };\n    ResponsiveFacetColumn.findColumn = function (root) {\n        var column = Dom_1.$$(root).find('.coveo-facet-column');\n        if (!column) {\n            var logger = new Logger_1.Logger('ResponsiveFacets');\n            logger.info('No element with class coveo-facet-column. Responsive facets cannot be enabled');\n        }\n        return column;\n    };\n    Object.defineProperty(ResponsiveFacetColumn.prototype, \"facetsMobileModeComponent\", {\n        get: function () {\n            return this.searchInterface ? this.searchInterface.getComponents(FacetsMobileMode_1.FacetsMobileMode.ID)[0] : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResponsiveFacetColumn.prototype, \"facetsMobileModeOptions\", {\n        get: function () {\n            var facetsMobileModeComponent = this.facetsMobileModeComponent;\n            if (!facetsMobileModeComponent) {\n                return {\n                    isModal: false,\n                    preventScrolling: false,\n                    displayOverlayWhileOpen: true\n                };\n            }\n            return facetsMobileModeComponent.options;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResponsiveFacetColumn.prototype.registerComponent = function (accept) {\n        this.componentsInFacetColumn.push(accept);\n        this.preservePositionOriginalValues.push(accept.options.preservePosition);\n        return true;\n    };\n    ResponsiveFacetColumn.prototype.needDropdownWrapper = function () {\n        return this.needSmallMode();\n    };\n    ResponsiveFacetColumn.prototype.handleResizeEvent = function () {\n        if (this.needSmallMode() && !ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n            this.changeToSmallMode();\n        }\n        else if (!this.needSmallMode() && ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n            this.changeToLargeMode();\n        }\n        if (this.dropdown.isOpened) {\n            this.dropdown.dropdownContent.positionDropdown();\n        }\n    };\n    ResponsiveFacetColumn.prototype.dismissFacetSearches = function () {\n        underscore_1.each(this.componentsInFacetColumn, function (component) {\n            if (component.facetSearch && component.facetSearch.currentlyDisplayedResults) {\n                component.facetSearch.dismissSearchResults();\n            }\n        });\n    };\n    ResponsiveFacetColumn.prototype.needSmallMode = function () {\n        if (!this.searchInterface) {\n            return (this.coveoRoot.width() <=\n                (Utils_1.Utils.isNullOrUndefined(this.breakpoint) ? new ResponsiveComponents_1.ResponsiveComponents().getMediumScreenWidth() : this.breakpoint));\n        }\n        switch (this.searchInterface.responsiveComponents.getResponsiveMode()) {\n            case 'small':\n            case 'medium':\n                return true;\n            case 'auto':\n                return (this.coveoRoot.width() <=\n                    (Utils_1.Utils.isNullOrUndefined(this.breakpoint) ? this.searchInterface.responsiveComponents.getMediumScreenWidth() : this.breakpoint));\n            default:\n                return false;\n        }\n    };\n    ResponsiveFacetColumn.prototype.changeToSmallMode = function () {\n        this.dropdown.close();\n        this.disableFacetPreservePosition();\n        Dom_1.$$(this.coveoRoot.find(\".\" + ResponsiveComponentsManager_1.ResponsiveComponentsManager.DROPDOWN_HEADER_WRAPPER_CSS_CLASS)).append(this.dropdown.dropdownHeader.element.el);\n        ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.activateSmallFacet(this.coveoRoot);\n    };\n    ResponsiveFacetColumn.prototype.changeToLargeMode = function () {\n        this.restoreFacetPreservePositionValue();\n        this.dropdown.cleanUp();\n        ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.deactivateSmallFacet(this.coveoRoot);\n    };\n    ResponsiveFacetColumn.prototype.buildDropdown = function (responsiveDropdown) {\n        var dropdownContent = this.buildDropdownContent();\n        var dropdownHeader = this.buildDropdownHeader();\n        var dropdown = responsiveDropdown ? responsiveDropdown : new ResponsiveDropdown_1.ResponsiveDropdown(dropdownContent, dropdownHeader, this.coveoRoot);\n        return dropdown;\n    };\n    ResponsiveFacetColumn.prototype.buildDropdownContent = function () {\n        var _this = this;\n        var dropdownContentElement = Dom_1.$$(this.coveoRoot.find('.coveo-facet-column'));\n        var filterByContainer = Dom_1.$$('div', { className: 'coveo-facet-header-filter-by-container', style: 'display: none' });\n        var filterBy = Dom_1.$$('div', { className: 'coveo-facet-header-filter-by' });\n        filterBy.text(Strings_1.l('Filter by:'));\n        filterByContainer.append(filterBy.el);\n        dropdownContentElement.prepend(filterByContainer.el);\n        if (this.facetsMobileModeOptions.isModal) {\n            return new ResponsiveDropdownModalContent_1.ResponsiveDropdownModalContent('facet', dropdownContentElement, Strings_1.l('CloseFiltersDropdown'), function () { return _this.dropdown.close(); });\n        }\n        return new ResponsiveDropdownContent_1.ResponsiveDropdownContent(dropdownContentElement);\n    };\n    ResponsiveFacetColumn.prototype.buildDropdownHeader = function () {\n        var dropdownHeaderElement = Dom_1.$$('a');\n        var content = Dom_1.$$('p');\n        content.text(this.dropdownHeaderLabel);\n        dropdownHeaderElement.el.appendChild(content.el);\n        var dropdownHeader = new ResponsiveDropdownHeader_1.ResponsiveDropdownHeader('facet', dropdownHeaderElement);\n        return dropdownHeader;\n    };\n    ResponsiveFacetColumn.prototype.initializeBreakpoint = function (defaultBreakpoint) {\n        var facetsMobileModeBreakpoint = this.facetsMobileModeOptions.breakpoint;\n        this.breakpoint = Utils_1.Utils.isNullOrUndefined(facetsMobileModeBreakpoint) ? defaultBreakpoint : facetsMobileModeBreakpoint;\n    };\n    ResponsiveFacetColumn.prototype.registerOnCloseHandler = function () {\n        this.dropdown.registerOnCloseHandler(this.dismissFacetSearches, this);\n    };\n    ResponsiveFacetColumn.prototype.registerQueryEvents = function () {\n        var _this = this;\n        this.coveoRoot.on(QueryEvents_1.QueryEvents.noResults, function () { return _this.handleNoResults(); });\n        this.coveoRoot.on(QueryEvents_1.QueryEvents.querySuccess, function (e, data) { return _this.handleQuerySuccess(data); });\n        this.coveoRoot.on(QueryEvents_1.QueryEvents.queryError, function () { return _this.handleQueryError(); });\n    };\n    ResponsiveFacetColumn.prototype.bindDropdownContentEvents = function () {\n        var _this = this;\n        this.dropdown.dropdownContent.element.on('scroll', underscore_1.debounce(function () {\n            underscore_1.each(_this.componentsInFacetColumn, function (component) {\n                var facetSearch = component.facetSearch;\n                if (facetSearch && facetSearch.currentlyDisplayedResults && !_this.isFacetSearchScrolledIntoView(facetSearch.search)) {\n                    component.facetSearch.positionSearchResults(_this.dropdown.dropdownContent.element.el);\n                }\n                else if (facetSearch && component.facetSearch.currentlyDisplayedResults) {\n                    component.facetSearch.positionSearchResults();\n                }\n            });\n        }, ResponsiveFacetColumn.DEBOUNCE_SCROLL_WAIT));\n    };\n    ResponsiveFacetColumn.prototype.bindFacetsMobileModeEvents = function () {\n        var facetsMobileModeComponent = this.facetsMobileModeComponent;\n        if (facetsMobileModeComponent) {\n            this.dropdown.registerOnOpenHandler(function () { return Dom_1.$$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents_1.FacetsMobileModeEvents.popupOpened); }, facetsMobileModeComponent);\n            this.dropdown.registerOnCloseHandler(function () { return Dom_1.$$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents_1.FacetsMobileModeEvents.popupClosed); }, facetsMobileModeComponent);\n        }\n    };\n    ResponsiveFacetColumn.prototype.restoreFacetPreservePositionValue = function () {\n        var _this = this;\n        underscore_1.each(this.componentsInFacetColumn, function (component, index) {\n            if (component.options) {\n                component.options.preservePosition = _this.preservePositionOriginalValues[index];\n            }\n        });\n    };\n    ResponsiveFacetColumn.prototype.disableFacetPreservePosition = function () {\n        underscore_1.each(this.componentsInFacetColumn, function (component) {\n            if (component.options) {\n                component.options.preservePosition = false;\n            }\n        });\n    };\n    ResponsiveFacetColumn.prototype.isFacetSearchScrolledIntoView = function (facetSearchElement) {\n        var facetTop = facetSearchElement.getBoundingClientRect().top;\n        var facetBottom = facetSearchElement.getBoundingClientRect().bottom;\n        var dropdownTop = this.dropdown.dropdownContent.element.el.getBoundingClientRect().top;\n        var dropdownBottom = this.dropdown.dropdownContent.element.el.getBoundingClientRect().bottom;\n        dropdownTop = dropdownTop >= 0 ? dropdownTop : 0;\n        return facetTop >= dropdownTop && facetBottom <= dropdownBottom;\n    };\n    ResponsiveFacetColumn.prototype.getDropdownHeaderLabel = function () {\n        var dropdownHeaderLabel;\n        ComponentsTypes_1.ComponentsTypes.getAllFacetInstancesFromElement(this.coveoRoot.find('.coveo-facet-column')).forEach(function (facet) {\n            var options = facet.options;\n            if (!dropdownHeaderLabel && options.dropdownHeaderLabel) {\n                dropdownHeaderLabel = options.dropdownHeaderLabel;\n            }\n        });\n        if (!dropdownHeaderLabel) {\n            dropdownHeaderLabel = Strings_1.l(ResponsiveFacetColumn.DROPDOWN_HEADER_LABEL_DEFAULT_VALUE);\n        }\n        return dropdownHeaderLabel;\n    };\n    ResponsiveFacetColumn.prototype.handleNoResults = function () {\n        this.dropdown.dropdownHeader.hide();\n    };\n    ResponsiveFacetColumn.prototype.handleQueryError = function () {\n        this.dropdown.dropdownHeader.hide();\n    };\n    ResponsiveFacetColumn.prototype.handleQuerySuccess = function (data) {\n        if (data.results.totalCount === 0) {\n            this.dropdown.dropdownHeader.hide();\n        }\n        else {\n            this.dropdown.dropdownHeader.show();\n        }\n    };\n    ResponsiveFacetColumn.DEBOUNCE_SCROLL_WAIT = 250;\n    ResponsiveFacetColumn.DROPDOWN_HEADER_LABEL_DEFAULT_VALUE = 'Filters';\n    return ResponsiveFacetColumn;\n}());\nexports.ResponsiveFacetColumn = ResponsiveFacetColumn;\n\n\n/***/ }),\n\n/***/ 215:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path='../ui/Facet/Facet.ts' />\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ExpressionBuilder_1 = __webpack_require__(73);\nvar Utils_1 = __webpack_require__(4);\nvar FacetSearchParameters_1 = __webpack_require__(169);\nvar Assert_1 = __webpack_require__(5);\nvar FacetUtils_1 = __webpack_require__(40);\nvar _ = __webpack_require__(0);\nvar QueryBuilderExpression_1 = __webpack_require__(183);\nvar FacetQueryController = /** @class */ (function () {\n    function FacetQueryController(facet) {\n        this.facet = facet;\n    }\n    /**\n     * Reset the expression for the facet search, used when a new query is triggered\n     */\n    FacetQueryController.prototype.prepareForNewQuery = function () {\n        this.lastGroupByRequestIndex = undefined;\n        this.expressionToUseForFacetSearch = undefined;\n        this.constantExpressionToUseForFacetSearch = undefined;\n    };\n    /**\n     * Compute the filter expression that the facet needs to output for the query\n     * @returns {string}\n     */\n    FacetQueryController.prototype.computeOurFilterExpression = function () {\n        var _this = this;\n        var builder = new ExpressionBuilder_1.ExpressionBuilder();\n        var selected = this.facet.values.getSelected();\n        if (selected.length > 0) {\n            if (this.facet.options.useAnd) {\n                _.each(selected, function (value) {\n                    builder.addFieldExpression(_this.facet.options.field, '==', [value.value]);\n                });\n            }\n            else {\n                builder.addFieldExpression(this.facet.options.field, '==', _.map(selected, function (value) { return value.value; }));\n            }\n        }\n        var excluded = this.facet.values.getExcluded();\n        if (excluded.length > 0) {\n            builder.addFieldNotEqualExpression(this.facet.options.field, _.map(excluded, function (value) { return value.value; }));\n        }\n        if (Utils_1.Utils.isNonEmptyString(this.facet.options.additionalFilter)) {\n            builder.add(this.facet.options.additionalFilter);\n        }\n        return builder.build();\n    };\n    /**\n     * Build the group by request for the facet, and insert it in the query builder\n     * @param queryBuilder\n     */\n    FacetQueryController.prototype.putGroupByIntoQueryBuilder = function (queryBuilder) {\n        Assert_1.Assert.exists(queryBuilder);\n        var allowedValues = this.createGroupByAllowedValues();\n        var groupByRequest = this.createBasicGroupByRequest(allowedValues);\n        var queryOverrideObject = this.createGroupByQueryOverride(queryBuilder);\n        if (!Utils_1.Utils.isNullOrUndefined(queryOverrideObject) || !QueryBuilderExpression_1.QueryBuilderExpression.isEmpty(queryOverrideObject)) {\n            groupByRequest.queryOverride = queryOverrideObject.basic;\n            groupByRequest.advancedQueryOverride = queryOverrideObject.advanced;\n            groupByRequest.constantQueryOverride = queryOverrideObject.constant;\n            this.expressionToUseForFacetSearch = queryOverrideObject.withoutConstant;\n            this.basicExpressionToUseForFacetSearch = queryOverrideObject.basic;\n            this.advancedExpressionToUseForFacetSearch = queryOverrideObject.advanced;\n            this.constantExpressionToUseForFacetSearch = queryOverrideObject.constant;\n        }\n        else {\n            var parts = queryBuilder.computeCompleteExpressionParts();\n            this.expressionToUseForFacetSearch = parts.withoutConstant == null ? '' : parts.withoutConstant;\n            this.basicExpressionToUseForFacetSearch = parts.basic == null ? '' : parts.basic;\n            this.advancedExpressionToUseForFacetSearch = parts.advanced;\n            this.constantExpressionToUseForFacetSearch = parts.constant;\n        }\n        this.lastGroupByRequestIndex = queryBuilder.groupByRequests.length;\n        this.lastGroupByRequest = groupByRequest;\n        queryBuilder.groupByRequests.push(groupByRequest);\n    };\n    /**\n     * Search inside the facet, using a group by request\n     * @param params\n     * @param oldLength Optional params, used by the search method to call itself recursively to fetch all required values\n     * @returns {Promise|Promise<T>}\n     */\n    FacetQueryController.prototype.search = function (params, oldLength) {\n        var _this = this;\n        if (oldLength === void 0) { oldLength = params.nbResults; }\n        // For search, we want to retrieve the exact values we requested, and not additional ones\n        params.completeFacetWithStandardValues = false;\n        return new Promise(function (resolve, reject) {\n            var onResult = function (fieldValues) {\n                var newLength = fieldValues.length;\n                fieldValues = _this.checkForFacetSearchValuesToRemove(fieldValues, params.valueToSearch);\n                if (FacetUtils_1.FacetUtils.needAnotherFacetSearch(fieldValues.length, newLength, oldLength, 5)) {\n                    // This means that we removed enough values from the returned one that we need to perform a new search with more values requested.\n                    params.nbResults += 5;\n                    return _this.search(params, fieldValues.length);\n                }\n                else {\n                    resolve(fieldValues);\n                }\n            };\n            var searchPromise = _this.facet.getEndpoint().search(params.getQuery());\n            _this.currentSearchPromise = searchPromise;\n            searchPromise\n                .then(function (queryResults) {\n                if (_this.currentSearchPromise == searchPromise) {\n                    // params.getQuery() will generate a query for all excluded values + some new values\n                    // there is no clean way to do a group by and remove some values\n                    // so instead we request more values than we need, and crop all the one we don't want\n                    var valuesCropped_1 = [];\n                    if (queryResults.groupByResults && queryResults.groupByResults[0]) {\n                        _.each(queryResults.groupByResults[0].values, function (v) {\n                            if (v.lookupValue) {\n                                if (!_.contains(params.alwaysExclude, v.lookupValue.toLowerCase())) {\n                                    valuesCropped_1.push(v);\n                                }\n                            }\n                            else {\n                                if (!_.contains(params.alwaysExclude, v.value.toLowerCase())) {\n                                    valuesCropped_1.push(v);\n                                }\n                            }\n                        });\n                    }\n                    onResult(_.first(valuesCropped_1, params.nbResults));\n                }\n                else {\n                    reject();\n                }\n            })\n                .catch(function (error) {\n                reject(error);\n            });\n        });\n    };\n    FacetQueryController.prototype.fetchMore = function (numberOfValuesToFetch) {\n        var _this = this;\n        var params = new FacetSearchParameters_1.FacetSearchParameters(this.facet);\n        params.alwaysInclude = this.facet.options.allowedValues || _.pluck(this.facet.values.getAll(), 'value');\n        params.nbResults = numberOfValuesToFetch;\n        return this.facet\n            .getEndpoint()\n            .search(params.getQuery())\n            .then(function (results) {\n            if (_this.facet.options.allowedValues && results && results.groupByResults && results.groupByResults[0]) {\n                results.groupByResults[0].values = _this.filterByAllowedValueOption(results.groupByResults[0].values);\n            }\n            return results;\n        });\n    };\n    FacetQueryController.prototype.searchInFacetToUpdateDelta = function (facetValues) {\n        var params = new FacetSearchParameters_1.FacetSearchParameters(this.facet);\n        var query = params.getQuery();\n        query.aq = (query.aq ? query.aq : '') + \" \" + this.computeOurFilterExpression();\n        _.each(facetValues, function (facetValue) {\n            facetValue.waitingForDelta = true;\n        });\n        query.groupBy = [this.createBasicGroupByRequest(_.map(facetValues, function (facetValue) { return facetValue.value; }))];\n        query.groupBy[0].completeFacetWithStandardValues = false;\n        return this.facet.getEndpoint().search(query);\n    };\n    FacetQueryController.prototype.createGroupByAllowedValues = function () {\n        // if you want to keep displayed values next time, take all current values as allowed values\n        // otherwise take only the selected value\n        if (this.facet.options.allowedValues != undefined) {\n            return this.facet.options.allowedValues;\n        }\n        else if (this.facet.options.customSort != undefined) {\n            // If there is a custom sort, we still need to add selectedValues to the group by\n            // Filter out duplicates with a lower case comparison on the value\n            return this.getUnionWithCustomSortLowercase(this.facet.options.customSort, this.getAllowedValuesFromSelected());\n        }\n        else {\n            return _.map(this.getAllowedValuesFromSelected(), function (facetValue) { return facetValue.value; });\n        }\n    };\n    FacetQueryController.prototype.createBasicGroupByRequest = function (allowedValues, addComputedField) {\n        if (addComputedField === void 0) { addComputedField = true; }\n        var nbOfRequestedValues = this.facet.numberOfValues;\n        if (this.facet.options.customSort != null) {\n            // If we have a custom sort, we need to make sure that we always request at least enough values to always receive them\n            var usedValues = this.getUnionWithCustomSortLowercase(this.facet.options.customSort, this.facet.values.getSelected().concat(this.facet.values.getExcluded()));\n            nbOfRequestedValues = Math.max(nbOfRequestedValues, usedValues.length);\n        }\n        var groupByRequest = {\n            field: this.facet.options.field,\n            maximumNumberOfValues: nbOfRequestedValues + (this.facet.options.enableMoreLess ? 1 : 0),\n            sortCriteria: this.facet.options.sortCriteria,\n            injectionDepth: this.facet.options.injectionDepth,\n            completeFacetWithStandardValues: this.facet.options.allowedValues == undefined ? true : false\n        };\n        if (this.facet.options.lookupField) {\n            groupByRequest.lookupField = this.facet.options.lookupField;\n        }\n        if (allowedValues != null) {\n            groupByRequest.allowedValues = allowedValues;\n        }\n        if (addComputedField && Utils_1.Utils.isNonEmptyString(this.facet.options.computedField)) {\n            groupByRequest.computedFields = [\n                {\n                    field: this.facet.options.computedField,\n                    operation: this.facet.options.computedFieldOperation\n                }\n            ];\n        }\n        return groupByRequest;\n    };\n    FacetQueryController.prototype.getAllowedValuesFromSelected = function () {\n        var facetValues = [];\n        if (this.facet.options.useAnd || !this.facet.keepDisplayedValuesNextTime) {\n            var selected = this.facet.values.getSelected();\n            if (selected.length == 0) {\n                return undefined;\n            }\n            facetValues = this.facet.values.getSelected();\n        }\n        else {\n            facetValues = this.facet.values.getAll();\n        }\n        return facetValues;\n    };\n    Object.defineProperty(FacetQueryController.prototype, \"additionalFilter\", {\n        get: function () {\n            return this.facet.options.additionalFilter ? this.facet.options.additionalFilter : '';\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetQueryController.prototype.getUnionWithCustomSortLowercase = function (customSort, facetValues) {\n        // This will take the custom sort, compare it against the passed in facetValues\n        // The comparison is lowercase.\n        // The union of the 2 arrays with duplicated filtered out is returned.\n        var toCompare = _.map(customSort, function (val) {\n            return val.toLowerCase();\n        });\n        var filtered = _.chain(facetValues)\n            .filter(function (facetValue) {\n            return !_.contains(toCompare, facetValue.value.toLowerCase());\n        })\n            .map(function (facetValue) {\n            return facetValue.value;\n        })\n            .value();\n        return _.compact(customSort.concat(filtered));\n    };\n    FacetQueryController.prototype.createGroupByQueryOverride = function (queryBuilder) {\n        var queryBuilderExpression = queryBuilder.computeCompleteExpressionParts();\n        if (this.queryOverrideIsNeededForMultiSelection()) {\n            queryBuilderExpression = this.processQueryOverrideForMultiSelection(queryBuilder, queryBuilderExpression);\n        }\n        else {\n            queryBuilderExpression.reset();\n        }\n        if (this.queryOverrideIsNeededForAdditionalFilter()) {\n            queryBuilderExpression = this.processQueryOverrideForAdditionalFilter(queryBuilder, queryBuilderExpression);\n        }\n        queryBuilderExpression = this.processQueryOverrideForEmptyValues(queryBuilder, queryBuilderExpression);\n        if (QueryBuilderExpression_1.QueryBuilderExpression.isEmpty(queryBuilderExpression)) {\n            return null;\n        }\n        return queryBuilderExpression;\n    };\n    FacetQueryController.prototype.queryOverrideIsNeededForMultiSelection = function () {\n        if (this.facet.options.useAnd) {\n            return false;\n        }\n        if (this.facet.values.hasSelectedOrExcludedValues()) {\n            return true;\n        }\n        return false;\n    };\n    FacetQueryController.prototype.queryOverrideIsNeededForAdditionalFilter = function () {\n        return Utils_1.Utils.isNonEmptyString(this.additionalFilter);\n    };\n    FacetQueryController.prototype.processQueryOverrideForMultiSelection = function (queryBuilder, mergeWith) {\n        if (this.facet.values.hasSelectedOrExcludedValues()) {\n            var ourExpression = this.computeOurFilterExpression();\n            mergeWith = queryBuilder.computeCompleteExpressionPartsExcept(ourExpression);\n            if (QueryBuilderExpression_1.QueryBuilderExpression.isEmpty(mergeWith)) {\n                mergeWith.advanced = '@uri';\n            }\n        }\n        return mergeWith;\n    };\n    FacetQueryController.prototype.processQueryOverrideForAdditionalFilter = function (queryBuilder, mergeWith) {\n        if (Utils_1.Utils.isEmptyString(mergeWith.basic)) {\n            mergeWith.basic = queryBuilder.expression.build();\n        }\n        if (Utils_1.Utils.isEmptyString(mergeWith.constant)) {\n            var addExistingConstantExpressionIfNotEmpty = queryBuilder.constantExpression.isEmpty()\n                ? ''\n                : queryBuilder.constantExpression.build() + ' ';\n            mergeWith.constant = \"\" + addExistingConstantExpressionIfNotEmpty + this.additionalFilter;\n        }\n        else {\n            mergeWith.constant = mergeWith.constant + \" \" + this.additionalFilter;\n        }\n        if (!mergeWith.advanced) {\n            mergeWith.advanced = this.getFilterExpressionWithoutOurFilterExpression(queryBuilder);\n        }\n        return mergeWith;\n    };\n    FacetQueryController.prototype.getFilterExpressionWithoutOurFilterExpression = function (queryBuilder) {\n        var expression = new ExpressionBuilder_1.ExpressionBuilder();\n        var advancedExpressionParts = queryBuilder.advancedExpression.getParts();\n        advancedExpressionParts.forEach(function (part) { return expression.add(part); });\n        var currentFacetAdvancedExpression = this.computeOurFilterExpression();\n        expression.remove(currentFacetAdvancedExpression);\n        return expression.build();\n    };\n    FacetQueryController.prototype.processQueryOverrideForEmptyValues = function (queryBuilder, mergeWith) {\n        var withoutEmptyValues = _.chain(mergeWith)\n            .keys()\n            .each(function (key) {\n            if (Utils_1.Utils.isEmptyString(mergeWith[key]) || Utils_1.Utils.isNullOrUndefined(mergeWith[key])) {\n                delete mergeWith[key];\n            }\n        })\n            .value();\n        if (_.keys(withoutEmptyValues).length == 0) {\n            mergeWith = undefined;\n        }\n        return mergeWith;\n    };\n    FacetQueryController.prototype.checkForFacetSearchValuesToRemove = function (fieldValues, valueToCheckAgainst) {\n        var _this = this;\n        var regex = FacetUtils_1.FacetUtils.getRegexToUseForFacetSearch(valueToCheckAgainst, this.facet.options.facetSearchIgnoreAccents);\n        return _.filter(fieldValues, function (fieldValue) {\n            var isAllowed = _.isEmpty(_this.facet.options.allowedValues) || _this.isValueAllowedByAllowedValueOption(fieldValue.value);\n            var value = _this.facet.getValueCaption(fieldValue);\n            return isAllowed && regex.test(value);\n        });\n    };\n    FacetQueryController.prototype.filterByAllowedValueOption = function (values) {\n        var _this = this;\n        return _.filter(values, function (value) { return _this.isValueAllowedByAllowedValueOption(value.value); });\n    };\n    FacetQueryController.prototype.isValueAllowedByAllowedValueOption = function (value) {\n        var _this = this;\n        return _.some(this.facet.options.allowedValues, function (allowedValue) {\n            var regexContent = _this.replaceWildcardsWithRegexEquivalent(_this.escapeMostRegexCharacters(allowedValue));\n            var regex = new RegExp(\"^\" + regexContent + \"$\", 'gi');\n            return regex.test(value);\n        });\n    };\n    FacetQueryController.prototype.escapeMostRegexCharacters = function (text) {\n        // Regex taken from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\n        // `*` and `?` were removed because they are used for wildcards\n        return text.replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&');\n    };\n    FacetQueryController.prototype.replaceWildcardsWithRegexEquivalent = function (text) {\n        // Allowed value option on the facet should support * (wildcard searches)\n        // We need to filter values client side the index will completeWithStandardValues\n        // Replace the wildcard (*) for a regex match (.*)\n        // Also replace the (?) with \"any character once\" since it is also supported by the index\n        return text.replace(/\\*/g, '.*').replace(/\\?/g, '.');\n    };\n    return FacetQueryController;\n}());\nexports.FacetQueryController = FacetQueryController;\n\n\n/***/ }),\n\n/***/ 257:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"../../controllers/HierarchicalFacetQueryController.ts\" />\n/// <reference path=\"HierarchicalFacetValuesList.ts\" />\n/// <reference path=\"HierarchicalFacetSearch.ts\" />\n/// <reference path=\"HierarchicalBreadcrumbValuesList.ts\" />\n/// <reference path=\"HierarchicalFacetValueElement.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetValue_1 = __webpack_require__(114);\nvar Facet_1 = __webpack_require__(69);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar HierarchicalFacetValuesList_1 = __webpack_require__(621);\nvar HierarchicalFacetQueryController_1 = __webpack_require__(622);\nvar Utils_1 = __webpack_require__(4);\nvar Dom_1 = __webpack_require__(1);\nvar Defer_1 = __webpack_require__(29);\nvar HierarchicalFacetSearchValuesList_1 = __webpack_require__(623);\nvar HierarchicalFacetSearch_1 = __webpack_require__(625);\nvar HierarchicalBreadcrumbValuesList_1 = __webpack_require__(626);\nvar Assert_1 = __webpack_require__(5);\nvar OmniboxHierarchicalValuesList_1 = __webpack_require__(628);\nvar HierarchicalFacetValueElement_1 = __webpack_require__(630);\nvar Initialization_1 = __webpack_require__(2);\nvar _ = __webpack_require__(0);\nvar GlobalExports_1 = __webpack_require__(3);\n__webpack_require__(631);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(15);\nvar ResponsiveFacetOptions_1 = __webpack_require__(82);\n/**\n * @deprecated This component is exposed for legacy reasons. Instead, use the {@link CategoryFacet} component, which is more performant and easier to use.\n *\n * The `HierarchicalFacet` component inherits all of its options and behaviors from the [`Facet`]{@link Facet}\n * component, but is meant to be used to render hierarchical values.\n *\n * **Note:**\n * > The `HierarchicalFacet` component does not support the [`customSort`]{@link Facet.options.customSort}\n * > `Facet` option.\n *\n * The `HierarchicalFacet` component can be used to display files in a file system, or categories for items in a\n * hierarchy.\n *\n * This facet requires a group by field with a special format to work correctly.\n *\n * **Example:**\n *\n * You have the following files indexed on a file system:\n * ```\n * c:\\\n *   folder1\\\n *     text1.txt\n *   folder2\\\n *     folder3\\\n *       text2.txt\n * ```\n * The `text1.txt` item would have a field with the following format:\n * `c; c|folder1;`\n *\n * The `text2.txt` item would have a field with the following format:\n * `c; c|folder2; c|folder2|folder3;`\n *\n * By default, the `|` character determines the hierarchy (`folder3` inside `folder2` inside `c`).\n *\n * Since both items contain the `c` value, selecting it value in the facet would return both items.\n *\n * Selecting the `folder3` value in the facet would only return the `text2.txt` item.\n *\n * @notSupportedIn salesforcefree\n *\n * @deprecatedSince [January 2019 Release (v2.5395.12)](https://docs.coveo.com/en/2763/)\n */\nvar HierarchicalFacet = /** @class */ (function (_super) {\n    __extends(HierarchicalFacet, _super);\n    /**\n     * Creates a new `HierarchicalFacet` component.\n     * @param element The HTMLElement on which to instantiate the component.\n     * @param options The options for the `HierarchicalFacet` component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time).\n     */\n    function HierarchicalFacet(element, options, bindings) {\n        var _this = _super.call(this, element, options, bindings, HierarchicalFacet.ID) || this;\n        _this.element = element;\n        _this.bindings = bindings;\n        _this.shouldReshuffleFacetValuesClientSide = false;\n        _this.correctLevels = [];\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, HierarchicalFacet, _this.options);\n        _this.numberOfValuesToShow = _this.originalNumberOfValuesToShow = _this.options.numberOfValues || 5;\n        _this.numberOfValues = Math.max(_this.options.numberOfValues, 10000);\n        _this.options.injectionDepth = Math.max(_this.options.injectionDepth, 10000);\n        _this.logger.info('Hierarchy facet: Set number of values very high in order to build hierarchy', _this.numberOfValues, _this);\n        _this.logger.info('Hierarchy facet: Set injection depth very high in order to build hierarchy', _this.options.injectionDepth);\n        return _this;\n    }\n    /**\n     * Selects a single value.\n     * @param value The value to select.\n     * @param selectChildren Specifies whether to also select all child values (if any). Default value is the opposite of\n     * the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n     */\n    HierarchicalFacet.prototype.selectValue = function (value, selectChildren) {\n        if (selectChildren === void 0) { selectChildren = !this.options.useAnd; }\n        this.ensureDom();\n        this.ensureValueHierarchyExists([value]);\n        var valueHierarchy = this.getValueFromHierarchy(value);\n        if (selectChildren) {\n            this.selectChilds(valueHierarchy, valueHierarchy.childs);\n        }\n        this.flagParentForSelection(valueHierarchy);\n        _super.prototype.selectValue.call(this, value);\n    };\n    /**\n     * Selects multiple values\n     * @param values The array of values to select.\n     * @param selectChildren Specifies whether to also select all child values (if any). Default value is the opposite of\n     * the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n     */\n    HierarchicalFacet.prototype.selectMultipleValues = function (values, selectChildren) {\n        var _this = this;\n        if (selectChildren === void 0) { selectChildren = !this.options.useAnd; }\n        this.ensureDom();\n        this.ensureValueHierarchyExists(values);\n        _.each(values, function (value) {\n            var valueHierarchy = _this.getValueFromHierarchy(value);\n            _this.flagParentForSelection(valueHierarchy);\n            if (selectChildren) {\n                _.each(valueHierarchy.childs, function (child) {\n                    _this.selectValue(child.facetValue);\n                });\n            }\n        });\n        _super.prototype.selectMultipleValues.call(this, values);\n    };\n    /**\n     * Deselects a single value\n     * @param value The value to deselect.\n     * @param deselectChildren Specifies whether to also deselect all child values (if any). Default value is `true`.\n     */\n    HierarchicalFacet.prototype.deselectValue = function (value, deselectChildren) {\n        var _this = this;\n        if (deselectChildren === void 0) { deselectChildren = true; }\n        this.ensureDom();\n        this.ensureValueHierarchyExists([value]);\n        var valueHierarchy = this.getValueFromHierarchy(value);\n        if (deselectChildren) {\n            var hasChilds = valueHierarchy.childs != undefined;\n            if (hasChilds) {\n                var activeChilds = _.filter(valueHierarchy.childs, function (child) {\n                    var valueToCompare = _this.getFacetValueFromHierarchy(child.facetValue);\n                    return valueToCompare.selected || valueToCompare.excluded;\n                });\n                valueHierarchy.hasChildSelected = false;\n                if (activeChilds.length == valueHierarchy.childs.length) {\n                    this.deselectChilds(valueHierarchy, valueHierarchy.childs);\n                }\n            }\n        }\n        this.deselectParent(valueHierarchy.parent);\n        this.unflagParentForSelection(valueHierarchy);\n        _super.prototype.deselectValue.call(this, value);\n    };\n    /**\n     * Excludes a single value.\n     * @param value The value to exclude.\n     * @param excludeChildren Specifies whether to also exclude all child values (if any). Default value is the opposite\n     * of the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n     */\n    HierarchicalFacet.prototype.excludeValue = function (value, excludeChildren) {\n        if (excludeChildren === void 0) { excludeChildren = !this.options.useAnd; }\n        this.ensureDom();\n        this.ensureValueHierarchyExists([value]);\n        var valueHierarchy = this.getValueFromHierarchy(value);\n        if (excludeChildren) {\n            this.excludeChilds(valueHierarchy.childs);\n        }\n        else {\n            this.deselectChilds(valueHierarchy, valueHierarchy.childs);\n            this.close(valueHierarchy);\n        }\n        this.flagParentForSelection(valueHierarchy);\n        _super.prototype.excludeValue.call(this, value);\n    };\n    /**\n     * Un-excludes a single value.\n     * @param value The value to un-exclude.\n     * @param unexludeChildren Specifies whether to also un-exclude all child values (if any). Default value is the\n     * opposite of the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n     */\n    HierarchicalFacet.prototype.unexcludeValue = function (value, unexludeChildren) {\n        if (unexludeChildren === void 0) { unexludeChildren = !this.options.useAnd; }\n        this.ensureDom();\n        this.ensureValueHierarchyExists([value]);\n        var valueHierarchy = this.getValueFromHierarchy(value);\n        if (unexludeChildren) {\n            this.unexcludeChilds(valueHierarchy.childs);\n        }\n        this.unflagParentForSelection(valueHierarchy);\n        _super.prototype.unexcludeValue.call(this, value);\n    };\n    /**\n     * Deselects multiple values.\n     * @param values The array of values to deselect.\n     * @param deselectChildren Specifies whether to also deselect all child values (if any). Default value is the opposite\n     * of the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n     */\n    HierarchicalFacet.prototype.deselectMultipleValues = function (values, deselectChildren) {\n        var _this = this;\n        if (deselectChildren === void 0) { deselectChildren = !this.options.useAnd; }\n        this.ensureDom();\n        this.ensureValueHierarchyExists(values);\n        _.each(values, function (value) {\n            var valueHierarchy = _this.getValueFromHierarchy(value);\n            valueHierarchy.hasChildSelected = false;\n            _this.unflagParentForSelection(valueHierarchy);\n            if (deselectChildren) {\n                _.each(valueHierarchy.childs, function (child) {\n                    var childInHierarchy = _this.getValueFromHierarchy(child.facetValue);\n                    childInHierarchy.hasChildSelected = false;\n                    _this.deselectValue(child.facetValue);\n                });\n            }\n        });\n        _super.prototype.deselectMultipleValues.call(this, values);\n    };\n    /**\n     * Toggles the selection of a single value (selects value if not selected; deselects value if selected).\n     * @param value The value to select or deselect.\n     */\n    HierarchicalFacet.prototype.toggleSelectValue = function (value) {\n        this.ensureDom();\n        this.ensureValueHierarchyExists([value]);\n        if (this.getFacetValueFromHierarchy(value).selected == false) {\n            this.selectValue(value);\n        }\n        else {\n            this.deselectValue(value);\n        }\n    };\n    /**\n     * Toggles the exclusion of a single value (excludes value if not excluded; un-excludes value if excluded).\n     * @param value The value to exclude or un-exclude.\n     */\n    HierarchicalFacet.prototype.toggleExcludeValue = function (value) {\n        this.ensureDom();\n        this.ensureValueHierarchyExists([value]);\n        if (this.getFacetValueFromHierarchy(value).excluded == false) {\n            this.excludeValue(value);\n        }\n        else {\n            this.unexcludeValue(value);\n        }\n    };\n    /**\n     * Gets the caption of a single value.\n     * @param facetValue The value whose caption the method should return.\n     * @returns {string} The caption of the value.\n     */\n    HierarchicalFacet.prototype.getValueCaption = function (facetValue) {\n        var stringValue = this.getSelf(facetValue);\n        var ret = stringValue;\n        if (Utils_1.Utils.exists(this.options.valueCaption)) {\n            if (typeof this.options.valueCaption == 'object') {\n                ret = this.options.valueCaption[stringValue] || ret;\n            }\n            if (typeof this.options.valueCaption == 'function') {\n                ret = this.options.valueCaption.call(this, facetValue);\n            }\n        }\n        return ret;\n    };\n    /**\n     * Gets the values that the `HierarchicalFacet` is currently displaying.\n     * @returns {any[]} An array containing all the values that the `HierarchicalFacet` is currently displaying.\n     */\n    HierarchicalFacet.prototype.getDisplayedValues = function () {\n        var _this = this;\n        var displayed = _.filter(this.values.getAll(), function (v) {\n            var valFromHierarchy = _this.getValueFromHierarchy(v);\n            if (valFromHierarchy) {\n                var elem = _this.getElementFromFacetValueList(v);\n                return !Dom_1.$$(elem).hasClass('coveo-inactive');\n            }\n            return false;\n        });\n        return _.pluck(displayed, 'value');\n    };\n    /**\n     * Updates the sort criteria for the `HierarchicalFacet`.\n     *\n     * See the [`sortCriteria`]{@link IGroupByRequest.sortCriteria} property of the [`IGroupByRequest`] interface for the\n     * list and description of possible values.\n     *\n     * @param criteria The new sort criteria.\n     */\n    HierarchicalFacet.prototype.updateSort = function (criteria) {\n        _super.prototype.updateSort.call(this, criteria);\n    };\n    /**\n     * Opens (expands) a single value and shows all its children.\n     * @param value The value to open.\n     */\n    HierarchicalFacet.prototype.open = function (value) {\n        var getter;\n        if (_.isString(value)) {\n            getter = this.getValueHierarchy(value);\n        }\n        else if (value instanceof FacetValue_1.FacetValue) {\n            getter = this.getValueHierarchy(value.value);\n        }\n        else {\n            getter = value;\n        }\n        if (getter != undefined) {\n            Dom_1.$$(this.getElementFromFacetValueList(getter.facetValue.value)).addClass('coveo-open');\n            this.showChilds(getter.childs);\n            if (getter.parent != undefined) {\n                this.open(this.getValueHierarchy(getter.facetValue.value).parent);\n            }\n            this.getValueHierarchy(getter.facetValue.value).keepOpened = true;\n        }\n    };\n    /**\n     * Closes (collapses) a single value and hides all its children.\n     * @param value The value to close.\n     */\n    HierarchicalFacet.prototype.close = function (value) {\n        var _this = this;\n        var getter;\n        if (_.isString(value)) {\n            getter = this.getValueHierarchy(value);\n        }\n        else if (value instanceof FacetValue_1.FacetValue) {\n            getter = this.getValueHierarchy(value.value);\n        }\n        else {\n            getter = value;\n        }\n        if (getter != undefined) {\n            Dom_1.$$(this.getElementFromFacetValueList(getter.facetValue)).removeClass('coveo-open');\n            this.hideChilds(getter.childs);\n            _.each(getter.childs, function (child) {\n                _this.close(_this.getValueHierarchy(child.facetValue.value));\n            });\n            this.getValueHierarchy(getter.facetValue.value).keepOpened = false;\n        }\n    };\n    /**\n     * Resets the `HierarchicalFacet` state.\n     */\n    HierarchicalFacet.prototype.reset = function () {\n        var _this = this;\n        _.each(this.getAllValueHierarchy(), function (valueHierarchy) {\n            valueHierarchy.hasChildSelected = false;\n            valueHierarchy.allChildShouldBeSelected = false;\n        });\n        // Need to close all values, otherwise we might end up with orphan(s)\n        // if a parent value, after reset, is no longer visible.\n        _.each(this.getAllValueHierarchy(), function (valueHierarchy) {\n            _this.close(valueHierarchy);\n        });\n        _super.prototype.reset.call(this);\n    };\n    HierarchicalFacet.prototype.processFacetSearchAllResultsSelected = function (facetValues) {\n        this.selectMultipleValues(facetValues);\n        this.triggerNewQuery();\n    };\n    HierarchicalFacet.prototype.triggerUpdateDeltaQuery = function (facetValues) {\n        this.shouldReshuffleFacetValuesClientSide = this.keepDisplayedValuesNextTime;\n        _super.prototype.triggerUpdateDeltaQuery.call(this, facetValues);\n    };\n    HierarchicalFacet.prototype.updateSearchElement = function (moreValuesAvailable) {\n        if (moreValuesAvailable === void 0) { moreValuesAvailable = true; }\n        // We always want to show search for hierarchical facet :\n        // It's useful since child values are folded under their parent most of the time\n        _super.prototype.updateSearchElement.call(this, true);\n    };\n    HierarchicalFacet.prototype.facetValueHasChanged = function () {\n        var _this = this;\n        this.updateQueryStateModel();\n        Defer_1.Defer.defer(function () {\n            _this.updateAppearanceDependingOnState();\n        });\n    };\n    HierarchicalFacet.prototype.initFacetQueryController = function () {\n        this.facetQueryController = new HierarchicalFacetQueryController_1.HierarchicalFacetQueryController(this);\n    };\n    HierarchicalFacet.prototype.initFacetSearch = function () {\n        this.facetSearch = new HierarchicalFacetSearch_1.HierarchicalFacetSearch(this, HierarchicalFacetSearchValuesList_1.HierarchicalFacetSearchValuesList, this.root);\n        this.element.appendChild(this.facetSearch.build());\n    };\n    HierarchicalFacet.prototype.handleDeferredQuerySuccess = function (data) {\n        this.updateAppearanceDependingOnState();\n        _super.prototype.handleDeferredQuerySuccess.call(this, data);\n    };\n    HierarchicalFacet.prototype.handlePopulateSearchAlerts = function (args) {\n        if (this.values.hasSelectedOrExcludedValues()) {\n            args.text.push(new HierarchicalBreadcrumbValuesList_1.HierarchicalBreadcrumbValuesList(this, this.values.getSelected().concat(this.values.getExcluded()), this.getAllValueHierarchy()).buildAsString());\n        }\n    };\n    HierarchicalFacet.prototype.handlePopulateBreadcrumb = function (args) {\n        Assert_1.Assert.exists(args);\n        if (this.values.hasSelectedOrExcludedValues()) {\n            var element = new HierarchicalBreadcrumbValuesList_1.HierarchicalBreadcrumbValuesList(this, this.values.getSelected().concat(this.values.getExcluded()), this.getAllValueHierarchy()).build();\n            args.breadcrumbs.push({\n                element: element\n            });\n        }\n    };\n    HierarchicalFacet.prototype.handleOmniboxWithStaticValue = function (eventArg) {\n        var _this = this;\n        var regex = eventArg.completeQueryExpression.regex;\n        var match = _.first(_.filter(this.getAllValueHierarchy(), function (existingValue) {\n            return regex.test(_this.getValueCaption(existingValue.facetValue));\n        }), this.options.numberOfValuesInOmnibox);\n        var facetValues = _.compact(_.map(match, function (gotAMatch) {\n            var fromList = _this.getFromFacetValueList(gotAMatch.facetValue);\n            return fromList ? fromList.facetValue : undefined;\n        }));\n        var element = new OmniboxHierarchicalValuesList_1.OmniboxHierarchicalValuesList(this, facetValues, eventArg).build();\n        eventArg.rows.push({\n            element: element,\n            zIndex: this.omniboxZIndex\n        });\n    };\n    HierarchicalFacet.prototype.rebuildValueElements = function () {\n        this.shouldReshuffleFacetValuesClientSide = this.shouldReshuffleFacetValuesClientSide || this.keepDisplayedValuesNextTime;\n        this.numberOfValues = Math.max(this.numberOfValues, 10000);\n        this.processHierarchy();\n        this.setValueListContent();\n        _super.prototype.rebuildValueElements.call(this);\n        this.buildParentChildRelationship();\n        this.checkForOrphans();\n        this.checkForNewUnselectedChild();\n        this.crop();\n        this.shouldReshuffleFacetValuesClientSide = false;\n    };\n    HierarchicalFacet.prototype.initFacetValuesList = function () {\n        this.facetValuesList = new HierarchicalFacetValuesList_1.HierarchicalFacetValuesList(this, HierarchicalFacetValueElement_1.HierarchicalFacetValueElement);\n        this.element.appendChild(this.facetValuesList.build());\n    };\n    HierarchicalFacet.prototype.updateMoreLess = function () {\n        var moreValuesAvailable = this.numberOfValuesToShow < this.topLevelHierarchy.length;\n        var lessIsShown = this.numberOfValuesToShow > this.originalNumberOfValuesToShow;\n        _super.prototype.updateMoreLess.call(this, lessIsShown, moreValuesAvailable);\n    };\n    HierarchicalFacet.prototype.handleClickMore = function () {\n        this.numberOfValuesToShow += this.originalNumberOfValuesToShow;\n        this.numberOfValuesToShow = Math.min(this.numberOfValuesToShow, this.values.size());\n        this.crop();\n        this.updateMoreLess();\n    };\n    HierarchicalFacet.prototype.handleClickLess = function () {\n        this.numberOfValuesToShow = this.originalNumberOfValuesToShow;\n        this.crop();\n        this.updateMoreLess();\n    };\n    HierarchicalFacet.prototype.updateNumberOfValues = function () {\n        this.numberOfValues = Math.max(this.numberOfValues, 10000);\n    };\n    HierarchicalFacet.prototype.ensureValueHierarchyExists = function (facetValues) {\n        var _this = this;\n        if (facetValues[0] && typeof facetValues[0] == 'string') {\n            facetValues = _.map(facetValues, function (value) {\n                return FacetValue_1.FacetValue.createFromValue(value);\n            });\n        }\n        var atLeastOneDoesNotExists = false;\n        _.each(facetValues, function (facetValue) {\n            if (_this.getValueHierarchy(facetValue.value) == undefined) {\n                atLeastOneDoesNotExists = true;\n            }\n        });\n        if (atLeastOneDoesNotExists) {\n            this.processHierarchy(facetValues);\n        }\n    };\n    HierarchicalFacet.prototype.crop = function () {\n        var _this = this;\n        // Partition the top level or the facet to only operate on the values that are not selected or excluded\n        var partition = _.partition(this.topLevelHierarchy, function (hierarchy) {\n            return hierarchy.facetValue.selected || hierarchy.facetValue.excluded || hierarchy.hasChildSelected;\n        });\n        // Hide and show the partitionned top level values, depending on the numberOfValuesToShow\n        var numberOfValuesLeft = this.numberOfValuesToShow - partition[0].length;\n        _.each(_.last(partition[1], partition[1].length - numberOfValuesLeft), function (toHide) {\n            _this.hideFacetValue(toHide);\n            _this.hideChilds(toHide.childs);\n        });\n        _.each(_.first(partition[1], numberOfValuesLeft), function (toShow) {\n            _this.showFacetValue(toShow);\n        });\n    };\n    HierarchicalFacet.prototype.placeChildsUnderTheirParent = function (hierarchy, hierarchyElement) {\n        var _this = this;\n        var toIterateOver = hierarchy.childs;\n        if (toIterateOver) {\n            var toIterateOverSorted = this.facetValuesList.sortFacetValues(_.pluck(toIterateOver, 'facetValue')).reverse();\n            _.each(toIterateOverSorted, function (child) {\n                var childFromHierarchy = _this.getValueFromHierarchy(child);\n                if (childFromHierarchy) {\n                    var childElement = _this.getElementFromFacetValueList(child);\n                    Dom_1.$$(childElement).insertAfter(hierarchyElement);\n                    if (childFromHierarchy.childs && childFromHierarchy.childs.length != 0) {\n                        _this.placeChildsUnderTheirParent(childFromHierarchy, childElement);\n                    }\n                }\n            });\n        }\n        if (hierarchy.keepOpened) {\n            this.open(hierarchy);\n            this.showChilds(hierarchy.childs);\n        }\n        else {\n            this.hideChilds(hierarchy.childs);\n        }\n    };\n    HierarchicalFacet.prototype.addCssClassToParentAndChilds = function (hierarchy, hierarchyElement) {\n        var _this = this;\n        Dom_1.$$(hierarchyElement).addClass('coveo-has-childs');\n        if (hierarchy.hasChildSelected) {\n            Dom_1.$$(hierarchyElement).addClass('coveo-has-childs-selected');\n        }\n        var expandChilds = Dom_1.$$('span', { className: 'coveo-hierarchical-facet-expand' }, SVGIcons_1.SVGIcons.icons.facetExpand);\n        var collapseChilds = Dom_1.$$('span', { className: 'coveo-hierarchical-facet-collapse' }, SVGIcons_1.SVGIcons.icons.facetCollapse);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(expandChilds.el, 'coveo-hierarchical-facet-expand-svg');\n        SVGDom_1.SVGDom.addClassToSVGInContainer(collapseChilds.el, 'coveo-hierarchical-facet-collapse-svg');\n        var openAndCloseChilds = Dom_1.$$('div', {\n            className: 'coveo-has-childs-toggle'\n        }, expandChilds.el, collapseChilds.el).el;\n        Dom_1.$$(openAndCloseChilds).on('click', function () {\n            Dom_1.$$(hierarchyElement).hasClass('coveo-open') ? _this.close(hierarchy) : _this.open(hierarchy);\n        });\n        Dom_1.$$(hierarchyElement).prepend(openAndCloseChilds);\n    };\n    HierarchicalFacet.prototype.buildParentChildRelationship = function () {\n        var _this = this;\n        var fragment = document.createDocumentFragment();\n        fragment.appendChild(this.facetValuesList.valueContainer);\n        var sorted = _.map(this.facetValuesList.sortFacetValues(), function (facetValue) {\n            return _this.getValueFromHierarchy(facetValue);\n        });\n        _.each(sorted, function (hierarchy) {\n            var hierarchyElement = _this.getElementFromFacetValueList(hierarchy.facetValue);\n            if (Utils_1.Utils.isNonEmptyArray(hierarchy.childs)) {\n                _this.placeChildsUnderTheirParent(hierarchy, hierarchyElement);\n                _this.addCssClassToParentAndChilds(hierarchy, hierarchyElement);\n            }\n            else {\n                Dom_1.$$(hierarchyElement).addClass('coveo-no-childs');\n            }\n            hierarchyElement.style.marginLeft = _this.options.marginByLevel * (hierarchy.level - _this.options.levelStart) + 'px';\n        });\n        Dom_1.$$(fragment).insertAfter(this.headerElement);\n    };\n    HierarchicalFacet.prototype.setValueListContent = function () {\n        var _this = this;\n        this.facetValuesList.hierarchyFacetValues = _.map(this.correctLevels, function (hierarchy) {\n            if (!_this.values.contains(hierarchy.facetValue.value)) {\n                hierarchy.facetValue.occurrences = 0;\n                _this.values.add(hierarchy.facetValue);\n            }\n            return hierarchy.facetValue;\n        });\n    };\n    HierarchicalFacet.prototype.createHierarchy = function (valuesToBuildWith) {\n        var _this = this;\n        var flatHierarchy = _.map(valuesToBuildWith, function (value) {\n            var parent = _this.getParent(value);\n            var self = value.lookupValue || value.value;\n            return {\n                facetValue: value,\n                level: _this.getLevel(value),\n                parent: parent,\n                self: self\n            };\n        });\n        this.setInHierarchy(flatHierarchy);\n        _.each(this.getAllValueHierarchy(), function (valueHierarchy) {\n            if (valueHierarchy.facetValue.selected) {\n                _this.flagParentForSelection(valueHierarchy);\n            }\n        });\n        return flatHierarchy;\n    };\n    HierarchicalFacet.prototype.processHierarchy = function (facetValues) {\n        var _this = this;\n        if (facetValues === void 0) { facetValues = this.values.getAll(); }\n        _.each(this.getAllValueHierarchy(), function (hierarchy) {\n            if (_this.values.get(hierarchy.facetValue.value) == undefined) {\n                _this.deleteValueHierarchy(_this.getLookupOrValue(hierarchy.facetValue));\n            }\n        });\n        this.createHierarchy(facetValues);\n    };\n    HierarchicalFacet.prototype.setInHierarchy = function (flatHierarchy) {\n        var _this = this;\n        this.correctLevels = _.filter(flatHierarchy, function (hierarchy) {\n            var isCorrectMinimumLevel = _this.options.levelStart == undefined || hierarchy.level >= _this.options.levelStart;\n            var isCorrectMaximumLevel = _this.options.levelEnd == undefined || hierarchy.level < _this.options.levelEnd;\n            return isCorrectMinimumLevel && isCorrectMaximumLevel;\n        });\n        _.each(this.correctLevels, function (hierarchy) {\n            var childs = _.map(_.filter(_this.correctLevels, function (possibleChild) {\n                return possibleChild.parent != null && possibleChild.parent.toLowerCase() == hierarchy.self.toLowerCase();\n            }), function (child) {\n                return {\n                    facetValue: child.facetValue,\n                    level: child.level,\n                    keepOpened: false,\n                    hasChildSelected: false,\n                    allChildShouldBeSelected: false\n                };\n            });\n            var parent = hierarchy.parent != null\n                ? _.find(_this.correctLevels, function (possibleParent) {\n                    return possibleParent.self.toLowerCase() == hierarchy.parent.toLowerCase();\n                })\n                : null;\n            var hierarchyThatAlreadyExists = _this.getValueHierarchy(hierarchy.facetValue.value);\n            if (hierarchyThatAlreadyExists && hierarchyThatAlreadyExists.childs.length != childs.length) {\n                hierarchyThatAlreadyExists.childs = childs;\n            }\n            var hierarchyThatAlreadyExistsAtParent;\n            if (parent) {\n                hierarchyThatAlreadyExistsAtParent = _this.getValueHierarchy(parent.facetValue.value);\n            }\n            _this.setValueHierarchy(hierarchy.facetValue.value, {\n                childs: childs,\n                parent: parent == undefined\n                    ? undefined\n                    : {\n                        facetValue: parent.facetValue,\n                        level: parent.level,\n                        keepOpened: hierarchyThatAlreadyExistsAtParent ? hierarchyThatAlreadyExistsAtParent.keepOpened : false,\n                        hasChildSelected: hierarchyThatAlreadyExistsAtParent ? hierarchyThatAlreadyExistsAtParent.hasChildSelected : false,\n                        originalPosition: hierarchyThatAlreadyExistsAtParent ? hierarchyThatAlreadyExistsAtParent.originalPosition : undefined,\n                        allChildShouldBeSelected: hierarchyThatAlreadyExistsAtParent\n                            ? hierarchyThatAlreadyExistsAtParent.allChildShouldBeSelected\n                            : false\n                    },\n                facetValue: hierarchy.facetValue,\n                level: hierarchy.level,\n                keepOpened: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.keepOpened : false,\n                hasChildSelected: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.hasChildSelected : false,\n                originalPosition: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.originalPosition : undefined,\n                allChildShouldBeSelected: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.allChildShouldBeSelected : false\n            });\n        });\n        this.topLevelHierarchy = _.chain(this.values.getAll())\n            .filter(function (value) {\n            var fromHierarchy = _this.getValueFromHierarchy(value);\n            if (fromHierarchy) {\n                return fromHierarchy.level == (_this.options.levelStart || 0);\n            }\n            else {\n                return false;\n            }\n        })\n            .map(function (value) {\n            return _this.getValueFromHierarchy(value);\n        })\n            .value();\n    };\n    HierarchicalFacet.prototype.getParent = function (value) {\n        var lastIndexOfDelimiting = this.getLookupOrValue(value).lastIndexOf(this.options.delimitingCharacter);\n        if (lastIndexOfDelimiting != -1) {\n            return this.getLookupOrValue(value).substring(0, lastIndexOfDelimiting);\n        }\n        return undefined;\n    };\n    HierarchicalFacet.prototype.getSelf = function (value) {\n        var parent = this.getParent(value);\n        if (parent == undefined) {\n            return this.getLookupOrValue(value);\n        }\n        else {\n            var indexOfParent = this.getLookupOrValue(value).indexOf(parent);\n            return this.getLookupOrValue(value).substring(indexOfParent + parent.length + 1);\n        }\n    };\n    HierarchicalFacet.prototype.showFacetValue = function (value) {\n        Dom_1.$$(this.getElementFromFacetValueList(value.facetValue.value)).removeClass('coveo-inactive');\n    };\n    HierarchicalFacet.prototype.hideFacetValue = function (value) {\n        Dom_1.$$(this.getElementFromFacetValueList(value.facetValue.value)).addClass('coveo-inactive');\n    };\n    HierarchicalFacet.prototype.hideChilds = function (children) {\n        var _this = this;\n        _.each(children, function (child) {\n            _this.hideFacetValue(child);\n        });\n    };\n    HierarchicalFacet.prototype.showChilds = function (children) {\n        var _this = this;\n        _.each(children, function (child) {\n            _this.showFacetValue(child);\n        });\n    };\n    HierarchicalFacet.prototype.selectChilds = function (parent, children) {\n        this.flagParentForSelection(parent);\n        parent.allChildShouldBeSelected = true;\n        this.selectMultipleValues(_.map(children, function (child) {\n            return child.facetValue;\n        }));\n    };\n    HierarchicalFacet.prototype.deselectChilds = function (parent, children) {\n        parent.hasChildSelected = false;\n        parent.allChildShouldBeSelected = false;\n        this.deselectMultipleValues(_.map(children, function (child) {\n            return child.facetValue;\n        }));\n    };\n    HierarchicalFacet.prototype.excludeChilds = function (children) {\n        this.excludeMultipleValues(_.map(children, function (child) {\n            return child.facetValue;\n        }));\n    };\n    HierarchicalFacet.prototype.unexcludeChilds = function (children) {\n        this.unexcludeMultipleValues(_.map(children, function (child) {\n            return child.facetValue;\n        }));\n    };\n    HierarchicalFacet.prototype.deselectParent = function (parent) {\n        if (parent != undefined) {\n            this.deselectValue(parent.facetValue, false);\n        }\n    };\n    HierarchicalFacet.prototype.flagParentForSelection = function (valueHierarchy) {\n        var parent = valueHierarchy.parent;\n        var current = valueHierarchy;\n        while (parent) {\n            var parentInHierarchy = this.getValueHierarchy(parent.facetValue.value);\n            parentInHierarchy.hasChildSelected = true;\n            var found = _.find(parentInHierarchy.childs, function (child) {\n                return child.facetValue.value.toLowerCase() == current.facetValue.value.toLowerCase();\n            });\n            if (found) {\n                if (this.getValueHierarchy(found.facetValue.value).hasChildSelected) {\n                    found.hasChildSelected = true;\n                }\n            }\n            parent = parentInHierarchy.parent;\n            current = parentInHierarchy;\n        }\n    };\n    HierarchicalFacet.prototype.unflagParentForSelection = function (valueHierarchy) {\n        var _this = this;\n        var parent = valueHierarchy.parent;\n        while (parent) {\n            var parentInHierarchy = this.getValueHierarchy(parent.facetValue.value);\n            var otherSelectedChilds = _.filter(parentInHierarchy.childs, function (child) {\n                var childInHierarchy = _this.getValueHierarchy(child.facetValue.value);\n                if (childInHierarchy != undefined) {\n                    return (childInHierarchy.facetValue.value != valueHierarchy.facetValue.value &&\n                        (childInHierarchy.facetValue.selected || childInHierarchy.facetValue.excluded || childInHierarchy.hasChildSelected));\n                }\n            });\n            if (otherSelectedChilds.length == 0) {\n                parentInHierarchy.hasChildSelected = false;\n            }\n            parentInHierarchy.allChildShouldBeSelected = false;\n            parent = parentInHierarchy.parent;\n        }\n    };\n    HierarchicalFacet.prototype.getValueFromHierarchy = function (value) {\n        var getter = value instanceof FacetValue_1.FacetValue ? value.value : value;\n        return this.getValueHierarchy(getter);\n    };\n    HierarchicalFacet.prototype.getFacetValueFromHierarchy = function (value) {\n        return this.getValueFromHierarchy(value).facetValue;\n    };\n    HierarchicalFacet.prototype.getLookupOrValue = function (value) {\n        return value.lookupValue || value.value;\n    };\n    HierarchicalFacet.prototype.getElementFromFacetValueList = function (value) {\n        var ret = this.getFromFacetValueList(value);\n        if (ret) {\n            return ret.renderer.listItem;\n        }\n        else {\n            return Dom_1.$$('div').el;\n        }\n    };\n    HierarchicalFacet.prototype.getFromFacetValueList = function (value) {\n        var fromHierarchy = this.getValueFromHierarchy(value);\n        if (fromHierarchy != undefined) {\n            return this.facetValuesList.get(value);\n        }\n        else {\n            return undefined;\n        }\n    };\n    HierarchicalFacet.prototype.getLevel = function (value) {\n        return value.value.split(this.options.delimitingCharacter).length - 1;\n    };\n    HierarchicalFacet.prototype.getAllValueHierarchy = function () {\n        if (this.valueHierarchy == null) {\n            this.valueHierarchy = {};\n        }\n        return this.valueHierarchy;\n    };\n    HierarchicalFacet.prototype.deleteValueHierarchy = function (key) {\n        if (this.valueHierarchy != null) {\n            delete this.valueHierarchy[key.toLowerCase()];\n        }\n    };\n    HierarchicalFacet.prototype.getValueHierarchy = function (key) {\n        if (this.valueHierarchy == null) {\n            return undefined;\n        }\n        return this.valueHierarchy[key.toLowerCase()];\n    };\n    HierarchicalFacet.prototype.setValueHierarchy = function (key, value) {\n        if (this.valueHierarchy == null) {\n            this.valueHierarchy = {};\n        }\n        this.valueHierarchy[key.toLowerCase()] = value;\n    };\n    HierarchicalFacet.prototype.checkForOrphans = function () {\n        var _this = this;\n        _.each(this.valueHierarchy, function (v) {\n            if (_this.getLevel(v.facetValue) != _this.options.levelStart) {\n                if (_this.getValueHierarchy(_this.getParent(v.facetValue)) == undefined) {\n                    _this.logger.error(\"Orphan value found in HierarchicalFacet : \" + v.facetValue.value, \"Needed : \" + _this.getParent(v.facetValue) + \" but not found\");\n                    _this.logger.warn(\"Removing incoherent facet value : \" + v.facetValue.value);\n                    _this.hideFacetValue(v);\n                }\n            }\n        });\n    };\n    HierarchicalFacet.prototype.checkForNewUnselectedChild = function () {\n        var _this = this;\n        // It's possible that after checking a facet value, the index returns new facet values (because of injection depth);\n        _.each(this.valueHierarchy, function (v) {\n            if (v.allChildShouldBeSelected) {\n                var notAlreadySelected = _.find(v.childs, function (child) {\n                    return child.facetValue.selected != true;\n                });\n                if (notAlreadySelected) {\n                    _this.selectValue(v.facetValue, true);\n                    _this.logger.info('Re-executing query with new facet values returned by index');\n                    _this.queryController.deferExecuteQuery();\n                }\n            }\n        });\n    };\n    HierarchicalFacet.ID = 'HierarchicalFacet';\n    HierarchicalFacet.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            HierarchicalFacet: HierarchicalFacet\n        });\n    };\n    /**\n     * The options for the component\n     * @componentOptions\n     */\n    HierarchicalFacet.options = __assign({ \n        /**\n         * The character that allows to specify the hierarchical dependency.\n         *\n         * **Example:**\n         *\n         * If your field has the following values:\n         *\n         * `@field: c; c>folder2; c>folder2>folder3;`\n         *\n         * The delimiting character is `>`.\n         *\n         * Default value is `|`.\n         */\n        delimitingCharacter: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: '|' }), \n        /**\n         * Specifies at which level (0-based index) of the hierarchy the `HierarchicalFacet` should start displaying its\n         * values.\n         *\n         * **Example:**\n         *\n         * If you have the following files indexed on a file system:\n         * ```\n         * c:\\\n         *    folder1\\\n         *        text1.txt\n         *    folder2\\\n         *      folder3\\\n         *        text2.txt\n         * ```\n         * Setting `levelStart` to `1` displays `folder1` and `folder2` in the `HierarchicalFacet`, but omits `c:`.\n         *\n         * Default (and minimum) value is `0`.\n         */\n        levelStart: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 0, min: 0 }), \n        /**\n         * Specifies at which level (0-based index) of the hierarchy the `HierarchicalFacet` should stop displaying its\n         * values.\n         *\n         * Default value is `undefined`, which means the `HierarchicalFacet` component renders all hierarchical levels.\n         * Minimum value is `0`.\n         */\n        levelEnd: ComponentOptions_1.ComponentOptions.buildNumberOption({ min: 0 }), \n        /**\n         * Specifies the margin (in pixels) to display between each hierarchical level when expanding.\n         *\n         * Default value is `10`.\n         */\n        marginByLevel: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 10, min: 0 }) }, ResponsiveFacetOptions_1.ResponsiveFacetOptions);\n    HierarchicalFacet.parent = Facet_1.Facet;\n    return HierarchicalFacet;\n}(Facet_1.Facet));\nexports.HierarchicalFacet = HierarchicalFacet;\nInitialization_1.Initialization.registerAutoCreateComponent(HierarchicalFacet);\n\n\n/***/ }),\n\n/***/ 40:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/// <reference path='Facet.ts' />\nvar StringUtils_1 = __webpack_require__(22);\nvar QueryUtils_1 = __webpack_require__(21);\nvar FileTypes_1 = __webpack_require__(116);\nvar DateUtils_1 = __webpack_require__(33);\nvar Utils_1 = __webpack_require__(4);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar Strings_1 = __webpack_require__(6);\nvar FacetUtils = /** @class */ (function () {\n    function FacetUtils() {\n    }\n    FacetUtils.getRegexToUseForFacetSearch = function (value, ignoreAccent) {\n        return new RegExp(StringUtils_1.StringUtils.stringToRegex(value, ignoreAccent), 'i');\n    };\n    FacetUtils.getDisplayValueFromValueCaption = function (value, field, valueCaption) {\n        var returnValue = this.tryToGetTranslatedCaption(field, value, false);\n        return valueCaption[value] || returnValue;\n    };\n    FacetUtils.getValuesToUseForSearchInFacet = function (original, facet) {\n        var ret = [original];\n        var regex = this.getRegexToUseForFacetSearch(original, facet.options.facetSearchIgnoreAccents);\n        if (facet.options.valueCaption) {\n            _.chain(facet.options.valueCaption)\n                .pairs()\n                .filter(function (pair) {\n                return regex.test(pair[1]);\n            })\n                .each(function (match) {\n                ret.push(match[0]);\n            });\n            if (QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@objecttype') ||\n                QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@filetype')) {\n                _.each(FileTypes_1.FileTypes.getFileTypeCaptions(), function (value, key) {\n                    if (!(key in facet.options.valueCaption) && regex.test(value)) {\n                        ret.push(key);\n                    }\n                });\n            }\n        }\n        else if (QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@objecttype') ||\n            QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@filetype')) {\n            _.each(_.filter(_.pairs(FileTypes_1.FileTypes.getFileTypeCaptions()), function (pair) {\n                return regex.test(pair[1]);\n            }), function (match) {\n                ret.push(match[0]);\n            });\n        }\n        else if (QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@month')) {\n            _.each(_.range(1, 13), function (month) {\n                if (regex.test(DateUtils_1.DateUtils.monthToString(month - 1))) {\n                    ret.push(('0' + month.toString()).substr(-2));\n                }\n            });\n        }\n        return ret;\n    };\n    FacetUtils.buildFacetSearchPattern = function (values) {\n        values = _.map(values, function (value) {\n            return Utils_1.Utils.escapeRegexCharacter(value);\n        });\n        values[0] = '.*' + values[0] + '.*';\n        return values.join('|');\n    };\n    FacetUtils.needAnotherFacetSearch = function (currentSearchLength, newSearchLength, oldSearchLength, desiredSearchLength) {\n        // Something was removed (currentSearch < newSearch)\n        // && we might want to display more facet search result(currentSearch < desiredSearch)\n        // && the new query returned more stuff than the old one so there's still more results(currentSearchLength > oldLength)\n        return currentSearchLength < newSearchLength && currentSearchLength < desiredSearchLength && currentSearchLength > oldSearchLength;\n    };\n    FacetUtils.addNoStateCssClassToFacetValues = function (facet, container) {\n        // This takes care of adding the correct css class on each facet value checkbox (empty white box) if at least one value is selected in that facet\n        if (facet.values.getSelected().length != 0) {\n            var noStates = Dom_1.$$(container).findAll('li:not(.coveo-selected)');\n            _.each(noStates, function (noState) {\n                Dom_1.$$(noState).addClass('coveo-no-state');\n            });\n        }\n    };\n    FacetUtils.tryToGetTranslatedCaption = function (field, value, fallbackOnLocalization) {\n        if (fallbackOnLocalization === void 0) { fallbackOnLocalization = true; }\n        var found;\n        if (QueryUtils_1.QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@filetype')) {\n            found = FileTypes_1.FileTypes.getFileType(value, fallbackOnLocalization).caption;\n        }\n        else if (QueryUtils_1.QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@objecttype')) {\n            found = FileTypes_1.FileTypes.getObjectType(value, fallbackOnLocalization).caption;\n        }\n        else if (FacetUtils.isMonthFieldValue(field, value)) {\n            var month = parseInt(value, 10);\n            found = DateUtils_1.DateUtils.monthToString(month - 1);\n        }\n        else if (fallbackOnLocalization) {\n            found = Strings_1.l(value);\n        }\n        return found != undefined && Utils_1.Utils.isNonEmptyString(found) ? found : value;\n    };\n    FacetUtils.isMonthFieldValue = function (field, value) {\n        if (!QueryUtils_1.QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@month')) {\n            return false;\n        }\n        var asInt = parseInt(value, 10);\n        if (isNaN(asInt)) {\n            return false;\n        }\n        if (asInt < 1 || asInt > 12) {\n            return false;\n        }\n        return true;\n    };\n    return FacetUtils;\n}());\nexports.FacetUtils = FacetUtils;\n\n\n/***/ }),\n\n/***/ 468:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Template_1 = __webpack_require__(27);\nvar TemplateList_1 = __webpack_require__(92);\nvar _ = __webpack_require__(0);\nvar TableTemplate = /** @class */ (function (_super) {\n    __extends(TableTemplate, _super);\n    function TableTemplate() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.defaultTemplate = \"<td><a class=\\\"CoveoResultLink\\\"></a></td>\\n                             <td><span class=\\\"CoveoExcerpt\\\"></span></td>\\n                             <td><span class=\\\"CoveoFieldValue\\\" data-field=\\\"@date\\\" data-helper=\\\"date\\\"></span></td>\";\n        _this.defaultRoledTemplates = {\n            'table-header': \"<th style=\\\"width: 40%\\\">Link</th>\\n                     <th>Excerpt</th>\\n                     <th style=\\\"width: 20%\\\"\\n                         class=\\\"CoveoSort coveo-table-header-sort\\\"\\n                         data-sort-criteria=\\\"date ascending,date descending\\\"\\n                         data-display-unselected-icon=\\\"false\\\">Date</th>\",\n            'table-footer': \"<th>Link</th>\\n                     <th>Excerpt</th>\\n                     <th>Date</th>\"\n        };\n        return _this;\n    }\n    TableTemplate.prototype.instantiateRoleToString = function (role) {\n        var roledTemplate = _.find(this.templates, function (t) { return t.role === role; });\n        if (roledTemplate) {\n            return roledTemplate.instantiateToString(undefined, {});\n        }\n        else {\n            return this.defaultRoledTemplates[role];\n        }\n    };\n    TableTemplate.prototype.instantiateRoleToElement = function (role) {\n        var _this = this;\n        var roledTemplate = _.find(this.templates, function (t) { return t.role === role; });\n        if (roledTemplate) {\n            return roledTemplate.instantiateToElement(undefined, {});\n        }\n        else {\n            var tmpl = new Template_1.Template(function () { return _this.defaultRoledTemplates[role]; });\n            tmpl.layout = 'table';\n            return tmpl.instantiateToElement(undefined);\n        }\n    };\n    TableTemplate.prototype.getFallbackTemplate = function () {\n        var _this = this;\n        return new Template_1.Template(function () { return _this.defaultTemplate; });\n    };\n    TableTemplate.prototype.hasTemplateWithRole = function (role) {\n        return _.find(this.templates, function (t) { return t.role === role; });\n    };\n    return TableTemplate;\n}(TemplateList_1.TemplateList));\nexports.TableTemplate = TableTemplate;\n\n\n/***/ }),\n\n/***/ 469:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Template_1 = __webpack_require__(27);\nvar DefaultRecommendationTemplate = /** @class */ (function (_super) {\n    __extends(DefaultRecommendationTemplate, _super);\n    function DefaultRecommendationTemplate() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DefaultRecommendationTemplate.prototype.instantiateToString = function (object) {\n        var template = \"<div class=\\\"coveo-result-frame\\\">\\n        <div class=\\\"coveo-result-row\\\">\\n          <div class=\\\"coveo-result-cell\\\" style=\\\"width:40px;text-align:center;vertical-align:middle;\\\">\\n            <span class=\\\"CoveoIcon\\\" data-small=\\\"true\\\" data-with-label=\\\"false\\\">\\n            </span>\\n          </div>\\n          <div class=\\\"coveo-result-cell\\\" style=\\\"padding:0 0 3px 5px;vertical-align:middle\\\">\\n            <div class=\\\"coveo-result-row\\\">\\n              <div class=\\\"coveo-result-cell\\\" style=\\\"font-size:10pt;\\\">\\n                <a class=\\\"CoveoResultLink\\\" style=\\\"display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis\\\">\\n                </a>\\n              </div>\\n            </div>\\n          </div>\\n        </div>\\n      </div>\";\n        return template;\n    };\n    DefaultRecommendationTemplate.prototype.instantiateToElement = function (object) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var div = document.createElement('div');\n            div.innerHTML = _this.instantiateToString(object);\n            resolve(div);\n        });\n    };\n    return DefaultRecommendationTemplate;\n}(Template_1.Template));\nexports.DefaultRecommendationTemplate = DefaultRecommendationTemplate;\n\n\n/***/ }),\n\n/***/ 470:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Core_1 = __webpack_require__(19);\nvar ResultList_1 = __webpack_require__(90);\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar Logger_1 = __webpack_require__(9);\nvar TemplateToHtml = /** @class */ (function () {\n    function TemplateToHtml(args) {\n        this.args = args;\n    }\n    TemplateToHtml.prototype.buildResults = function (results, layout, currentlyDisplayedResults) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            var res, resultsPromises;\n            return __generator(this, function (_a) {\n                res = [];\n                resultsPromises = underscore_1.map(results.results, function (result, index) {\n                    return _this.buildResult(result, layout, currentlyDisplayedResults).then(function (resultElement) {\n                        if (resultElement != null) {\n                            res.push({ elem: resultElement, idx: index });\n                        }\n                        ResultList_1.ResultList.resultCurrentlyBeingRendered = null;\n                        return resultElement;\n                    });\n                });\n                // We need to sort by the original index order, because in lazy loading mode, it's possible that results does not gets rendered\n                // in the correct order returned by the index, depending on the time it takes to load all the results component for a given result template\n                return [2 /*return*/, Promise.all(resultsPromises).then(function () {\n                        return underscore_1.pluck(underscore_1.sortBy(res, 'idx'), 'elem');\n                    })];\n            });\n        });\n    };\n    TemplateToHtml.prototype.buildResult = function (result, layout, currentlyDisplayedResults) {\n        return __awaiter(this, void 0, void 0, function () {\n            var resultElement;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        Core_1.Assert.exists(result);\n                        Core_1.QueryUtils.setStateObjectOnQueryResult(this.args.queryStateModel.get(), result);\n                        Core_1.QueryUtils.setSearchInterfaceObjectOnQueryResult(this.args.searchInterface, result);\n                        ResultList_1.ResultList.resultCurrentlyBeingRendered = result;\n                        return [4 /*yield*/, this.createHtmlElement(result, layout)];\n                    case 1:\n                        resultElement = _a.sent();\n                        if (resultElement != null) {\n                            Core_1.Component.bindResultToElement(resultElement, result);\n                        }\n                        currentlyDisplayedResults.push(result);\n                        return [4 /*yield*/, this.autoCreateComponentsInsideResult(resultElement, result).initResult];\n                    case 2:\n                        _a.sent();\n                        this.verifyChildren(resultElement);\n                        return [2 /*return*/, resultElement];\n                }\n            });\n        });\n    };\n    TemplateToHtml.prototype.autoCreateComponentsInsideResult = function (element, result) {\n        Core_1.Assert.exists(element);\n        return Core_1.Initialization.automaticallyCreateComponentsInsideResult(element, result);\n    };\n    TemplateToHtml.prototype.createHtmlElement = function (result, layout) {\n        return this.args.resultTemplate.instantiateToElement(result, {\n            wrapInDiv: true,\n            checkCondition: true,\n            currentLayout: layout,\n            responsiveComponents: this.args.searchInterface.responsiveComponents\n        });\n    };\n    TemplateToHtml.prototype.verifyChildren = function (element) {\n        var containsResultLink = !!Dom_1.$$(element).find('.CoveoResultLink');\n        if (containsResultLink) {\n            return;\n        }\n        var msg = \"Result does not contain a \\\"CoveoResultLink\\\" component, please verify the result template\";\n        new Logger_1.Logger(element).warn(msg, this.args.resultTemplate);\n    };\n    return TemplateToHtml;\n}());\nexports.TemplateToHtml = TemplateToHtml;\n\n\n/***/ }),\n\n/***/ 471:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TemplateHelpers_1 = __webpack_require__(117);\nvar HighlightUtils_1 = __webpack_require__(68);\nvar DateUtils_1 = __webpack_require__(33);\nvar CurrencyUtils_1 = __webpack_require__(131);\nvar HtmlUtils_1 = __webpack_require__(177);\nvar Utils_1 = __webpack_require__(4);\nvar StringUtils_1 = __webpack_require__(22);\nvar TimeSpanUtils_1 = __webpack_require__(72);\nvar EmailUtils_1 = __webpack_require__(176);\nvar QueryUtils_1 = __webpack_require__(21);\nvar DeviceUtils_1 = __webpack_require__(24);\nvar Dom_1 = __webpack_require__(1);\nvar SearchEndpoint_1 = __webpack_require__(51);\nvar StreamHighlightUtils_1 = __webpack_require__(115);\nvar FacetUtils_1 = __webpack_require__(40);\nvar Globalize = __webpack_require__(23);\nvar _ = __webpack_require__(0);\nvar Component_1 = __webpack_require__(7);\nvar TemplateCache_1 = __webpack_require__(67);\nvar CoreHelpers = /** @class */ (function () {\n    function CoreHelpers() {\n    }\n    /**\n     * For backward compatibility reason, the \"global\" template helper should be available under the\n     * coveo namespace.\n     * @param scope\n     */\n    CoreHelpers.exportAllHelpersGlobally = function (scope) {\n        _.each(TemplateHelpers_1.TemplateHelpers.getHelpers(), function (helper, name) {\n            if (scope[name] == undefined) {\n                scope[name] = helper;\n            }\n        });\n    };\n    return CoreHelpers;\n}());\nexports.CoreHelpers = CoreHelpers;\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('javascriptEncode', function (value) {\n    return Utils_1.Utils.exists(value) ? StringUtils_1.StringUtils.javascriptEncode(value) : undefined;\n});\nvar executeShorten = function (content, options) {\n    var strAndHoles = HighlightUtils_1.StringAndHoles.shortenString(content, options.length, '...');\n    if (Utils_1.Utils.exists(options.highlights)) {\n        return HighlightUtils_1.HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n    }\n    else {\n        return strAndHoles.value;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shorten', function (content, length, highlights, cssClass) {\n    return executeShorten(content, {\n        length: length,\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenv2', function (content, options) {\n    return executeShorten(content, options);\n});\nvar executeShortenPath = function (content, options) {\n    var strAndHoles = HighlightUtils_1.StringAndHoles.shortenPath(content, options.length);\n    if (Utils_1.Utils.exists(options.highlights)) {\n        return HighlightUtils_1.HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n    }\n    else {\n        return strAndHoles.value;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenPath', function (content, length, highlights, cssClass) {\n    return executeShortenPath(content, {\n        length: length,\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('shortenPathv2', function (content, options) {\n    return executeShortenPath(content, options);\n});\nvar executeShortenUri = function (content, options) {\n    var strAndHoles = HighlightUtils_1.StringAndHoles.shortenUri(content, options.length);\n    if (Utils_1.Utils.exists(options.highlights)) {\n        return HighlightUtils_1.HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n    }\n    else {\n        return strAndHoles.value;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenUri', function (content, length, highlights, cssClass) {\n    return executeShortenUri(content, {\n        length: length,\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenUriv2', function (content, options) {\n    return executeShortenUri(content, options);\n});\nvar executeHighlight = function (content, options) {\n    if (Utils_1.Utils.exists(content)) {\n        if (Utils_1.Utils.exists(options.highlights)) {\n            return HighlightUtils_1.HighlightUtils.highlightString(content, options.highlights, null, options.cssClass || 'highlight');\n        }\n        else {\n            return content;\n        }\n    }\n    else {\n        return undefined;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlight', function (content, highlights, cssClass) {\n    return executeHighlight(content, {\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightv2', function (content, options) {\n    return executeHighlight(content, options);\n});\nvar executeHighlightStreamText = function (content, options) {\n    if (Utils_1.Utils.exists(content) && Utils_1.Utils.exists(options.termsToHighlight) && Utils_1.Utils.exists(options.phrasesToHighlight)) {\n        if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n            return StreamHighlightUtils_1.StreamHighlightUtils.highlightStreamText(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n        }\n        else {\n            return content;\n        }\n    }\n    else {\n        return undefined;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamText', function (content, termsToHighlight, phrasesToHighlight, opts) {\n    if (termsToHighlight === void 0) { termsToHighlight = resolveTermsToHighlight(); }\n    if (phrasesToHighlight === void 0) { phrasesToHighlight = resolvePhrasesToHighlight(); }\n    return executeHighlightStreamText(content, {\n        termsToHighlight: termsToHighlight,\n        phrasesToHighlight: phrasesToHighlight,\n        opts: opts\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamTextv2', function (content, options) {\n    var mergedOptions = __assign({ termsToHighlight: resolveTermsToHighlight(), phrasesToHighlight: resolvePhrasesToHighlight() }, options);\n    return executeHighlightStreamText(content, mergedOptions);\n});\nvar executeHighlightStreamHTML = function (content, options) {\n    if (Utils_1.Utils.exists(content) && Utils_1.Utils.exists(options.termsToHighlight) && Utils_1.Utils.exists(options.phrasesToHighlight)) {\n        if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n            return StreamHighlightUtils_1.StreamHighlightUtils.highlightStreamHTML(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n        }\n        else {\n            return content;\n        }\n    }\n    else {\n        return undefined;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamHTML', function (content, termsToHighlight, phrasesToHighlight, opts) {\n    if (termsToHighlight === void 0) { termsToHighlight = resolveTermsToHighlight(); }\n    if (phrasesToHighlight === void 0) { phrasesToHighlight = resolvePhrasesToHighlight(); }\n    return executeHighlightStreamHTML(content, {\n        termsToHighlight: termsToHighlight,\n        phrasesToHighlight: phrasesToHighlight,\n        opts: opts\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamHTMLv2', function (content, options) {\n    var mergedOptions = __assign({ termsToHighlight: resolveTermsToHighlight(), phrasesToHighlight: resolvePhrasesToHighlight() }, options);\n    return executeHighlightStreamHTML(content, mergedOptions);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('number', function (value, options) {\n    if (!Utils_1.Utils.exists(value)) {\n        return undefined;\n    }\n    var numberValue = Number(value);\n    var format = _.isString(options) ? options : options && options.format;\n    if (!format) {\n        return StringUtils_1.StringUtils.htmlEncode(numberValue.toString());\n    }\n    return StringUtils_1.StringUtils.htmlEncode(Globalize.format(numberValue, format));\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('date', function (value, options) {\n    return DateUtils_1.DateUtils.dateToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('time', function (value, options) {\n    return DateUtils_1.DateUtils.timeToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('dateTime', function (value, options) {\n    return DateUtils_1.DateUtils.dateTimeToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('emailDateTime', function (value, options) {\n    var defaultOptions = {};\n    defaultOptions.includeTimeIfThisWeek = true;\n    var optionsToUse = _.extend(options, defaultOptions);\n    return value ? DateUtils_1.DateUtils.dateTimeToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), optionsToUse) : undefined;\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('currency', function (value, options) {\n    return CurrencyUtils_1.CurrencyUtils.currencyToString(value, options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('timeSpan', function (value, options) {\n    if (options === void 0) { options = { isMilliseconds: false }; }\n    return new TimeSpanUtils_1.TimeSpan(value, options.isMilliseconds).getHHMMSS();\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('email', function (value) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    // support old arguments (value: any, companyDomain: string, me: string, lengthLimit = 2, truncateName = false)\n    var companyDomain;\n    var me;\n    var lengthLimit;\n    var truncateName;\n    if (_.isObject(args[0])) {\n        companyDomain = args[0]['companyDomain'];\n        me = args[0]['me'];\n        lengthLimit = args[0]['lengthLimit'];\n        truncateName = args[0]['truncateName'];\n    }\n    else {\n        companyDomain = args[0];\n        me = args[1];\n        lengthLimit = args[2];\n        truncateName = args[3];\n    }\n    if (lengthLimit == undefined) {\n        lengthLimit = 2;\n    }\n    if (truncateName == undefined) {\n        truncateName = false;\n    }\n    if (_.isString(value)) {\n        var listOfAddresses = EmailUtils_1.EmailUtils.splitSemicolonSeparatedListOfEmailAddresses(value);\n        return EmailUtils_1.EmailUtils.emailAddressesToHyperlinks(listOfAddresses, companyDomain, me, lengthLimit, truncateName);\n    }\n    else if (_.isArray(value)) {\n        return EmailUtils_1.EmailUtils.emailAddressesToHyperlinks(value, companyDomain, me, lengthLimit, truncateName);\n    }\n    else {\n        return undefined;\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('excessEmailToggle', function (target) {\n    Dom_1.$$(target).removeClass('coveo-active');\n    if (Dom_1.$$(target).hasClass('coveo-emails-excess-collapsed')) {\n        _.each(Dom_1.$$(target).siblings('.coveo-emails-excess-expanded'), function (sibling) {\n            Dom_1.$$(sibling).addClass('coveo-active');\n        });\n    }\n    else if (Dom_1.$$(target).hasClass('coveo-hide-expanded')) {\n        Dom_1.$$(target.parentElement).addClass('coveo-inactive');\n        _.each(Dom_1.$$(target.parentElement).siblings('.coveo-emails-excess-collapsed'), function (sibling) {\n            Dom_1.$$(sibling).addClass('coveo-active');\n        });\n    }\n    return undefined;\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('anchor', function (href, options) {\n    return HtmlUtils_1.AnchorUtils.buildAnchor(href, options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('image', function (src, options, result) {\n    if (result === void 0) { result = resolveQueryResult(); }\n    if (options && options.srcTemplate) {\n        return HtmlUtils_1.ImageUtils.buildImage(StringUtils_1.StringUtils.buildStringTemplateFromResult(options.srcTemplate, result), {\n            alt: options.alt,\n            height: options.height,\n            width: options.width\n        });\n    }\n    return HtmlUtils_1.ImageUtils.buildImage(src, options);\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('thumbnail', function (result, endpoint, options) {\n    if (result === void 0) { result = resolveQueryResult(); }\n    if (endpoint === void 0) { endpoint = 'default'; }\n    if (QueryUtils_1.QueryUtils.hasThumbnail(result)) {\n        return HtmlUtils_1.ImageUtils.buildImageFromResult(result, SearchEndpoint_1.SearchEndpoint.endpoints[endpoint], options);\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('fromFileTypeToIcon', function (result, options) {\n    if (result === void 0) { result = resolveQueryResult(); }\n    if (options === void 0) { options = {}; }\n    var icon = Component_1.Component.getComponentRef('Icon');\n    if (icon) {\n        return icon.createIcon(result, options).outerHTML;\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('attrEncode', function (value) {\n    return ('' + value) /* Forces the conversion to string. */\n        .replace(/&/g, '&amp;') /* This MUST be the 1st replacement. */\n        .replace(/'/g, '&apos;') /* The 4 other predefined entities, required. */\n        .replace(/'/g, '&quot;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('loadTemplates', function (templatesToLoad, once) {\n    if (once === void 0) { once = true; }\n    var ret = '';\n    var data = resolveQueryResult();\n    var atLeastOneWasLoaded = false;\n    var toLoad = templatesToLoad;\n    var defaultTmpl;\n    _.each(templatesToLoad, function (value, key, obj) {\n        if (value == 'default') {\n            defaultTmpl = key;\n        }\n    });\n    if (defaultTmpl != undefined) {\n        toLoad = _.omit(templatesToLoad, defaultTmpl);\n    }\n    _.each(toLoad, function (condition, id, obj) {\n        if (!atLeastOneWasLoaded || !once) {\n            atLeastOneWasLoaded = atLeastOneWasLoaded || condition;\n            ret += TemplateHelpers_1.TemplateHelpers.getHelper('loadTemplate')(id, condition, data);\n        }\n    });\n    if (!atLeastOneWasLoaded && defaultTmpl != undefined) {\n        ret += TemplateHelpers_1.TemplateHelpers.getHelper('loadTemplate')(defaultTmpl, true, data);\n    }\n    return ret;\n});\nvar byteMeasure = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB'];\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('size', function (value, options) {\n    var size = parseInt(value, 10);\n    var precision = options != null && options.precision != null ? options.precision : 2;\n    var base = options != null && options.base != null ? options.base : 0;\n    while (size > 1024 && base + 1 < byteMeasure.length) {\n        size /= 1024;\n        base++;\n    }\n    size = Math.floor(size * Math.pow(10, precision)) / Math.pow(10, precision);\n    return size + ' ' + byteMeasure[base];\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('translatedCaption', function (value) {\n    return FacetUtils_1.FacetUtils.tryToGetTranslatedCaption('@filetype', value);\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('loadTemplate', function (id, condition, data) {\n    if (condition === void 0) { condition = true; }\n    if (Utils_1.Utils.isNullOrUndefined(data)) {\n        data = resolveQueryResult();\n    }\n    if (condition) {\n        return TemplateCache_1.TemplateCache.getTemplate(id).instantiateToString(data, {\n            checkCondition: false\n        });\n    }\n    return '';\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('encodeCarriageReturn', function (data) {\n    if (Utils_1.Utils.isNullOrUndefined(data)) {\n        return undefined;\n    }\n    else {\n        return StringUtils_1.StringUtils.encodeCarriageReturn(data);\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('isMobileDevice', function () {\n    return DeviceUtils_1.DeviceUtils.isMobileDevice() ? DeviceUtils_1.DeviceUtils.getDeviceName() : null;\n});\nfunction resolveQueryResult() {\n    var found;\n    var resultList = Component_1.Component.getComponentRef('ResultList');\n    if (resultList) {\n        found = resultList.resultCurrentlyBeingRendered;\n    }\n    if (!found) {\n        var quickview = Component_1.Component.getComponentRef('Quickview');\n        if (quickview) {\n            found = quickview.resultCurrentlyBeingRendered;\n        }\n    }\n    return found;\n}\nfunction resolveTermsToHighlight() {\n    var currentQueryResult = resolveQueryResult();\n    if (currentQueryResult) {\n        return currentQueryResult.termsToHighlight;\n    }\n}\nfunction resolvePhrasesToHighlight() {\n    var currentQueryResult = resolveQueryResult();\n    if (currentQueryResult) {\n        return currentQueryResult.phrasesToHighlight;\n    }\n}\nfunction termsToHighlightAreDefined(termsToHighlight, phrasesToHighlight) {\n    return Utils_1.Utils.isNonEmptyArray(_.keys(termsToHighlight)) || Utils_1.Utils.isNonEmptyArray(_.keys(phrasesToHighlight));\n}\n\n\n/***/ }),\n\n/***/ 472:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The possible values for the [allowedValuesPatternType]{@link IGroupByRequest.allowedValuesPatternType} property of the `IGroupByRequest` interface.\n */\nvar AllowedValuesPatternType;\n(function (AllowedValuesPatternType) {\n    /**\n     * Only supports trailing wildcards in the pattern.\n     */\n    AllowedValuesPatternType[\"Legacy\"] = \"legacy\";\n    /**\n     * Fully supports wildcards.\n     */\n    AllowedValuesPatternType[\"Wildcards\"] = \"wildcards\";\n    /**\n     * Supports regular expression as the pattern.\n     */\n    AllowedValuesPatternType[\"Regex\"] = \"regex\";\n    /**\n     *Applies the Edit Distance algorithm to match values that are close to the specified pattern.\n     */\n    AllowedValuesPatternType[\"EditDistance\"] = \"editdistance\";\n    /**\n     *Applies a phonetic algorithm to match values that are phonetically similar to the specified pattern.\n     */\n    AllowedValuesPatternType[\"Phonetic\"] = \"phonetic\";\n})(AllowedValuesPatternType = exports.AllowedValuesPatternType || (exports.AllowedValuesPatternType = {}));\n\n\n/***/ }),\n\n/***/ 473:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ValueElementRenderer_1 = __webpack_require__(474);\nvar Utils_1 = __webpack_require__(4);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Dom_1 = __webpack_require__(1);\nvar KeyboardUtils_1 = __webpack_require__(26);\nvar ValueElement = /** @class */ (function () {\n    function ValueElement(facet, facetValue, onSelect, onExclude) {\n        this.facet = facet;\n        this.facetValue = facetValue;\n        this.onSelect = onSelect;\n        this.onExclude = onExclude;\n    }\n    ValueElement.prototype.build = function () {\n        this.renderer = new ValueElementRenderer_1.ValueElementRenderer(this.facet, this.facetValue).build();\n        this.bindEvent({ displayNextTime: true, pinFacet: this.facet.options.preservePosition });\n        return this;\n    };\n    ValueElement.prototype.bindEvent = function (eventBindings) {\n        if (!Utils_1.Utils.isNullOrUndefined(eventBindings.omniboxObject)) {\n            this.isOmnibox = true;\n        }\n        else {\n            this.isOmnibox = false;\n        }\n        this.handleEventForCheckboxChange(eventBindings);\n        if (this.facetValue.excluded) {\n            this.handleEventForExcludedValueElement(eventBindings);\n        }\n        else {\n            this.handleEventForValueElement(eventBindings);\n        }\n    };\n    ValueElement.prototype.select = function () {\n        this.facetValue.selected = true;\n        this.facetValue.excluded = false;\n        this.renderer.setCssClassOnListValueElement();\n    };\n    ValueElement.prototype.unselect = function () {\n        this.facetValue.selected = false;\n        this.facetValue.excluded = false;\n        this.renderer.setCssClassOnListValueElement();\n    };\n    ValueElement.prototype.exclude = function () {\n        this.facetValue.selected = false;\n        this.facetValue.excluded = true;\n        this.renderer.setCssClassOnListValueElement();\n    };\n    ValueElement.prototype.unexclude = function () {\n        this.facetValue.selected = false;\n        this.facetValue.excluded = false;\n        this.renderer.setCssClassOnListValueElement();\n    };\n    ValueElement.prototype.toggleExcludeWithUA = function () {\n        var _this = this;\n        var actionCause;\n        if (this.facetValue.excluded) {\n            actionCause = this.isOmnibox ? AnalyticsActionListMeta_1.analyticsActionCauseList.omniboxFacetUnexclude : AnalyticsActionListMeta_1.analyticsActionCauseList.facetUnexclude;\n        }\n        else {\n            actionCause = this.isOmnibox ? AnalyticsActionListMeta_1.analyticsActionCauseList.omniboxFacetExclude : AnalyticsActionListMeta_1.analyticsActionCauseList.facetExclude;\n        }\n        this.facet.toggleExcludeValue(this.facetValue);\n        if (this.onExclude) {\n            this.facet.triggerNewQuery(function () { return _this.onExclude(_this, actionCause); });\n        }\n        else {\n            this.facet.triggerNewQuery(function () {\n                return _this.facet.usageAnalytics.logSearchEvent(actionCause, _this.getAnalyticsFacetMeta());\n            });\n        }\n    };\n    ValueElement.prototype.handleSelectValue = function (eventBindings) {\n        var _this = this;\n        this.facet.keepDisplayedValuesNextTime = eventBindings.displayNextTime && !this.facet.options.useAnd;\n        var actionCause;\n        if (this.facetValue.excluded) {\n            actionCause = this.isOmnibox ? AnalyticsActionListMeta_1.analyticsActionCauseList.omniboxFacetUnexclude : AnalyticsActionListMeta_1.analyticsActionCauseList.facetUnexclude;\n            this.facet.unexcludeValue(this.facetValue);\n        }\n        else {\n            if (this.facetValue.selected) {\n                actionCause = this.isOmnibox ? AnalyticsActionListMeta_1.analyticsActionCauseList.omniboxFacetDeselect : AnalyticsActionListMeta_1.analyticsActionCauseList.facetDeselect;\n            }\n            else {\n                actionCause = this.isOmnibox ? AnalyticsActionListMeta_1.analyticsActionCauseList.omniboxFacetSelect : AnalyticsActionListMeta_1.analyticsActionCauseList.facetSelect;\n            }\n            this.facet.toggleSelectValue(this.facetValue);\n        }\n        if (this.onSelect) {\n            this.facet.triggerNewQuery(function () { return _this.onSelect(_this, actionCause); });\n        }\n        else {\n            this.facet.triggerNewQuery(function () {\n                return _this.facet.usageAnalytics.logSearchEvent(actionCause, _this.getAnalyticsFacetMeta());\n            });\n        }\n    };\n    ValueElement.prototype.handleExcludeClick = function (eventBindings) {\n        this.facet.keepDisplayedValuesNextTime = eventBindings.displayNextTime && !this.facet.options.useAnd;\n        this.toggleExcludeWithUA();\n    };\n    ValueElement.prototype.handleSelectEventForExcludedValueElement = function (eventBindings) {\n        var _this = this;\n        var clickEvent = function () {\n            if (eventBindings.pinFacet) {\n                _this.facet.pinFacetPosition();\n            }\n            if (eventBindings.omniboxObject) {\n                _this.omniboxCloseEvent(eventBindings.omniboxObject);\n            }\n            _this.handleSelectValue(eventBindings);\n            _this.tryDismissSearchResults();\n            return false;\n        };\n        Dom_1.$$(this.renderer.label).on('click', function (e) {\n            e.stopPropagation();\n            clickEvent();\n        });\n        Dom_1.$$(this.renderer.stylishCheckbox).on('keydown', KeyboardUtils_1.KeyboardUtils.keypressAction([KeyboardUtils_1.KEYBOARD.SPACEBAR, KeyboardUtils_1.KEYBOARD.ENTER], clickEvent));\n    };\n    ValueElement.prototype.handleExcludeEventForValueElement = function (eventBindings) {\n        var _this = this;\n        var excludeAction = function (event) {\n            if (eventBindings.omniboxObject) {\n                _this.omniboxCloseEvent(eventBindings.omniboxObject);\n            }\n            _this.handleExcludeClick(eventBindings);\n            _this.tryDismissSearchResults();\n            event.stopPropagation();\n            event.preventDefault();\n        };\n        Dom_1.$$(this.renderer.excludeIcon).on('click', excludeAction);\n        Dom_1.$$(this.renderer.excludeIcon).on('keydown', KeyboardUtils_1.KeyboardUtils.keypressAction([KeyboardUtils_1.KEYBOARD.SPACEBAR, KeyboardUtils_1.KEYBOARD.ENTER], excludeAction));\n    };\n    ValueElement.prototype.handleSelectEventForValueElement = function (eventBindings) {\n        var _this = this;\n        var selectAction = function (event) {\n            if (eventBindings.pinFacet) {\n                _this.facet.pinFacetPosition();\n            }\n            _this.tryDismissSearchResults();\n            Dom_1.$$(_this.renderer.checkbox).trigger('change');\n            event.preventDefault();\n        };\n        Dom_1.$$(this.renderer.label).on('click', selectAction);\n        Dom_1.$$(this.renderer.stylishCheckbox).on('keydown', KeyboardUtils_1.KeyboardUtils.keypressAction([KeyboardUtils_1.KEYBOARD.SPACEBAR, KeyboardUtils_1.KEYBOARD.ENTER], selectAction));\n    };\n    ValueElement.prototype.handleEventForExcludedValueElement = function (eventBindings) {\n        this.handleSelectEventForExcludedValueElement(eventBindings);\n        this.handleExcludeEventForValueElement(eventBindings);\n    };\n    ValueElement.prototype.handleEventForValueElement = function (eventBindings) {\n        this.handleSelectEventForValueElement(eventBindings);\n        this.handleExcludeEventForValueElement(eventBindings);\n    };\n    ValueElement.prototype.handleEventForCheckboxChange = function (eventBindings) {\n        var _this = this;\n        Dom_1.$$(this.renderer.checkbox).on('change', function () {\n            if (eventBindings.omniboxObject) {\n                _this.omniboxCloseEvent(eventBindings.omniboxObject);\n            }\n            _this.handleSelectValue(eventBindings);\n        });\n    };\n    ValueElement.prototype.omniboxCloseEvent = function (eventArg) {\n        eventArg.closeOmnibox();\n        eventArg.clear();\n    };\n    ValueElement.prototype.tryDismissSearchResults = function () {\n        if (this.facet && this.facet.facetSearch && this.facet.facetSearch.dismissSearchResults) {\n            this.facet.facetSearch.dismissSearchResults();\n        }\n    };\n    ValueElement.prototype.getAnalyticsFacetMeta = function () {\n        return {\n            facetId: this.facet.options.id,\n            facetField: this.facet.options.field.toString(),\n            facetValue: this.facetValue.value,\n            facetTitle: this.facet.options.title\n        };\n    };\n    return ValueElement;\n}());\nexports.ValueElement = ValueElement;\n\n\n/***/ }),\n\n/***/ 474:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar Utils_1 = __webpack_require__(4);\nvar Strings_1 = __webpack_require__(6);\nvar Component_1 = __webpack_require__(7);\nvar _ = __webpack_require__(0);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(15);\nvar ValueElementRenderer = /** @class */ (function () {\n    function ValueElementRenderer(facet, facetValue) {\n        this.facet = facet;\n        this.facetValue = facetValue;\n    }\n    ValueElementRenderer.prototype.withNo = function (element) {\n        if (_.isArray(element)) {\n            _.each(element, function (e) {\n                if (e) {\n                    Dom_1.$$(e).detach();\n                }\n            });\n        }\n        else {\n            if (element) {\n                Dom_1.$$(element).detach();\n            }\n        }\n        return this;\n    };\n    ValueElementRenderer.prototype.build = function () {\n        this.buildListItem();\n        this.initAndAppendLabel();\n        this.initAndAppendExcludeIcon();\n        this.setCssClassOnListValueElement();\n        this.addAccessibilityAttributesToTargetElement();\n        return this;\n    };\n    ValueElementRenderer.prototype.setCssClassOnListValueElement = function () {\n        Dom_1.$$(this.listItem).toggleClass('coveo-selected', this.facetValue.selected);\n        Dom_1.$$(this.listItem).toggleClass('coveo-excluded', this.facetValue.excluded);\n    };\n    Object.defineProperty(ValueElementRenderer.prototype, \"accessibleElement\", {\n        get: function () {\n            return this.stylishCheckbox;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueElementRenderer.prototype.buildExcludeIcon = function () {\n        var isExcluded = this.facetValue.excluded;\n        var excludeIcon = Dom_1.$$('div', {\n            ariaLabel: Strings_1.l('ExcludeValueWithResultCount', this.caption, Strings_1.l('ResultCount', this.count, parseInt(this.count, 10))),\n            className: 'coveo-facet-value-exclude',\n            tabindex: 0,\n            role: 'button',\n            ariaPressed: isExcluded.toString()\n        }).el;\n        this.addFocusAndBlurEventListeners(excludeIcon);\n        excludeIcon.innerHTML = isExcluded ? SVGIcons_1.SVGIcons.icons.plus : SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(excludeIcon, isExcluded ? 'coveo-facet-value-unexclude-svg' : 'coveo-facet-value-exclude-svg');\n        SVGDom_1.SVGDom.addAttributesToSVGInContainer(excludeIcon, { 'aria-hidden': 'true' });\n        return excludeIcon;\n    };\n    ValueElementRenderer.prototype.buildValueComputedField = function () {\n        var computedField = this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat);\n        if (Utils_1.Utils.isNonEmptyString(computedField)) {\n            var elem = Dom_1.$$('span', {\n                className: 'coveo-facet-value-computed-field'\n            }).el;\n            Dom_1.$$(elem).text(computedField);\n            return elem;\n        }\n        else {\n            return undefined;\n        }\n    };\n    ValueElementRenderer.prototype.buildValueCheckbox = function () {\n        var checkbox = Dom_1.$$('input', {\n            type: 'checkbox',\n            ariaHidden: true,\n            ariaLabel: this.ariaLabel\n        }).el;\n        this.facetValue.selected ? checkbox.setAttribute('checked', 'checked') : checkbox.removeAttribute('checked');\n        this.facetValue.excluded ? checkbox.setAttribute('disabled', 'disabled') : checkbox.removeAttribute('disabled');\n        Component_1.Component.pointElementsToDummyForm(checkbox);\n        return checkbox;\n    };\n    ValueElementRenderer.prototype.buildValueStylishCheckbox = function () {\n        var checkbox = Dom_1.$$('div', {\n            className: 'coveo-facet-value-checkbox',\n            tabindex: 0\n        }).el;\n        checkbox.innerHTML = SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(checkbox, 'coveo-facet-value-checkbox-svg');\n        this.addFocusAndBlurEventListeners(checkbox);\n        return checkbox;\n    };\n    ValueElementRenderer.prototype.buildValueIcon = function () {\n        var icon = this.getValueIcon();\n        if (Utils_1.Utils.exists(icon)) {\n            return Dom_1.$$('img', {\n                className: 'coveo-facet-value-icon coveo-icon',\n                src: this.getValueIcon()\n            }).el;\n        }\n        else {\n            return this.buildValueIconFromSprite();\n        }\n    };\n    ValueElementRenderer.prototype.getValueIcon = function () {\n        if (Utils_1.Utils.exists(this.facet.options.valueIcon)) {\n            return this.facet.options.valueIcon(this.facetValue);\n        }\n        else {\n            return undefined;\n        }\n    };\n    ValueElementRenderer.prototype.buildValueIconFromSprite = function () {\n        return Dom_1.$$('div', {\n            className: 'coveo-facet-value-icon coveo-icon ' + this.facet.options.field.substr(1) + ' ' + this.facetValue.value\n        }).el;\n    };\n    ValueElementRenderer.prototype.buildValueCaption = function () {\n        var valueCaption = Dom_1.$$('span', {\n            className: 'coveo-facet-value-caption',\n            title: this.caption,\n            'data-original-value': this.facetValue.value\n        }).el;\n        Dom_1.$$(valueCaption).text(this.caption);\n        return valueCaption;\n    };\n    ValueElementRenderer.prototype.buildValueCount = function () {\n        if (Utils_1.Utils.isNonEmptyString(this.count)) {\n            var countElement = Dom_1.$$('span', {\n                className: 'coveo-facet-value-count'\n            }).el;\n            Dom_1.$$(countElement).text(this.count);\n            return countElement;\n        }\n        else {\n            return undefined;\n        }\n    };\n    Object.defineProperty(ValueElementRenderer.prototype, \"caption\", {\n        get: function () {\n            return this.facet.getValueCaption(this.facetValue);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ValueElementRenderer.prototype, \"count\", {\n        get: function () {\n            return this.facetValue.getFormattedCount();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueElementRenderer.prototype.addFocusAndBlurEventListeners = function (elem) {\n        var _this = this;\n        Dom_1.$$(elem).on('focus', function () { return Dom_1.$$(_this.listItem).addClass('coveo-focused'); });\n        Dom_1.$$(elem).on('blur', function () { return Dom_1.$$(_this.listItem).removeClass('coveo-focused'); });\n    };\n    ValueElementRenderer.prototype.buildListItem = function () {\n        this.listItem = Dom_1.$$('li', { className: 'coveo-facet-value coveo-facet-selectable', ariaLabel: this.ariaLabel }).el;\n        if (!Dom_1.$$(this.listItem).canHandleEvent('touchstart')) {\n            Dom_1.$$(this.listItem).addClass('coveo-with-hover');\n        }\n        this.listItem.setAttribute('data-value', this.facetValue.value);\n    };\n    ValueElementRenderer.prototype.initAndAppendLabel = function () {\n        this.label = Dom_1.$$('label', { className: 'coveo-facet-value-label', role: 'group' }).el;\n        this.tryToInitAndAppendComputedField();\n        this.initAndAppendFacetValueLabelWrapper();\n        this.listItem.appendChild(this.label);\n    };\n    ValueElementRenderer.prototype.initAndAppendExcludeIcon = function () {\n        this.excludeIcon = this.buildExcludeIcon();\n        this.attachExcludeIconEventHandlers();\n        this.listItem.appendChild(this.excludeIcon);\n    };\n    ValueElementRenderer.prototype.attachExcludeIconEventHandlers = function () {\n        var _this = this;\n        Dom_1.$$(this.excludeIcon).on('mouseover', function () {\n            Dom_1.$$(_this.listItem).addClass('coveo-facet-value-will-exclude');\n        });\n        Dom_1.$$(this.excludeIcon).on('mouseout', function () {\n            Dom_1.$$(_this.listItem).removeClass('coveo-facet-value-will-exclude');\n        });\n    };\n    ValueElementRenderer.prototype.tryToInitAndAppendComputedField = function () {\n        if (!Utils_1.Utils.exists(this.facetValue.computedField)) {\n            return;\n        }\n        this.computedField = this.buildValueComputedField();\n        if (!this.computedField) {\n            return;\n        }\n        this.label.appendChild(this.computedField);\n        Dom_1.$$(this.label).addClass('coveo-with-computed-field');\n    };\n    ValueElementRenderer.prototype.initAndAppendFacetValueLabelWrapper = function () {\n        this.facetValueLabelWrapper = Dom_1.$$('div', { className: 'coveo-facet-value-label-wrapper' }).el;\n        this.initAndAppendCheckbox();\n        this.initAndAppendStylishCheckbox();\n        this.initAndAppendValueCaption();\n        this.initAndAppendValueCount();\n        this.label.appendChild(this.facetValueLabelWrapper);\n    };\n    ValueElementRenderer.prototype.initAndAppendCheckbox = function () {\n        this.checkbox = this.buildValueCheckbox();\n        this.facetValueLabelWrapper.appendChild(this.checkbox);\n    };\n    ValueElementRenderer.prototype.initAndAppendStylishCheckbox = function () {\n        this.stylishCheckbox = this.buildValueStylishCheckbox();\n        this.facetValueLabelWrapper.appendChild(this.stylishCheckbox);\n    };\n    ValueElementRenderer.prototype.initAndAppendValueCount = function () {\n        this.valueCount = this.buildValueCount();\n        if (!this.valueCount) {\n            return;\n        }\n        this.facetValueLabelWrapper.appendChild(this.valueCount);\n    };\n    ValueElementRenderer.prototype.initAndAppendValueCaption = function () {\n        this.valueCaption = this.buildValueCaption();\n        this.facetValueLabelWrapper.appendChild(this.valueCaption);\n    };\n    ValueElementRenderer.prototype.addAccessibilityAttributesToTargetElement = function () {\n        var el = this.accessibleElement;\n        el.setAttribute('aria-label', this.ariaLabel);\n        el.setAttribute('role', 'button');\n        el.setAttribute('aria-pressed', this.ariaPressed);\n    };\n    Object.defineProperty(ValueElementRenderer.prototype, \"ariaLabel\", {\n        get: function () {\n            var resultCount = Strings_1.l('ResultCount', this.count, parseInt(this.count, 10));\n            return \"\" + Strings_1.l('IncludeValueWithResultCount', this.caption, resultCount);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ValueElementRenderer.prototype, \"ariaPressed\", {\n        get: function () {\n            if (this.facetValue.excluded) {\n                return 'mixed';\n            }\n            return this.facetValue.selected ? 'true' : 'false';\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return ValueElementRenderer;\n}());\nexports.ValueElementRenderer = ValueElementRenderer;\n\n\n/***/ }),\n\n/***/ 475:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar StringUtils_1 = __webpack_require__(22);\nvar _ = __webpack_require__(0);\nvar FacetValuesOrder = /** @class */ (function () {\n    function FacetValuesOrder(facet, facetSort) {\n        this.facet = facet;\n        this.facetSort = facetSort;\n    }\n    FacetValuesOrder.prototype.reorderValues = function (facetValues) {\n        if (this.facetSort && this.facetSort.activeSort) {\n            if (this.usingCustomSort) {\n                return this.reorderValuesWithCustomOrder(facetValues);\n            }\n            if (this.usingAlphabeticalSort) {\n                return this.reorderValuesWithCustomCaption(facetValues);\n            }\n        }\n        return facetValues;\n    };\n    FacetValuesOrder.prototype.reorderValuesIfUsingCustomSort = function (values) {\n        return this.usingCustomSort ? this.reorderValuesWithCustomOrder(values) : values;\n    };\n    FacetValuesOrder.prototype.reorderValuesIfUsingAlphabeticalSort = function (values) {\n        return this.usingAlphabeticalSort ? this.reorderValuesWithCustomCaption(values) : values;\n    };\n    Object.defineProperty(FacetValuesOrder.prototype, \"usingCustomSort\", {\n        get: function () {\n            return this.facetSort.activeSort.name == 'custom' && this.facet.options.customSort != undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetValuesOrder.prototype, \"usingAlphabeticalSort\", {\n        get: function () {\n            return this.facetSort.activeSort.name.indexOf('alpha') != -1;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetValuesOrder.prototype.reorderValuesWithCustomOrder = function (facetValues) {\n        var customSortsLowercase = _.map(this.facet.options.customSort, function (customSort) { return customSort.toLowerCase(); });\n        var valueIndexPair = _.map(facetValues, function (facetValue, i) {\n            // Get the index of the current value in the custom sort array.\n            // If it's not found, put it's index to it's original value + the length of customSort so that's always after the specified custom sort order.\n            var index = _.findIndex(customSortsLowercase, function (customSort) {\n                return (StringUtils_1.StringUtils.equalsCaseInsensitive(customSort, facetValue.value) ||\n                    (facetValue.lookupValue != null && StringUtils_1.StringUtils.equalsCaseInsensitive(customSort, facetValue.lookupValue)));\n            });\n            if (index == -1) {\n                index = i + customSortsLowercase.length;\n            }\n            return { facetValue: facetValue, index: index };\n        });\n        var sorted = _.sortBy(valueIndexPair, 'index');\n        sorted = this.facetSort.customSortDirection == 'ascending' ? sorted : sorted.reverse();\n        return _.pluck(sorted, 'facetValue');\n    };\n    FacetValuesOrder.prototype.reorderValuesWithCustomCaption = function (facetValues) {\n        var _this = this;\n        var sorted = facetValues.sort(function (firstValue, secondValue) {\n            return _this.facet.getValueCaption(firstValue).localeCompare(_this.facet.getValueCaption(secondValue), String['locale'], {\n                sensitivity: 'base'\n            });\n        });\n        if (this.facetSort.activeSort.name.indexOf('descending') != -1) {\n            sorted = sorted.reverse();\n        }\n        return sorted;\n    };\n    return FacetValuesOrder;\n}());\nexports.FacetValuesOrder = FacetValuesOrder;\n\n\n/***/ }),\n\n/***/ 476:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(15);\nvar Component_1 = __webpack_require__(7);\nvar Strings_1 = __webpack_require__(6);\nvar EventsUtils_1 = __webpack_require__(482);\nvar FacetSearchUserInputHandler_1 = __webpack_require__(544);\nvar underscore_1 = __webpack_require__(0);\nvar SearchDropdownNavigatorFactory_1 = __webpack_require__(545);\nvar KeyboardUtils_1 = __webpack_require__(26);\nvar FacetSearchElement = /** @class */ (function () {\n    function FacetSearchElement(facetSearch) {\n        this.facetSearch = facetSearch;\n        this.searchBarIsAnimating = false;\n        this.triggeredScroll = false;\n        this.facetSearchId = underscore_1.uniqueId('coveo-facet-search-results');\n        this.facetValueNotFoundId = underscore_1.uniqueId('coveo-facet-value-not-found');\n        this.facetSearchUserInputHandler = new FacetSearchUserInputHandler_1.FacetSearchUserInputHandler(this.facetSearch);\n        this.initSearchResults();\n    }\n    FacetSearchElement.prototype.build = function (handleFacetSearchClear) {\n        var _this = this;\n        this.search = document.createElement('div');\n        Dom_1.$$(this.search).addClass('coveo-facet-search');\n        this.magnifier = this.buildMagnifierIcon();\n        this.search.appendChild(this.magnifier);\n        this.wait = this.buildWaitIcon();\n        this.search.appendChild(this.wait);\n        this.hideFacetSearchWaitingAnimation();\n        this.clear = Dom_1.$$('div', { className: 'coveo-facet-search-clear', title: Strings_1.l('Clear', Strings_1.l('Search')) }, SVGIcons_1.SVGIcons.icons.clear).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(this.clear, 'coveo-facet-search-clear-svg');\n        this.clear.style.display = 'none';\n        this.search.appendChild(this.clear);\n        this.combobox = this.buildCombobox();\n        this.search.appendChild(this.combobox);\n        this.input = this.buildInputElement();\n        Component_1.Component.pointElementsToDummyForm(this.input);\n        this.combobox.appendChild(this.input);\n        Dom_1.$$(this.input).on('keyup', function (e) {\n            _this.facetSearchUserInputHandler.handleKeyboardEvent(e);\n        });\n        Dom_1.$$(this.clear).on('click', function (e) {\n            handleFacetSearchClear && handleFacetSearchClear();\n        });\n        Dom_1.$$(this.input).on('focus', function (e) {\n            _this.handleFacetSearchFocus();\n        });\n        Dom_1.$$(this.input).on('blur', function (e) { return _this.onInputBlur(e); });\n        this.detectSearchBarAnimation();\n        this.initSearchDropdownNavigator();\n        return this.search;\n    };\n    FacetSearchElement.prototype.initSearchResults = function () {\n        var _this = this;\n        this.searchResults = Dom_1.$$('ul', { id: this.facetSearchId, className: 'coveo-facet-search-results', role: 'listbox' }).el;\n        Dom_1.$$(this.searchResults).on('scroll', function () { return _this.handleScrollEvent(); });\n        Dom_1.$$(this.searchResults).on('keyup', function (e) {\n            if (e.which === KeyboardUtils_1.KEYBOARD.ESCAPE) {\n                _this.facetSearch.dismissSearchResults();\n            }\n        });\n        Dom_1.$$(this.searchResults).on('focusout', function (event) { return _this.onSearchResultsFocusOut(event); });\n        Dom_1.$$(this.searchResults).hide();\n    };\n    FacetSearchElement.prototype.onInputBlur = function (e) {\n        var target = e.relatedTarget;\n        var isUsingKeyboard = !!target;\n        var focusedOnSearchResult = this.searchResults.contains(target);\n        if (isUsingKeyboard && !focusedOnSearchResult) {\n            this.facetSearch.dismissSearchResults();\n        }\n    };\n    FacetSearchElement.prototype.onSearchResultsFocusOut = function (e) {\n        var target = e.relatedTarget;\n        var isUsingKeyboard = !!target;\n        var focusedOnInput = this.input.contains(target);\n        var focusedOnSearchResult = this.searchResults.contains(target);\n        if (isUsingKeyboard && !focusedOnInput && !focusedOnSearchResult) {\n            this.facetSearch.dismissSearchResults();\n        }\n    };\n    FacetSearchElement.prototype.initSearchDropdownNavigator = function () {\n        var _this = this;\n        var config = {\n            input: this.input,\n            searchResults: this.searchResults,\n            setScrollTrigger: function (val) { return (_this.triggeredScroll = val); }\n        };\n        this.searchDropdownNavigator = SearchDropdownNavigatorFactory_1.SearchDropdownNavigatorFactory(this.facetSearch, config);\n    };\n    FacetSearchElement.prototype.buildCombobox = function () {\n        return Dom_1.$$('div', {\n            className: 'coveo-facet-search-middle',\n            ariaHaspopup: 'listbox',\n            ariaExpanded: 'true'\n        }).el;\n    };\n    FacetSearchElement.prototype.showFacetSearchWaitingAnimation = function () {\n        this.magnifier && Dom_1.$$(this.magnifier).hide();\n        Dom_1.$$(this.wait).show();\n    };\n    FacetSearchElement.prototype.getValueInInputForFacetSearch = function () {\n        return this.input.value.trim();\n    };\n    FacetSearchElement.prototype.hideFacetSearchWaitingAnimation = function () {\n        Dom_1.$$(this.magnifier).show();\n        Dom_1.$$(this.wait).hide();\n    };\n    FacetSearchElement.prototype.detectSearchBarAnimation = function () {\n        var _this = this;\n        EventsUtils_1.EventsUtils.addPrefixedEvent(this.search, 'AnimationStart', function (event) {\n            if (event.animationName == 'grow') {\n                _this.searchBarIsAnimating = true;\n            }\n        });\n        EventsUtils_1.EventsUtils.addPrefixedEvent(this.search, 'AnimationEnd', function (event) {\n            if (event.animationName == 'grow') {\n                _this.searchBarIsAnimating = false;\n            }\n        });\n    };\n    FacetSearchElement.prototype.positionSearchResults = function () {\n        var _this = this;\n        if (this.searchResults != null) {\n            Dom_1.$$(this.searchResults).insertAfter(this.search);\n            Dom_1.$$(this.searchResults).show();\n            if (Dom_1.$$(this.searchResults).css('display') == 'none') {\n                this.searchResults.style.display = '';\n            }\n            var searchBar = Dom_1.$$(this.search);\n            if (searchBar.css('display') == 'none' || this.searchBarIsAnimating) {\n                if (Dom_1.$$(this.searchResults).css('display') == 'none') {\n                    this.searchResults.style.display = '';\n                }\n                EventsUtils_1.EventsUtils.addPrefixedEvent(this.search, 'AnimationEnd', function () {\n                    EventsUtils_1.EventsUtils.removePrefixedEvent(_this.search, 'AnimationEnd', _this);\n                });\n            }\n        }\n        this.addAriaAttributes();\n    };\n    FacetSearchElement.prototype.setAsCurrentResult = function (toSet) {\n        this.searchDropdownNavigator.setAsCurrentResult(toSet);\n    };\n    Object.defineProperty(FacetSearchElement.prototype, \"currentResult\", {\n        get: function () {\n            return this.searchDropdownNavigator.currentResult;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetSearchElement.prototype.moveCurrentResultDown = function () {\n        this.searchDropdownNavigator.focusNextElement();\n    };\n    FacetSearchElement.prototype.moveCurrentResultUp = function () {\n        this.searchDropdownNavigator.focusPreviousElement();\n    };\n    FacetSearchElement.prototype.highlightCurrentQueryInSearchResults = function (regex) {\n        var captions = this.facetSearch.getCaptions();\n        captions.forEach(function (caption) {\n            caption.innerHTML = Dom_1.$$(caption).text().replace(regex, '<span class=\"coveo-highlight\">$1</span>');\n        });\n    };\n    FacetSearchElement.prototype.appendToSearchResults = function (el) {\n        this.searchResults.appendChild(el);\n        this.setupFacetSearchResultsEvents(el);\n    };\n    FacetSearchElement.prototype.emptyAndShowNoResults = function () {\n        Dom_1.$$(this.searchResults).empty();\n        this.searchResults.appendChild(Dom_1.$$('li', { id: this.facetValueNotFoundId, className: 'coveo-facet-value-not-found', role: 'option', ariaSelected: 'true', tabindex: 0 }, Strings_1.l('NoValuesFound')).el);\n        this.input.setAttribute('aria-activedescendant', this.facetValueNotFoundId);\n    };\n    FacetSearchElement.prototype.updateAriaLiveWithResults = function (inputValue, numberOfResults, moreValuesToFetch) {\n        var ariaLiveText = inputValue === ''\n            ? Strings_1.l('ShowingResults', numberOfResults, inputValue, numberOfResults)\n            : Strings_1.l('ShowingResultsWithQuery', numberOfResults, inputValue, numberOfResults);\n        if (moreValuesToFetch) {\n            ariaLiveText = ariaLiveText + \" (\" + Strings_1.l('MoreValuesAvailable') + \")\";\n        }\n        this.facetSearch.updateAriaLive(ariaLiveText);\n    };\n    FacetSearchElement.prototype.focus = function () {\n        this.input.focus();\n        this.handleFacetSearchFocus();\n    };\n    FacetSearchElement.prototype.handleFacetSearchFocus = function () {\n        if (this.facetSearch.currentlyDisplayedResults == null) {\n            this.facetSearch.displayNewValues();\n            this.addAriaAttributes();\n        }\n    };\n    FacetSearchElement.prototype.setupFacetSearchResultsEvents = function (el) {\n        var _this = this;\n        Dom_1.$$(el).on('mousemove', function () {\n            _this.setAsCurrentResult(Dom_1.$$(el));\n        });\n        // Prevent closing the search results on the end of a touch drag\n        var touchDragging = false;\n        var mouseDragging = false;\n        Dom_1.$$(el).on('mousedown', function () { return (mouseDragging = false); });\n        Dom_1.$$(el).on('mousemove', function () { return (mouseDragging = true); });\n        Dom_1.$$(el).on('touchmove', function () { return (touchDragging = true); });\n        Dom_1.$$(el).on('mouseup touchend', function () {\n            if (!touchDragging && !mouseDragging) {\n                setTimeout(function () {\n                    _this.facetSearch.dismissSearchResults();\n                }, 0); // setTimeout is to give time to trigger the click event before hiding the search menu.\n            }\n            touchDragging = false;\n            mouseDragging = false;\n        });\n    };\n    FacetSearchElement.prototype.hideSearchResultsElement = function () {\n        this.removeAriaAttributes();\n        Dom_1.$$(this.searchResults).hide();\n        Dom_1.$$(this.searchResults).remove();\n    };\n    FacetSearchElement.prototype.clearSearchInput = function () {\n        if (this.input) {\n            this.input.value = '';\n        }\n    };\n    FacetSearchElement.prototype.buildMagnifierIcon = function () {\n        var magnifier = document.createElement('div');\n        magnifier.innerHTML = SVGIcons_1.SVGIcons.icons.search;\n        Dom_1.$$(magnifier).addClass('coveo-facet-search-magnifier');\n        SVGDom_1.SVGDom.addClassToSVGInContainer(magnifier, 'coveo-facet-search-magnifier-svg');\n        this.search.appendChild(magnifier);\n        return magnifier;\n    };\n    FacetSearchElement.prototype.buildWaitIcon = function () {\n        var wait = document.createElement('div');\n        wait.innerHTML = SVGIcons_1.SVGIcons.icons.loading;\n        Dom_1.$$(wait).addClass('coveo-facet-search-wait-animation');\n        SVGDom_1.SVGDom.addClassToSVGInContainer(wait, 'coveo-facet-search-wait-animation-svg');\n        return wait;\n    };\n    FacetSearchElement.prototype.buildInputElement = function () {\n        return Dom_1.$$('input', {\n            className: 'coveo-facet-search-input',\n            type: 'text',\n            autocapitalize: 'off',\n            autocorrect: 'off',\n            ariaLabel: Strings_1.l('SearchFacetResults', this.facetSearch.facetTitle),\n            ariaHaspopup: 'true',\n            ariaAutocomplete: 'list'\n        }).el;\n    };\n    FacetSearchElement.prototype.handleScrollEvent = function () {\n        if (this.triggeredScroll) {\n            this.triggeredScroll = false;\n        }\n        else {\n            this.facetSearchUserInputHandler.handleFacetSearchResultsScroll();\n        }\n    };\n    FacetSearchElement.prototype.addAriaAttributes = function () {\n        if (!this.input || !this.combobox) {\n            return;\n        }\n        this.combobox.setAttribute('role', 'combobox');\n        this.combobox.setAttribute('aria-owns', this.facetSearchId);\n        this.input.setAttribute('aria-controls', this.facetSearchId);\n        this.input.setAttribute('aria-expanded', 'true');\n        this.facetSearch.setExpandedFacetSearchAccessibilityAttributes(this.searchResults);\n    };\n    FacetSearchElement.prototype.removeAriaAttributes = function () {\n        if (!this.input || !this.combobox) {\n            return;\n        }\n        this.combobox.removeAttribute('role');\n        this.combobox.removeAttribute('aria-owns');\n        this.input.removeAttribute('aria-controls');\n        this.input.removeAttribute('aria-activedescendant');\n        this.input.setAttribute('aria-expanded', 'false');\n        this.facetSearch.setCollapsedFacetSearchAccessibilityAttributes();\n    };\n    return FacetSearchElement;\n}());\nexports.FacetSearchElement = FacetSearchElement;\n\n\n/***/ }),\n\n/***/ 477:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar DefaultSearchDropdownNavigator = /** @class */ (function () {\n    function DefaultSearchDropdownNavigator(config) {\n        this.config = config;\n    }\n    DefaultSearchDropdownNavigator.prototype.setAsCurrentResult = function (toSet) {\n        this.currentResult && this.currentResult.removeClass('coveo-facet-search-current-result');\n        this.currentResult = toSet;\n        toSet.addClass('coveo-facet-search-current-result');\n        this.updateSelectedOption(toSet);\n    };\n    DefaultSearchDropdownNavigator.prototype.focusNextElement = function () {\n        this.moveCurrentResultDown();\n    };\n    DefaultSearchDropdownNavigator.prototype.focusPreviousElement = function () {\n        this.moveCurrentResultUp();\n    };\n    DefaultSearchDropdownNavigator.prototype.moveCurrentResultDown = function () {\n        var nextResult = this.currentResult.el.nextElementSibling;\n        if (!nextResult) {\n            nextResult = underscore_1.first(this.searchResults.children);\n        }\n        this.setAsCurrentResult(Dom_1.$$(nextResult));\n        this.highlightAndShowCurrentResultWithKeyboard();\n    };\n    DefaultSearchDropdownNavigator.prototype.moveCurrentResultUp = function () {\n        var previousResult = this.currentResult.el.previousElementSibling;\n        if (!previousResult) {\n            previousResult = underscore_1.last(this.searchResults.children);\n        }\n        this.setAsCurrentResult(Dom_1.$$(previousResult));\n        this.highlightAndShowCurrentResultWithKeyboard();\n    };\n    DefaultSearchDropdownNavigator.prototype.highlightAndShowCurrentResultWithKeyboard = function () {\n        this.currentResult.addClass('coveo-facet-search-current-result');\n        this.config.setScrollTrigger(true);\n        this.searchResults.scrollTop = this.currentResult.el.offsetTop;\n    };\n    Object.defineProperty(DefaultSearchDropdownNavigator.prototype, \"searchResults\", {\n        get: function () {\n            return this.config.searchResults;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DefaultSearchDropdownNavigator.prototype.updateSelectedOption = function (option) {\n        this.config.input.setAttribute('aria-activedescendant', option.getAttribute('id'));\n        var previouslySelectedOption = Dom_1.$$(this.searchResults).find('[aria-selected^=\"true\"]');\n        previouslySelectedOption && previouslySelectedOption.setAttribute('aria-selected', 'false');\n        option.setAttribute('aria-selected', 'true');\n    };\n    return DefaultSearchDropdownNavigator;\n}());\nexports.DefaultSearchDropdownNavigator = DefaultSearchDropdownNavigator;\n\n\n/***/ }),\n\n/***/ 478:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar CategoryValue_1 = __webpack_require__(549);\nvar underscore_1 = __webpack_require__(0);\nvar CategoryChildrenValueRenderer = /** @class */ (function () {\n    function CategoryChildrenValueRenderer(element, categoryFacetTemplates, categoryValue, categoryFacet) {\n        this.element = element;\n        this.categoryFacetTemplates = categoryFacetTemplates;\n        this.categoryValue = categoryValue;\n        this.categoryFacet = categoryFacet;\n        this.children = [];\n    }\n    CategoryChildrenValueRenderer.prototype.clearChildren = function () {\n        this.element.removeClass('coveo-active-category-facet-parent');\n        this.children.forEach(function (child) {\n            child.clear();\n        });\n        this.children = [];\n    };\n    CategoryChildrenValueRenderer.prototype.renderChildren = function (values) {\n        var _this = this;\n        underscore_1.each(values, function (value) {\n            _this.renderValue(value, true).makeSelectable();\n        });\n    };\n    CategoryChildrenValueRenderer.prototype.renderAsParent = function (value) {\n        var categoryValue = this.renderValue(value, false);\n        return categoryValue;\n    };\n    CategoryChildrenValueRenderer.prototype.renderValue = function (value, isChild) {\n        var path = this.categoryValue.path.concat([value.value]);\n        var categoryValueDescriptor = {\n            value: value.value,\n            count: value.numberOfResults,\n            path: path\n        };\n        var categoryValue = new CategoryValue_1.CategoryValue(this.categoryValue.listRoot, categoryValueDescriptor, this.categoryFacetTemplates, this.categoryFacet);\n        categoryValue.render(isChild);\n        this.children.push(categoryValue);\n        return categoryValue;\n    };\n    return CategoryChildrenValueRenderer;\n}());\nexports.CategoryChildrenValueRenderer = CategoryChildrenValueRenderer;\n\n\n/***/ }),\n\n/***/ 479:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar popper_js_1 = __webpack_require__(173);\n__webpack_require__(558);\nvar underscore_1 = __webpack_require__(0);\nvar InitializationEvents_1 = __webpack_require__(17);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar Strings_1 = __webpack_require__(6);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar Dom_1 = __webpack_require__(1);\nvar KeyboardUtils_1 = __webpack_require__(26);\nvar LocalStorageUtils_1 = __webpack_require__(41);\nvar SVGDom_1 = __webpack_require__(15);\nvar SVGIcons_1 = __webpack_require__(12);\nvar Utils_1 = __webpack_require__(4);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar FacetSort_1 = __webpack_require__(480);\n/**\n * Handle the rendering of the {@link Facet} settings menu (typically the ... in the facet header).\n */\nvar FacetSettings = /** @class */ (function (_super) {\n    __extends(FacetSettings, _super);\n    function FacetSettings(sorts, facet) {\n        var _this = _super.call(this, sorts, facet) || this;\n        _this.sorts = sorts;\n        _this.facet = facet;\n        _this.customSortDirectionChange = false;\n        _this.onDocumentClick = function () { return _this.close(); };\n        _this.enabledSortsIgnoreRenderBecauseOfPairs = [];\n        _this.filterDuplicateForRendering();\n        return _this;\n    }\n    Object.defineProperty(FacetSettings.prototype, \"isExpanded\", {\n        get: function () {\n            return this.settingsButton && this.settingsButton.getAttribute('aria-expanded') === \"\" + true;\n        },\n        set: function (expanded) {\n            this.settingsButton.setAttribute('aria-expanded', \"\" + expanded);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSettings.prototype, \"firstFocusablePopupElement\", {\n        get: function () {\n            return underscore_1.find(Dom_1.$$(this.settingsPopup).findAll('[tabindex]'), function (element) { return element.tabIndex >= 0; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Build the menu, hook click events.\n     * @returns {HTMLElement}\n     */\n    FacetSettings.prototype.build = function () {\n        var _this = this;\n        this.buildSettingsButton();\n        this.buildSettingsPopup();\n        if (Utils_1.Utils.isNonEmptyArray(this.enabledSorts)) {\n            this.sortSection = this.buildSortSection();\n            if (this.enabledSortsAllowDirection()) {\n                this.directionSection = this.buildDirectionSection();\n            }\n        }\n        if (this.facet.options.enableSettingsFacetState) {\n            this.saveStateSection = this.buildSaveStateSection();\n            this.clearStateSection = this.buildClearStateSection();\n        }\n        if (this.facet.options.enableCollapse) {\n            this.hideSection = this.buildHideSection();\n            this.showSection = this.buildShowSection();\n        }\n        var appendCommon = function () {\n            _this.appendIfNotUndefined(_this.saveStateSection);\n            _this.appendIfNotUndefined(_this.clearStateSection);\n            _this.appendIfNotUndefined(_this.hideSection);\n            _this.appendIfNotUndefined(_this.showSection);\n        };\n        this.addOnDocumentClickHandler();\n        this.addOnNukeHandler();\n        if (Utils_1.Utils.isNonEmptyArray(this.enabledSorts)) {\n            this.settingsPopup.appendChild(this.sortSection.element);\n            underscore_1.each(this.directionSection, function (d) {\n                _this.appendIfNotUndefined(d);\n            });\n            appendCommon();\n        }\n        else {\n            appendCommon();\n        }\n        return this.settingsButton;\n    };\n    /**\n     * Restore the facet state from local storage, and apply it in the query state model.\n     */\n    FacetSettings.prototype.loadSavedState = function () {\n        if (this.facetStateLocalStorage) {\n            // set the state from the settings only if there is nothing\n            // in the query state model for the current facet\n            var state = this.facetStateLocalStorage.load();\n            var currentStateIncluded = this.facet.queryStateModel.get(this.includedStateAttribute);\n            var currentStateExcluded = this.facet.queryStateModel.get(this.excludedStateAttribute);\n            var currentStateOperator = this.facet.queryStateModel.get(this.operatorStateAttribute);\n            if (!Utils_1.Utils.isNullOrUndefined(state) &&\n                Utils_1.Utils.isEmptyArray(currentStateIncluded) &&\n                Utils_1.Utils.isEmptyArray(currentStateExcluded) &&\n                !Utils_1.Utils.isNonEmptyString(currentStateOperator)) {\n                var toSet = {};\n                toSet[this.includedStateAttribute] = state.included;\n                toSet[this.excludedStateAttribute] = state.excluded;\n                toSet[this.operatorStateAttribute] = state.operator;\n                this.facet.queryStateModel.setMultiple(toSet);\n                this.loadedFromSettings = toSet;\n            }\n        }\n        else {\n            this.facet.logger.info('Facet state local storage not enabled : See Facet.options.enableSettingsFacetState');\n        }\n    };\n    /**\n     * Take the current state of the facet and save it in the local storage.\n     */\n    FacetSettings.prototype.saveState = function () {\n        if (this.facetStateLocalStorage) {\n            this.facetStateLocalStorage.save({\n                included: this.facet.queryStateModel.get(this.includedStateAttribute),\n                excluded: this.facet.queryStateModel.get(this.excludedStateAttribute),\n                operator: this.facet.queryStateModel.get(this.operatorStateAttribute)\n            });\n        }\n        else {\n            this.facet.logger.info('Facet state local storage not enabled : See Facet.options.enableSettingsFacetState');\n        }\n    };\n    /**\n     * Close the settings menu\n     */\n    FacetSettings.prototype.close = function () {\n        if (!this.isExpanded) {\n            return;\n        }\n        this.isExpanded = false;\n        Dom_1.$$(this.settingsPopup).detach();\n    };\n    /**\n     * Open the settings menu\n     */\n    FacetSettings.prototype.open = function () {\n        var _this = this;\n        Dom_1.$$(this.settingsPopup).insertAfter(this.settingsButton);\n        new popper_js_1.default(this.settingsButton, this.settingsPopup);\n        this.isExpanded = true;\n        if (this.hideSection && this.showSection) {\n            Dom_1.$$(this.hideSection).toggle(!Dom_1.$$(this.facet.element).hasClass('coveo-facet-collapsed'));\n            Dom_1.$$(this.showSection).toggle(Dom_1.$$(this.facet.element).hasClass('coveo-facet-collapsed'));\n        }\n        if (this.facet.options.enableSettingsFacetState) {\n            Dom_1.$$(this.clearStateSection).toggle(!Utils_1.Utils.isNullOrUndefined(this.facetStateLocalStorage.load()));\n        }\n        underscore_1.each(this.enabledSorts, function (criteria, i) {\n            if (_this.activeSort.name == criteria.name.toLowerCase()) {\n                _this.selectItem(_this.getSortItem(criteria.name));\n            }\n            else {\n                _this.unselectItem(_this.getSortItem(criteria.name));\n            }\n        });\n        var elementToFocus = this.firstFocusablePopupElement;\n        if (elementToFocus) {\n            elementToFocus.focus();\n        }\n    };\n    FacetSettings.prototype.getSortItem = function (sortName) {\n        return underscore_1.find(this.sortSection.sortItems, function (sortItem) {\n            return Dom_1.$$(sortItem).getAttribute('data-sort-name').toLowerCase() == sortName.replace('ascending|descending', '').toLowerCase();\n        });\n    };\n    Object.defineProperty(FacetSettings.prototype, \"button\", {\n        get: function () {\n            return this.settingsButton;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetSettings.prototype.buildSettingsButton = function () {\n        var _this = this;\n        this.settingsButton = Dom_1.$$('div', { className: 'coveo-facet-header-settings', 'aria-haspopup': 'true' }).el;\n        this.settingsButton.innerHTML = SVGIcons_1.SVGIcons.icons.more;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(this.settingsButton, 'coveo-facet-settings-more-svg');\n        this.hideElementOnMouseEnterLeave(this.settingsButton);\n        this.isExpanded = false;\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(this.settingsButton)\n            .withLabel(Strings_1.l('Settings'))\n            .withClickAction(function (e) { return _this.handleSettingsButtonClick(e); })\n            .withEnterKeyboardAction(function (e) { return _this.handleSettingsButtonClick(e); })\n            .build();\n    };\n    FacetSettings.prototype.hideElementOnMouseEnterLeave = function (el) {\n        var _this = this;\n        var mouseLeave = function () { return (_this.closeTimeout = window.setTimeout(function () { return _this.close(); }, 300)); };\n        var mouseEnter = function () { return clearTimeout(_this.closeTimeout); };\n        Dom_1.$$(el).on('mouseleave', mouseLeave);\n        Dom_1.$$(el).on('mouseenter', mouseEnter);\n        Dom_1.$$(el).on('keyup', KeyboardUtils_1.KeyboardUtils.keypressAction(KeyboardUtils_1.KEYBOARD.ESCAPE, function () { return _this.handleKeyboardClose(); }));\n    };\n    FacetSettings.prototype.handleKeyboardClose = function () {\n        this.close();\n        this.settingsButton.focus();\n    };\n    FacetSettings.prototype.buildSettingsPopup = function () {\n        var _this = this;\n        this.settingsPopup = Dom_1.$$('div', { className: 'coveo-facet-settings-popup' }).el;\n        this.hideElementOnMouseEnterLeave(this.settingsPopup);\n        Dom_1.$$(this.settingsPopup).on('focusout', function (e) {\n            if (e.relatedTarget && _this.settingsPopup.contains(e.relatedTarget)) {\n                return;\n            }\n            _this.close();\n        });\n    };\n    FacetSettings.prototype.buildSortSection = function () {\n        var sortSection = this.buildSection('coveo-facet-settings-section-sort');\n        var sortSectionIcon = this.buildIcon('coveo-facet-settings-section-sort-svg', SVGIcons_1.SVGIcons.icons.sort);\n        var sortSectionItems = this.buildItems();\n        var sortTitle = document.createElement('div');\n        Dom_1.$$(sortTitle).addClass('coveo-facet-settings-section-sort-title');\n        Dom_1.$$(sortTitle).text(Strings_1.l('SortBy') + ' :');\n        sortSectionItems.appendChild(sortTitle);\n        var sortItems = this.buildSortSectionItems();\n        underscore_1.each(sortItems, function (s) {\n            sortSectionItems.appendChild(s);\n        });\n        sortSection.appendChild(sortSectionIcon);\n        sortSection.appendChild(sortSectionItems);\n        return { element: sortSection, sortItems: sortItems };\n    };\n    FacetSettings.prototype.buildSortSectionItems = function () {\n        var _this = this;\n        var elems = underscore_1.map(this.enabledSorts, function (enabledSort) {\n            if (underscore_1.contains(_this.enabledSortsIgnoreRenderBecauseOfPairs, enabledSort)) {\n                return undefined;\n            }\n            else {\n                var elem = _this.buildItem(Strings_1.l(enabledSort.label), enabledSort.description);\n                Dom_1.$$(elem).setAttribute('data-sort-name', enabledSort.name.toLowerCase().replace('ascending|descending', ''));\n                new AccessibleButton_1.AccessibleButton()\n                    .withElement(elem)\n                    .withSelectAction(function (e) { return _this.handleClickSortButton(e, enabledSort); })\n                    .withLabel(enabledSort.label)\n                    .build();\n                return elem;\n            }\n        });\n        elems = underscore_1.compact(elems);\n        return elems;\n    };\n    FacetSettings.prototype.closePopupAndUpdateSort = function () {\n        this.close();\n        if (this.activeSort.name != 'custom') {\n            this.facet.updateSort(this.activeSort.name);\n        }\n        else {\n            this.facet.updateSort('nosort');\n            if (this.customSortDirectionChange) {\n                this.customSortDirectionChange = false;\n                this.facet.queryController.executeQuery();\n            }\n        }\n    };\n    FacetSettings.prototype.enabledSortsAllowDirection = function () {\n        var _this = this;\n        var allEnabledSortsWithPossibleDirectionToggle = underscore_1.filter(this.enabledSorts, function (facetSortDescription) {\n            return facetSortDescription.directionToggle;\n        });\n        var allowToggle = underscore_1.filter(allEnabledSortsWithPossibleDirectionToggle, function (possibleDirectionToggle) {\n            return underscore_1.findWhere(_this.enabledSorts, { name: possibleDirectionToggle.relatedSort }) != undefined;\n        });\n        return allowToggle.length > 0;\n    };\n    FacetSettings.prototype.buildDirectionSection = function () {\n        var _this = this;\n        var directionAscendingSection = this.buildAscendingOrDescendingSection('Ascending');\n        var iconAscending = this.buildIcon('coveo-facet-settings-section-direction-ascending-svg', SVGIcons_1.SVGIcons.icons.ascending);\n        var iconDescending = this.buildIcon('coveo-facet-settings-section-direction-descending-svg', SVGIcons_1.SVGIcons.icons.descending);\n        var directionItemsAscending = this.buildItems();\n        var ascending = this.buildAscendingOrDescending('Ascending');\n        directionItemsAscending.appendChild(ascending);\n        directionAscendingSection.appendChild(iconAscending);\n        directionAscendingSection.appendChild(directionItemsAscending);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(ascending)\n            .withoutLabelOrTitle()\n            .withSelectAction(function () { return _this.handleDirectionClick(ascending, 'ascending'); })\n            .build();\n        this.unselectSection(directionAscendingSection);\n        var directionDescendingSection = this.buildAscendingOrDescendingSection('Descending');\n        var directionItemsDescending = this.buildItems();\n        var descending = this.buildAscendingOrDescending('Descending');\n        directionItemsDescending.appendChild(descending);\n        directionDescendingSection.appendChild(iconDescending);\n        directionDescendingSection.appendChild(directionItemsDescending);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(descending)\n            .withoutLabelOrTitle()\n            .withSelectAction(function () { return _this.handleDirectionClick(descending, 'descending'); })\n            .build();\n        this.unselectSection(directionDescendingSection);\n        if (!this.activeSort.directionToggle) {\n            Dom_1.$$(directionAscendingSection).addClass('coveo-facet-settings-disabled');\n            Dom_1.$$(directionDescendingSection).addClass('coveo-facet-settings-disabled');\n        }\n        else {\n            this.selectItem(this.getItems(directionAscendingSection)[0]);\n        }\n        return [directionAscendingSection, directionDescendingSection];\n    };\n    FacetSettings.prototype.buildSaveStateSection = function () {\n        var _this = this;\n        var saveStateSection = this.buildSection('coveo-facet-settings-section-save-state');\n        var icon = this.buildIcon('coveo-facet-settings-section-save-state-svg', SVGIcons_1.SVGIcons.icons.dropdownMore);\n        var saveStateItems = this.buildItems();\n        this.facetStateLocalStorage = new LocalStorageUtils_1.LocalStorageUtils('facet-state-' + this.facet.options.id);\n        this.includedStateAttribute = QueryStateModel_1.QueryStateModel.getFacetId(this.facet.options.id);\n        this.excludedStateAttribute = QueryStateModel_1.QueryStateModel.getFacetId(this.facet.options.id, false);\n        this.operatorStateAttribute = QueryStateModel_1.QueryStateModel.getFacetOperator(this.facet.options.id);\n        var saveStateItem = document.createElement('div');\n        Dom_1.$$(saveStateItem).addClass('coveo-facet-settings-item');\n        saveStateItem.setAttribute('title', Strings_1.l('SaveFacetState'));\n        Dom_1.$$(saveStateItem).text(Strings_1.l('SaveFacetState'));\n        saveStateItems.appendChild(saveStateItem);\n        saveStateSection.appendChild(icon);\n        saveStateSection.appendChild(saveStateItems);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(saveStateSection)\n            .withSelectAction(function () { return _this.handleSaveStateClick(); })\n            .withoutLabelOrTitle()\n            .build();\n        return saveStateSection;\n    };\n    FacetSettings.prototype.buildClearStateSection = function () {\n        var _this = this;\n        var clearStateSection = this.buildSection('coveo-facet-settings-section-clear-state');\n        var icon = this.buildIcon('coveo-facet-settings-section-clear-state-svg', SVGIcons_1.SVGIcons.icons.dropdownLess);\n        var clearStateItems = this.buildItems();\n        var clearStateItem = this.buildItem(Strings_1.l('ClearFacetState'));\n        clearStateItems.appendChild(clearStateItem);\n        clearStateSection.appendChild(icon);\n        clearStateSection.appendChild(clearStateItems);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(clearStateSection)\n            .withSelectAction(function () { return _this.handleClearStateClick(); })\n            .withoutLabelOrTitle()\n            .build();\n        return clearStateSection;\n    };\n    FacetSettings.prototype.buildHideSection = function () {\n        var _this = this;\n        var hideSection = this.buildSection('coveo-facet-settings-section-hide');\n        var icon = this.buildIcon('coveo-facet-settings-section-hide-svg', SVGIcons_1.SVGIcons.icons.facetCollapse);\n        var hideItems = this.buildItems();\n        var hideItem = this.buildItem(Strings_1.l('Collapse'));\n        hideItems.appendChild(hideItem);\n        hideSection.appendChild(icon);\n        hideSection.appendChild(hideItems);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(hideSection)\n            .withSelectAction(function () {\n            _this.facet.facetHeader.collapseFacet();\n            _this.close();\n        })\n            .withLabel(Strings_1.l('CollapseFacet', this.facet.options.title))\n            .build();\n        return hideSection;\n    };\n    FacetSettings.prototype.buildShowSection = function () {\n        var _this = this;\n        var showSection = this.buildSection('coveo-facet-settings-section-show');\n        var icon = this.buildIcon('coveo-facet-settings-section-show-svg', SVGIcons_1.SVGIcons.icons.facetExpand);\n        var showItems = this.buildItems();\n        var showItem = this.buildItem(Strings_1.l('Expand'));\n        showItems.appendChild(showItem);\n        showSection.appendChild(icon);\n        showSection.appendChild(showItems);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(showSection)\n            .withSelectAction(function () {\n            _this.facet.facetHeader.expandFacet();\n            _this.close();\n        })\n            .withLabel(Strings_1.l('ExpandFacet', this.facet.options.title))\n            .build();\n        return showSection;\n    };\n    FacetSettings.prototype.buildIcon = function (iconClass, svgIcon) {\n        if (iconClass && svgIcon) {\n            var icon = Dom_1.$$('div', { className: 'coveo-icon-container' }, svgIcon);\n            SVGDom_1.SVGDom.addClassToSVGInContainer(icon.el, iconClass);\n            return icon.el;\n        }\n        else {\n            return Dom_1.$$('div', { className: 'coveo-icon' }).el;\n        }\n    };\n    FacetSettings.prototype.buildAscendingOrDescending = function (direction) {\n        var elem = this.buildItem(Strings_1.l(direction));\n        elem.setAttribute('aria-disabled', 'true');\n        elem.setAttribute('data-direction', direction.toLowerCase());\n        return elem;\n    };\n    FacetSettings.prototype.buildAscendingOrDescendingSection = function (direction) {\n        return this.buildSection('coveo-facet-settings-section-direction-' + direction.toLowerCase());\n    };\n    FacetSettings.prototype.buildItem = function (label, title) {\n        if (title === void 0) { title = label; }\n        return Dom_1.$$('div', {\n            className: 'coveo-facet-settings-item',\n            title: title\n        }, underscore_1.escape(label)).el;\n    };\n    FacetSettings.prototype.buildItems = function () {\n        var elem = document.createElement('div');\n        Dom_1.$$(elem).addClass('coveo-facet-settings-items');\n        return elem;\n    };\n    FacetSettings.prototype.buildSection = function (className) {\n        var section = document.createElement('div');\n        Dom_1.$$(section).addClass(['coveo-facet-settings-section', className]);\n        return section;\n    };\n    FacetSettings.prototype.handleSettingsButtonClick = function (event) {\n        event.stopPropagation();\n        var settingsPopupIsOpen = !Utils_1.Utils.isNullOrUndefined(this.settingsPopup.parentElement);\n        settingsPopupIsOpen ? this.close() : this.open();\n    };\n    FacetSettings.prototype.handleClickSortButton = function (e, enabledSort) {\n        if (this.activeSort != enabledSort && this.activeSort.relatedSort != enabledSort.name) {\n            this.activeSort = enabledSort;\n            if (enabledSort.directionToggle && underscore_1.contains(this.enabledSorts, FacetSettings.availableSorts[this.activeSort.relatedSort])) {\n                this.activateDirectionSection();\n            }\n            else {\n                this.disableDirectionSection();\n            }\n            this.unselectSection(this.sortSection.element);\n            this.selectItem(e.target);\n            this.closePopupAndUpdateSort();\n        }\n    };\n    FacetSettings.prototype.handleDirectionClick = function (item, direction) {\n        var _this = this;\n        if (item.getAttribute('aria-disabled') === 'false' && this.activeSort.name.indexOf(direction) === -1) {\n            this.activeSort = FacetSettings.availableSorts[this.activeSort.relatedSort];\n            underscore_1.each(this.directionSection, function (d) {\n                _this.unselectSection(d);\n            });\n            this.selectItem(item);\n            if (this.activeSort.name == 'custom' && this.customSortDirection != direction) {\n                this.customSortDirection = direction;\n                this.customSortDirectionChange = true;\n            }\n            this.closePopupAndUpdateSort();\n        }\n    };\n    FacetSettings.prototype.handleSaveStateClick = function () {\n        this.saveState();\n        this.close();\n    };\n    FacetSettings.prototype.handleClearStateClick = function () {\n        var _this = this;\n        this.facetStateLocalStorage.remove();\n        this.facet.reset();\n        this.close();\n        this.facet.triggerNewQuery(function () {\n            return _this.facet.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.facetClearAll, {\n                facetId: _this.facet.options.id,\n                facetField: _this.facet.options.field.toString(),\n                facetTitle: _this.facet.options.title\n            });\n        });\n    };\n    FacetSettings.prototype.addOnNukeHandler = function () {\n        var _this = this;\n        Dom_1.$$(this.facet.root).on(InitializationEvents_1.InitializationEvents.nuke, function () { return _this.handleNuke(); });\n    };\n    FacetSettings.prototype.addOnDocumentClickHandler = function () {\n        var _this = this;\n        document.addEventListener('click', function () { return _this.onDocumentClick(); });\n    };\n    FacetSettings.prototype.getCurrentDirectionItem = function (directionSection) {\n        var _this = this;\n        if (directionSection === void 0) { directionSection = this.directionSection; }\n        var found;\n        underscore_1.each(directionSection, function (direction) {\n            if (!found) {\n                found = underscore_1.find(_this.getItems(direction), function (direction) {\n                    return _this.activeSort.name.indexOf(direction.getAttribute('data-direction')) != -1;\n                });\n            }\n        });\n        if (!found) {\n            found = directionSection[0];\n        }\n        return found;\n    };\n    FacetSettings.prototype.activateDirectionSection = function () {\n        var _this = this;\n        underscore_1.each(this.directionSection, function (direction) {\n            Dom_1.$$(direction).removeClass('coveo-facet-settings-disabled');\n            Dom_1.$$(direction).find('.coveo-facet-settings-item').setAttribute('aria-disabled', 'false');\n            _this.unselectSection(direction);\n        });\n        this.selectItem(this.getCurrentDirectionItem());\n    };\n    FacetSettings.prototype.disableDirectionSection = function () {\n        var _this = this;\n        underscore_1.each(this.directionSection, function (direction) {\n            Dom_1.$$(direction).addClass('coveo-facet-settings-disabled');\n            Dom_1.$$(direction).find('.coveo-facet-settings-item').setAttribute('aria-disabled', 'true');\n            _this.unselectSection(direction);\n        });\n    };\n    FacetSettings.prototype.getItems = function (section) {\n        return Dom_1.$$(section).findAll('.coveo-facet-settings-item');\n    };\n    FacetSettings.prototype.unselectSection = function (section) {\n        var _this = this;\n        underscore_1.each(this.getItems(section), function (i) { return _this.unselectItem(i); });\n    };\n    FacetSettings.prototype.selectItem = function (item) {\n        if (item) {\n            Dom_1.$$(item).addClass('coveo-selected');\n            item.setAttribute('aria-pressed', 'true');\n        }\n    };\n    FacetSettings.prototype.unselectItem = function (item) {\n        if (item) {\n            Dom_1.$$(item).removeClass('coveo-selected');\n            item.setAttribute('aria-pressed', 'false');\n        }\n    };\n    FacetSettings.prototype.filterDuplicateForRendering = function () {\n        var _this = this;\n        underscore_1.each(this.enabledSorts, function (enabledSort, i) {\n            if (enabledSort.relatedSort != null) {\n                for (var j = i + 1; j < _this.enabledSorts.length; j++) {\n                    if (_this.enabledSorts[j].name == enabledSort.relatedSort) {\n                        _this.enabledSortsIgnoreRenderBecauseOfPairs.push(_this.enabledSorts[j]);\n                        break;\n                    }\n                }\n            }\n        });\n    };\n    FacetSettings.prototype.appendIfNotUndefined = function (toAppend) {\n        if (!Utils_1.Utils.isNullOrUndefined(toAppend)) {\n            this.settingsPopup.appendChild(toAppend);\n        }\n    };\n    FacetSettings.prototype.handleNuke = function () {\n        document.removeEventListener('click', this.onDocumentClick);\n    };\n    return FacetSettings;\n}(FacetSort_1.FacetSort));\nexports.FacetSettings = FacetSettings;\n\n\n/***/ }),\n\n/***/ 480:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Strings_1 = __webpack_require__(6);\nvar FacetSettings_1 = __webpack_require__(479);\nvar Utils_1 = __webpack_require__(4);\nvar _ = __webpack_require__(0);\nvar FacetSort = /** @class */ (function () {\n    function FacetSort(sorts, facet) {\n        var _this = this;\n        this.facet = facet;\n        this.enabledSorts = [];\n        this.customSortDirection = 'ascending';\n        _.each(sorts, function (sortToActivate) {\n            var newSortToEnable = FacetSettings_1.FacetSettings.availableSorts[sortToActivate.toLowerCase()];\n            if (newSortToEnable != undefined) {\n                _this.enabledSorts.push(newSortToEnable);\n            }\n        });\n        this.removeEnabledSortsBasedOnFacetType();\n        if (Utils_1.Utils.isNonEmptyArray(this.enabledSorts)) {\n            if (this.facet.options.sortCriteria != undefined) {\n                this.activeSort = _.find(this.enabledSorts, function (enabledSort) {\n                    return enabledSort.name == _this.facet.options.sortCriteria;\n                });\n            }\n            if (!this.activeSort) {\n                this.activeSort = this.enabledSorts[0];\n            }\n        }\n    }\n    FacetSort.prototype.removeEnabledSortsBasedOnFacetType = function () {\n        if (Coveo.FacetRange && this.facet instanceof Coveo.FacetRange) {\n            var facetRange = this.facet;\n            if (facetRange.options['slider']) {\n                this.enabledSorts = [];\n            }\n        }\n    };\n    FacetSort.availableSorts = {\n        score: {\n            label: Strings_1.l('Score'),\n            directionToggle: false,\n            description: Strings_1.l('ScoreDescription'),\n            name: 'score'\n        },\n        occurrences: {\n            label: Strings_1.l('Occurrences'),\n            directionToggle: false,\n            description: Strings_1.l('OccurrencesDescription'),\n            name: 'occurrences'\n        },\n        alphaascending: {\n            label: Strings_1.l('Label'),\n            directionToggle: true,\n            description: Strings_1.l('LabelDescription'),\n            name: 'alphaascending',\n            relatedSort: 'alphadescending'\n        },\n        alphadescending: {\n            label: Strings_1.l('Label'),\n            directionToggle: true,\n            description: Strings_1.l('LabelDescription'),\n            name: 'alphadescending',\n            relatedSort: 'alphaascending'\n        },\n        computedfieldascending: {\n            label: Strings_1.l('Value'),\n            directionToggle: true,\n            description: Strings_1.l('ValueDescription'),\n            name: 'computedfieldascending',\n            relatedSort: 'computedfielddescending'\n        },\n        computedfielddescending: {\n            label: Strings_1.l('Value'),\n            directionToggle: true,\n            description: Strings_1.l('ValueDescription'),\n            name: 'computedfielddescending',\n            relatedSort: 'computedfieldascending'\n        },\n        chisquare: {\n            label: Strings_1.l('RelativeFrequency'),\n            directionToggle: false,\n            description: Strings_1.l('RelativeFrequencyDescription'),\n            name: 'chisquare'\n        },\n        nosort: {\n            label: Strings_1.l('Nosort'),\n            directionToggle: false,\n            description: Strings_1.l('NosortDescription'),\n            name: 'nosort'\n        },\n        custom: {\n            label: Strings_1.l('Custom'),\n            directionToggle: true,\n            description: Strings_1.l('CustomDescription'),\n            name: 'custom',\n            relatedSort: 'custom'\n        }\n    };\n    return FacetSort;\n}());\nexports.FacetSort = FacetSort;\n\n\n/***/ }),\n\n/***/ 481:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar Strings_1 = __webpack_require__(6);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\n__webpack_require__(538);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(15);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar FacetHeader = /** @class */ (function () {\n    function FacetHeader(options) {\n        this.options = options;\n        this.element = document.createElement('div');\n        Dom_1.$$(this.element).addClass('coveo-facet-header');\n    }\n    FacetHeader.prototype.build = function () {\n        var titleSection = Dom_1.$$('div', {\n            className: 'coveo-facet-header-title-section'\n        });\n        if (this.options.icon != undefined) {\n            this.iconElement = this.buildIcon();\n            titleSection.append(this.iconElement);\n        }\n        titleSection.append(this.buildTitle());\n        this.waitElement = this.buildWaitAnimation();\n        titleSection.append(this.waitElement);\n        this.element.appendChild(titleSection.el);\n        var settingsSection = Dom_1.$$('div', {\n            className: 'coveo-facet-header-settings-section'\n        });\n        this.eraserElement = this.buildEraser();\n        settingsSection.append(this.eraserElement);\n        if (this.options.facet) {\n            this.operatorElement = this.buildOperatorToggle();\n            settingsSection.append(this.operatorElement);\n            Dom_1.$$(this.operatorElement).toggle(this.options.facet.options.enableTogglingOperator);\n        }\n        if (this.options.settingsKlass) {\n            this.sort = this.settings = new this.options.settingsKlass(this.options.availableSorts, this.options.facet);\n            settingsSection.append(this.settings.build());\n        }\n        else if (this.options.sortKlass) {\n            this.sort = new this.options.sortKlass(this.options.availableSorts, this.options.facet);\n        }\n        this.element.appendChild(settingsSection.el);\n        return this.element;\n    };\n    FacetHeader.prototype.switchToAnd = function () {\n        if (this.options.facet) {\n            this.options.facet.options.useAnd = true;\n            this.rebuildOperatorToggle();\n            this.updateOperatorQueryStateModel();\n        }\n    };\n    FacetHeader.prototype.switchToOr = function () {\n        if (this.options.facet) {\n            this.options.facet.options.useAnd = false;\n            this.rebuildOperatorToggle();\n            this.updateOperatorQueryStateModel();\n        }\n    };\n    FacetHeader.prototype.collapseFacet = function () {\n        if (this.collapseElement && this.expandElement) {\n            Dom_1.$$(this.collapseElement).hide();\n            Dom_1.$$(this.expandElement).show();\n        }\n        Dom_1.$$(this.options.facetElement).addClass('coveo-facet-collapsed');\n    };\n    FacetHeader.prototype.expandFacet = function () {\n        if (this.collapseElement && this.expandElement) {\n            Dom_1.$$(this.expandElement).hide();\n            Dom_1.$$(this.collapseElement).show();\n        }\n        Dom_1.$$(this.options.facetElement).removeClass('coveo-facet-collapsed');\n    };\n    FacetHeader.prototype.updateOperatorQueryStateModel = function () {\n        if (this.options.facet && this.options.facet.options.enableTogglingOperator) {\n            var valueToSet = '';\n            if (this.options.facet.getSelectedValues().length != 0 || this.options.facet.getExcludedValues().length != 0) {\n                valueToSet = this.options.facet.options.useAnd ? 'and' : 'or';\n            }\n            this.options.facet.queryStateModel.set(this.options.facet.operatorAttributeId, valueToSet);\n        }\n    };\n    FacetHeader.prototype.rebuildOperatorToggle = function () {\n        var newElement = this.buildOperatorToggle();\n        if (this.operatorElement) {\n            Dom_1.$$(this.operatorElement).replaceWith(newElement);\n        }\n        this.operatorElement = newElement;\n    };\n    FacetHeader.prototype.buildIcon = function () {\n        var cssClassForIcon;\n        if (this.options.icon) {\n            cssClassForIcon = 'coveo-icon-custom ' + this.options.icon;\n        }\n        else {\n            cssClassForIcon = 'coveo-icon ' + this.options.field.substr(1);\n        }\n        this.iconElement = document.createElement('div');\n        Dom_1.$$(this.iconElement).addClass(cssClassForIcon);\n        return this.iconElement;\n    };\n    FacetHeader.prototype.buildWaitAnimation = function () {\n        this.waitElement = Dom_1.$$('div', { className: 'coveo-facet-header-wait-animation' }, SVGIcons_1.SVGIcons.icons.loading).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(this.waitElement, 'coveo-facet-header-wait-animation-svg');\n        this.waitElement.style.visibility = 'hidden';\n        return this.waitElement;\n    };\n    FacetHeader.prototype.buildOperatorToggle = function () {\n        var _this = this;\n        var label = Strings_1.l('SwitchTo', this.options.facet.options.useAnd ? Strings_1.l('Or') : Strings_1.l('And'));\n        var icon = Dom_1.$$('span', { className: 'coveo-' + (this.options.facet.options.useAnd ? 'and' : 'or') }, SVGIcons_1.SVGIcons.icons.orAnd);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(icon.el, 'coveo-or-and-svg');\n        var toggle = Dom_1.$$('div', {\n            className: 'coveo-facet-header-operator',\n            title: label\n        });\n        toggle.append(icon.el);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(toggle)\n            .withLabel(label)\n            .withSelectAction(function () { return _this.handleOperatorClick(); })\n            .build();\n        return toggle.el;\n    };\n    FacetHeader.prototype.handleOperatorClick = function () {\n        var _this = this;\n        if (this.options.facet.options.useAnd) {\n            this.options.facet.switchToOr();\n        }\n        else {\n            this.options.facet.switchToAnd();\n        }\n        if (this.options.facet.getSelectedValues().length != 0) {\n            var operatorNow_1 = this.options.facet.options.useAnd ? 'AND' : 'OR';\n            var operatorBefore_1 = this.options.facet.options.useAnd ? 'OR' : 'AND';\n            this.options.facet.triggerNewQuery(function () {\n                return _this.options.facet.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.facetToggle, {\n                    facetId: _this.options.facet.options.id,\n                    facetField: _this.options.field.toString(),\n                    facetOperatorBefore: operatorBefore_1,\n                    facetOperatorAfter: operatorNow_1,\n                    facetTitle: _this.options.title\n                });\n            });\n        }\n    };\n    FacetHeader.prototype.buildTitle = function () {\n        var title = Dom_1.$$('div', { className: 'coveo-facet-header-title' });\n        title.text(this.options.title);\n        title.setAttribute('role', 'heading');\n        title.setAttribute('aria-level', '2');\n        title.setAttribute('aria-label', Strings_1.l('FacetTitle', this.options.title) + \".\");\n        return title.el;\n    };\n    FacetHeader.prototype.buildEraser = function () {\n        var _this = this;\n        var eraser = Dom_1.$$('div', { className: 'coveo-facet-header-eraser' }, SVGIcons_1.SVGIcons.icons.mainClear);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(eraser.el, 'coveo-facet-header-eraser-svg');\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(eraser.el)\n            .withLabel(Strings_1.l('Clear', this.options.title))\n            .withClickAction(function () { return _this.onEraserClick(); })\n            .withEnterKeyboardAction(function () { return _this.onEraserClick(); })\n            .build();\n        return eraser.el;\n    };\n    FacetHeader.prototype.onEraserClick = function () {\n        var cmp = this.options.facet || this.options.facetSlider;\n        cmp.reset();\n        cmp.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.facetClearAll, {\n            facetId: cmp.options.id,\n            facetField: cmp.options.field.toString(),\n            facetTitle: cmp.options.title\n        });\n        cmp.queryController.executeQuery();\n    };\n    return FacetHeader;\n}());\nexports.FacetHeader = FacetHeader;\n\n\n/***/ }),\n\n/***/ 482:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _ = __webpack_require__(0);\nvar EventsUtils = /** @class */ (function () {\n    function EventsUtils() {\n    }\n    // eventName must be in PascalCase\n    EventsUtils.addPrefixedEvent = function (element, pascalCaseEventName, callback) {\n        _.each(this.prefixes, function (prefix) {\n            if (prefix == '') {\n                pascalCaseEventName = pascalCaseEventName.toLowerCase();\n            }\n            element.addEventListener(prefix + pascalCaseEventName, callback, false);\n        });\n    };\n    // eventName must be in PascalCase\n    EventsUtils.removePrefixedEvent = function (element, pascalCaseEventName, callback) {\n        _.each(this.prefixes, function (prefix) {\n            if (prefix == '') {\n                pascalCaseEventName = pascalCaseEventName.toLowerCase();\n            }\n            element.removeEventListener(prefix + pascalCaseEventName, callback, false);\n        });\n    };\n    EventsUtils.prefixes = ['webkit', 'moz', 'MS', 'o', ''];\n    return EventsUtils;\n}());\nexports.EventsUtils = EventsUtils;\n\n\n/***/ }),\n\n/***/ 483:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"Facet.ts\" />\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(542);\nvar underscore_1 = __webpack_require__(0);\nvar Assert_1 = __webpack_require__(5);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar Dom_1 = __webpack_require__(1);\nvar SVGIcons_1 = __webpack_require__(12);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Strings_1 = __webpack_require__(6);\nvar BreadcrumbValueElement = /** @class */ (function () {\n    function BreadcrumbValueElement(facet, facetValue) {\n        this.facet = facet;\n        this.facetValue = facetValue;\n    }\n    BreadcrumbValueElement.prototype.build = function () {\n        Assert_1.Assert.exists(this.facetValue);\n        var _a = this.buildElements(), container = _a.container, caption = _a.caption, clear = _a.clear, listContainer = _a.listContainer;\n        container.append(caption.el);\n        container.append(clear.el);\n        listContainer.append(container.el);\n        return listContainer;\n    };\n    BreadcrumbValueElement.prototype.getBreadcrumbTooltip = function () {\n        var tooltipParts = [\n            this.facet.getValueCaption(this.facetValue),\n            this.facetValue.getFormattedCount(),\n            this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat)\n        ];\n        return underscore_1.compact(tooltipParts).join(' ');\n    };\n    BreadcrumbValueElement.prototype.buildElements = function () {\n        return {\n            container: this.buildContainer(),\n            clear: this.buildClear(),\n            caption: this.buildCaption(),\n            listContainer: this.buildListContainer()\n        };\n    };\n    BreadcrumbValueElement.prototype.buildContainer = function () {\n        var _this = this;\n        var container = Dom_1.$$('div', {\n            className: 'coveo-facet-breadcrumb-value'\n        });\n        container.toggleClass('coveo-selected', this.facetValue.selected);\n        container.toggleClass('coveo-excluded', this.facetValue.excluded);\n        var labelString = this.facetValue.excluded ? 'Unexclude' : 'RemoveFilterOn';\n        var label = Strings_1.l(labelString, this.facet.getValueCaption(this.facetValue));\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(container)\n            .withLabel(label)\n            .withSelectAction(function () { return _this.selectAction(); })\n            .build();\n        return container;\n    };\n    BreadcrumbValueElement.prototype.buildListContainer = function () {\n        return Dom_1.$$('li', {\n            className: 'coveo-facet-breadcrumb-value-list-item'\n        });\n    };\n    BreadcrumbValueElement.prototype.buildClear = function () {\n        var clear = Dom_1.$$('span', {\n            className: 'coveo-facet-breadcrumb-clear'\n        }, SVGIcons_1.SVGIcons.icons.mainClear);\n        return clear;\n    };\n    BreadcrumbValueElement.prototype.buildCaption = function () {\n        var caption = Dom_1.$$('span', {\n            className: 'coveo-facet-breadcrumb-caption'\n        });\n        caption.text(this.facet.getValueCaption(this.facetValue));\n        return caption;\n    };\n    BreadcrumbValueElement.prototype.selectAction = function () {\n        var _this = this;\n        if (this.facetValue.excluded) {\n            this.facet.unexcludeValue(this.facetValue.value);\n        }\n        else {\n            this.facet.deselectValue(this.facetValue.value);\n        }\n        this.facet.triggerNewQuery(function () {\n            return _this.facet.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.breadcrumbFacet, {\n                facetId: _this.facet.options.id,\n                facetField: _this.facet.options.field.toString(),\n                facetValue: _this.facetValue.value,\n                facetTitle: _this.facet.options.title\n            });\n        });\n        this.focusOnContainer();\n    };\n    BreadcrumbValueElement.prototype.focusOnContainer = function () {\n        var breadcrumb = underscore_1.first(this.facet.searchInterface.getComponents('Breadcrumb'));\n        breadcrumb ? breadcrumb.element.focus() : null;\n    };\n    return BreadcrumbValueElement;\n}());\nexports.BreadcrumbValueElement = BreadcrumbValueElement;\n\n\n/***/ }),\n\n/***/ 484:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Globalize = __webpack_require__(23);\nvar underscore_1 = __webpack_require__(0);\nvar Assert_1 = __webpack_require__(5);\nvar Strings_1 = __webpack_require__(6);\nvar Dom_1 = __webpack_require__(1);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar BreadcrumbValueList = /** @class */ (function () {\n    function BreadcrumbValueList(facet, facetValues, breadcrumbValueElementKlass) {\n        this.facet = facet;\n        this.facetValues = facetValues;\n        this.breadcrumbValueElementKlass = breadcrumbValueElementKlass;\n        this.setExpandedAndCollapsed();\n        this.elem = Dom_1.$$('div', {\n            className: 'coveo-facet-breadcrumb'\n        }).el;\n        var title = Dom_1.$$('span');\n        title.addClass('coveo-facet-breadcrumb-title');\n        title.text(this.facet.options.title + ':');\n        this.elem.appendChild(title.el);\n        this.valueContainer = Dom_1.$$('ul', {\n            className: 'coveo-facet-breadcrumb-values'\n        }).el;\n        this.elem.appendChild(this.valueContainer);\n    }\n    BreadcrumbValueList.prototype.build = function () {\n        this.buildExpanded();\n        if (this.collapsed.length != 0) {\n            this.buildCollapsed();\n        }\n        return this.elem;\n    };\n    BreadcrumbValueList.prototype.buildAsString = function () {\n        this.build();\n        if (this.elem) {\n            return (this.facet.options.title + \": \" +\n                Dom_1.$$(this.elem)\n                    .findAll('.coveo-facet-breadcrumb-value')\n                    .map(function (value) {\n                    return Dom_1.$$(value).text();\n                })\n                    .join(', '));\n        }\n        return '';\n    };\n    BreadcrumbValueList.prototype.buildExpanded = function () {\n        var _this = this;\n        this.expanded.forEach(function (value) {\n            var elementBreadcrumb = new _this.breadcrumbValueElementKlass(_this.facet, value).build();\n            _this.valueContainer.appendChild(elementBreadcrumb.el);\n        });\n    };\n    BreadcrumbValueList.prototype.buildCollapsed = function () {\n        var _this = this;\n        var numberOfSelected = underscore_1.filter(this.collapsed, function (value) { return value.selected; }).length;\n        var numberOfExcluded = underscore_1.filter(this.collapsed, function (value) { return value.excluded; }).length;\n        Assert_1.Assert.check(numberOfSelected + numberOfExcluded == this.collapsed.length);\n        var nMoreElement = Dom_1.$$('div', {\n            className: 'coveo-facet-breadcrumb-value'\n        }, Dom_1.$$('span', {\n            className: 'coveo-facet-breadcrumb-multi-count'\n        }, Strings_1.l('NMore', Globalize.format(numberOfSelected + numberOfExcluded, 'n0'))));\n        var nMoreContainer = Dom_1.$$('li', {\n            className: 'coveo-facet-breadcrumb-value-list-item'\n        }, nMoreElement);\n        var collapsedBreadcrumbs = this.collapsed.map(function (value) { return new _this.breadcrumbValueElementKlass(_this.facet, value); });\n        var toolTip = collapsedBreadcrumbs.map(function (element) { return element.getBreadcrumbTooltip(); }).join('\\n');\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(nMoreElement)\n            .withTitle(toolTip)\n            .withSelectAction(function () {\n            nMoreElement.remove();\n            collapsedBreadcrumbs.forEach(function (breadcrumb) {\n                _this.valueContainer.appendChild(breadcrumb.build().el);\n            });\n        })\n            .build();\n        this.valueContainer.appendChild(nMoreContainer.el);\n    };\n    BreadcrumbValueList.prototype.setExpandedAndCollapsed = function () {\n        if (this.facetValues.length > this.facet.options.numberOfValuesInBreadcrumb) {\n            this.collapsed = underscore_1.rest(this.facetValues, this.facet.options.numberOfValuesInBreadcrumb);\n            this.expanded = underscore_1.first(this.facetValues, this.facet.options.numberOfValuesInBreadcrumb);\n        }\n        else {\n            this.collapsed = [];\n            this.expanded = this.facetValues;\n        }\n    };\n    return BreadcrumbValueList;\n}());\nexports.BreadcrumbValueList = BreadcrumbValueList;\n\n\n/***/ }),\n\n/***/ 485:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"Facet.ts\" />\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Facet_1 = __webpack_require__(69);\nvar Dom_1 = __webpack_require__(1);\nvar Utils_1 = __webpack_require__(4);\nvar InitializationEvents_1 = __webpack_require__(17);\nvar FacetSearchParameters_1 = __webpack_require__(169);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Strings_1 = __webpack_require__(6);\nvar Assert_1 = __webpack_require__(5);\nvar FacetValue_1 = __webpack_require__(114);\nvar StringUtils_1 = __webpack_require__(22);\nvar FacetValueElement_1 = __webpack_require__(128);\nvar ExternalModulesShim_1 = __webpack_require__(25);\nvar SearchInterface_1 = __webpack_require__(20);\nvar ResponsiveComponentsUtils_1 = __webpack_require__(127);\nvar FacetValuesOrder_1 = __webpack_require__(475);\n__webpack_require__(543);\nvar underscore_1 = __webpack_require__(0);\nvar FacetSearchElement_1 = __webpack_require__(476);\n/**\n * Used by the {@link Facet} component to render and handle the facet search part of each facet.\n */\nvar FacetSearch = /** @class */ (function () {\n    function FacetSearch(facet, facetSearchValuesListKlass, root) {\n        var _this = this;\n        this.facet = facet;\n        this.facetSearchValuesListKlass = facetSearchValuesListKlass;\n        this.root = root;\n        this.moreValuesToFetch = true;\n        this.lastSearchWasEmpty = true;\n        this.facetSearchElement = new FacetSearchElement_1.FacetSearchElement(this);\n        this.onResize = underscore_1.debounce(function () {\n            // Mitigate issues in UT where the window in phantom js might get resized in the scope of another test.\n            // These would point to random instance of a test karma object, and not a real search interface.\n            if (_this.facet instanceof Facet_1.Facet && _this.facet.searchInterface instanceof SearchInterface_1.SearchInterface) {\n                if (_this.shouldPositionSearchResults()) {\n                    _this.positionSearchResults();\n                }\n            }\n        }, 250);\n        this.onDocumentClick = function (e) {\n            _this.handleClickElsewhere(e);\n        };\n        window.addEventListener('resize', this.onResize);\n        document.addEventListener('click', function (e) { return _this.onDocumentClick(e); });\n        Dom_1.$$(facet.root).on(InitializationEvents_1.InitializationEvents.nuke, function () { return _this.handleNuke(); });\n    }\n    Object.defineProperty(FacetSearch.prototype, \"facetType\", {\n        get: function () {\n            return Facet_1.Facet.ID;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSearch.prototype, \"facetTitle\", {\n        get: function () {\n            return this.facet.options.title || this.facet.options.field.toString();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Build the search component and return an `HTMLElement` which can be appended to the {@link Facet}.\n     * @returns {HTMLElement}\n     */\n    FacetSearch.prototype.build = function () {\n        return this.buildBaseSearch();\n    };\n    /**\n     * Position the search results at the footer of the facet.\n     */\n    FacetSearch.prototype.positionSearchResults = function () {\n        this.facetSearchElement.positionSearchResults();\n    };\n    FacetSearch.prototype.fetchMoreValues = function () {\n        this.triggerNewFacetSearch(this.buildParamsForFetchingMore());\n    };\n    /**\n     * Dismiss the search results\n     */\n    FacetSearch.prototype.dismissSearchResults = function () {\n        this.cancelAnyPendingSearchOperation();\n        this.facet.unfadeInactiveValuesInMainList();\n        Dom_1.$$(this.searchResults).empty();\n        this.moreValuesToFetch = true;\n        Dom_1.$$(this.search).removeClass('coveo-facet-search-no-results');\n        Dom_1.$$(this.facet.element).removeClass('coveo-facet-searching');\n        this.facetSearchElement.hideSearchResultsElement();\n        this.input.value = '';\n        Dom_1.$$(this.clear).hide();\n        this.currentlyDisplayedResults = undefined;\n    };\n    /**\n     * Trigger a new facet search, and display the results.\n     * @param params\n     */\n    FacetSearch.prototype.triggerNewFacetSearch = function (params) {\n        var _this = this;\n        this.cancelAnyPendingSearchOperation();\n        this.facetSearchElement.showFacetSearchWaitingAnimation();\n        this.facet.logger.info('Triggering new facet search');\n        this.facetSearchPromise = this.facet.facetQueryController.search(params);\n        if (this.facetSearchPromise) {\n            this.facetSearchPromise\n                .then(function (fieldValues) {\n                _this.facet.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.facetSearch, {\n                    facetId: _this.facet.options.id,\n                    facetField: _this.facet.options.field.toString(),\n                    facetTitle: _this.facet.options.title\n                }, _this.facet.root);\n                _this.facet.logger.debug('Received field values', fieldValues);\n                _this.processNewFacetSearchResults(fieldValues, params);\n                _this.facetSearchElement.hideFacetSearchWaitingAnimation();\n                _this.facetSearchPromise = undefined;\n            })\n                .catch(function (error) {\n                // The request might be normally cancelled if another search is triggered.\n                // In this case we do not hide the animation to prevent flicking.\n                if (Utils_1.Utils.exists(error)) {\n                    _this.facet.logger.error('Error while retrieving facet values', error);\n                    _this.facetSearchElement.hideFacetSearchWaitingAnimation();\n                }\n                _this.facetSearchPromise = undefined;\n                return null;\n            });\n        }\n    };\n    /**\n     * Trigger the event associated with the focus of the search input.\n     */\n    FacetSearch.prototype.focus = function () {\n        this.facetSearchElement.focus();\n    };\n    Object.defineProperty(FacetSearch.prototype, \"searchResults\", {\n        get: function () {\n            return this.facetSearchElement.searchResults;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSearch.prototype, \"searchBarIsAnimating\", {\n        get: function () {\n            return this.facetSearchElement.searchBarIsAnimating;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSearch.prototype, \"search\", {\n        get: function () {\n            return this.facetSearchElement.search;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetSearch.prototype.setExpandedFacetSearchAccessibilityAttributes = function (searchResultsElement) {\n        this.facet.setExpandedFacetSearchAccessibilityAttributes(searchResultsElement);\n    };\n    FacetSearch.prototype.setCollapsedFacetSearchAccessibilityAttributes = function () {\n        this.facet.setCollapsedFacetSearchAccessibilityAttributes();\n    };\n    FacetSearch.prototype.keyboardEventDefaultHandler = function () {\n        this.moreValuesToFetch = true;\n        this.highlightCurrentQueryWithinSearchResults();\n        if (!this.inputIsEmpty()) {\n            this.lastSearchWasEmpty = false;\n            this.displayNewValues(this.buildParamsForNormalSearch());\n        }\n        else if (!this.lastSearchWasEmpty) {\n            // This normally happen if a user delete the search box content to go back to \"empty\" state.\n            this.currentlyDisplayedResults = undefined;\n            Dom_1.$$(this.searchResults).empty();\n            this.lastSearchWasEmpty = true;\n            this.displayNewValues(this.buildParamsForFetchingMore());\n        }\n    };\n    FacetSearch.prototype.keyboardNavigationEnterPressed = function (event) {\n        if (event.shiftKey) {\n            this.triggerNewFacetSearch(this.buildParamsForNormalSearch());\n        }\n        else {\n            if (this.searchResults.style.display != 'none') {\n                this.performActionOnCurrentSearchResult();\n                this.dismissSearchResults();\n            }\n            else if (Dom_1.$$(this.search).is('.coveo-facet-search-no-results')) {\n                this.selectAllValuesMatchingSearch();\n            }\n        }\n    };\n    FacetSearch.prototype.keyboardNavigationDeletePressed = function (event) {\n        if (event.shiftKey) {\n            this.performExcludeActionOnCurrentSearchResult();\n            this.dismissSearchResults();\n            this.input.value = '';\n        }\n    };\n    FacetSearch.prototype.displayNewValues = function (params) {\n        var _this = this;\n        if (params === void 0) { params = this.buildParamsForExcludingCurrentlyDisplayedValues(); }\n        this.cancelAnyPendingSearchOperation();\n        this.facetSearchTimeout = window.setTimeout(function () {\n            _this.triggerNewFacetSearch(params);\n        }, this.facet.options.facetSearchDelay);\n    };\n    FacetSearch.prototype.getCaptions = function () {\n        return Dom_1.$$(this.searchResults).findAll('.coveo-facet-value-caption');\n    };\n    FacetSearch.prototype.getValueInInputForFacetSearch = function () {\n        return this.facetSearchElement.getValueInInputForFacetSearch();\n    };\n    FacetSearch.prototype.updateAriaLive = function (text) {\n        this.facet.searchInterface.ariaLive.updateText(text);\n    };\n    Object.defineProperty(FacetSearch.prototype, \"input\", {\n        get: function () {\n            return this.facetSearchElement.input;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSearch.prototype, \"clear\", {\n        get: function () {\n            return this.facetSearchElement.clear;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetSearch.prototype.shouldPositionSearchResults = function () {\n        return !ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.isSmallFacetActivated(Dom_1.$$(this.root)) && Dom_1.$$(this.facet.element).hasClass('coveo-facet-searching');\n    };\n    FacetSearch.prototype.buildBaseSearch = function () {\n        var _this = this;\n        this.facetSearchElement.build(function () { return _this.handleFacetSearchClear(); });\n        Dom_1.$$(this.facetSearchElement.input).on('keyup', function () { return _this.showOrHideClearElement(); });\n        return this.search;\n    };\n    FacetSearch.prototype.handleNuke = function () {\n        window.removeEventListener('resize', this.onResize);\n        document.removeEventListener('click', this.onDocumentClick);\n    };\n    FacetSearch.prototype.handleClickElsewhere = function (event) {\n        if (this.currentlyDisplayedResults && this.search != event.target && this.searchResults != event.target && this.input != event.target) {\n            this.dismissSearchResults();\n        }\n    };\n    FacetSearch.prototype.handleFacetSearchClear = function () {\n        this.input.value = '';\n        Dom_1.$$(this.clear).hide();\n        this.dismissSearchResults();\n    };\n    FacetSearch.prototype.showOrHideClearElement = function () {\n        if (!this.inputIsEmpty()) {\n            Dom_1.$$(this.clear).show();\n        }\n        else {\n            Dom_1.$$(this.clear).hide();\n            Dom_1.$$(this.search).removeClass('coveo-facet-search-no-results');\n        }\n    };\n    FacetSearch.prototype.cancelAnyPendingSearchOperation = function () {\n        if (Utils_1.Utils.exists(this.facetSearchTimeout)) {\n            clearTimeout(this.facetSearchTimeout);\n            this.facetSearchTimeout = undefined;\n        }\n        if (Utils_1.Utils.exists(this.facetSearchPromise)) {\n            Promise.reject(this.facetSearchPromise).catch(function () { });\n            this.facetSearchPromise = undefined;\n        }\n        this.facetSearchElement.hideFacetSearchWaitingAnimation();\n    };\n    FacetSearch.prototype.inputIsEmpty = function () {\n        return this.input.value.trim() == '';\n    };\n    FacetSearch.prototype.processNewFacetSearchResults = function (fieldValues, facetSearchParameters) {\n        Assert_1.Assert.exists(fieldValues);\n        fieldValues = new FacetValuesOrder_1.FacetValuesOrder(this.facet, this.facet.facetSort).reorderValues(fieldValues);\n        if (fieldValues.length > 0) {\n            Dom_1.$$(this.search).removeClass('coveo-facet-search-no-results');\n            this.facet.fadeInactiveValuesInMainList(this.facet.options.facetSearchDelay);\n            this.rebuildSearchResults(fieldValues, facetSearchParameters);\n            if (!facetSearchParameters.fetchMore) {\n                this.showSearchResultsElement();\n            }\n            this.highlightCurrentQueryWithinSearchResults();\n            this.makeFirstSearchResultTheCurrentOne();\n            this.facetSearchElement.updateAriaLiveWithResults(this.input.value, this.currentlyDisplayedResults.length, this.moreValuesToFetch);\n        }\n        else {\n            if (facetSearchParameters.fetchMore) {\n                this.moreValuesToFetch = false;\n            }\n            else {\n                Dom_1.$$(this.search).addClass('coveo-facet-search-no-results');\n                this.showSearchResultsElement();\n                this.facetSearchElement.emptyAndShowNoResults();\n            }\n        }\n    };\n    FacetSearch.prototype.rebuildSearchResults = function (fieldValues, facetSearchParameters) {\n        var _this = this;\n        Assert_1.Assert.exists(fieldValues);\n        if (!facetSearchParameters.fetchMore) {\n            Dom_1.$$(this.searchResults).empty();\n        }\n        var facetSearchHasQuery = Utils_1.Utils.isNonEmptyString(facetSearchParameters.valueToSearch);\n        if (facetSearchHasQuery) {\n            this.appendSelectAllResultsButton();\n        }\n        var facetValues = underscore_1.map(fieldValues, function (fieldValue) {\n            return FacetValue_1.FacetValue.create(fieldValue);\n        });\n        underscore_1.each(new this.facetSearchValuesListKlass(this.facet, FacetValueElement_1.FacetValueElement).build(facetValues), function (listElement) {\n            _this.facetSearchElement.appendToSearchResults(listElement);\n        });\n        if (this.currentlyDisplayedResults) {\n            this.currentlyDisplayedResults = this.currentlyDisplayedResults.concat(underscore_1.pluck(facetValues, 'value'));\n        }\n        else {\n            this.currentlyDisplayedResults = underscore_1.pluck(facetValues, 'value');\n        }\n        underscore_1.each(Dom_1.$$(this.searchResults).findAll('.coveo-facet-selectable'), function (elem, index) {\n            Dom_1.$$(elem).setAttribute('id', \"coveo-facet-search-\" + _this.facet.options.id + \"-suggestion-\" + index);\n            Dom_1.$$(elem).setAttribute('role', 'option');\n            Dom_1.$$(elem).setAttribute('aria-selected', 'false');\n            Dom_1.$$(elem).addClass('coveo-facet-search-selectable');\n        });\n    };\n    FacetSearch.prototype.appendSelectAllResultsButton = function () {\n        var _this = this;\n        var selectAll = document.createElement('li');\n        Dom_1.$$(selectAll).addClass(['coveo-facet-selectable', 'coveo-facet-search-selectable', 'coveo-facet-search-select-all']);\n        Dom_1.$$(selectAll).text(Strings_1.l('SelectAll'));\n        Dom_1.$$(selectAll).on('click', function () { return _this.selectAllValuesMatchingSearch(); });\n        this.facetSearchElement.appendToSearchResults(selectAll);\n    };\n    FacetSearch.prototype.buildParamsForNormalSearch = function () {\n        var params = new FacetSearchParameters_1.FacetSearchParameters(this.facet);\n        params.setValueToSearch(this.getValueInInputForFacetSearch());\n        params.fetchMore = false;\n        return params;\n    };\n    FacetSearch.prototype.buildParamsForFetchingMore = function () {\n        var params = this.buildParamsForExcludingCurrentlyDisplayedValues();\n        params.fetchMore = true;\n        return params;\n    };\n    FacetSearch.prototype.buildParamsForExcludingCurrentlyDisplayedValues = function () {\n        var params = new FacetSearchParameters_1.FacetSearchParameters(this.facet);\n        params.excludeCurrentlyDisplayedValuesInSearch(this.searchResults);\n        params.setValueToSearch(this.getValueInInputForFacetSearch());\n        return params;\n    };\n    FacetSearch.prototype.showSearchResultsElement = function () {\n        this.positionSearchResults();\n    };\n    FacetSearch.prototype.highlightCurrentQueryWithinSearchResults = function () {\n        var search = this.getValueInInputForFacetSearch();\n        var regex = new RegExp('(' + StringUtils_1.StringUtils.wildcardsToRegex(search, this.facet.options.facetSearchIgnoreAccents) + ')', 'ig');\n        this.facetSearchElement.highlightCurrentQueryInSearchResults(regex);\n    };\n    FacetSearch.prototype.makeFirstSearchResultTheCurrentOne = function () {\n        this.facetSearchElement.setAsCurrentResult(Dom_1.$$(this.getSelectables()[0]));\n    };\n    FacetSearch.prototype.getSelectables = function (target) {\n        if (target === void 0) { target = this.searchResults; }\n        return Dom_1.$$(target).findAll('.coveo-facet-selectable');\n    };\n    FacetSearch.prototype.performActionOnCurrentSearchResult = function () {\n        var current = Dom_1.$$(this.searchResults).find('.coveo-facet-search-current-result');\n        Assert_1.Assert.check(current != undefined);\n        var shouldExclude = Dom_1.$$(current).hasClass('coveo-facet-value-will-exclude');\n        if (shouldExclude) {\n            var excludeIcon = Dom_1.$$(current).find('.coveo-facet-value-exclude');\n            excludeIcon.click();\n            return;\n        }\n        var checkbox = Dom_1.$$(current).find('input[type=\"checkbox\"]');\n        if (checkbox) {\n            checkbox.checked = true;\n            Dom_1.$$(checkbox).trigger('change');\n        }\n        else {\n            current.click();\n        }\n    };\n    FacetSearch.prototype.performExcludeActionOnCurrentSearchResult = function () {\n        var current = Dom_1.$$(this.searchResults).find('.coveo-facet-search-current-result');\n        Assert_1.Assert.check(current != null);\n        var valueCaption = Dom_1.$$(current).find('.coveo-facet-value-caption');\n        var valueElement = this.facet.facetValuesList.get(Dom_1.$$(valueCaption).text());\n        valueElement.toggleExcludeWithUA();\n    };\n    FacetSearch.prototype.selectAllValuesMatchingSearch = function () {\n        var _this = this;\n        this.facet.showWaitingAnimation();\n        var searchParameters = new FacetSearchParameters_1.FacetSearchParameters(this.facet);\n        searchParameters.nbResults = 1000;\n        searchParameters.setValueToSearch(this.getValueInInputForFacetSearch());\n        this.facet.facetQueryController.search(searchParameters).then(function (fieldValues) {\n            _this.dismissSearchResults();\n            ExternalModulesShim_1.ModalBox.close(true);\n            var facetValues = underscore_1.map(fieldValues, function (fieldValue) {\n                var facetValue = _this.facet.values.get(fieldValue.value);\n                if (!Utils_1.Utils.exists(facetValue)) {\n                    facetValue = FacetValue_1.FacetValue.create(fieldValue);\n                }\n                facetValue.selected = true;\n                facetValue.excluded = false;\n                return facetValue;\n            });\n            _this.facet.processFacetSearchAllResultsSelected(facetValues);\n        });\n        this.dismissSearchResults();\n    };\n    return FacetSearch;\n}());\nexports.FacetSearch = FacetSearch;\n\n\n/***/ }),\n\n/***/ 486:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _ = __webpack_require__(0);\nvar FacetSearchValuesList = /** @class */ (function () {\n    function FacetSearchValuesList(facet, facetValueElementKlass) {\n        this.facet = facet;\n        this.facetValueElementKlass = facetValueElementKlass;\n    }\n    FacetSearchValuesList.prototype.build = function (facetValues) {\n        var _this = this;\n        var valuesToBuildWith = _.map(facetValues, function (facetValue) {\n            return (_.find(_this.facet.values.getAll(), function (valueAlreadyInFacet) {\n                return valueAlreadyInFacet.value == facetValue.value;\n            }) || facetValue);\n        });\n        return _.map(valuesToBuildWith, function (facetValue) {\n            var valueElement = new _this.facetValueElementKlass(_this.facet, facetValue, _this.facet.keepDisplayedValuesNextTime).build();\n            valueElement.renderer.excludeIcon.setAttribute('aria-hidden', 'true');\n            valueElement.renderer.label.setAttribute('aria-hidden', 'true');\n            return valueElement.renderer.listItem;\n        });\n    };\n    return FacetSearchValuesList;\n}());\nexports.FacetSearchValuesList = FacetSearchValuesList;\n\n\n/***/ }),\n\n/***/ 487:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"Facet.ts\" />\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetValueElement_1 = __webpack_require__(128);\nvar Dom_1 = __webpack_require__(1);\nvar FacetValue_1 = __webpack_require__(114);\nvar Utils_1 = __webpack_require__(4);\nvar FacetUtils_1 = __webpack_require__(40);\nvar _ = __webpack_require__(0);\nvar FacetValuesList = /** @class */ (function () {\n    function FacetValuesList(facet, facetValueElementKlass) {\n        this.facet = facet;\n        this.facetValueElementKlass = facetValueElementKlass;\n        // Dictionary of values. The key is always in lowercase.\n        this.valueList = {};\n        this.currentlyDisplayed = [];\n    }\n    FacetValuesList.prototype.build = function () {\n        this.valueContainer = document.createElement('ul');\n        Dom_1.$$(this.valueContainer).addClass('coveo-facet-values');\n        return this.valueContainer;\n    };\n    FacetValuesList.prototype.getAllCurrentlyDisplayed = function () {\n        return this.currentlyDisplayed;\n    };\n    FacetValuesList.prototype.getAll = function () {\n        return _.toArray(this.valueList);\n    };\n    FacetValuesList.prototype.getAllFacetValue = function () {\n        return _.map(this.getAll(), function (v) {\n            return v.facetValue;\n        });\n    };\n    FacetValuesList.prototype.get = function (value) {\n        var getter;\n        if (value instanceof FacetValue_1.FacetValue) {\n            getter = value.value;\n        }\n        else {\n            value = Utils_1.Utils.anyTypeToString(value);\n            getter = value;\n        }\n        this.ensureFacetValueIsInList(value);\n        return this.valueList[getter.toLowerCase()];\n    };\n    FacetValuesList.prototype.select = function (value) {\n        var valueElement = this.get(value);\n        valueElement.select();\n        return valueElement;\n    };\n    FacetValuesList.prototype.unselect = function (value) {\n        var valueElement = this.get(value);\n        valueElement.unselect();\n        return valueElement;\n    };\n    FacetValuesList.prototype.exclude = function (value) {\n        var valueElement = this.get(value);\n        valueElement.exclude();\n        return valueElement;\n    };\n    FacetValuesList.prototype.unExclude = function (value) {\n        var valueElement = this.get(value);\n        valueElement.unexclude();\n        return valueElement;\n    };\n    FacetValuesList.prototype.toggleSelect = function (value) {\n        var valueElement = this.get(value);\n        if (valueElement.facetValue.selected) {\n            valueElement.unselect();\n        }\n        else {\n            valueElement.select();\n        }\n        return valueElement;\n    };\n    FacetValuesList.prototype.toggleExclude = function (value) {\n        var valueElement = this.get(value);\n        if (valueElement.facetValue.excluded) {\n            valueElement.unexclude();\n        }\n        else {\n            valueElement.exclude();\n        }\n        return valueElement;\n    };\n    FacetValuesList.prototype.rebuild = function (numberOfValues) {\n        var _this = this;\n        Dom_1.$$(this.valueContainer).empty();\n        this.currentlyDisplayed = [];\n        var allValues = this.getValuesToBuildWith();\n        var toCompare = numberOfValues;\n        var docFragment = document.createDocumentFragment();\n        _.each(allValues, function (facetValue, index, list) {\n            if (_this.facetValueShouldBeRemoved(facetValue)) {\n                _this.facet.values.remove(facetValue.value);\n                toCompare += 1;\n            }\n            else if (index < toCompare) {\n                var valueElement = new _this.facetValueElementKlass(_this.facet, facetValue, true);\n                _this.valueList[facetValue.value.toLowerCase()] = valueElement;\n                var valueListElement = valueElement.build().renderer.listItem;\n                docFragment.appendChild(valueListElement);\n                _this.currentlyDisplayed.push(valueElement);\n            }\n        });\n        this.valueContainer.appendChild(docFragment);\n        FacetUtils_1.FacetUtils.addNoStateCssClassToFacetValues(this.facet, this.valueContainer);\n    };\n    FacetValuesList.prototype.getValuesToBuildWith = function () {\n        return this.facet.values.getAll();\n    };\n    FacetValuesList.prototype.facetValueShouldBeRemoved = function (facetValue) {\n        return (facetValue.occurrences == 0 &&\n            (facetValue.delta == 0 || facetValue.delta == undefined) &&\n            !facetValue.selected &&\n            !facetValue.excluded &&\n            !this.facet.keepDisplayedValuesNextTime);\n    };\n    FacetValuesList.prototype.ensureFacetValueIsInList = function (value) {\n        var facetValue;\n        if (value instanceof FacetValue_1.FacetValue) {\n            facetValue = this.facet.values.get(value.value);\n            if (facetValue == null) {\n                this.facet.values.add(value);\n                facetValue = value;\n            }\n        }\n        else {\n            facetValue = this.facet.values.get(value);\n            if (facetValue == null) {\n                facetValue = FacetValue_1.FacetValue.createFromValue(value);\n                this.facet.values.add(facetValue);\n            }\n        }\n        var key = facetValue.value.toLowerCase();\n        var found = this.valueList[key];\n        if (found == undefined) {\n            found = this.valueList[key] = new FacetValueElement_1.FacetValueElement(this.facet, facetValue, true);\n            found.build();\n        }\n        else {\n            found.facetValue = facetValue;\n        }\n    };\n    return FacetValuesList;\n}());\nexports.FacetValuesList = FacetValuesList;\n\n\n/***/ }),\n\n/***/ 488:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"Facet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ValueElement_1 = __webpack_require__(473);\nvar OmniboxValueElement = /** @class */ (function (_super) {\n    __extends(OmniboxValueElement, _super);\n    function OmniboxValueElement(facet, facetValue, eventArg, onSelect, onExclude) {\n        var _this = _super.call(this, facet, facetValue, onSelect, onExclude) || this;\n        _this.facet = facet;\n        _this.facetValue = facetValue;\n        _this.eventArg = eventArg;\n        return _this;\n    }\n    OmniboxValueElement.prototype.bindEvent = function () {\n        _super.prototype.bindEvent.call(this, { displayNextTime: false, pinFacet: false, omniboxObject: this.eventArg });\n    };\n    return OmniboxValueElement;\n}(ValueElement_1.ValueElement));\nexports.OmniboxValueElement = OmniboxValueElement;\n\n\n/***/ }),\n\n/***/ 489:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/// <reference path=\"Facet.ts\" />\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar Utils_1 = __webpack_require__(4);\nvar FacetUtils_1 = __webpack_require__(40);\nvar OmniboxValuesList = /** @class */ (function () {\n    function OmniboxValuesList(facet, facetValues, omniboxObject, omniboxValueElementKlass) {\n        this.facet = facet;\n        this.facetValues = facetValues;\n        this.omniboxObject = omniboxObject;\n        this.omniboxValueElementKlass = omniboxValueElementKlass;\n    }\n    OmniboxValuesList.prototype.build = function () {\n        var _this = this;\n        var rows = [];\n        underscore_1.each(this.facetValues, function (facetValue) {\n            rows.push(_this.buildOmniboxForOneRow(facetValue, _this.omniboxObject));\n        });\n        return this.buildFinalOmniboxElement(rows);\n    };\n    OmniboxValuesList.prototype.buildOmniboxForOneRow = function (facetValue, omniboxObject) {\n        var _this = this;\n        var selectCallback = function (elem, cause) { return _this.logAnalyticsEvent(elem, cause); };\n        var excludeCallback = function (elem, cause) { return _this.logAnalyticsEvent(elem, cause); };\n        var omniboxValueElement = new this.omniboxValueElementKlass(this.facet, facetValue, omniboxObject, selectCallback, excludeCallback);\n        var omniboxRowContent = omniboxValueElement.build().renderer.listItem;\n        var regex = omniboxObject.completeQueryExpression.regex;\n        var valueToSearch = omniboxObject.completeQueryExpression.word;\n        var caption = Dom_1.$$(omniboxRowContent).find('.coveo-facet-value-caption');\n        caption.innerHTML = this.highlightOmniboxMatch(this.facet.getValueCaption(facetValue), regex, valueToSearch);\n        var omniboxRow = Dom_1.$$('ul', {\n            className: 'coveo-omnibox-selectable coveo-facet-value coveo-omnibox-facet-value'\n        }).el;\n        omniboxRow.appendChild(omniboxRowContent);\n        Dom_1.$$(omniboxRow).on('keyboardSelect', function () {\n            var input = Dom_1.$$(omniboxRowContent).find('input[type=checkbox]');\n            Dom_1.$$(input).trigger('change');\n        });\n        omniboxRow['no-text-suggestion'] = true;\n        return omniboxRow;\n    };\n    OmniboxValuesList.prototype.buildFinalOmniboxElement = function (rows) {\n        var header = this.buildOmniboxHeader();\n        if (Utils_1.Utils.isEmptyArray(rows)) {\n            return undefined;\n        }\n        else {\n            var ret_1 = Dom_1.$$('div', {\n                className: 'coveo-omnibox-facet-value'\n            }).el;\n            ret_1.appendChild(header);\n            underscore_1.each(rows, function (r) {\n                ret_1.appendChild(r);\n            });\n            FacetUtils_1.FacetUtils.addNoStateCssClassToFacetValues(this.facet, ret_1);\n            return ret_1;\n        }\n    };\n    OmniboxValuesList.prototype.buildOmniboxHeader = function () {\n        var title = this.facet.options.title;\n        var header = Dom_1.$$('div', {\n            className: 'coveo-omnibox-facet-header'\n        }).el;\n        Dom_1.$$(header).text(title);\n        return header;\n    };\n    OmniboxValuesList.prototype.highlightOmniboxMatch = function (orignalStr, regex, valueToSearch) {\n        var firstChar = orignalStr.search(regex);\n        var lastChar = firstChar + valueToSearch.length;\n        return (orignalStr.slice(0, firstChar) +\n            '<span class=\"coveo-highlight\">' +\n            orignalStr.slice(firstChar, lastChar) +\n            '</span>' +\n            orignalStr.slice(lastChar));\n    };\n    OmniboxValuesList.prototype.logAnalyticsEvent = function (elem, cause) {\n        var strippedFacetValues = underscore_1.pluck(this.facetValues, 'value');\n        elem.facet.usageAnalytics.logSearchEvent(cause, {\n            query: this.omniboxObject.completeQueryExpression.word,\n            facetId: elem.facet.options.id,\n            facetField: elem.facet.options.field.toString(),\n            facetTitle: elem.facet.options.title,\n            facetValue: elem.facetValue.value,\n            suggestions: strippedFacetValues.join(';'),\n            suggestionRanking: underscore_1.indexOf(strippedFacetValues, elem.facetValue.value)\n        });\n    };\n    return OmniboxValuesList;\n}());\nexports.OmniboxValuesList = OmniboxValuesList;\n\n\n/***/ }),\n\n/***/ 527:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 528:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 529:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 530:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveComponentsManager_1 = __webpack_require__(83);\nvar SearchInterface_1 = __webpack_require__(20);\nvar ResultList_1 = __webpack_require__(90);\nvar Dom_1 = __webpack_require__(1);\nvar Component_1 = __webpack_require__(7);\nvar Logger_1 = __webpack_require__(9);\nvar ResponsiveDefaultResultTemplate = /** @class */ (function () {\n    function ResponsiveDefaultResultTemplate(coveoRoot, ID, options, responsiveDropdown) {\n        this.coveoRoot = coveoRoot;\n        this.ID = ID;\n        this.searchInterface = Component_1.Component.get(this.coveoRoot.el, SearchInterface_1.SearchInterface, false);\n        this.currentMode = 'large';\n    }\n    ResponsiveDefaultResultTemplate.init = function (root, component, options) {\n        if (!Dom_1.$$(root).find(\".\" + Component_1.Component.computeCssClassName(ResultList_1.ResultList))) {\n            var logger = new Logger_1.Logger('ResponsiveDefaultResultTemplate');\n            logger.trace('No ResultLayout component found : Cannot instantiate ResponsiveResultLayout');\n            return;\n        }\n        ResponsiveComponentsManager_1.ResponsiveComponentsManager.register(ResponsiveDefaultResultTemplate, Dom_1.$$(root), ResultList_1.ResultList.ID, component, options);\n    };\n    ResponsiveDefaultResultTemplate.prototype.registerComponent = function (accept) {\n        if (accept instanceof ResultList_1.ResultList) {\n            this.resultList = accept;\n            return true;\n        }\n        return false;\n    };\n    ResponsiveDefaultResultTemplate.prototype.handleResizeEvent = function () {\n        var _this = this;\n        var lastResults = this.resultList.queryController.getLastResults();\n        if (this.needSmallMode()) {\n            Dom_1.$$(this.resultList.options.resultsContainer).addClass('coveo-card-layout-container');\n            Dom_1.$$(this.resultList.options.resultsContainer).removeClass(\"coveo-list-layout-container\");\n            if (this.currentMode != 'small') {\n                if (lastResults) {\n                    this.resultList.buildResults(lastResults).then(function (elements) {\n                        _this.resultList.renderResults(elements);\n                    });\n                }\n                this.currentMode = 'small';\n            }\n        }\n        else {\n            Dom_1.$$(this.resultList.options.resultsContainer).removeClass('coveo-card-layout-container');\n            Dom_1.$$(this.resultList.options.resultsContainer).addClass(\"coveo-list-layout-container\");\n            if (this.currentMode != 'large') {\n                if (lastResults) {\n                    this.resultList.buildResults(lastResults).then(function (elements) {\n                        _this.resultList.renderResults(elements);\n                    });\n                }\n                this.currentMode = 'large';\n            }\n        }\n    };\n    ResponsiveDefaultResultTemplate.prototype.needSmallMode = function () {\n        return this.coveoRoot.width() <= this.searchInterface.responsiveComponents.getSmallScreenWidth();\n    };\n    return ResponsiveDefaultResultTemplate;\n}());\nexports.ResponsiveDefaultResultTemplate = ResponsiveDefaultResultTemplate;\n\n\n/***/ }),\n\n/***/ 531:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar ResultContainer = /** @class */ (function () {\n    function ResultContainer(resultContainer, searchInterface) {\n        this.searchInterface = searchInterface;\n        this.resultContainerElement = Dom_1.$$(resultContainer);\n    }\n    ResultContainer.prototype.empty = function () {\n        this.searchInterface.detachComponentsInside(this.resultContainerElement.el);\n        Dom_1.$$(this.resultContainerElement).empty();\n    };\n    ResultContainer.prototype.addClass = function (classToAdd) {\n        this.resultContainerElement.addClass(classToAdd);\n    };\n    ResultContainer.prototype.isEmpty = function () {\n        return this.resultContainerElement.isEmpty();\n    };\n    ResultContainer.prototype.hideChildren = function () {\n        this.resultContainerElement.children().forEach(function (child) { return Dom_1.$$(child).hide(); });\n    };\n    ResultContainer.prototype.getResultElements = function () {\n        return this.resultContainerElement.findAll('.CoveoResult');\n    };\n    Object.defineProperty(ResultContainer.prototype, \"el\", {\n        get: function () {\n            return this.resultContainerElement.el;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResultContainer.resultCurrentlyBeingRendered = null;\n    return ResultContainer;\n}());\nexports.ResultContainer = ResultContainer;\n\n\n/***/ }),\n\n/***/ 532:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResultListRenderer_1 = __webpack_require__(213);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar ResultListCardRenderer = /** @class */ (function (_super) {\n    __extends(ResultListCardRenderer, _super);\n    function ResultListCardRenderer() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ResultListCardRenderer.prototype.getEndFragment = function (resultElements) {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (!_.isEmpty(resultElements)) {\n                // with infinite scrolling, we want the additional results to append at the end of the previous query.\n                // For this, we need to remove the padding.\n                if (_this.resultListOptions.enableInfiniteScroll) {\n                    var needToBeRemoved = Dom_1.$$(_this.resultListOptions.resultsContainer).findAll('.coveo-card-layout-padding');\n                    _.each(needToBeRemoved, function (toRemove) { return Dom_1.$$(toRemove).remove(); });\n                }\n                // Used to prevent last card from spanning the grid's whole width\n                var emptyCards_1 = document.createDocumentFragment();\n                _.times(3, function () { return emptyCards_1.appendChild(Dom_1.$$('div', { className: 'coveo-card-layout coveo-card-layout-padding' }).el); });\n                resolve(emptyCards_1);\n            }\n            resolve(null);\n        });\n    };\n    return ResultListCardRenderer;\n}(ResultListRenderer_1.ResultListRenderer));\nexports.ResultListCardRenderer = ResultListCardRenderer;\n\n\n/***/ }),\n\n/***/ 533:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResultListRenderer_1 = __webpack_require__(213);\nvar TableTemplate_1 = __webpack_require__(468);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar ResultListTableRenderer = /** @class */ (function (_super) {\n    __extends(ResultListTableRenderer, _super);\n    function ResultListTableRenderer(resultListOptions, autoCreateComponentsFn) {\n        var _this = _super.call(this, resultListOptions, autoCreateComponentsFn) || this;\n        _this.resultListOptions = resultListOptions;\n        _this.autoCreateComponentsFn = autoCreateComponentsFn;\n        _this.shouldDisplayHeader = true;\n        _this.shouldDisplayFooter = false;\n        if (_this.resultListOptions.resultTemplate instanceof TableTemplate_1.TableTemplate) {\n            if (_this.resultListOptions.resultTemplate.hasTemplateWithRole('table-footer')) {\n                _this.shouldDisplayFooter = true;\n            }\n            // If custom templates are defined but no header template, do not display it.\n            if (_this.resultListOptions.resultTemplate.templates.length !== 0 &&\n                !_this.resultListOptions.resultTemplate.hasTemplateWithRole('table-header')) {\n                _this.shouldDisplayHeader = false;\n            }\n        }\n        return _this;\n    }\n    ResultListTableRenderer.prototype.getStartFragment = function (resultElements, append) {\n        if (!append && !_.isEmpty(resultElements) && this.shouldDisplayHeader) {\n            return this.renderRoledTemplate('table-header');\n        }\n    };\n    ResultListTableRenderer.prototype.getEndFragment = function (resultElements, append) {\n        if (!append && !_.isEmpty(resultElements) && this.shouldDisplayFooter) {\n            return this.renderRoledTemplate('table-footer');\n        }\n    };\n    ResultListTableRenderer.prototype.renderRoledTemplate = function (role) {\n        return __awaiter(this, void 0, void 0, function () {\n            var elem, frag;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.resultListOptions.resultTemplate.instantiateRoleToElement(role)];\n                    case 1:\n                        elem = _a.sent();\n                        Dom_1.$$(elem).addClass(\"coveo-result-list-\" + role);\n                        this.autoCreateComponentsFn(elem, undefined);\n                        frag = document.createDocumentFragment();\n                        frag.appendChild(elem);\n                        return [2 /*return*/, frag];\n                }\n            });\n        });\n    };\n    return ResultListTableRenderer;\n}(ResultListRenderer_1.ResultListRenderer));\nexports.ResultListTableRenderer = ResultListTableRenderer;\n\n\n/***/ }),\n\n/***/ 535:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 536:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveDropdownContent_1 = __webpack_require__(66);\nvar Core_1 = __webpack_require__(19);\nvar SVGIcons_1 = __webpack_require__(12);\nvar FocusTrap_1 = __webpack_require__(182);\nvar ResponsiveDropdownModalContent = /** @class */ (function () {\n    function ResponsiveDropdownModalContent(componentName, element, closeButtonLabel, close) {\n        this.componentName = componentName;\n        this.element = element;\n        this.closeButtonLabel = closeButtonLabel;\n        this.close = close;\n        this.className = \"coveo-\" + this.componentName + \"-dropdown-modal-content\";\n    }\n    Object.defineProperty(ResponsiveDropdownModalContent.prototype, \"hidden\", {\n        set: function (shouldHide) {\n            this.element.toggleClass('coveo-hidden', shouldHide);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResponsiveDropdownModalContent.prototype.positionDropdown = function () {\n        this.element.el.classList.add(this.className, ResponsiveDropdownContent_1.ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n        this.element.setAttribute('role', 'group');\n        this.element.setAttribute('aria-label', Core_1.l('FiltersDropdown'));\n        this.hidden = false;\n        this.ensureCloseButton();\n        this.ensureFocusTrap();\n    };\n    ResponsiveDropdownModalContent.prototype.hideDropdown = function () {\n        this.element.el.classList.remove(this.className, ResponsiveDropdownContent_1.ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n        this.element.setAttribute('role', null);\n        this.element.setAttribute('aria-label', null);\n        this.hidden = true;\n        this.removeCloseButton();\n        this.removeFocusTrap();\n    };\n    ResponsiveDropdownModalContent.prototype.cleanUp = function () {\n        this.hidden = false;\n    };\n    ResponsiveDropdownModalContent.prototype.ensureCloseButton = function () {\n        var _this = this;\n        if (!this.closeButton) {\n            this.closeButton = Core_1.$$('button', {\n                className: 'coveo-facet-modal-close-button',\n                type: 'button',\n                ariaLabel: this.closeButtonLabel\n            }, SVGIcons_1.SVGIcons.icons.mainClear);\n            this.closeButton.on('click', function () { return _this.close(); });\n            this.element.prepend(this.closeButton.el);\n        }\n    };\n    Object.defineProperty(ResponsiveDropdownModalContent.prototype, \"focusableSelector\", {\n        get: function () {\n            var facetElements = '[data-field]:not(.coveo-facet-empty) [tabindex]';\n            var dynamicFacetsElements = '[data-field]:not(.coveo-hidden) button';\n            var modalButton = '.coveo-facet-modal-close-button';\n            return [facetElements, dynamicFacetsElements, modalButton].join(' , ');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResponsiveDropdownModalContent.prototype.ensureFocusTrap = function () {\n        if (!this.focusTrap) {\n            this.focusTrap = new FocusTrap_1.FocusTrap(this.element.el, { focusableSelector: this.focusableSelector });\n        }\n    };\n    ResponsiveDropdownModalContent.prototype.removeCloseButton = function () {\n        if (this.closeButton) {\n            this.closeButton.remove();\n            this.closeButton = null;\n        }\n    };\n    ResponsiveDropdownModalContent.prototype.removeFocusTrap = function () {\n        if (this.focusTrap) {\n            this.focusTrap.disable();\n            this.focusTrap = null;\n        }\n    };\n    return ResponsiveDropdownModalContent;\n}());\nexports.ResponsiveDropdownModalContent = ResponsiveDropdownModalContent;\n\n\n/***/ }),\n\n/***/ 537:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The names of the events that can be triggered by the [FacetsMobileMode]{@link FacetsMobileMode} component.\n */\nvar FacetsMobileModeEvents = /** @class */ (function () {\n    function FacetsMobileModeEvents() {\n    }\n    /**\n     * The name of the event that gets triggered when the facets pop-up (or modal) is opened in mobile mode.\n     */\n    FacetsMobileModeEvents.popupOpened = 'popupOpened';\n    /**\n     * The name of the event that gets triggered when the facets pop-up (or modal) is closed in mobile mode.\n     */\n    FacetsMobileModeEvents.popupClosed = 'popupClosed';\n    return FacetsMobileModeEvents;\n}());\nexports.FacetsMobileModeEvents = FacetsMobileModeEvents;\n\n\n/***/ }),\n\n/***/ 538:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 540:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 541:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 542:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 543:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 544:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar KeyboardUtils_1 = __webpack_require__(26);\nvar FacetSearchUserInputHandler = /** @class */ (function () {\n    function FacetSearchUserInputHandler(facetSearch) {\n        this.facetSearch = facetSearch;\n    }\n    FacetSearchUserInputHandler.prototype.handleKeyboardEvent = function (event) {\n        switch (event.which) {\n            case KeyboardUtils_1.KEYBOARD.ENTER:\n                this.facetSearch.keyboardNavigationEnterPressed(event);\n                break;\n            case KeyboardUtils_1.KEYBOARD.DELETE:\n                this.facetSearch.keyboardNavigationDeletePressed && this.facetSearch.keyboardNavigationDeletePressed(event);\n                break;\n            case KeyboardUtils_1.KEYBOARD.ESCAPE:\n                this.facetSearch.dismissSearchResults();\n                break;\n            case KeyboardUtils_1.KEYBOARD.DOWN_ARROW:\n                this.facetSearch.facetSearchElement.moveCurrentResultDown();\n                break;\n            case KeyboardUtils_1.KEYBOARD.UP_ARROW:\n                this.facetSearch.facetSearchElement.moveCurrentResultUp();\n                break;\n            default:\n                this.facetSearch.keyboardEventDefaultHandler();\n        }\n    };\n    FacetSearchUserInputHandler.prototype.handleFacetSearchResultsScroll = function () {\n        if (this.facetSearch.facetSearchPromise ||\n            this.facetSearch.facetSearchElement.getValueInInputForFacetSearch() != '' ||\n            !this.facetSearch.moreValuesToFetch) {\n            return;\n        }\n        var elementHeight = this.facetSearch.facetSearchElement.searchResults.clientHeight;\n        var scrollHeight = this.facetSearch.facetSearchElement.searchResults.scrollHeight;\n        var bottomPosition = this.facetSearch.facetSearchElement.searchResults.scrollTop + elementHeight;\n        if (scrollHeight - bottomPosition < elementHeight / 2) {\n            this.facetSearch.fetchMoreValues();\n        }\n    };\n    return FacetSearchUserInputHandler;\n}());\nexports.FacetSearchUserInputHandler = FacetSearchUserInputHandler;\n\n\n/***/ }),\n\n/***/ 545:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar DefaultSearchDropdownNavigator_1 = __webpack_require__(477);\nvar FacetSearchDropdownNavigator_1 = __webpack_require__(546);\nvar CategoryFacet_1 = __webpack_require__(91);\nvar Facet_1 = __webpack_require__(69);\nfunction SearchDropdownNavigatorFactory(facetSearch, config) {\n    switch (facetSearch.facetType) {\n        case Facet_1.Facet.ID:\n            return new FacetSearchDropdownNavigator_1.FacetSearchDropdownNavigator(__assign({}, config, { facetSearch: facetSearch }));\n        case CategoryFacet_1.CategoryFacet.ID:\n        default:\n            return new DefaultSearchDropdownNavigator_1.DefaultSearchDropdownNavigator(config);\n    }\n}\nexports.SearchDropdownNavigatorFactory = SearchDropdownNavigatorFactory;\n\n\n/***/ }),\n\n/***/ 546:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar DefaultSearchDropdownNavigator_1 = __webpack_require__(477);\nvar Dom_1 = __webpack_require__(1);\nvar FacetSearchDropdownNavigator = /** @class */ (function () {\n    function FacetSearchDropdownNavigator(config) {\n        this.config = config;\n        this.defaultDropdownNavigator = new DefaultSearchDropdownNavigator_1.DefaultSearchDropdownNavigator(config);\n    }\n    FacetSearchDropdownNavigator.prototype.setAsCurrentResult = function (dom) {\n        this.defaultDropdownNavigator.setAsCurrentResult(dom);\n    };\n    Object.defineProperty(FacetSearchDropdownNavigator.prototype, \"currentResult\", {\n        get: function () {\n            return this.defaultDropdownNavigator.currentResult;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetSearchDropdownNavigator.prototype.focusNextElement = function () {\n        this.toggleCanExcludeCurrentResult();\n        if (this.willExcludeCurrentResult) {\n            this.announceCurrentResultCanBeExcluded();\n            return;\n        }\n        this.defaultDropdownNavigator.moveCurrentResultDown();\n    };\n    FacetSearchDropdownNavigator.prototype.focusPreviousElement = function () {\n        if (this.willExcludeCurrentResult) {\n            this.toggleCanExcludeCurrentResult();\n            return;\n        }\n        this.moveResultUp();\n        this.toggleCanExcludeCurrentResult();\n    };\n    FacetSearchDropdownNavigator.prototype.moveResultUp = function () {\n        if (this.willExcludeCurrentResult) {\n            this.toggleCanExcludeCurrentResult();\n            return;\n        }\n        this.defaultDropdownNavigator.moveCurrentResultUp();\n        this.toggleCanExcludeCurrentResult();\n    };\n    Object.defineProperty(FacetSearchDropdownNavigator.prototype, \"isCurrentResultNotAFacetValue\", {\n        get: function () {\n            return this.currentResult.hasClass('coveo-facet-search-select-all') || this.currentResult.hasClass('coveo-facet-value-not-found');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSearchDropdownNavigator.prototype, \"willExcludeCurrentResult\", {\n        get: function () {\n            return this.currentResult.hasClass('coveo-facet-value-will-exclude');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetSearchDropdownNavigator.prototype.toggleCanExcludeCurrentResult = function () {\n        if (this.isCurrentResultNotAFacetValue) {\n            return;\n        }\n        this.currentResult.toggleClass('coveo-facet-value-will-exclude', !this.willExcludeCurrentResult);\n    };\n    FacetSearchDropdownNavigator.prototype.announceCurrentResultCanBeExcluded = function () {\n        if (this.isCurrentResultNotAFacetValue) {\n            return;\n        }\n        var excludeIcon = Dom_1.$$(this.currentResult).find('.coveo-facet-value-exclude');\n        this.config.facetSearch.updateAriaLive(excludeIcon.getAttribute('aria-label'));\n    };\n    return FacetSearchDropdownNavigator;\n}());\nexports.FacetSearchDropdownNavigator = FacetSearchDropdownNavigator;\n\n\n/***/ }),\n\n/***/ 547:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(15);\nvar underscore_1 = __webpack_require__(0);\nvar Strings_1 = __webpack_require__(6);\nvar Globalize = __webpack_require__(23);\nvar CategoryFacetTemplates = /** @class */ (function () {\n    function CategoryFacetTemplates() {\n        this.listRoot = Dom_1.$$('ul', { className: 'coveo-category-facet-values' });\n        this.collapseArrow = Dom_1.$$('span', { className: 'coveo-category-facet-collapse-children' }, SVGIcons_1.SVGIcons.icons.arrowDown);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(this.collapseArrow.el, 'coveo-category-facet-collapse-children-svg');\n    }\n    CategoryFacetTemplates.prototype.buildListRoot = function () {\n        return this.listRoot.clone(true);\n    };\n    CategoryFacetTemplates.prototype.buildListElement = function (data) {\n        var div = Dom_1.$$('div', {}, this.createListElement(data));\n        return Dom_1.$$(div.el.firstChild);\n    };\n    CategoryFacetTemplates.prototype.buildAllCategoriesButton = function () {\n        var allCategoriesCaption = Dom_1.$$('span', { className: 'coveo-category-facet-all-categories-caption' }, Strings_1.l('AllCategories'));\n        var allCategories = Dom_1.$$('li', { className: 'coveo-category-facet-value coveo-category-facet-all-categories' }, this.buildCollapseArrow(), allCategoriesCaption);\n        return allCategories;\n    };\n    CategoryFacetTemplates.prototype.buildEllipsis = function () {\n        var ellipsisCaption = Dom_1.$$('span', { className: 'coveo-category-facet-ellipsis-caption' }, '[ ... ]');\n        var ellipsis = Dom_1.$$('li', { className: 'coveo-category-facet-ellipsis' }, ellipsisCaption);\n        return ellipsis;\n    };\n    CategoryFacetTemplates.prototype.buildCollapseArrow = function () {\n        return this.collapseArrow.clone(true);\n    };\n    CategoryFacetTemplates.prototype.getFormattedCount = function (count) {\n        return Globalize.format(count, 'n0');\n    };\n    CategoryFacetTemplates.prototype.createListElement = function (data) {\n        return \"<li class=\\\"coveo-category-facet-value\\\">\\n        <label class=\\\"coveo-category-facet-value-label\\\">\\n          <span title=\\\"\" + underscore_1.escape(data.value) + \"\\\" class=\\\"coveo-category-facet-value-caption\\\">\" + underscore_1.escape(data.value) + \"</span>\\n          <span class=\\\"coveo-category-facet-value-count\\\">\" + this.getFormattedCount(data.count) + \"</span>\\n        </label>\\n      </li>\";\n    };\n    return CategoryFacetTemplates;\n}());\nexports.CategoryFacetTemplates = CategoryFacetTemplates;\n\n\n/***/ }),\n\n/***/ 548:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar CategoryValueChildrenRenderer_1 = __webpack_require__(478);\nvar CategoryValueRoot = /** @class */ (function () {\n    function CategoryValueRoot(element, categoryFacetTemplates, categoryFacet) {\n        this.element = element;\n        this.path = [];\n        this.categoryChildrenValueRenderer = new CategoryValueChildrenRenderer_1.CategoryChildrenValueRenderer(element, categoryFacetTemplates, this, categoryFacet);\n        this.listRoot = categoryFacetTemplates.buildListRoot();\n        this.appendListRoot();\n    }\n    CategoryValueRoot.prototype.renderChildren = function (values) {\n        this.appendListRoot();\n        this.categoryChildrenValueRenderer.renderChildren(values);\n    };\n    CategoryValueRoot.prototype.renderAsParent = function (value) {\n        this.appendListRoot();\n        return this.categoryChildrenValueRenderer.renderAsParent(value);\n    };\n    Object.defineProperty(CategoryValueRoot.prototype, \"children\", {\n        get: function () {\n            return this.categoryChildrenValueRenderer.children;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CategoryValueRoot.prototype.clear = function () {\n        this.listRoot.detach();\n        this.listRoot.empty();\n        this.categoryChildrenValueRenderer.clearChildren();\n    };\n    CategoryValueRoot.prototype.appendListRoot = function () {\n        this.element.append(this.listRoot.el);\n    };\n    return CategoryValueRoot;\n}());\nexports.CategoryValueRoot = CategoryValueRoot;\n\n\n/***/ }),\n\n/***/ 549:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar CategoryValueChildrenRenderer_1 = __webpack_require__(478);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar Strings_1 = __webpack_require__(6);\nvar CategoryValue = /** @class */ (function () {\n    function CategoryValue(listRoot, categoryValueDescriptor, categoryFacetTemplates, categoryFacet) {\n        this.listRoot = listRoot;\n        this.categoryValueDescriptor = categoryValueDescriptor;\n        this.categoryFacetTemplates = categoryFacetTemplates;\n        this.categoryFacet = categoryFacet;\n        this.isActive = false;\n        this.element = this.categoryFacetTemplates.buildListElement({\n            value: this.captionedValueDescriptorValue,\n            count: this.categoryValueDescriptor.count\n        });\n        this.collapseArrow = this.categoryFacetTemplates.buildCollapseArrow();\n        this.categoryChildrenValueRenderer = new CategoryValueChildrenRenderer_1.CategoryChildrenValueRenderer(this.element, categoryFacetTemplates, this, this.categoryFacet);\n        this.path = this.categoryValueDescriptor.path;\n    }\n    CategoryValue.prototype.render = function (isChild) {\n        if (this.pastMaximumDepth()) {\n            this.element.addClass('coveo-category-facet-last-value');\n        }\n        if (isChild) {\n            this.element.addClass('coveo-category-facet-child-value');\n        }\n        else {\n            this.element.addClass('coveo-category-facet-parent-value');\n        }\n        this.listRoot.append(this.element.el);\n    };\n    CategoryValue.prototype.getDescriptor = function () {\n        return {\n            value: this.categoryValueDescriptor.value,\n            count: this.categoryValueDescriptor.count,\n            path: this.path\n        };\n    };\n    CategoryValue.prototype.clear = function () {\n        this.element.detach();\n        this.categoryChildrenValueRenderer.clearChildren();\n    };\n    CategoryValue.prototype.renderChildren = function (values) {\n        this.isActive = true;\n        this.element.addClass('coveo-active-category-facet-parent');\n        this.categoryChildrenValueRenderer.renderChildren(values);\n    };\n    CategoryValue.prototype.renderAsParent = function (value) {\n        return this.categoryChildrenValueRenderer.renderAsParent(value);\n    };\n    Object.defineProperty(CategoryValue.prototype, \"children\", {\n        get: function () {\n            return this.categoryChildrenValueRenderer.children;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CategoryValue.prototype.makeSelectable = function () {\n        var _this = this;\n        var element = Dom_1.$$(this.element.find('.coveo-category-facet-value-label'));\n        element.addClass('coveo-selectable');\n        var count = this.categoryValueDescriptor.count;\n        var countLabel = Strings_1.l('ResultCount', count.toString(), count);\n        var label = Strings_1.l('IncludeValueWithResultCount', this.captionedValueDescriptorValue, countLabel);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(element)\n            .withSelectAction(function () { return _this.onSelect(); })\n            .withLabel(label)\n            .build();\n        return this;\n    };\n    CategoryValue.prototype.showCollapseArrow = function () {\n        if (!this.collapseArrow.el.parentElement) {\n            var label = this.element.find('label');\n            Dom_1.$$(label).prepend(this.collapseArrow.el);\n        }\n        return this;\n    };\n    Object.defineProperty(CategoryValue.prototype, \"captionedValueDescriptorValue\", {\n        get: function () {\n            var value = this.categoryValueDescriptor.value;\n            return this.categoryFacet.getCaption(value);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CategoryValue.prototype.onSelect = function () {\n        if (!this.pastMaximumDepth()) {\n            this.categoryFacet.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetSelect, this.path);\n            this.categoryFacet.scrollToTop();\n            this.categoryFacet.changeActivePath(this.path);\n            this.categoryFacet.executeQuery();\n        }\n    };\n    CategoryValue.prototype.pastMaximumDepth = function () {\n        return this.path.length - this.categoryFacet.options.basePath.length >= this.categoryFacet.options.maximumDepth;\n    };\n    return CategoryValue;\n}());\nexports.CategoryValue = CategoryValue;\n\n\n/***/ }),\n\n/***/ 550:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar AllowedValuesPatternType_1 = __webpack_require__(472);\nvar Utils_1 = __webpack_require__(4);\nvar CategoryFacetQueryController = /** @class */ (function () {\n    function CategoryFacetQueryController(categoryFacet) {\n        this.categoryFacet = categoryFacet;\n    }\n    CategoryFacetQueryController.prototype.putCategoryFacetInQueryBuilder = function (queryBuilder, path, maximumNumberOfValues) {\n        var positionInQuery = queryBuilder.categoryFacets.length;\n        this.addQueryFilter(queryBuilder, path);\n        this.addCategoryFacetRequest(queryBuilder, path, maximumNumberOfValues);\n        return positionInQuery;\n    };\n    CategoryFacetQueryController.prototype.searchFacetValues = function (value, numberOfValues) {\n        return __awaiter(this, void 0, void 0, function () {\n            var lastQuery, groupByRequest, results, sortByNumberOfResultsThenPathLength;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        lastQuery = __assign({}, this.categoryFacet.queryController.getLastQuery());\n                        groupByRequest = {\n                            allowedValues: [this.getAllowedValuesPattern(value)],\n                            allowedValuesPatternType: AllowedValuesPatternType_1.AllowedValuesPatternType.Wildcards,\n                            maximumNumberOfValues: numberOfValues,\n                            field: this.categoryFacet.options.field,\n                            sortCriteria: 'occurrences',\n                            injectionDepth: this.categoryFacet.options.injectionDepth\n                        };\n                        lastQuery.groupBy = [groupByRequest];\n                        lastQuery.categoryFacets.splice(this.categoryFacet.positionInQuery, 1);\n                        return [4 /*yield*/, this.categoryFacet.queryController.getEndpoint().search(lastQuery)];\n                    case 1:\n                        results = _a.sent();\n                        sortByNumberOfResultsThenPathLength = function (firstGroupByValue, secondGroupByValue) {\n                            if (firstGroupByValue.numberOfResults == secondGroupByValue.numberOfResults) {\n                                return firstGroupByValue.value.length - secondGroupByValue.value.length;\n                            }\n                            return secondGroupByValue.numberOfResults - firstGroupByValue.numberOfResults;\n                        };\n                        return [2 /*return*/, results.groupByResults[0].values.sort(sortByNumberOfResultsThenPathLength)];\n                }\n            });\n        });\n    };\n    CategoryFacetQueryController.prototype.addDebugGroupBy = function (queryBuilder, value) {\n        queryBuilder.groupByRequests.push({\n            field: this.categoryFacet.options.field,\n            allowedValues: [\".*\" + Utils_1.Utils.escapeRegexCharacter(value) + \".*\"],\n            allowedValuesPatternType: AllowedValuesPatternType_1.AllowedValuesPatternType.Regex\n        });\n    };\n    CategoryFacetQueryController.prototype.shouldAddFilterToQuery = function (path) {\n        return path.length != 0 && !Utils_1.Utils.arrayEqual(path, this.categoryFacet.options.basePath);\n    };\n    CategoryFacetQueryController.prototype.addQueryFilter = function (queryBuilder, path) {\n        if (this.shouldAddFilterToQuery(path)) {\n            queryBuilder.advancedExpression.addFieldExpression(this.categoryFacet.options.field, '==', [\n                path.join(this.categoryFacet.options.delimitingCharacter)\n            ]);\n        }\n    };\n    CategoryFacetQueryController.prototype.addCategoryFacetRequest = function (queryBuilder, path, maximumNumberOfValues) {\n        var categoryFacetsRequest = {\n            field: this.categoryFacet.options.field,\n            path: path,\n            injectionDepth: this.categoryFacet.options.injectionDepth,\n            maximumNumberOfValues: maximumNumberOfValues,\n            delimitingCharacter: this.categoryFacet.options.delimitingCharacter\n        };\n        queryBuilder.categoryFacets.push(categoryFacetsRequest);\n    };\n    CategoryFacetQueryController.prototype.getAllowedValuesPattern = function (value) {\n        var basePath = this.categoryFacet.options.basePath;\n        var delimiter = this.categoryFacet.options.delimitingCharacter;\n        if (Utils_1.Utils.isNonEmptyArray(basePath)) {\n            return \"\" + basePath.join(delimiter) + delimiter + \"*\" + value + \"*\";\n        }\n        return \"*\" + value + \"*\";\n    };\n    return CategoryFacetQueryController;\n}());\nexports.CategoryFacetQueryController = CategoryFacetQueryController;\n\n\n/***/ }),\n\n/***/ 551:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 552:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar CategoryFacet_1 = __webpack_require__(91);\nvar FacetSearchElement_1 = __webpack_require__(476);\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar SVGDom_1 = __webpack_require__(15);\nvar SVGIcons_1 = __webpack_require__(12);\nvar Strings_1 = __webpack_require__(6);\n__webpack_require__(553);\nvar StringUtils_1 = __webpack_require__(22);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar Globalize = __webpack_require__(23);\nvar CategoryFacetSearch = /** @class */ (function () {\n    function CategoryFacetSearch(categoryFacet, displayButton) {\n        if (displayButton === void 0) { displayButton = true; }\n        var _this = this;\n        this.categoryFacet = categoryFacet;\n        this.displayButton = displayButton;\n        this.moreValuesToFetch = true;\n        this.facetSearchElement = new FacetSearchElement_1.FacetSearchElement(this);\n        this.displayNewValues = underscore_1.debounce(this.getDisplayNewValuesFunction(), this.categoryFacet.options.facetSearchDelay);\n        this.categoryFacet.root.addEventListener('click', function (e) { return _this.handleClickElsewhere(e); });\n        this.numberOfValuesToFetch = this.categoryFacet.options.numberOfResultsInFacetSearch;\n    }\n    Object.defineProperty(CategoryFacetSearch.prototype, \"facetType\", {\n        get: function () {\n            return CategoryFacet_1.CategoryFacet.ID;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CategoryFacetSearch.prototype, \"facetTitle\", {\n        get: function () {\n            return this.categoryFacet.options.title || this.categoryFacet.options.field.toString();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CategoryFacetSearch.prototype.setExpandedFacetSearchAccessibilityAttributes = function (searchResultsElements) {\n        this.container.setAttribute('aria-expanded', 'true');\n    };\n    CategoryFacetSearch.prototype.setCollapsedFacetSearchAccessibilityAttributes = function () {\n        this.container.setAttribute('aria-expanded', 'false');\n    };\n    CategoryFacetSearch.prototype.build = function () {\n        this.container = Dom_1.$$('div', {\n            className: 'coveo-category-facet-search-container',\n            role: 'button'\n        });\n        this.container.toggleClass('coveo-category-facet-search-without-button', !this.displayButton);\n        this.displayButton && this.buildButton();\n        this.container.append(this.facetSearchElement.build());\n        Dom_1.$$(this.facetSearchElement.search).toggleClass('without-animation', !this.displayButton);\n        return this.container;\n    };\n    CategoryFacetSearch.prototype.buildButton = function () {\n        var _this = this;\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(this.container)\n            .withSelectAction(function () {\n            Dom_1.$$(_this.categoryFacet.element).addClass('coveo-category-facet-searching');\n            _this.focus();\n        })\n            .withLabel(Strings_1.l('SearchFacetResults', this.facetTitle))\n            .build();\n        this.buildfacetSearchPlaceholder();\n    };\n    CategoryFacetSearch.prototype.focus = function () {\n        this.facetSearchElement.focus();\n    };\n    CategoryFacetSearch.prototype.clear = function () {\n        this.dismissSearchResults();\n        this.container && this.container.detach();\n    };\n    CategoryFacetSearch.prototype.dismissSearchResults = function () {\n        this.removeNoResultsCssClasses();\n        Dom_1.$$(this.categoryFacet.element).removeClass('coveo-category-facet-searching');\n        Dom_1.$$(this.facetSearchElement.searchResults).empty();\n        this.facetSearchElement.clearSearchInput();\n        this.facetSearchElement.hideSearchResultsElement();\n        this.currentlyDisplayedResults = null;\n        this.numberOfValuesToFetch = this.categoryFacet.options.numberOfResultsInFacetSearch;\n        this.moreValuesToFetch = true;\n    };\n    CategoryFacetSearch.prototype.keyboardEventDefaultHandler = function () {\n        this.moreValuesToFetch = true;\n        this.displayNewValues();\n    };\n    CategoryFacetSearch.prototype.keyboardNavigationEnterPressed = function () {\n        this.selectCurrentResult();\n    };\n    CategoryFacetSearch.prototype.fetchMoreValues = function () {\n        this.numberOfValuesToFetch += this.categoryFacet.options.numberOfResultsInFacetSearch;\n        this.displayNewValues();\n    };\n    CategoryFacetSearch.prototype.getCaptions = function () {\n        var searchResults = Dom_1.$$(this.facetSearchElement.searchResults);\n        var captions = searchResults\n            .findAll('.coveo-category-facet-search-value-caption')\n            .concat(searchResults.findAll('.coveo-category-facet-search-path-parents'))\n            .concat(searchResults.findAll('.coveo-category-facet-search-path-last-value'));\n        return captions;\n    };\n    CategoryFacetSearch.prototype.updateAriaLive = function (text) {\n        this.categoryFacet.searchInterface.ariaLive.updateText(text);\n    };\n    CategoryFacetSearch.prototype.selectCurrentResult = function () {\n        if (this.facetSearchElement.currentResult) {\n            var currentResultPathData = this.facetSearchElement.currentResult.el.dataset.path;\n            var delimiter = this.categoryFacet.options.delimitingCharacter;\n            var path = currentResultPathData.split(delimiter);\n            this.categoryFacet.changeActivePath(path);\n            this.categoryFacet.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetSelect, path);\n            this.categoryFacet.executeQuery();\n            this.categoryFacet.scrollToTop();\n        }\n    };\n    CategoryFacetSearch.prototype.handleClickElsewhere = function (e) {\n        var closestContainer = Dom_1.$$(e.target).closest('.coveo-category-facet-search-container');\n        var isSelfContainer = this.container && closestContainer === this.container.el;\n        if (!closestContainer || !isSelfContainer) {\n            this.dismissSearchResults();\n        }\n    };\n    CategoryFacetSearch.prototype.buildfacetSearchPlaceholder = function () {\n        var placeholder = Dom_1.$$('div', { className: 'coveo-category-facet-search-placeholder' });\n        var icon = Dom_1.$$('div', { className: 'coveo-category-facet-search-icon' }, SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(icon.el, 'coveo-category-facet-search-icon-svg');\n        var label = Dom_1.$$('span', { className: 'coveo-category-facet-search-label' }, Strings_1.l('Search'));\n        placeholder.append(icon.el);\n        placeholder.append(label.el);\n        this.container.append(placeholder.el);\n    };\n    CategoryFacetSearch.prototype.getDisplayNewValuesFunction = function () {\n        var _this = this;\n        return function () { return __awaiter(_this, void 0, void 0, function () {\n            var categoryFacetValues;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.facetSearchElement.showFacetSearchWaitingAnimation();\n                        this.categoryFacet.logger.info('Triggering new Category Facet search');\n                        return [4 /*yield*/, this.categoryFacet.categoryFacetQueryController.searchFacetValues(this.facetSearchElement.input.value, this.numberOfValuesToFetch)];\n                    case 1:\n                        categoryFacetValues = _a.sent();\n                        this.logAnalyticsEvent();\n                        if (categoryFacetValues.length < this.numberOfValuesToFetch) {\n                            this.moreValuesToFetch = false;\n                        }\n                        if (categoryFacetValues.length == 0) {\n                            this.noFacetSearchResults();\n                            return [2 /*return*/];\n                        }\n                        this.removeNoResultsCssClasses();\n                        this.setFacetSearchResults(categoryFacetValues);\n                        if (this.shouldPositionSearchResults) {\n                            this.facetSearchElement.positionSearchResults();\n                        }\n                        this.facetSearchElement.hideFacetSearchWaitingAnimation();\n                        return [2 /*return*/];\n                }\n            });\n        }); };\n    };\n    CategoryFacetSearch.prototype.setFacetSearchResults = function (categoryFacetValues) {\n        Dom_1.$$(this.facetSearchElement.searchResults).empty();\n        this.currentlyDisplayedResults = underscore_1.pluck(categoryFacetValues, 'value');\n        for (var i = 0; i < categoryFacetValues.length; i++) {\n            var searchResult = this.buildFacetSearchValue(categoryFacetValues[i], i);\n            if (i == 0) {\n                this.facetSearchElement.setAsCurrentResult(searchResult);\n            }\n            this.facetSearchElement.appendToSearchResults(searchResult.el);\n        }\n        this.highlightCurrentQueryWithinSearchResults();\n        this.facetSearchElement.updateAriaLiveWithResults(this.facetSearchElement.input.value, this.currentlyDisplayedResults.length, this.moreValuesToFetch);\n    };\n    CategoryFacetSearch.prototype.getFormattedCount = function (count) {\n        return Globalize.format(count, 'n0');\n    };\n    CategoryFacetSearch.prototype.buildFacetSearchValue = function (categoryFacetValue, index) {\n        var _this = this;\n        var path = categoryFacetValue.value.split(this.categoryFacet.options.delimitingCharacter);\n        var pathParents = path.slice(0, -1).length != 0 ? path.slice(0, -1).join('/') + \"/\" : '';\n        var value = Dom_1.$$('span', { className: 'coveo-category-facet-search-value-caption' }, underscore_1.last(path));\n        var number = Dom_1.$$('span', { className: 'coveo-category-facet-search-value-number' }, this.getFormattedCount(categoryFacetValue.numberOfResults));\n        var pathParentsCaption = Dom_1.$$('span', { className: 'coveo-category-facet-search-path-parents' }, pathParents);\n        var pathToValueCaption = Dom_1.$$('span', { className: 'coveo-category-facet-search-path' }, pathParentsCaption);\n        var firstRow = Dom_1.$$('div', { className: 'coveo-category-facet-search-first-row' }, value, number);\n        var secondRow = Dom_1.$$('div', { className: 'coveo-category-facet-search-second-row' }, pathToValueCaption);\n        var item = Dom_1.$$('li', {\n            id: \"coveo-category-facet-search-suggestion-\" + index,\n            role: 'option',\n            ariaSelected: 'false',\n            className: 'coveo-category-facet-search-value',\n            title: path\n        }, firstRow, secondRow);\n        item.el.dataset.path = categoryFacetValue.value;\n        var countLabel = Strings_1.l('ResultCount', this.getFormattedCount(categoryFacetValue.numberOfResults), categoryFacetValue.numberOfResults);\n        var label = Strings_1.l('IncludeValueWithResultCount', underscore_1.last(path), countLabel);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(item)\n            .withSelectAction(function () {\n            _this.categoryFacet.changeActivePath(path);\n            _this.categoryFacet.scrollToTop();\n            _this.categoryFacet.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetSelect, path);\n            _this.categoryFacet.executeQuery();\n        })\n            .withLabel(label)\n            .build();\n        return item;\n    };\n    CategoryFacetSearch.prototype.noFacetSearchResults = function () {\n        this.facetSearchElement.hideFacetSearchWaitingAnimation();\n        this.facetSearchElement.emptyAndShowNoResults();\n        Dom_1.$$(this.facetSearchElement.search).addClass('coveo-facet-search-no-results');\n        Dom_1.$$(this.categoryFacet.element).addClass('coveo-no-results');\n    };\n    CategoryFacetSearch.prototype.removeNoResultsCssClasses = function () {\n        this.facetSearchElement.search && Dom_1.$$(this.facetSearchElement.search).removeClass('coveo-facet-search-no-results');\n        Dom_1.$$(this.categoryFacet.element).removeClass('coveo-no-results');\n    };\n    CategoryFacetSearch.prototype.highlightCurrentQueryWithinSearchResults = function () {\n        var regex = new RegExp(\"(\" + StringUtils_1.StringUtils.stringToRegex(this.facetSearchElement.input.value, true) + \")\", 'ig');\n        this.facetSearchElement.highlightCurrentQueryInSearchResults(regex);\n    };\n    CategoryFacetSearch.prototype.logAnalyticsEvent = function () {\n        this.categoryFacet.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetSearch, {\n            categoryFacetId: this.categoryFacet.options.id,\n            categoryFacetField: this.categoryFacet.options.field.toString(),\n            categoryFacetTitle: this.categoryFacet.options.title\n        }, this.categoryFacet.root);\n    };\n    Object.defineProperty(CategoryFacetSearch.prototype, \"shouldPositionSearchResults\", {\n        get: function () {\n            var searchResults = this.facetSearchElement.searchResults;\n            return searchResults && !searchResults.parentElement;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return CategoryFacetSearch;\n}());\nexports.CategoryFacetSearch = CategoryFacetSearch;\n\n\n/***/ }),\n\n/***/ 553:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 554:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar SVGIcons_1 = __webpack_require__(12);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar Strings_1 = __webpack_require__(6);\nvar underscore_1 = __webpack_require__(0);\nvar CategoryFacetBreadcrumb = /** @class */ (function () {\n    function CategoryFacetBreadcrumb(categoryFacet, onClickHandler, categoryValueDescriptor) {\n        this.categoryFacet = categoryFacet;\n        this.onClickHandler = onClickHandler;\n        this.categoryValueDescriptor = categoryValueDescriptor;\n    }\n    CategoryFacetBreadcrumb.prototype.build = function () {\n        var _this = this;\n        var clear = Dom_1.$$('span', {\n            className: 'coveo-facet-breadcrumb-clear'\n        }, SVGIcons_1.SVGIcons.icons.mainClear);\n        var pathToRender = underscore_1.without.apply(void 0, [this.categoryValueDescriptor.path].concat(this.categoryFacet.options.basePath));\n        var captionLabel = pathToRender.map(function (pathPart) { return _this.categoryFacet.getCaption(pathPart); }).join('/');\n        var breadcrumbTitle = Dom_1.$$('span', { className: 'coveo-category-facet-breadcrumb-title' }, this.categoryFacet.options.title + \":\");\n        var valuesContainer = Dom_1.$$('span', { className: 'coveo-category-facet-breadcrumb-values' }, captionLabel, clear);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(valuesContainer)\n            .withLabel(Strings_1.l('RemoveFilterOn', captionLabel))\n            .withSelectAction(this.onClickHandler)\n            .build();\n        var breadcrumb = Dom_1.$$('span', { className: 'coveo-category-facet-breadcrumb' }, breadcrumbTitle, valuesContainer);\n        return breadcrumb.el;\n    };\n    return CategoryFacetBreadcrumb;\n}());\nexports.CategoryFacetBreadcrumb = CategoryFacetBreadcrumb;\n\n\n/***/ }),\n\n/***/ 555:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar CategoryFacet_1 = __webpack_require__(91);\nvar QueryEvents_1 = __webpack_require__(11);\nvar underscore_1 = __webpack_require__(0);\nvar Logger_1 = __webpack_require__(9);\nvar PathMap = /** @class */ (function () {\n    function PathMap() {\n    }\n    return PathMap;\n}());\nvar CategoryFacetDebug = /** @class */ (function () {\n    function CategoryFacetDebug(categoryFacet) {\n        var _this = this;\n        this.categoryFacet = categoryFacet;\n        this.categoryFacet.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) { return _this.handleBuildingQuery(args); });\n        this.categoryFacet.bind.onRootElement(QueryEvents_1.QueryEvents.querySuccess, function (args) {\n            _this.handleQuerySuccess(args);\n        });\n    }\n    CategoryFacetDebug.prototype.handleBuildingQuery = function (args) {\n        var firstPositionInQuery = args.queryBuilder.groupByRequests.length;\n        if (this.categoryFacet.activePath.length == 0) {\n            this.positionInQuery = { start: firstPositionInQuery, end: firstPositionInQuery + 1 };\n            this.addGroupByForEmptyPath(args.queryBuilder);\n        }\n        else {\n            var path = this.categoryFacet.activePath;\n            this.positionInQuery = { start: firstPositionInQuery, end: firstPositionInQuery + path.length };\n            this.addGroupByForEachPathElement(args.queryBuilder, path);\n        }\n    };\n    CategoryFacetDebug.prototype.handleQuerySuccess = function (args) {\n        var _this = this;\n        args.results.groupByResults\n            .slice(this.positionInQuery.start, this.positionInQuery.end)\n            .forEach(function (groupByResult) { return CategoryFacetDebug.analyzeResults(groupByResult, _this.categoryFacet.options.delimitingCharacter); });\n    };\n    CategoryFacetDebug.prototype.addGroupByForEmptyPath = function (queryBuilder) {\n        queryBuilder.groupByRequests.push({\n            field: this.categoryFacet.options.field,\n            injectionDepth: this.categoryFacet.options.injectionDepth\n        });\n    };\n    CategoryFacetDebug.prototype.addGroupByForEachPathElement = function (queryBuilder, path) {\n        var _this = this;\n        path.forEach(function (pathElement) {\n            _this.categoryFacet.categoryFacetQueryController.addDebugGroupBy(queryBuilder, pathElement);\n        });\n    };\n    CategoryFacetDebug.analyzeResults = function (groupByResults, delimiter) {\n        var _this = this;\n        var treeRoot = new Map();\n        var orphans = [];\n        var paths = this.buildPathsFromGroupByValues(groupByResults.values, delimiter);\n        paths = underscore_1.sortBy(paths, function (value) { return value.length; });\n        paths.forEach(function (path) {\n            if (path.length == 1) {\n                _this.addFirstNodeToTree(treeRoot, path);\n            }\n            else {\n                var pathIsValid = true;\n                var parentsOnly = path.slice(0, -1);\n                var currentNode = treeRoot;\n                for (var _i = 0, parentsOnly_1 = parentsOnly; _i < parentsOnly_1.length; _i++) {\n                    var parent_1 = parentsOnly_1[_i];\n                    currentNode = currentNode.get(parent_1);\n                    if (!currentNode) {\n                        _this.processOrphan(orphans, path, delimiter);\n                        pathIsValid = false;\n                        break;\n                    }\n                }\n                if (pathIsValid) {\n                    _this.addValidNodeToTree(currentNode, path);\n                }\n            }\n        });\n        return orphans;\n    };\n    CategoryFacetDebug.buildPathsFromGroupByValues = function (values, delimiter) {\n        return underscore_1.chain(values)\n            .pluck('value')\n            .map(function (value) { return value.split(delimiter); })\n            .sortBy(function (value) { return value.length; })\n            .value();\n    };\n    CategoryFacetDebug.addFirstNodeToTree = function (treeRoot, path) {\n        treeRoot.set(path[0], new Map());\n    };\n    CategoryFacetDebug.addValidNodeToTree = function (node, path) {\n        node.set(path.slice(-1)[0], new Map());\n    };\n    CategoryFacetDebug.processOrphan = function (orphans, path, delimiter) {\n        var formattedOrphan = path.join(delimiter);\n        orphans.push(formattedOrphan);\n        this.logger.error(\"Value \" + formattedOrphan + \" has no parent.\");\n    };\n    CategoryFacetDebug.logger = new Logger_1.Logger(CategoryFacet_1.CategoryFacet);\n    return CategoryFacetDebug;\n}());\nexports.CategoryFacetDebug = CategoryFacetDebug;\n\n\n/***/ }),\n\n/***/ 556:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar CategoryFacet_1 = __webpack_require__(91);\nvar Dom_1 = __webpack_require__(1);\nvar Strings_1 = __webpack_require__(6);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(15);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar CategoryFacetHeader = /** @class */ (function () {\n    function CategoryFacetHeader(options) {\n        this.options = options;\n        this.element = document.createElement('div');\n        Dom_1.$$(this.element).addClass('coveo-facet-header');\n    }\n    CategoryFacetHeader.prototype.build = function () {\n        var waitElement = this.buildWaitAnimation();\n        var titleSection = Dom_1.$$('div', {\n            className: 'coveo-category-facet-title',\n            role: 'heading',\n            'aria-level': '2',\n            'aria-label': Strings_1.l('FacetTitle', this.options.title) + \".\"\n        }, this.options.title);\n        this.element = Dom_1.$$('div', { className: 'coveo-category-facet-header' }, titleSection).el;\n        Dom_1.$$(this.element).append(waitElement);\n        var eraserElement = this.buildEraser();\n        Dom_1.$$(this.element).append(eraserElement);\n        return this.element;\n    };\n    CategoryFacetHeader.prototype.buildWaitAnimation = function () {\n        var waitElement = Dom_1.$$('div', { className: CategoryFacet_1.CategoryFacet.WAIT_ELEMENT_CLASS }, SVGIcons_1.SVGIcons.icons.loading).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(waitElement, 'coveo-category-facet-header-wait-animation-svg');\n        waitElement.style.visibility = 'hidden';\n        return waitElement;\n    };\n    CategoryFacetHeader.prototype.buildEraser = function () {\n        var _this = this;\n        var eraserElement = Dom_1.$$('div', { className: 'coveo-category-facet-header-eraser coveo-facet-header-eraser' }, SVGIcons_1.SVGIcons.icons.mainClear)\n            .el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(eraserElement, 'coveo-facet-header-eraser-svg');\n        var onClearClick = function () {\n            _this.options.categoryFacet.reset();\n            _this.options.categoryFacet.scrollToTop();\n        };\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(eraserElement)\n            .withLabel(Strings_1.l('Clear', this.options.title))\n            .withClickAction(onClearClick)\n            .withEnterKeyboardAction(onClearClick)\n            .build();\n        return eraserElement;\n    };\n    return CategoryFacetHeader;\n}());\nexports.CategoryFacetHeader = CategoryFacetHeader;\n\n\n/***/ }),\n\n/***/ 557:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar underscore_1 = __webpack_require__(0);\nvar CategoryFacetValuesTree = /** @class */ (function () {\n    function CategoryFacetValuesTree() {\n        this.seenValues = [];\n    }\n    CategoryFacetValuesTree.prototype.getValueForLastPartInPath = function (path) {\n        var nullCategoryFacetValue = { value: '', numberOfResults: 0 };\n        var currentNode;\n        for (var _i = 0, path_1 = path; _i < path_1.length; _i++) {\n            var part = path_1[_i];\n            var nodesToSearch = currentNode ? currentNode.children : this.seenValues;\n            var node = this.findNodeWithValue(nodesToSearch, part);\n            if (!node) {\n                return nullCategoryFacetValue;\n            }\n            currentNode = node;\n        }\n        return currentNode ? currentNode.result : nullCategoryFacetValue;\n    };\n    CategoryFacetValuesTree.prototype.storeNewValues = function (categoryFacetResult) {\n        var _this = this;\n        var currentNodes = this.seenValues;\n        for (var _i = 0, _a = categoryFacetResult.parentValues; _i < _a.length; _i++) {\n            var parent_1 = _a[_i];\n            var node = this.findNodeWithValue(currentNodes, parent_1.value);\n            if (!node) {\n                var newNode = { result: parent_1, children: [] };\n                currentNodes.push(newNode);\n            }\n            currentNodes = this.findNodeWithValue(currentNodes, parent_1.value).children;\n        }\n        categoryFacetResult.values\n            .filter(function (result) { return !_this.findNodeWithValue(currentNodes, result.value); })\n            .forEach(function (result) { return currentNodes.push({ result: result, children: [] }); });\n    };\n    CategoryFacetValuesTree.prototype.findNodeWithValue = function (nodes, value) {\n        return underscore_1.find(nodes, function (node) { return node.result.value === value; });\n    };\n    return CategoryFacetValuesTree;\n}());\nexports.CategoryFacetValuesTree = CategoryFacetValuesTree;\n\n\n/***/ }),\n\n/***/ 558:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 559:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Assert_1 = __webpack_require__(5);\nvar Utils_1 = __webpack_require__(4);\nvar FacetValue_1 = __webpack_require__(114);\nvar _ = __webpack_require__(0);\nvar FacetValues = /** @class */ (function () {\n    function FacetValues(groupByResult) {\n        if (Utils_1.Utils.exists(groupByResult)) {\n            this.values = _.map(groupByResult.values, function (groupByValue) { return FacetValue_1.FacetValue.createFromGroupByValue(groupByValue); });\n        }\n        else {\n            this.values = [];\n        }\n    }\n    FacetValues.prototype.add = function (facetValue) {\n        Assert_1.Assert.exists(facetValue);\n        Assert_1.Assert.check(!this.contains(facetValue.value));\n        this.values.push(facetValue);\n    };\n    FacetValues.prototype.remove = function (value) {\n        Assert_1.Assert.isNonEmptyString(value);\n        value = value;\n        this.values = _.filter(this.values, function (elem) { return elem.value != value; });\n    };\n    FacetValues.prototype.size = function () {\n        return this.values.length;\n    };\n    FacetValues.prototype.isEmpty = function () {\n        return this.values.length == 0;\n    };\n    FacetValues.prototype.at = function (index) {\n        Assert_1.Assert.isLargerOrEqualsThan(0, index);\n        Assert_1.Assert.isSmallerThan(this.values.length, index);\n        return this.values[index];\n    };\n    FacetValues.prototype.get = function (value) {\n        return _.find(this.values, function (elem) { return elem.value.toLowerCase() == value.toLowerCase(); });\n    };\n    FacetValues.prototype.contains = function (value) {\n        return Utils_1.Utils.exists(this.get(value));\n    };\n    FacetValues.prototype.getAll = function () {\n        return this.values;\n    };\n    FacetValues.prototype.getSelected = function () {\n        return _.filter(this.values, function (value) { return value.selected; });\n    };\n    FacetValues.prototype.getExcluded = function () {\n        return _.filter(this.values, function (value) { return value.excluded; });\n    };\n    FacetValues.prototype.hasSelectedOrExcludedValues = function () {\n        return this.getSelected().length != 0 || this.getExcluded().length != 0;\n    };\n    FacetValues.prototype.hasSelectedAndExcludedValues = function () {\n        return this.getSelected().length != 0 && this.getExcluded().length != 0;\n    };\n    FacetValues.prototype.hasOnlyExcludedValues = function () {\n        return this.getSelected().length == 0 && this.getExcluded().length != 0;\n    };\n    FacetValues.prototype.hasOnlySelectedValues = function () {\n        return this.getSelected().length != 0 && this.getExcluded().length == 0;\n    };\n    FacetValues.prototype.reset = function () {\n        _.each(this.values, function (elem) { return elem.reset(); });\n    };\n    FacetValues.prototype.importActiveValuesFromOtherList = function (other) {\n        var _this = this;\n        Assert_1.Assert.exists(other);\n        _.each(other.getSelected(), function (otherValue) {\n            var myValue = _this.get(otherValue.value);\n            if (Utils_1.Utils.exists(myValue)) {\n                myValue.selected = true;\n            }\n            else {\n                _this.values.push(otherValue.cloneWithZeroOccurrences());\n            }\n        });\n        _.each(other.getExcluded(), function (otherValue) {\n            var myValue = _this.get(otherValue.value);\n            if (Utils_1.Utils.exists(myValue)) {\n                myValue.excluded = true;\n            }\n            else if (otherValue.occurrences != 0) {\n                var occurrences = otherValue.occurrences;\n                var clone = otherValue.cloneWithZeroOccurrences();\n                clone.occurrences = occurrences;\n                _this.values.push(clone);\n            }\n            else {\n                _this.values.push(otherValue.cloneWithZeroOccurrences());\n            }\n        });\n    };\n    FacetValues.prototype.updateCountsFromNewValues = function (newValues) {\n        Assert_1.Assert.exists(newValues);\n        this.values = _.map(this.values, function (myValue) {\n            var newValue = newValues.get(myValue.value);\n            if (Utils_1.Utils.exists(newValue)) {\n                myValue.updateCountsFromNewValue(newValue);\n                return myValue;\n            }\n            else if (myValue.occurrences == null) {\n                return myValue.cloneWithZeroOccurrences();\n            }\n            return myValue;\n        });\n    };\n    FacetValues.prototype.updateDeltaWithFilteredFacetValues = function (filtered, isMultiValueField) {\n        var _this = this;\n        Assert_1.Assert.exists(filtered);\n        _.each(this.values, function (unfilteredValue) {\n            var filteredValue = filtered.get(unfilteredValue.value);\n            unfilteredValue.waitingForDelta = false;\n            if (Utils_1.Utils.exists(filteredValue)) {\n                if (unfilteredValue.occurrences - filteredValue.occurrences > 0) {\n                    // When there are only exclusion in the facet, there should be no \"delta\"\n                    // The number of value for each facet will be what is selected, no addition.\n                    if (_this.hasOnlyExcludedValues()) {\n                        unfilteredValue.delta = null;\n                        unfilteredValue.occurrences = filteredValue.occurrences;\n                    }\n                    else {\n                        unfilteredValue.delta = unfilteredValue.occurrences - filteredValue.occurrences;\n                    }\n                }\n                else {\n                    unfilteredValue.delta = null;\n                }\n            }\n            else if (!unfilteredValue.selected && !unfilteredValue.excluded) {\n                if (isMultiValueField && filtered.values.length == 0) {\n                    unfilteredValue.delta = null;\n                    unfilteredValue.occurrences = 0;\n                }\n                else {\n                    unfilteredValue.delta = unfilteredValue.occurrences;\n                }\n            }\n        });\n    };\n    FacetValues.prototype.mergeWithUnfilteredFacetValues = function (unfiltered) {\n        var _this = this;\n        Assert_1.Assert.exists(unfiltered);\n        var values = [];\n        _.each(unfiltered.values, function (unfilteredValue) {\n            var filteredValue = _this.get(unfilteredValue.value);\n            if (Utils_1.Utils.exists(filteredValue)) {\n                if (filteredValue.occurrences == unfilteredValue.occurrences) {\n                    values.push(filteredValue);\n                }\n                else {\n                    values.push(unfilteredValue.cloneWithDelta(unfilteredValue.occurrences, unfilteredValue.occurrences - filteredValue.occurrences));\n                }\n            }\n            else {\n                values.push(unfilteredValue.cloneWithDelta(unfilteredValue.occurrences, unfilteredValue.occurrences));\n            }\n        });\n        var index = 0;\n        _.each(this.values, function (value) {\n            var unfilteredValue = unfiltered.get(value.value);\n            if (!Utils_1.Utils.exists(unfilteredValue)) {\n                if (value.selected || value.excluded) {\n                    values.splice(index, 0, value);\n                    index++;\n                }\n            }\n            else {\n                for (var i = 0; i < values.length; i++) {\n                    if (values[i].value == value.value) {\n                        index = i + 1;\n                        break;\n                    }\n                }\n            }\n        });\n        this.values = values;\n    };\n    FacetValues.prototype.sort = function (options) {\n        var facetValuesOrder = options.facetValuesOrder, numberOfValues = options.numberOfValues;\n        this.values = facetValuesOrder.reorderValuesIfUsingAlphabeticalSort(this.values);\n        this.sortValuesDependingOnStatus(numberOfValues);\n        this.values = facetValuesOrder.reorderValuesIfUsingCustomSort(this.values);\n    };\n    FacetValues.prototype.sortValuesDependingOnStatus = function (numOfDisplayedValues) {\n        this.values = _.sortBy(this.values, function (value) {\n            if (value.selected) {\n                return 1;\n            }\n            else if (value.excluded) {\n                return 3;\n            }\n            else {\n                return 2;\n            }\n        });\n        this.ensureExcludedValuesAreDisplayed(numOfDisplayedValues);\n    };\n    FacetValues.prototype.ensureExcludedValuesAreDisplayed = function (numOfDisplayedValues) {\n        if (numOfDisplayedValues != null && numOfDisplayedValues < this.values.length) {\n            var nbExclude = this.getExcluded().length;\n            var excludedValues = this.values.splice(this.values.length - nbExclude, nbExclude);\n            (_a = this.values).splice.apply(_a, [numOfDisplayedValues - nbExclude, 0].concat(excludedValues));\n        }\n        var _a;\n    };\n    return FacetValues;\n}());\nexports.FacetValues = FacetValues;\n\n\n/***/ }),\n\n/***/ 621:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"HierarchicalFacet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetValuesList_1 = __webpack_require__(487);\nvar _ = __webpack_require__(0);\nvar HierarchicalFacetValuesList = /** @class */ (function (_super) {\n    __extends(HierarchicalFacetValuesList, _super);\n    function HierarchicalFacetValuesList(facet, facetValueElementKlass) {\n        var _this = _super.call(this, facet, facetValueElementKlass) || this;\n        _this.facet = facet;\n        _this.facetValueElementKlass = facetValueElementKlass;\n        return _this;\n    }\n    HierarchicalFacetValuesList.prototype.sortFacetValues = function (hierarchyFacetValues) {\n        var _this = this;\n        if (hierarchyFacetValues === void 0) { hierarchyFacetValues = this.hierarchyFacetValues; }\n        if (!this.facet.shouldReshuffleFacetValuesClientSide) {\n            var sortArray = _.map(hierarchyFacetValues, function (hierarchy, idx) {\n                return {\n                    hierarchy: hierarchy,\n                    idx: idx\n                };\n            });\n            // If we exclude the top level, the alpha order is not respected (since it is done by the index, and the first level is omitted by client side code).\n            // Do the ordering client side, in the precise case where its alpha ordering and the starting level is not 0;\n            if (this.facet.options.levelStart != 0 &&\n                this.facet.options.sortCriteria &&\n                this.facet.options.sortCriteria.toLowerCase().indexOf('alpha') != -1) {\n                var reversed_1 = this.facet.options.sortCriteria.toLowerCase().indexOf('descending') != -1;\n                sortArray = sortArray.sort(function (first, second) {\n                    var firstInTopLevel = _.find(_this.facet.topLevelHierarchy, function (hierarchy) {\n                        return hierarchy.facetValue.value.toLowerCase() == first.hierarchy.value.toLowerCase();\n                    }) != null;\n                    var secondInTopLevel = _.find(_this.facet.topLevelHierarchy, function (hierarchy) {\n                        return hierarchy.facetValue.value.toLowerCase() == first.hierarchy.value.toLowerCase();\n                    }) != null;\n                    if (firstInTopLevel && secondInTopLevel) {\n                        var firstValue = _this.facet.getValueCaption(first.hierarchy);\n                        var secondValue = _this.facet.getValueCaption(second.hierarchy);\n                        var compared = firstValue.localeCompare(secondValue);\n                        return reversed_1 ? -1 * compared : compared;\n                    }\n                    return first.idx - second.idx;\n                });\n            }\n            // Normally facet values are sorted by selected first, then inactive, then excluded values.\n            // For hierarchical, we want selected first, then those that have childs selected, then normal sorting.\n            sortArray = sortArray.sort(function (first, second) {\n                if (first.hierarchy.selected === second.hierarchy.selected) {\n                    var firstFromHierarchy = _this.facet.getValueFromHierarchy(first.hierarchy);\n                    var secondFromHierarchy = _this.facet.getValueFromHierarchy(second.hierarchy);\n                    if (firstFromHierarchy.hasChildSelected === secondFromHierarchy.hasChildSelected) {\n                        return first.idx - second.idx;\n                    }\n                    else {\n                        return firstFromHierarchy.hasChildSelected ? -1 : 1;\n                    }\n                }\n                else {\n                    return first.hierarchy.selected ? -1 : 1;\n                }\n            });\n            return _.pluck(sortArray, 'hierarchy');\n        }\n        return hierarchyFacetValues;\n    };\n    HierarchicalFacetValuesList.prototype.getValuesToBuildWith = function () {\n        if (this.facet.shouldReshuffleFacetValuesClientSide) {\n            return this.hierarchyFacetValues;\n        }\n        else {\n            return this.sortFacetValues();\n        }\n    };\n    return HierarchicalFacetValuesList;\n}(FacetValuesList_1.FacetValuesList));\nexports.HierarchicalFacetValuesList = HierarchicalFacetValuesList;\n\n\n/***/ }),\n\n/***/ 622:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"../ui/HierarchicalFacet/HierarchicalFacet.ts\" />\n/// <reference path=\"./FacetQueryController.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetQueryController_1 = __webpack_require__(215);\nvar FacetUtils_1 = __webpack_require__(40);\nvar _ = __webpack_require__(0);\nvar HierarchicalFacetQueryController = /** @class */ (function (_super) {\n    __extends(HierarchicalFacetQueryController, _super);\n    function HierarchicalFacetQueryController(facet) {\n        var _this = _super.call(this, facet) || this;\n        _this.facet = facet;\n        return _this;\n    }\n    HierarchicalFacetQueryController.prototype.search = function (params, oldLength) {\n        var _this = this;\n        if (oldLength === void 0) { oldLength = params.nbResults; }\n        // Do a client side search, since HierarchicalFacet should normally have all value client side\n        var regex = FacetUtils_1.FacetUtils.getRegexToUseForFacetSearch(this.facet.facetSearch.getValueInInputForFacetSearch(), this.facet.options.facetSearchIgnoreAccents);\n        return new Promise(function (resolve) {\n            var match = _.chain(_this.facet.getAllValueHierarchy())\n                .toArray()\n                .filter(function (v) {\n                return (_this.facet.getValueCaption(v.facetValue).match(regex) != null &&\n                    !_.contains(_.map(params.alwaysExclude, function (toExclude) { return toExclude.toLowerCase(); }), v.facetValue.value.toLowerCase()));\n            })\n                .first(_this.facet.options.numberOfValuesInFacetSearch)\n                .value();\n            var facetValues = _.map(match, function (v) {\n                return v.facetValue;\n            });\n            resolve(facetValues);\n        });\n    };\n    HierarchicalFacetQueryController.prototype.getAllowedValuesFromSelected = function () {\n        return [];\n    };\n    return HierarchicalFacetQueryController;\n}(FacetQueryController_1.FacetQueryController));\nexports.HierarchicalFacetQueryController = HierarchicalFacetQueryController;\n\n\n/***/ }),\n\n/***/ 623:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"../Facet/Facet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetSearchValuesList_1 = __webpack_require__(486);\nvar HierarchicalFacetSearchValueElement_1 = __webpack_require__(624);\nvar HierarchicalFacetSearchValuesList = /** @class */ (function (_super) {\n    __extends(HierarchicalFacetSearchValuesList, _super);\n    function HierarchicalFacetSearchValuesList(facet) {\n        var _this = _super.call(this, facet, HierarchicalFacetSearchValueElement_1.HierarchicalFacetSearchValueElement) || this;\n        _this.facet = facet;\n        return _this;\n    }\n    return HierarchicalFacetSearchValuesList;\n}(FacetSearchValuesList_1.FacetSearchValuesList));\nexports.HierarchicalFacetSearchValuesList = HierarchicalFacetSearchValuesList;\n\n\n/***/ }),\n\n/***/ 624:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetValueElement_1 = __webpack_require__(128);\nvar HierarchicalFacetSearchValueElement = /** @class */ (function (_super) {\n    __extends(HierarchicalFacetSearchValueElement, _super);\n    function HierarchicalFacetSearchValueElement(facet, facetValue, keepDisplayedValueNextTime) {\n        var _this = _super.call(this, facet, facetValue, keepDisplayedValueNextTime) || this;\n        _this.facet = facet;\n        _this.facetValue = facetValue;\n        _this.keepDisplayedValueNextTime = keepDisplayedValueNextTime;\n        return _this;\n    }\n    HierarchicalFacetSearchValueElement.prototype._handleSelectValue = function (eventBindings) {\n        this.facet.open(this.facetValue);\n        _super.prototype.handleSelectValue.call(this, eventBindings);\n    };\n    HierarchicalFacetSearchValueElement.prototype._handleExcludeClick = function (eventBindings) {\n        this.facet.open(this.facetValue);\n        _super.prototype.handleExcludeClick.call(this, eventBindings);\n    };\n    return HierarchicalFacetSearchValueElement;\n}(FacetValueElement_1.FacetValueElement));\nexports.HierarchicalFacetSearchValueElement = HierarchicalFacetSearchValueElement;\n\n\n/***/ }),\n\n/***/ 625:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"HierarchicalFacet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetSearch_1 = __webpack_require__(485);\nvar FacetSearchParameters_1 = __webpack_require__(169);\nvar FacetValue_1 = __webpack_require__(114);\nvar Utils_1 = __webpack_require__(4);\nvar ExternalModulesShim_1 = __webpack_require__(25);\nvar _ = __webpack_require__(0);\nvar HierarchicalFacetSearch = /** @class */ (function (_super) {\n    __extends(HierarchicalFacetSearch, _super);\n    function HierarchicalFacetSearch(facet, facetSearchValuesListKlass, root) {\n        var _this = _super.call(this, facet, facetSearchValuesListKlass, root) || this;\n        _this.facet = facet;\n        _this.facetSearchValuesListKlass = facetSearchValuesListKlass;\n        return _this;\n    }\n    HierarchicalFacetSearch.prototype.buildParamsForExcludingCurrentlyDisplayedValues = function () {\n        var params = _super.prototype.buildParamsForExcludingCurrentlyDisplayedValues.call(this);\n        params.alwaysExclude = this.facet.getDisplayedValues();\n        if (this.facet.facetSearch.currentlyDisplayedResults) {\n            params.alwaysExclude = params.alwaysExclude.concat(this.facet.facetSearch.currentlyDisplayedResults);\n        }\n        return params;\n    };\n    HierarchicalFacetSearch.prototype.selectAllValuesMatchingSearch = function () {\n        var _this = this;\n        this.facet.showWaitingAnimation();\n        var searchParameters = new FacetSearchParameters_1.FacetSearchParameters(this.facet);\n        searchParameters.nbResults = this.facet.numberOfValues;\n        searchParameters.alwaysInclude = this.facet.getDisplayedValues();\n        searchParameters.setValueToSearch(this.getValueInInputForFacetSearch());\n        this.facet.facetQueryController.search(searchParameters).then(function (fieldValues) {\n            _this.dismissSearchResults();\n            ExternalModulesShim_1.ModalBox.close(true);\n            var facetValues = _this.getFacetValues(fieldValues);\n            _this.facet.processFacetSearchAllResultsSelected(facetValues);\n        });\n        this.dismissSearchResults();\n    };\n    HierarchicalFacetSearch.prototype.getFacetValues = function (fieldValues) {\n        var _this = this;\n        var values = [];\n        _.each(fieldValues, function (fieldValue) {\n            var hierarchy = _this.facet.getValueFromHierarchy(fieldValue.value);\n            values.push(_this.createFacetValuesFromHierarchy(hierarchy));\n        });\n        return _.flatten(values);\n    };\n    HierarchicalFacetSearch.prototype.createFacetValuesFromHierarchy = function (hierarchy) {\n        var _this = this;\n        var values = [];\n        var fieldValue = hierarchy.facetValue.value;\n        var facetValue = this.facet.values.get(fieldValue);\n        if (!Utils_1.Utils.exists(facetValue)) {\n            facetValue = FacetValue_1.FacetValue.create(fieldValue);\n        }\n        facetValue.selected = true;\n        facetValue.excluded = false;\n        values.push(facetValue);\n        var childs = hierarchy.childs;\n        _.each(childs, function (child) {\n            var childHierarchy = _this.facet.getValueFromHierarchy(child.facetValue.value);\n            values.push(_this.createFacetValuesFromHierarchy(childHierarchy));\n        });\n        return values;\n    };\n    return HierarchicalFacetSearch;\n}(FacetSearch_1.FacetSearch));\nexports.HierarchicalFacetSearch = HierarchicalFacetSearch;\n\n\n/***/ }),\n\n/***/ 626:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"HierarchicalFacet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar BreadcrumbValuesList_1 = __webpack_require__(484);\nvar HierarchicalBreadcrumbValueElement_1 = __webpack_require__(627);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar HierarchicalBreadcrumbValuesList = /** @class */ (function (_super) {\n    __extends(HierarchicalBreadcrumbValuesList, _super);\n    function HierarchicalBreadcrumbValuesList(facet, facetValues, valueHierarchy) {\n        var _this = _super.call(this, facet, facetValues, HierarchicalBreadcrumbValueElement_1.HierarchicalBreadcrumbValueElement) || this;\n        _this.facet = facet;\n        _this.facetValues = facetValues;\n        _this.valueHierarchy = valueHierarchy;\n        return _this;\n    }\n    HierarchicalBreadcrumbValuesList.prototype.buildAsString = function () {\n        this.build();\n        if (this.elem) {\n            var joined = this.facet.options.title + \": \" +\n                _.map(Dom_1.$$(this.elem).findAll('.coveo-facet-breadcrumb-value'), function (value) {\n                    _.each(Dom_1.$$(value).findAll('.coveo-hierarchical-breadcrumb-separator'), function (separator) {\n                        // small right black triangle\n                        Dom_1.$$(separator).text('\\u25B8');\n                    });\n                    return Dom_1.$$(value).text();\n                }).join(', ');\n            return joined;\n        }\n        return '';\n    };\n    return HierarchicalBreadcrumbValuesList;\n}(BreadcrumbValuesList_1.BreadcrumbValueList));\nexports.HierarchicalBreadcrumbValuesList = HierarchicalBreadcrumbValuesList;\n\n\n/***/ }),\n\n/***/ 627:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar BreadcrumbValueElement_1 = __webpack_require__(483);\nvar _ = __webpack_require__(0);\nvar HierarchicalBreadcrumbValueElement = /** @class */ (function (_super) {\n    __extends(HierarchicalBreadcrumbValueElement, _super);\n    function HierarchicalBreadcrumbValueElement(facet, facetValue) {\n        var _this = _super.call(this, facet, facetValue) || this;\n        _this.facet = facet;\n        _this.facetValue = facetValue;\n        return _this;\n    }\n    HierarchicalBreadcrumbValueElement.prototype.build = function () {\n        var build = _super.prototype.build.call(this);\n        build.addClass('coveo-hierarchical-facet-value');\n        var caption = build.find('.coveo-facet-breadcrumb-caption');\n        var values = this.facetValue.value.split(this.facet.options.delimitingCharacter);\n        values = _.map(values, function (v) {\n            return _.escape(v);\n        });\n        caption.innerHTML = values.join(\"<span class='coveo-hierarchical-breadcrumb-separator'></span>\");\n        return build;\n    };\n    return HierarchicalBreadcrumbValueElement;\n}(BreadcrumbValueElement_1.BreadcrumbValueElement));\nexports.HierarchicalBreadcrumbValueElement = HierarchicalBreadcrumbValueElement;\n\n\n/***/ }),\n\n/***/ 628:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"../HierarchicalFacet/HierarchicalFacet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar OmniboxValuesList_1 = __webpack_require__(489);\nvar OmniboxHierarchicalValueElement_1 = __webpack_require__(629);\nvar OmniboxHierarchicalValuesList = /** @class */ (function (_super) {\n    __extends(OmniboxHierarchicalValuesList, _super);\n    function OmniboxHierarchicalValuesList(facet, facetValues, omniboxObject) {\n        var _this = _super.call(this, facet, facetValues, omniboxObject, OmniboxHierarchicalValueElement_1.OmniboxHierarchicalValueElement) || this;\n        _this.facet = facet;\n        _this.facetValues = facetValues;\n        _this.omniboxObject = omniboxObject;\n        return _this;\n    }\n    return OmniboxHierarchicalValuesList;\n}(OmniboxValuesList_1.OmniboxValuesList));\nexports.OmniboxHierarchicalValuesList = OmniboxHierarchicalValuesList;\n\n\n/***/ }),\n\n/***/ 629:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"HierarchicalFacet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar OmniboxValueElement_1 = __webpack_require__(488);\nvar OmniboxHierarchicalValueElement = /** @class */ (function (_super) {\n    __extends(OmniboxHierarchicalValueElement, _super);\n    function OmniboxHierarchicalValueElement(facet, facetValue, eventArg) {\n        var _this = _super.call(this, facet, facetValue, eventArg) || this;\n        _this.facet = facet;\n        _this.facetValue = facetValue;\n        _this.eventArg = eventArg;\n        return _this;\n    }\n    OmniboxHierarchicalValueElement.prototype._handleSelectValue = function (eventBindings) {\n        this.facet.open(this.facetValue);\n        _super.prototype.handleSelectValue.call(this, eventBindings);\n    };\n    OmniboxHierarchicalValueElement.prototype._handleExcludeClick = function (eventBindings) {\n        this.facet.open(this.facetValue);\n        _super.prototype.handleExcludeClick.call(this, eventBindings);\n    };\n    return OmniboxHierarchicalValueElement;\n}(OmniboxValueElement_1.OmniboxValueElement));\nexports.OmniboxHierarchicalValueElement = OmniboxHierarchicalValueElement;\n\n\n/***/ }),\n\n/***/ 630:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/// <reference path=\"HierarchicalFacet.ts\" />\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetValueElement_1 = __webpack_require__(128);\nvar HierarchicalFacetValueElement = /** @class */ (function (_super) {\n    __extends(HierarchicalFacetValueElement, _super);\n    function HierarchicalFacetValueElement(facet, facetValue, keepDisplayedValueNextTime) {\n        var _this = _super.call(this, facet, facetValue, keepDisplayedValueNextTime) || this;\n        _this.facet = facet;\n        _this.facetValue = facetValue;\n        _this.keepDisplayedValueNextTime = keepDisplayedValueNextTime;\n        return _this;\n    }\n    return HierarchicalFacetValueElement;\n}(FacetValueElement_1.FacetValueElement));\nexports.HierarchicalFacetValueElement = HierarchicalFacetValueElement;\n\n\n/***/ }),\n\n/***/ 631:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 69:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(540);\n__webpack_require__(541);\nvar _ = __webpack_require__(0);\nvar FacetQueryController_1 = __webpack_require__(215);\nvar BreadcrumbEvents_1 = __webpack_require__(35);\nvar OmniboxEvents_1 = __webpack_require__(34);\nvar QueryEvents_1 = __webpack_require__(11);\nvar SearchAlertEvents_1 = __webpack_require__(84);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Assert_1 = __webpack_require__(5);\nvar Defer_1 = __webpack_require__(29);\nvar Model_1 = __webpack_require__(18);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar Strings_1 = __webpack_require__(6);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar ComponentsTypes_1 = __webpack_require__(47);\nvar DependsOnManager_1 = __webpack_require__(170);\nvar DeviceUtils_1 = __webpack_require__(24);\nvar Dom_1 = __webpack_require__(1);\nvar SVGDom_1 = __webpack_require__(15);\nvar SVGIcons_1 = __webpack_require__(12);\nvar Utils_1 = __webpack_require__(4);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\nvar ResponsiveFacetOptions_1 = __webpack_require__(82);\nvar ResponsiveFacets_1 = __webpack_require__(171);\nvar BreadcrumbValueElement_1 = __webpack_require__(483);\nvar BreadcrumbValuesList_1 = __webpack_require__(484);\nvar FacetHeader_1 = __webpack_require__(481);\nvar FacetSearch_1 = __webpack_require__(485);\nvar FacetSearchParameters_1 = __webpack_require__(169);\nvar FacetSearchValuesList_1 = __webpack_require__(486);\nvar FacetSettings_1 = __webpack_require__(479);\nvar FacetSort_1 = __webpack_require__(480);\nvar FacetUtils_1 = __webpack_require__(40);\nvar FacetValueElement_1 = __webpack_require__(128);\nvar FacetValue_1 = __webpack_require__(114);\nvar FacetValues_1 = __webpack_require__(559);\nvar FacetValuesList_1 = __webpack_require__(487);\nvar FacetValuesOrder_1 = __webpack_require__(475);\nvar OmniboxValueElement_1 = __webpack_require__(488);\nvar OmniboxValuesList_1 = __webpack_require__(489);\nvar ValueElementRenderer_1 = __webpack_require__(474);\n/**\n * The `Facet` component displays a *facet* of the results for the current query. A facet is a list of values for a\n * certain field occurring in the results, ordered using a configurable criteria (e.g., number of occurrences).\n *\n * The list of values is obtained using a [`GroupByRequest`]{@link IGroupByRequest} operation performed at the same time\n * as the main query.\n *\n * The `Facet` component allows the end user to drill down inside a result set by restricting the result to certain\n * field values. It also allows filtering out values from the facet itself, and can provide a search box to look for\n * specific values inside larger sets.\n *\n * This is probably the most complex component in the Coveo JavaScript Search Framework and as such, it allows for many\n * configuration options.\n *\n * See also the [`FacetRange`]{@link FacetRange} and [`TimespanFacet`]{@link TimespanFacet} components (which\n * extend this component), and the [`FacetSlider`]{@link FacetSlider} and [`CategoryFacet`]{@link CategoryFacet} components (which do not extend this\n * component, but are very similar).\n */\nvar Facet = /** @class */ (function (_super) {\n    __extends(Facet, _super);\n    /**\n     * Creates a new `Facet` component. Binds multiple query events as well.\n     * @param element The HTMLElement on which to instantiate the component.\n     * @param options The options for the `Facet` component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time).\n     * @param facetClassId The ID to use for this facet (as `Facet` inherited from by other component\n     * (e.g., [`FacetRange`]{@link FacetRange}). Default value is `Facet`.\n     */\n    function Facet(element, options, bindings, facetClassId) {\n        if (facetClassId === void 0) { facetClassId = Facet.ID; }\n        var _this = _super.call(this, element, facetClassId, bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.keepDisplayedValuesNextTime = false;\n        _this.values = new FacetValues_1.FacetValues();\n        _this.currentPage = 0;\n        _this.firstQuery = true;\n        _this.isFieldValueCompatible = true;\n        _this.canFetchMore = true;\n        _this.showingWaitAnimation = false;\n        _this.listenToQueryStateChange = true;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, Facet, options);\n        if (_this.options.valueCaption != null) {\n            _this.options.availableSorts = _.filter(_this.options.availableSorts, function (sort) { return !/^alpha.*$/.test(sort); });\n            _this.logger.warn(\"Because the \" + _this.options.field + \" facet is using value captions, alphabetical sorts are disabled.\");\n        }\n        ResponsiveFacets_1.ResponsiveFacets.init(_this.root, _this, _this.options);\n        // Serves as a way to render facet in the omnibox in the order in which they are instantiated\n        _this.omniboxZIndex = Facet.omniboxIndex;\n        Facet.omniboxIndex--;\n        _this.checkForComputedFieldAndSort();\n        _this.checkForValueCaptionType();\n        _this.checkForCustomSort();\n        _this.initDependsOnManager();\n        _this.initFacetQueryController();\n        _this.initQueryEvents();\n        _this.initQueryStateEvents();\n        _this.initComponentStateEvents();\n        _this.initOmniboxEvents();\n        _this.initBreadCrumbEvents();\n        _this.initSearchAlertEvents();\n        _this.updateNumberOfValues();\n        _this.bind.oneRootElement(QueryEvents_1.QueryEvents.querySuccess, function () {\n            _this.firstQuery = false;\n        });\n        return _this;\n    }\n    Facet.prototype.setExpandedFacetSearchAccessibilityAttributes = function (searchResultsElement) {\n        if (!this.searchContainer) {\n            return;\n        }\n        Assert_1.Assert.exists(searchResultsElement);\n        var accessibleElement = this.searchContainer.accessibleElement;\n        accessibleElement.setAttribute('aria-expanded', true.toString());\n    };\n    Facet.prototype.setCollapsedFacetSearchAccessibilityAttributes = function () {\n        if (!this.searchContainer) {\n            return;\n        }\n        this.searchContainer.accessibleElement.setAttribute('aria-expanded', false.toString());\n    };\n    Facet.prototype.isCurrentlyDisplayed = function () {\n        if (!Dom_1.$$(this.element).isVisible()) {\n            return false;\n        }\n        if (Dom_1.$$(this.element).hasClass('coveo-active')) {\n            return true;\n        }\n        if (Dom_1.$$(this.element).hasClass('coveo-facet-empty')) {\n            return false;\n        }\n        return true;\n    };\n    Facet.prototype.createDom = function () {\n        var _this = this;\n        this.initBottomAndTopSpacer();\n        this.buildFacetContent();\n        this.updateAppearanceDependingOnState();\n        // After the facet has been created (and before the first query is applied)\n        // Try to load a state from the setting, if it's available\n        // Execute only _.once (only the first query, or the first time the user switch to a tab that contains a newly set of active facet)\n        if (this.facetSettings && this.options.enableSettingsFacetState) {\n            var loadOnce = _.once(function () {\n                _this.facetSettings.loadSavedState.apply(_this.facetSettings);\n            });\n            this.bind.onRootElement(QueryEvents_1.QueryEvents.newQuery, loadOnce);\n        }\n    };\n    /**\n     * Selects a single value.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param value Can be a [`FacetValue`]{@link FacetValue} or a string (e.g., `selectValue('foobar')` or\n     * `selectValue(new FacetValue('foobar'))`).\n     */\n    Facet.prototype.selectValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.ensureDom();\n        this.logger.info('Selecting facet value', this.facetValuesList.select(value));\n        this.facetValueHasChanged();\n    };\n    /**\n     * Selects multiple values.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n     */\n    Facet.prototype.selectMultipleValues = function (values) {\n        var _this = this;\n        Assert_1.Assert.exists(values);\n        this.ensureDom();\n        _.each(values, function (value) {\n            _this.logger.info('Selecting facet value', _this.facetValuesList.select(value));\n        });\n        this.facetValueHasChanged();\n    };\n    /**\n     * Deselects a single value.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param value Can be a [`FacetValue`]{@link FacetValue} or a string (e.g., `deselectValue('foobar')` or\n     * `deselectValue(new FacetValue('foobar'))`).\n     */\n    Facet.prototype.deselectValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.ensureDom();\n        this.logger.info('Deselecting facet value', this.facetValuesList.unselect(value));\n        this.facetValueHasChanged();\n    };\n    /**\n     * Deselects multiple values.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n     */\n    Facet.prototype.deselectMultipleValues = function (values) {\n        var _this = this;\n        Assert_1.Assert.exists(values);\n        this.ensureDom();\n        _.each(values, function (value) {\n            _this.logger.info('Deselecting facet value', _this.facetValuesList.unselect(value));\n        });\n        this.facetValueHasChanged();\n    };\n    /**\n     * Excludes a single value.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param value Can be a [`FacetValue`]{@link FacetValue} or a string (e.g., `excludeValue('foobar')` or\n     * `excludeValue(new FacetValue('foobar'))`).\n     */\n    Facet.prototype.excludeValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.ensureDom();\n        this.logger.info('Excluding facet value', this.facetValuesList.exclude(value));\n        this.facetValueHasChanged();\n    };\n    /**\n     * Excludes multiple values.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n     */\n    Facet.prototype.excludeMultipleValues = function (values) {\n        var _this = this;\n        Assert_1.Assert.exists(values);\n        this.ensureDom();\n        _.each(values, function (value) {\n            _this.logger.info('Excluding facet value', _this.facetValuesList.exclude(value));\n        });\n        this.facetValueHasChanged();\n    };\n    /**\n     * Unexcludes a single value.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param value Can be a [`FacetValue`]{@link FacetValue} or a string.\n     */\n    Facet.prototype.unexcludeValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.ensureDom();\n        this.logger.info('Unexcluding facet value', this.facetValuesList.unExclude(value));\n        this.facetValueHasChanged();\n    };\n    /**\n     * Unexcludes multiple values.\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n     */\n    Facet.prototype.unexcludeMultipleValues = function (values) {\n        var _this = this;\n        Assert_1.Assert.exists(values);\n        this.ensureDom();\n        _.each(values, function (value) {\n            _this.logger.info('Unexcluding facet value', _this.facetValuesList.unExclude(value));\n        });\n        this.facetValueHasChanged();\n    };\n    /**\n     * Toggles the selection state of a single value (selects the value if it is not already selected; un-selects the\n     * value if it is already selected).\n     *\n     * Does not trigger a query automatically.\n     * @param value Can be a [`FacetValue`]{@link FacetValue} or a string.\n     */\n    Facet.prototype.toggleSelectValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.ensureDom();\n        this.logger.info('Toggle select facet value', this.facetValuesList.toggleSelect(value));\n        this.facetValueHasChanged();\n    };\n    /**\n     * Toggles the exclusion state of a single value (excludes the value if it is not already excluded; un-excludes the\n     * value if it is already excluded).\n     *\n     * Does not trigger a query automatically.\n     *\n     * @param value Can be a [`FacetValue`]{@link FacetValue} or a string.\n     */\n    Facet.prototype.toggleExcludeValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.ensureDom();\n        this.logger.info('Toggle exclude facet value', this.facetValuesList.toggleExclude(value));\n        this.facetValueHasChanged();\n    };\n    /**\n     * Returns the currently displayed values as an array of strings.\n     *\n     * @returns {any[]} The currently displayed values.\n     */\n    Facet.prototype.getDisplayedValues = function () {\n        return _.pluck(this.getDisplayedFacetValues(), 'value');\n    };\n    /**\n     * Returns the currently displayed values as an array of [`FacetValue`]{@link FacetValue}.\n     *\n     * @returns {T[]} The currently displayed values.\n     */\n    Facet.prototype.getDisplayedFacetValues = function () {\n        this.ensureDom();\n        var displayed = this.facetValuesList.getAllCurrentlyDisplayed();\n        return _.map(displayed, function (value) {\n            return value.facetValue;\n        });\n    };\n    /**\n     * Returns the currently selected values as an array of strings.\n     * @returns {string[]} The currently selected values.\n     */\n    Facet.prototype.getSelectedValues = function () {\n        this.ensureDom();\n        return _.map(this.values.getSelected(), function (value) { return value.value; });\n    };\n    /**\n     * Determines whether the specified value is selected in the facet.\n     * @param value The name of the facet value to verify.\n     */\n    Facet.prototype.hasSelectedValue = function (value) {\n        var facetValue = this.values.get(value);\n        return facetValue && facetValue.selected;\n    };\n    /**\n     * Returns the currently excluded values as an array of strings.\n     * @returns {string[]} The currently excluded values.\n     */\n    Facet.prototype.getExcludedValues = function () {\n        this.ensureDom();\n        return _.map(this.values.getExcluded(), function (value) { return value.value; });\n    };\n    /**\n     * Resets the facet by un-selecting all values, un-excluding all values, and redrawing the facet.\n     */\n    Facet.prototype.reset = function () {\n        this.ensureDom();\n        this.values.reset();\n        this.rebuildValueElements();\n        this.updateAppearanceDependingOnState();\n        this.updateQueryStateModel();\n    };\n    /**\n     * Switches the facet to `AND` mode.\n     *\n     * See the [`useAnd`]{@link Facet.options.useAnd}, and\n     * [`enableTogglingOperator`]{@link Facet.options.enableTogglingOperator} options.\n     */\n    Facet.prototype.switchToAnd = function () {\n        this.ensureDom();\n        this.logger.info('Switching to AND');\n        this.facetHeader.switchToAnd();\n    };\n    /**\n     * Switches the facet to `OR` mode.\n     *\n     * See the [`useAnd`]{@link Facet.options.useAnd}, and\n     * [`enableTogglingOperator`]{@link Facet.options.enableTogglingOperator} options.\n     */\n    Facet.prototype.switchToOr = function () {\n        this.ensureDom();\n        this.logger.info('Switching to OR');\n        this.facetHeader.switchToOr();\n    };\n    /**\n     * Returns the endpoint for the facet.\n     * @returns {ISearchEndpoint} The endpoint for the facet.\n     */\n    Facet.prototype.getEndpoint = function () {\n        return this.queryController.getEndpoint();\n    };\n    /**\n     * Changes the sort parameter for the facet.\n     *\n     * See {@link Facet.options.availableSorts} for the list of possible values.\n     *\n     * Also triggers a new query.\n     *\n     * @param criteria The new sort parameter for the facet.\n     */\n    Facet.prototype.updateSort = function (criteria) {\n        this.ensureDom();\n        if (this.options.sortCriteria != criteria) {\n            this.options.sortCriteria = criteria;\n            this.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.facetUpdateSort, {\n                criteria: criteria,\n                facetId: this.options.id,\n                facetField: this.options.field.toString(),\n                facetTitle: this.options.title\n            }, this.element);\n            this.triggerNewQuery();\n        }\n    };\n    Facet.prototype.unfadeInactiveValuesInMainList = function () {\n        Dom_1.$$(this.element).removeClass('coveo-facet-fade');\n    };\n    Facet.prototype.fadeInactiveValuesInMainList = function (delay) {\n        Dom_1.$$(this.element).addClass('coveo-facet-fade');\n    };\n    /**\n     * Shows a waiting animation in the facet header (a spinner).\n     */\n    Facet.prototype.showWaitingAnimation = function () {\n        this.ensureDom();\n        if (!this.showingWaitAnimation) {\n            Dom_1.$$(this.headerElement).find('.coveo-facet-header-wait-animation').style.visibility = 'visible';\n            this.showingWaitAnimation = true;\n        }\n    };\n    /**\n     * Hides the waiting animation in the facet header.\n     */\n    Facet.prototype.hideWaitingAnimation = function () {\n        this.ensureDom();\n        if (this.showingWaitAnimation) {\n            Dom_1.$$(this.headerElement).find('.coveo-facet-header-wait-animation').style.visibility = 'hidden';\n            this.showingWaitAnimation = false;\n        }\n    };\n    Facet.prototype.processFacetSearchAllResultsSelected = function (facetValues) {\n        var _this = this;\n        var valuesForAnalytics = [];\n        _.each(facetValues, function (facetValue) {\n            _this.ensureFacetValueIsInList(facetValue);\n            valuesForAnalytics.push(facetValue.value);\n        });\n        // Calculate the correct number of values from the current selected/excluded values (those will stay no matter what next rendering)\n        // add the new one that will be selected (and are not already selected in the facet)\n        // The minimum number of values is the number of values set in the option\n        var valuesThatStays = this.values.getSelected().concat(this.values.getExcluded());\n        this.numberOfValues = valuesThatStays.length + _.difference(valuesThatStays, facetValues).length;\n        this.numberOfValues = Math.max(this.numberOfValues, this.options.numberOfValues);\n        this.updateQueryStateModel();\n        this.triggerNewQuery(function () {\n            return _this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.facetSelectAll, {\n                facetId: _this.options.id,\n                facetField: _this.options.field.toString(),\n                facetTitle: _this.options.title\n            });\n        });\n    };\n    Facet.prototype.pinFacetPosition = function () {\n        if (this.options.preservePosition) {\n            this.pinnedViewportPosition = this.element.getBoundingClientRect().top;\n        }\n    };\n    /**\n     * Returns the configured caption for the given [`FacetValue`]{@link FacetValue}.\n     *\n     * @param facetValue The `FacetValue` whose caption the method should return.\n     */\n    Facet.prototype.getValueCaption = function (facetValue) {\n        Assert_1.Assert.exists(facetValue);\n        var lookupValue = typeof facetValue === 'string' ? facetValue : facetValue.lookupValue || facetValue.value;\n        var ret = FacetUtils_1.FacetUtils.tryToGetTranslatedCaption(this.options.field, lookupValue);\n        if (Utils_1.Utils.exists(this.options.valueCaption)) {\n            if (typeof this.options.valueCaption == 'object') {\n                ret = this.options.valueCaption[lookupValue] || ret;\n            }\n            if (typeof this.options.valueCaption == 'function') {\n                var fv = facetValue instanceof FacetValue_1.FacetValue ? facetValue : FacetValue_1.FacetValue.create(facetValue);\n                var valueFromList = this.facetValuesList.get(fv).facetValue;\n                ret = this.options.valueCaption.call(this, valueFromList);\n            }\n        }\n        return ret;\n    };\n    /**\n     * Returns the configured caption for a desired facet value.\n     *\n     * @param value The string facet value whose caption the method should return.\n     */\n    Facet.prototype.getCaptionForStringValue = function (value) {\n        Assert_1.Assert.exists(value);\n        return this.getValueCaption(value);\n    };\n    /**\n     * Shows the next page of results in the facet.\n     *\n     * See the [`enableMoreLess`]{@link Facet.options.enableMoreLess}, and [`pageSize`]{@link Facet.options.pageSize}\n     * options.\n     *\n     * Triggers a query if needed, or displays the already available values.\n     */\n    Facet.prototype.showMore = function () {\n        this.currentPage = Math.floor((this.numberOfValues - this.options.numberOfValues) / this.options.pageSize) + 1;\n        this.updateNumberOfValues();\n        if (this.nbAvailableValues >= this.numberOfValues || !this.canFetchMore) {\n            this.rebuildValueElements();\n        }\n        else {\n            this.triggerMoreQuery();\n        }\n    };\n    /**\n     * Shows less elements in the Facet (up to the original number of values).\n     *\n     * See the [`enableMoreLess`]{@link Facet.options.enableMoreLess}, and\n     * [`numberOfValues`]{@link Facet.options.numberOfValues} options.\n     */\n    Facet.prototype.showLess = function () {\n        Dom_1.$$(this.lessElement).removeClass('coveo-active');\n        this.currentPage = 0;\n        this.updateNumberOfValues();\n        Dom_1.$$(this.moreElement).addClass('coveo-active');\n        this.values.sortValuesDependingOnStatus(this.numberOfValues);\n        this.rebuildValueElements();\n        this.logAnalyticsFacetShowMoreLess(AnalyticsActionListMeta_1.analyticsActionCauseList.facetShowLess);\n    };\n    /**\n     * Collapses the facet.\n     */\n    Facet.prototype.collapse = function () {\n        this.ensureDom();\n        if (this.facetHeader) {\n            this.facetHeader.collapseFacet();\n        }\n    };\n    /**\n     * Expands the facet.\n     */\n    Facet.prototype.expand = function () {\n        this.ensureDom();\n        if (this.facetHeader) {\n            this.facetHeader.expandFacet();\n        }\n    };\n    Facet.prototype.triggerNewQuery = function (beforeExecuteQuery) {\n        if (!beforeExecuteQuery) {\n            this.queryController.executeQuery({ ignoreWarningSearchEvent: true });\n        }\n        else {\n            this.queryController.executeQuery({ beforeExecuteQuery: beforeExecuteQuery });\n        }\n        this.showWaitingAnimation();\n    };\n    Facet.prototype.handleDeferredQuerySuccess = function (data) {\n        Assert_1.Assert.exists(data);\n        this.unfadeInactiveValuesInMainList();\n        this.hideWaitingAnimation();\n        var groupByResult = data.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];\n        this.facetQueryController.lastGroupByResult = groupByResult;\n        // Two corner case to handle regarding the \"sticky\" aspect of facets :\n        // 1) The group by is empty (so there is nothing to \"sticky\")\n        // 2) There is only one value displayed currently, so there is nothing to \"sticky\" either\n        if (!groupByResult) {\n            this.keepDisplayedValuesNextTime = false;\n        }\n        if (this.values.getAll().length == 1) {\n            this.keepDisplayedValuesNextTime = false;\n        }\n        this.processNewGroupByResults(groupByResult);\n    };\n    Facet.prototype.handleQueryError = function () {\n        this.updateValues(new FacetValues_1.FacetValues());\n        this.updateAppearanceDependingOnState();\n        this.hideWaitingAnimation();\n    };\n    Facet.prototype.handlePopulateBreadcrumb = function (args) {\n        Assert_1.Assert.exists(args);\n        if (this.values.hasSelectedOrExcludedValues()) {\n            var element = new BreadcrumbValuesList_1.BreadcrumbValueList(this, this.values.getSelected().concat(this.values.getExcluded()), BreadcrumbValueElement_1.BreadcrumbValueElement).build();\n            args.breadcrumbs.push({ element: element });\n        }\n    };\n    Facet.prototype.handlePopulateSearchAlerts = function (args) {\n        if (this.values.hasSelectedOrExcludedValues()) {\n            var excludedValues = this.values.getExcluded();\n            var selectedValues = this.values.getSelected();\n            if (!_.isEmpty(excludedValues)) {\n                args.text.push({\n                    value: new BreadcrumbValuesList_1.BreadcrumbValueList(this, excludedValues, BreadcrumbValueElement_1.BreadcrumbValueElement).buildAsString(),\n                    lineThrough: true\n                });\n            }\n            if (!_.isEmpty(selectedValues)) {\n                args.text.push({\n                    value: new BreadcrumbValuesList_1.BreadcrumbValueList(this, selectedValues, BreadcrumbValueElement_1.BreadcrumbValueElement).buildAsString(),\n                    lineThrough: false\n                });\n            }\n        }\n    };\n    Facet.prototype.initFacetQueryController = function () {\n        this.facetQueryController = new FacetQueryController_1.FacetQueryController(this);\n    };\n    Facet.prototype.initFacetValuesList = function () {\n        this.facetValuesList = new FacetValuesList_1.FacetValuesList(this, FacetValueElement_1.FacetValueElement);\n        this.element.appendChild(this.facetValuesList.build());\n    };\n    Facet.prototype.initFacetSearch = function () {\n        this.facetSearch = new FacetSearch_1.FacetSearch(this, FacetSearchValuesList_1.FacetSearchValuesList, this.root);\n        this.element.appendChild(this.facetSearch.build());\n    };\n    Facet.prototype.facetValueHasChanged = function () {\n        var _this = this;\n        this.updateQueryStateModel();\n        this.rebuildValueElements();\n        Defer_1.Defer.defer(function () {\n            _this.updateAppearanceDependingOnState();\n        });\n    };\n    Facet.prototype.updateAppearanceDependingOnState = function () {\n        Dom_1.$$(this.element).toggleClass('coveo-active', this.values.hasSelectedOrExcludedValues());\n        Dom_1.$$(this.element).toggleClass('coveo-facet-empty', !this.isAnyValueCurrentlyDisplayed());\n        Dom_1.$$(this.facetHeader.eraserElement).toggleClass('coveo-facet-header-eraser-visible', this.values.hasSelectedOrExcludedValues());\n    };\n    Facet.prototype.initQueryEvents = function () {\n        var _this = this;\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.duringQuery, function () { return _this.handleDuringQuery(); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) { return _this.handleBuildingQuery(args); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.doneBuildingQuery, function (args) { return _this.handleDoneBuildingQuery(args); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function (args) { return _this.handleDeferredQuerySuccess(args); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.queryError, function () { return _this.handleQueryError(); });\n    };\n    Facet.prototype.initQueryStateEvents = function () {\n        var _this = this;\n        this.includedAttributeId = QueryStateModel_1.QueryStateModel.getFacetId(this.options.id);\n        this.excludedAttributeId = QueryStateModel_1.QueryStateModel.getFacetId(this.options.id, false);\n        this.operatorAttributeId = QueryStateModel_1.QueryStateModel.getFacetOperator(this.options.id);\n        this.lookupValueAttributeId = QueryStateModel_1.QueryStateModel.getFacetLookupValue(this.options.id);\n        this.queryStateModel.registerNewAttribute(this.includedAttributeId, []);\n        this.queryStateModel.registerNewAttribute(this.excludedAttributeId, []);\n        this.queryStateModel.registerNewAttribute(this.operatorAttributeId, '');\n        this.queryStateModel.registerNewAttribute(this.lookupValueAttributeId, {});\n        this.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE, undefined, function (args) { return _this.handleQueryStateChanged(args); });\n    };\n    Facet.prototype.initComponentStateEvents = function () {\n        this.componentStateId = QueryStateModel_1.QueryStateModel.getFacetId(this.options.id);\n        this.componentStateModel.registerComponent(this.componentStateId, this);\n    };\n    Facet.prototype.initOmniboxEvents = function () {\n        var _this = this;\n        if (this.options.includeInOmnibox) {\n            this.bind.onRootElement(OmniboxEvents_1.OmniboxEvents.populateOmnibox, function (args) { return _this.handlePopulateOmnibox(args); });\n        }\n    };\n    Facet.prototype.initBreadCrumbEvents = function () {\n        var _this = this;\n        if (this.options.includeInBreadcrumb) {\n            this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.populateBreadcrumb, function (args) {\n                return _this.handlePopulateBreadcrumb(args);\n            });\n            this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.clearBreadcrumb, function (args) { return _this.handleClearBreadcrumb(); });\n        }\n    };\n    Facet.prototype.initSearchAlertEvents = function () {\n        var _this = this;\n        this.bind.onRootElement(SearchAlertEvents_1.SearchAlertsEvents.searchAlertsPopulateMessage, function (args) {\n            return _this.handlePopulateSearchAlerts(args);\n        });\n    };\n    Facet.prototype.handleOmniboxWithStaticValue = function (eventArg) {\n        var _this = this;\n        var regex = new RegExp('^' + eventArg.completeQueryExpression.regex.source, 'i');\n        var match = _.first(_.filter(this.getDisplayedValues(), function (displayedValue) {\n            var value = _this.getValueCaption(_this.facetValuesList.get(displayedValue).facetValue);\n            return regex.test(value);\n        }), this.options.numberOfValuesInOmnibox);\n        var facetValues = _.map(match, function (gotAMatch) {\n            return _this.facetValuesList.get(gotAMatch).facetValue;\n        });\n        var element = new OmniboxValuesList_1.OmniboxValuesList(this, facetValues, eventArg, OmniboxValueElement_1.OmniboxValueElement).build();\n        eventArg.rows.push({ element: element, zIndex: this.omniboxZIndex });\n    };\n    Facet.prototype.processNewGroupByResults = function (groupByResult) {\n        this.logger.trace('Displaying group by results', groupByResult);\n        if (groupByResult != undefined && groupByResult.values != undefined) {\n            this.nbAvailableValues = groupByResult.values.length;\n        }\n        var newFacetValues = new FacetValues_1.FacetValues(groupByResult);\n        this.updateValues(newFacetValues);\n        this.canFetchMore = this.numberOfValues < this.nbAvailableValues;\n        if (this.values.hasSelectedOrExcludedValues() && !this.options.useAnd && this.options.isMultiValueField) {\n            this.triggerUpdateDeltaQuery(_.filter(this.values.getAll(), function (facetValue) {\n                return !facetValue.selected && !facetValue.excluded;\n            }));\n        }\n        else if (this.values.getSelected().length > 0 && !this.options.useAnd) {\n            this.values.updateDeltaWithFilteredFacetValues(new FacetValues_1.FacetValues(), this.options.isMultiValueField);\n        }\n        if (!this.values.hasSelectedOrExcludedValues() || this.options.useAnd || !this.options.isMultiValueField) {\n            this.rebuildValueElements();\n            this.updateAppearanceDependingOnState();\n            this.ensurePinnedFacetHasntMoved();\n        }\n        this.keepDisplayedValuesNextTime = false;\n    };\n    Facet.prototype.updateQueryStateModel = function () {\n        this.listenToQueryStateChange = false;\n        this.updateExcludedQueryStateModel();\n        this.updateIncludedQueryStateModel();\n        this.facetHeader.updateOperatorQueryStateModel();\n        this.updateLookupValueQueryStateModel();\n        this.listenToQueryStateChange = true;\n    };\n    Facet.prototype.rebuildValueElements = function () {\n        this.updateNumberOfValues();\n        this.facetValuesList.rebuild(this.numberOfValues);\n        if (this.shouldRenderMoreLess()) {\n            this.updateMoreLess();\n            if (this.shouldRenderFacetSearch()) {\n                this.updateSearchElement(this.nbAvailableValues > this.numberOfValues);\n            }\n        }\n        else if (this.shouldRenderFacetSearch()) {\n            this.updateSearchElement();\n        }\n    };\n    Facet.prototype.updateSearchElement = function (moreValuesAvailable) {\n        var _this = this;\n        if (moreValuesAvailable === void 0) { moreValuesAvailable = true; }\n        if (!moreValuesAvailable) {\n            return;\n        }\n        var renderer = new ValueElementRenderer_1.ValueElementRenderer(this, FacetValue_1.FacetValue.create(Strings_1.l('Search')));\n        this.searchContainer = renderer.build().withNo([renderer.excludeIcon, renderer.icon]);\n        Dom_1.$$(this.searchContainer.listItem).addClass('coveo-facet-search-button');\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(this.searchContainer.accessibleElement)\n            .withLabel(Strings_1.l('SearchFacetResults', this.options.title))\n            .withEnterKeyboardAction(function (e) { return _this.toggleSearchMenu(e); })\n            .build();\n        this.setCollapsedFacetSearchAccessibilityAttributes();\n        // Mobile do not like label. Use click event\n        if (DeviceUtils_1.DeviceUtils.isMobileDevice()) {\n            Dom_1.$$(this.searchContainer.label).on('click', function (e) { return _this.toggleSearchMenu(e); });\n        }\n        Dom_1.$$(this.searchContainer.checkbox).on('change', function () {\n            Dom_1.$$(_this.element).addClass('coveo-facet-searching');\n            _this.facetSearch.focus();\n        });\n        this.facetValuesList.valueContainer.appendChild(this.searchContainer.listItem);\n    };\n    Facet.prototype.updateMoreLess = function (lessElementIsShown, moreValuesAvailable) {\n        if (lessElementIsShown === void 0) { lessElementIsShown = this.getMinimumNumberOfValuesToDisplay() < this.numberOfValues; }\n        if (moreValuesAvailable === void 0) { moreValuesAvailable = this.nbAvailableValues > this.numberOfValues; }\n        if (lessElementIsShown) {\n            Dom_1.$$(this.lessElement).addClass('coveo-active');\n        }\n        else {\n            Dom_1.$$(this.lessElement).removeClass('coveo-active');\n        }\n        if (moreValuesAvailable) {\n            Dom_1.$$(this.moreElement).addClass('coveo-active');\n        }\n        else {\n            Dom_1.$$(this.moreElement).removeClass('coveo-active');\n        }\n        if (lessElementIsShown || moreValuesAvailable) {\n            Dom_1.$$(this.footerElement).removeClass('coveo-facet-empty');\n        }\n        else {\n            Dom_1.$$(this.footerElement).addClass('coveo-facet-empty');\n        }\n    };\n    Facet.prototype.handleClickMore = function () {\n        this.showMore();\n    };\n    Facet.prototype.handleClickLess = function () {\n        this.showLess();\n    };\n    Facet.prototype.toggleSearchMenu = function (e) {\n        var searchButton = this.searchContainer;\n        if (searchButton.checkbox.getAttribute('checked')) {\n            searchButton.checkbox.removeAttribute('checked');\n        }\n        else {\n            searchButton.checkbox.setAttribute('checked', 'checked');\n        }\n        Dom_1.$$(searchButton.checkbox).trigger('change');\n        e.stopPropagation();\n        e.preventDefault();\n    };\n    Facet.prototype.checkForComputedFieldAndSort = function () {\n        if (this.options.sortCriteria.toLowerCase().indexOf('computedfield') != -1 && Utils_1.Utils.isNullOrUndefined(this.options.computedField)) {\n            this.logger.warn('Sort criteria is specified as ComputedField, but the facet uses no computed field. Facet will always be empty !', this);\n        }\n    };\n    Facet.prototype.checkForValueCaptionType = function () {\n        if (this.options.valueCaption && typeof this.options.valueCaption == 'function') {\n            this.options.enableFacetSearch = false;\n            this.options.includeInOmnibox = false;\n            this.logger.warn('Using a function as valueCaption is now deprecated. Use a json key value pair instead. Facet search and omnibox has been disabled for this facet', this);\n        }\n    };\n    Facet.prototype.checkForCustomSort = function () {\n        if (this.options.customSort != undefined && !_.contains(this.options.availableSorts, 'custom')) {\n            this.options.availableSorts.unshift('custom');\n        }\n        if (this.options.availableSorts[0] == 'custom') {\n            this.options.sortCriteria = 'nosort';\n        }\n    };\n    Facet.prototype.initDependsOnManager = function () {\n        var _this = this;\n        var facetInfo = {\n            reset: function () { return _this.reset(); },\n            ref: this\n        };\n        this.dependsOnManager = new DependsOnManager_1.DependsOnManager(facetInfo);\n    };\n    Facet.prototype.dependsOnUpdateParentDisplayValue = function () {\n        var _this = this;\n        if (!this.options.dependsOn) {\n            return;\n        }\n        var masterFacetComponent = ComponentsTypes_1.ComponentsTypes.getAllFacetInstancesFromElement(this.root).filter(function (cmp) {\n            var idFacet = cmp instanceof Facet;\n            return idFacet && cmp.options.id === _this.options.dependsOn;\n        });\n        if (!masterFacetComponent.length) {\n            this.logger.warn(\"Unable to find a Facet with the id or field \\\"\" + this.options.dependsOn + \"\\\".\", \"The master facet values can't be updated.\");\n            return;\n        }\n        if (masterFacetComponent.length > 1) {\n            this.logger.warn(\"Multiple facets with id \\\"\" + this.options.dependsOn + \"\\\" found.\", \"A given facet may only depend on a single other facet.\", \"Ensure that each facet in your search interface has a unique id.\", \"The master facet cannot be updated.\", masterFacetComponent);\n            return;\n        }\n        var masterFacet = masterFacetComponent[0];\n        masterFacet.keepDisplayedValuesNextTime = false;\n    };\n    Facet.prototype.initBottomAndTopSpacer = function () {\n        var _this = this;\n        var bottomSpace = Dom_1.$$(this.options.paddingContainer).find('.coveo-bottomSpace');\n        var topSpace = Dom_1.$$(this.options.paddingContainer).find('.coveo-topSpace');\n        if (this.options.preservePosition) {\n            Dom_1.$$(this.options.paddingContainer).on('mouseleave', function () { return _this.unpinFacetPosition(); });\n            this.pinnedTopSpace = topSpace;\n            this.pinnedBottomSpace = bottomSpace;\n            if (!this.pinnedTopSpace) {\n                this.pinnedTopSpace = document.createElement('div');\n                Dom_1.$$(this.pinnedTopSpace).addClass('coveo-topSpace');\n                Dom_1.$$(this.pinnedTopSpace).insertBefore(this.options.paddingContainer.firstChild);\n            }\n            if (!this.pinnedBottomSpace) {\n                this.pinnedBottomSpace = document.createElement('div');\n                Dom_1.$$(this.pinnedBottomSpace).addClass('coveo-bottomSpace');\n                this.options.paddingContainer.appendChild(this.pinnedBottomSpace);\n            }\n        }\n    };\n    Facet.prototype.updateIncludedQueryStateModel = function () {\n        var selectedValues = { included: this.getSelectedValues(), title: this.includedAttributeId };\n        this.queryStateModel.set(this.includedAttributeId, selectedValues.included);\n    };\n    Facet.prototype.updateExcludedQueryStateModel = function () {\n        var excludedValues = { title: this.excludedAttributeId, excluded: this.getExcludedValues() };\n        this.queryStateModel.set(this.excludedAttributeId, excludedValues.excluded);\n    };\n    Facet.prototype.updateLookupValueQueryStateModel = function () {\n        if (this.options.lookupField) {\n            var valueToSet_1 = {};\n            _.each(this.values.getSelected().concat(this.values.getExcluded()), function (value) {\n                valueToSet_1[value.value] = value.lookupValue;\n            });\n            this.queryStateModel.set(this.lookupValueAttributeId, valueToSet_1);\n        }\n    };\n    Facet.prototype.handleQueryStateChangedOperator = function (operator) {\n        if (operator == 'and') {\n            this.switchToAnd();\n        }\n        else if (operator == 'or') {\n            this.switchToOr();\n        }\n    };\n    Facet.prototype.handleQueryStateChangedIncluded = function (includedChanged) {\n        var toUnSelect = _.difference(this.getSelectedValues(), includedChanged);\n        if (Utils_1.Utils.isNonEmptyArray(toUnSelect)) {\n            this.deselectMultipleValues(toUnSelect);\n        }\n        if (!Utils_1.Utils.arrayEqual(this.getSelectedValues(), includedChanged, false)) {\n            this.selectMultipleValues(includedChanged);\n        }\n    };\n    Facet.prototype.handleQueryStateChangedExcluded = function (excludedChanged) {\n        var toUnExclude = _.difference(this.getExcludedValues(), excludedChanged);\n        if (Utils_1.Utils.isNonEmptyArray(toUnExclude)) {\n            this.unexcludeMultipleValues(toUnExclude);\n        }\n        if (!Utils_1.Utils.arrayEqual(this.getExcludedValues(), excludedChanged, false)) {\n            this.excludeMultipleValues(excludedChanged);\n        }\n    };\n    Facet.prototype.handleLookupvalueChanged = function (lookupFieldChanged) {\n        var _this = this;\n        _.each(lookupFieldChanged, function (lookupvalue, value) {\n            _this.facetValuesList.get(decodeURIComponent(value)).facetValue.lookupValue = decodeURIComponent(lookupvalue);\n        });\n    };\n    Facet.prototype.handleQueryStateChanged = function (data) {\n        Assert_1.Assert.exists(data);\n        this.ensureDom();\n        this.dependsOnUpdateParentDisplayValue();\n        var trimValuesFromModel = function (values) {\n            if (values) {\n                values = _.map(values, function (value) { return value.trim(); });\n            }\n            return values;\n        };\n        var queryStateAttributes = data.attributes;\n        var includedChanged = trimValuesFromModel(queryStateAttributes[this.includedAttributeId]);\n        var excludedChanged = trimValuesFromModel(queryStateAttributes[this.excludedAttributeId]);\n        var operator = queryStateAttributes[this.operatorAttributeId];\n        var lookupValueChanged = queryStateAttributes[this.lookupValueAttributeId];\n        if (this.listenToQueryStateChange) {\n            if (!Utils_1.Utils.isNullOrEmptyString(operator)) {\n                this.handleQueryStateChangedOperator(operator);\n            }\n            if (!Utils_1.Utils.isNullOrUndefined(includedChanged)) {\n                this.handleQueryStateChangedIncluded(includedChanged);\n            }\n            if (!Utils_1.Utils.isNullOrUndefined(excludedChanged)) {\n                this.handleQueryStateChangedExcluded(excludedChanged);\n            }\n            if (!Utils_1.Utils.isNullOrUndefined(lookupValueChanged)) {\n                this.handleLookupvalueChanged(lookupValueChanged);\n            }\n        }\n    };\n    Facet.prototype.handlePopulateOmnibox = function (data) {\n        Assert_1.Assert.exists(data);\n        Assert_1.Assert.exists(data.completeQueryExpression);\n        // The omnibox calls can come in before a first query was executed (atypical, but\n        // if no query is auto-triggered on initialization). To ensure that we've got the\n        // proper filters, we ensure that at least a dumbshow query builder run occured\n        // before proceeding.\n        this.queryController.ensureCreatedQueryBuilder();\n        if (this.canFetchMore) {\n            this.handleOmniboxWithSearchInFacet(data);\n        }\n        else {\n            this.handleOmniboxWithStaticValue(data);\n        }\n    };\n    Facet.prototype.handleOmniboxWithSearchInFacet = function (eventArg) {\n        var _this = this;\n        var regex = new RegExp('^' + eventArg.completeQueryExpression.regex.source, 'i');\n        var promise = new Promise(function (resolve, reject) {\n            var searchParameters = new FacetSearchParameters_1.FacetSearchParameters(_this);\n            searchParameters.setValueToSearch(eventArg.completeQueryExpression.word);\n            searchParameters.nbResults = _this.options.numberOfValuesInOmnibox;\n            _this.facetQueryController\n                .search(searchParameters)\n                .then(function (fieldValues) {\n                var facetValues = _.map(_.filter(fieldValues, function (fieldValue) {\n                    return regex.test(fieldValue.lookupValue);\n                }), function (fieldValue) {\n                    return _this.values.get(fieldValue.lookupValue) || FacetValue_1.FacetValue.create(fieldValue);\n                });\n                var element = new OmniboxValuesList_1.OmniboxValuesList(_this, facetValues, eventArg, OmniboxValueElement_1.OmniboxValueElement).build();\n                resolve({ element: element, zIndex: _this.omniboxZIndex });\n            })\n                .catch(function () {\n                resolve({ element: undefined });\n            });\n        });\n        eventArg.rows.push({ deferred: promise });\n    };\n    Facet.prototype.handleDuringQuery = function () {\n        this.ensureDom();\n        if (!this.keepDisplayedValuesNextTime) {\n            this.fadeInactiveValuesInMainList(this.options.facetSearchDelay);\n        }\n    };\n    Facet.prototype.handleBuildingQuery = function (data) {\n        Assert_1.Assert.exists(data);\n        Assert_1.Assert.exists(data.queryBuilder);\n        this.facetQueryController.prepareForNewQuery();\n        if (this.values.hasSelectedOrExcludedValues()) {\n            var expression = this.facetQueryController.computeOurFilterExpression();\n            this.logger.trace('Putting filter in query', expression);\n            data.queryBuilder.advancedExpression.add(expression);\n        }\n    };\n    Facet.prototype.handleDoneBuildingQuery = function (data) {\n        Assert_1.Assert.exists(data);\n        Assert_1.Assert.exists(data.queryBuilder);\n        var queryBuilder = data.queryBuilder;\n        this.facetQueryController.putGroupByIntoQueryBuilder(queryBuilder);\n    };\n    Facet.prototype.handleClearBreadcrumb = function () {\n        this.reset();\n    };\n    Facet.prototype.updateValues = function (facetValues) {\n        Assert_1.Assert.exists(facetValues);\n        if (this.keepDisplayedValuesNextTime) {\n            this.values.updateCountsFromNewValues(facetValues);\n        }\n        else {\n            this.values = this.consolidateAndSortNewFacetValues(facetValues);\n        }\n        this.updateNumberOfValues();\n    };\n    Facet.prototype.consolidateAndSortNewFacetValues = function (newValues) {\n        newValues.importActiveValuesFromOtherList(this.values);\n        newValues.sort(this.optionsToSortFacetValues);\n        return newValues;\n    };\n    Object.defineProperty(Facet.prototype, \"optionsToSortFacetValues\", {\n        get: function () {\n            return {\n                facetValuesOrder: this.facetValuesOrder,\n                numberOfValues: this.numberOfValues\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Facet.prototype, \"facetValuesOrder\", {\n        get: function () {\n            return new FacetValuesOrder_1.FacetValuesOrder(this, this.facetSort);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Facet.prototype.ensureFacetValueIsInList = function (facetValue) {\n        Assert_1.Assert.exists(facetValue);\n        if (!this.values.contains(facetValue.value)) {\n            this.values.add(facetValue);\n        }\n    };\n    Facet.prototype.isAnyValueCurrentlyDisplayed = function () {\n        return !this.values.isEmpty();\n    };\n    Facet.prototype.buildFacetContent = function () {\n        this.headerElement = this.buildHeader();\n        this.element.appendChild(this.headerElement);\n        this.initFacetValuesList();\n        if (this.shouldRenderFacetSearch()) {\n            this.initFacetSearch();\n        }\n        if (this.shouldRenderMoreLess()) {\n            this.moreElement = this.buildMore();\n            this.lessElement = this.buildLess();\n        }\n        this.footerElement = this.buildFooter();\n        this.element.appendChild(this.footerElement);\n        if (this.lessElement && this.moreElement) {\n            this.footerElement.appendChild(this.lessElement);\n            this.footerElement.appendChild(this.moreElement);\n        }\n    };\n    Facet.prototype.buildHeader = function () {\n        var icon = this.options.headerIcon;\n        if (this.options.headerIcon == this.options.field) {\n            icon = undefined;\n        }\n        this.facetHeader = new FacetHeader_1.FacetHeader({\n            facetElement: this.element,\n            title: this.options.title,\n            icon: icon,\n            field: this.options.field,\n            enableClearElement: true,\n            enableCollapseElement: this.options.enableCollapse,\n            facet: this,\n            settingsKlass: this.options.enableSettings ? FacetSettings_1.FacetSettings : undefined,\n            sortKlass: FacetSort_1.FacetSort,\n            availableSorts: this.options.availableSorts\n        });\n        var built = this.facetHeader.build();\n        this.facetSettings = this.facetHeader.settings;\n        this.facetSort = this.facetHeader.sort;\n        return built;\n    };\n    Facet.prototype.unpinFacetPosition = function () {\n        if (this.shouldFacetUnpin() && this.options.preservePosition) {\n            Dom_1.$$(this.pinnedTopSpace).addClass('coveo-with-animation');\n            Dom_1.$$(this.pinnedBottomSpace).addClass('coveo-with-animation');\n            this.pinnedTopSpace.style.height = '0px';\n            this.pinnedBottomSpace.style.height = '0px';\n        }\n        this.unpinnedViewportPosition = undefined;\n        this.pinnedViewportPosition = undefined;\n    };\n    Facet.prototype.isFacetPinned = function () {\n        return Utils_1.Utils.exists(this.pinnedViewportPosition);\n    };\n    Facet.prototype.shouldFacetUnpin = function () {\n        return Utils_1.Utils.exists(this.unpinnedViewportPosition);\n    };\n    Facet.prototype.ensurePinnedFacetHasntMoved = function () {\n        if (this.isFacetPinned()) {\n            Assert_1.Assert.exists(this.pinnedViewportPosition);\n            Dom_1.$$(this.pinnedTopSpace).removeClass('coveo-with-animation');\n            Dom_1.$$(this.pinnedBottomSpace).removeClass('coveo-with-animation');\n            this.pinnedTopSpace.style.height = '0px';\n            this.pinnedBottomSpace.style.height = '0px';\n            // Under firefox scrolling the body doesn't work, but window does\n            // on all browser, so we substitute those here when needed.\n            var elementToScroll_1 = this.options.scrollContainer == document.body ? window : this.options.scrollContainer;\n            var currentViewportPosition = this.element.getBoundingClientRect().top;\n            var offset_1 = currentViewportPosition - this.pinnedViewportPosition;\n            var scrollToOffset = function () {\n                if (elementToScroll_1 instanceof Window) {\n                    window.scrollTo(0, new Dom_1.Win(elementToScroll_1).scrollY() + offset_1);\n                }\n                else {\n                    elementToScroll_1.scrollTop = elementToScroll_1.scrollTop + offset_1;\n                }\n            };\n            // First try to adjust position by scrolling the page\n            scrollToOffset();\n            currentViewportPosition = this.element.getBoundingClientRect().top;\n            offset_1 = currentViewportPosition - this.pinnedViewportPosition;\n            // If scrolling has worked (offset == 0), we're good to go, nothing to do anymore.\n            if (offset_1 < 0) {\n                // This means the facet element is scrolled up in the viewport,\n                // scroll it down by adding space in the top container\n                this.pinnedTopSpace.style.height = offset_1 * -1 + 'px';\n            }\n            this.unpinnedViewportPosition = this.pinnedViewportPosition;\n            this.pinnedViewportPosition = null;\n        }\n    };\n    Facet.prototype.buildFooter = function () {\n        return Dom_1.$$('div', { className: 'coveo-facet-footer' }).el;\n    };\n    Facet.prototype.buildMore = function () {\n        var _this = this;\n        var svgContainer = Dom_1.$$('span', { className: 'coveo-facet-more-icon' }, SVGIcons_1.SVGIcons.icons.arrowDown).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-more-icon-svg');\n        var more = Dom_1.$$('div', { className: 'coveo-facet-more', tabindex: 0 }, svgContainer).el;\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(more)\n            .withLabel(Strings_1.l('ShowMoreFacetResults', this.options.title))\n            .withSelectAction(function () { return _this.handleClickMore(); })\n            .build();\n        return more;\n    };\n    Facet.prototype.buildLess = function () {\n        var _this = this;\n        var svgContainer = Dom_1.$$('span', { className: 'coveo-facet-less-icon' }, SVGIcons_1.SVGIcons.icons.arrowUp).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-less-icon-svg');\n        var less = Dom_1.$$('div', { className: 'coveo-facet-less', tabindex: 0 }, svgContainer).el;\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(less)\n            .withLabel(Strings_1.l('ShowLessFacetResults', this.options.title))\n            .withSelectAction(function () { return _this.handleClickLess(); })\n            .build();\n        return less;\n    };\n    Facet.prototype.triggerMoreQuery = function () {\n        var _this = this;\n        this.logger.info('Triggering new facet more query');\n        this.showWaitingAnimation();\n        // fetch 1 more value than we need, so we can see if there is more value to fetch still or if we have reached\n        // the end of the availables values\n        this.facetQueryController\n            .fetchMore(this.numberOfValues + 1)\n            .then(function (queryResults) {\n            _this.logAnalyticsFacetShowMoreLess(AnalyticsActionListMeta_1.analyticsActionCauseList.facetShowMore);\n            var facetValues = new FacetValues_1.FacetValues(queryResults.groupByResults[0]);\n            _this.values = _this.consolidateAndSortNewFacetValues(facetValues);\n            _this.nbAvailableValues = _this.values.size();\n            _this.updateNumberOfValues();\n            _this.canFetchMore = _this.numberOfValues < _this.nbAvailableValues;\n            if (_this.values.hasSelectedOrExcludedValues() && !_this.options.useAnd && _this.options.isMultiValueField) {\n                _this.triggerUpdateDeltaQuery(_.filter(_this.values.getAll(), function (facetValue) { return !facetValue.selected && !facetValue.excluded; }));\n            }\n            else if (_this.values.hasSelectedOrExcludedValues() && !_this.options.useAnd) {\n                _this.values.updateDeltaWithFilteredFacetValues(new FacetValues_1.FacetValues(), _this.options.isMultiValueField);\n                _this.hideWaitingAnimation();\n            }\n            else {\n                _this.hideWaitingAnimation();\n            }\n            _this.rebuildValueElements();\n        })\n            .catch(function () { return _this.hideWaitingAnimation(); });\n    };\n    Facet.prototype.triggerUpdateDeltaQuery = function (facetValues) {\n        var _this = this;\n        this.showWaitingAnimation();\n        this.facetQueryController.searchInFacetToUpdateDelta(facetValues).then(function (queryResults) {\n            var values = new FacetValues_1.FacetValues();\n            _.each(queryResults.groupByResults, function (groupByResult) {\n                _.each(groupByResult.values, function (groupByValue) {\n                    if (!values.contains(groupByValue.value)) {\n                        values.add(FacetValue_1.FacetValue.createFromGroupByValue(groupByValue));\n                    }\n                });\n            });\n            _this.values.updateDeltaWithFilteredFacetValues(values, _this.options.isMultiValueField);\n            _this.cleanupDeltaValuesForMultiValueField();\n            _this.rebuildValueElements();\n            _this.hideWaitingAnimation();\n        });\n    };\n    Facet.prototype.updateNumberOfValues = function () {\n        if (this.keepDisplayedValuesNextTime) {\n            return;\n        }\n        if (this.currentPage <= 0) {\n            // We're on the first page, let's reset the number of values to a minimum.\n            this.currentPage = 0;\n            this.numberOfValues = 0;\n        }\n        else {\n            // Calculate the number of value with the current page.\n            this.numberOfValues = this.options.numberOfValues + this.currentPage * this.options.pageSize;\n        }\n        // Make sure we have at least the absolute minimum of value to display.\n        this.numberOfValues = Math.max(this.numberOfValues, this.getMinimumNumberOfValuesToDisplay());\n    };\n    Facet.prototype.getMinimumNumberOfValuesToDisplay = function () {\n        // The min value is the number of used values.\n        var minValue = this.values.getExcluded().length + this.values.getSelected().length;\n        // When using a custom sort, we have to show all values between the selected ones.\n        // Thus, we must find the last selected value after a reorder and use that value as the number of value.\n        if (this.options.customSort != null && this.facetSort != null && this.options.customSort.length > 0) {\n            var lastSelectedValueIndex_1 = -1;\n            new FacetValuesOrder_1.FacetValuesOrder(this, this.facetSort).reorderValues(this.values.getAll()).forEach(function (facetValue, index) {\n                if (facetValue.selected) {\n                    lastSelectedValueIndex_1 = index;\n                }\n            });\n            minValue = lastSelectedValueIndex_1 + 1;\n        }\n        return Math.max(minValue, this.options.numberOfValues);\n    };\n    Facet.prototype.cleanupDeltaValuesForMultiValueField = function () {\n        var _this = this;\n        // On a multi value field, it's possible to end up in a scenario where many of the current values are empty\n        // Crop those out, and adjust the nbAvailable values for the \"search\" and \"show more\";\n        if (this.options.isMultiValueField) {\n            _.each(this.values.getAll(), function (v) {\n                if (v.occurrences == 0 && !v.selected && !v.excluded) {\n                    _this.values.remove(v.value);\n                }\n            });\n            this.nbAvailableValues = this.values.getAll().length;\n        }\n    };\n    Facet.prototype.shouldRenderFacetSearch = function () {\n        return this.options.enableFacetSearch;\n    };\n    Facet.prototype.shouldRenderMoreLess = function () {\n        return this.options.enableMoreLess;\n    };\n    Facet.prototype.debugInfo = function () {\n        var info = {};\n        info[this['constructor']['ID']] = {\n            component: this,\n            groupByRequest: this.facetQueryController.lastGroupByRequest,\n            groupByResult: this.facetQueryController.lastGroupByResult\n        };\n        return info;\n    };\n    Facet.prototype.logAnalyticsFacetShowMoreLess = function (cause) {\n        this.usageAnalytics.logCustomEvent(cause, {\n            facetId: this.options.id,\n            facetField: this.options.field.toString(),\n            facetTitle: this.options.title\n        }, this.element);\n    };\n    Facet.ID = 'Facet';\n    Facet.omniboxIndex = 50;\n    Facet.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            Facet: Facet,\n            FacetHeader: FacetHeader_1.FacetHeader,\n            FacetSearchValuesList: FacetSearchValuesList_1.FacetSearchValuesList,\n            FacetSettings: FacetSettings_1.FacetSettings,\n            FacetSort: FacetSort_1.FacetSort,\n            FacetUtils: FacetUtils_1.FacetUtils,\n            FacetValueElement: FacetValueElement_1.FacetValueElement,\n            FacetValue: FacetValue_1.FacetValue\n        });\n    };\n    /**\n     * The possible options for a facet\n     * @componentOptions\n     */\n    Facet.options = __assign({ \n        /**\n         * Specifies the title to display at the top of the facet.\n         *\n         * Default value is the localized string for `NoTitle`.\n         */\n        title: ComponentOptions_1.ComponentOptions.buildLocalizedStringOption({\n            localizedString: function () { return Strings_1.l('NoTitle'); },\n            section: 'CommonOptions',\n            priority: 10\n        }), \n        /**\n         * Specifies the index field whose values the facet should use.\n         *\n         * The field must of the `string` type.\n         *\n         * This requires the given field to be configured correctly in the index as a *Facet field* (see\n         * [Add or Edit Fields](https://docs.coveo.com/en/1982/)).\n         *\n         * Specifying a value for this option is required for the `Facet` component to work.\n         */\n        field: ComponentOptions_1.ComponentOptions.buildFieldOption({ required: true, groupByField: true, section: 'CommonOptions' }), headerIcon: ComponentOptions_1.ComponentOptions.buildStringOption({\n            deprecated: 'This option is exposed for legacy reasons, and the recommendation is to not use this option.'\n        }), \n        /**\n         * Specifies a unique identifier for the facet. Among other things, this identifier serves the purpose of saving\n         * the facet state in the URL hash.\n         *\n         * If you have two facets with the same field on the same page, you should specify an `id` value for at least one of\n         * those two facets. This `id` must be unique among the facets.\n         *\n         * Non-word characters except - @ $ _ . + ! * ' ( ) , , ( `^a-zA-Z0-9-@$_.+!*'(),,]+` ) are automatically removed from the `id` value.\n         *\n         * Default value is the [`field`]{@link Facet.options.field} option value.\n         */\n        id: ComponentOptions_1.ComponentOptions.buildStringOption({\n            postProcessing: function (value, options) {\n                if (value) {\n                    // All non-word characters, except @ (the default character that specifies a field in the index)\n                    // and characters that do no need to be encoded in the URL : - @ $ _ . + ! * ' ( ) , ,\n                    var modified = value.replace(/[^a-zA-Z0-9-@$_.+!*'(),,]+/g, '');\n                    if (Utils_1.Utils.isNullOrEmptyString(modified)) {\n                        return options.field;\n                    }\n                    return modified;\n                }\n                return options.field;\n            }\n        }), \n        /**\n         * Specifies whether the facet [`field`]{@link Facet.options.field} is configured in the index as a multi-value\n         * field (semicolon separated values such as `abc;def;ghi`).\n         *\n         * Default value is `false`.\n         */\n        isMultiValueField: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'CommonOptions' }), \n        /**\n         * Specifies the field whose values the Facet should display.\n         *\n         * @deprecated This option is exposed for legacy reasons. It is not recommended to use this option.\n         */\n        lookupField: ComponentOptions_1.ComponentOptions.buildFieldOption({\n            deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n        }), \n        /**\n         * Specifies whether to display the facet **Settings** menu.\n         *\n         * See also the [`enableSettingsFacetState`]{@link Facet.options.enableSettingsFacetState},\n         * [`availableSorts`]{@link Facet.options.availableSorts}, and\n         * [`enableCollapse`]{@link Facet.options.enableCollapse} options.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `true`.\n         */\n        enableSettings: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'Sorting', priority: 9 }), \n        /**\n         * If the [`enableSettings`]{@link Facet.options.enableSettings} option is `true`, specifies whether the\n         * **Save state** menu option is available in the facet **Settings** menu.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `false`.\n         */\n        enableSettingsFacetState: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableSettings' }), \n        /**\n         * If the [`enableSettings`]{@link Facet.options.enableSettings} option is `true`, specifies the sort criteria\n         * options to display in the facet **Settings** menu.\n         *\n         * Possible values are:\n         * - `\"occurrences\"`\n         * - `\"score\"`\n         * - `\"alphaascending\"`\n         * - `\"alphadescending\"`\n         * - `\"computedfieldascending\"`\n         * - `\"computedfielddescending\"`\n         * - `\"custom\"`\n         *\n         * See {@link IGroupByRequest.sortCriteria} for a description of each possible value.\n         *\n         * **Notes:**\n         * > * The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * > * Using value captions will disable alphabetical sorts (see the [valueCaption]{@link Facet.options.valueCaption} option).\n         *\n         * Default value is `occurrences,score,alphaascending,alphadescending`.\n         */\n        availableSorts: ComponentOptions_1.ComponentOptions.buildListOption({\n            defaultValue: ['occurrences', 'score', 'alphaascending', 'alphadescending'],\n            section: 'Sorting',\n            depend: 'enableSettings',\n            values: [\n                'occurrences',\n                'score',\n                'alphaascending',\n                'alphadescending',\n                'computedfieldascending',\n                'computedfielddescending',\n                'chisquare',\n                'nosort'\n            ]\n        }), \n        /**\n         * Specifies the criteria to use to sort the facet values.\n         *\n         * See {@link IGroupByRequest.sortCriteria} for the list and description of possible values.\n         *\n         * Default value is the first sort criteria specified in the [`availableSorts`]{@link Facet.options.availableSorts}\n         * option, or `occurrences` if no sort criteria is specified.\n         */\n        sortCriteria: ComponentOptions_1.ComponentOptions.buildStringOption({\n            postProcessing: function (value, options) {\n                return value || (options.availableSorts.length > 0 ? options.availableSorts[0] : 'occurrences');\n            },\n            section: 'Sorting'\n        }), \n        /**\n         * Specifies a custom order by which to sort the facet values.\n         *\n         * **Example:**\n         *\n         * You could use this option to specify a logical order for support tickets, such as:\n         * ```html\n         * <div class=\"CoveoFacet\" data-field=\"@ticketstatus\" data-title=\"Ticket Status\" data-tab=\"All\" data-custom-sort=\"New,Opened,Feedback,Resolved\"></div>\n         * ```\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         */\n        customSort: ComponentOptions_1.ComponentOptions.buildListOption({ section: 'Sorting' }), \n        /**\n         * Specifies the maximum number of field values to display by default in the facet before the user\n         * clicks the arrow to show more.\n         *\n         * See also the [`enableMoreLess`]{@link Facet.options.enableMoreLess} option.\n         */\n        numberOfValues: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0, section: 'CommonOptions' }), \n        /**\n         * Specifies the *injection depth* to use for the [`GroupByRequest`]{@link IGroupByRequest} operation.\n         *\n         * The injection depth determines how many results to scan in the index to ensure that the facet lists all potential\n         * facet values. Increasing this value enhances the accuracy of the listed values at the cost of performance.\n         *\n         * Default value is `1000`. Minimum value is `0`.\n         * @notSupportedIn salesforcefree\n         */\n        injectionDepth: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 1000, min: 0 }), showIcon: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            defaultValue: false,\n            deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n        }), \n        /**\n         * Specifies whether to use the `AND` operator in the resulting filter when multiple values are selected in the\n         * facet.\n         *\n         * Setting this option to `true` means that items must have all of the selected values to match the resulting\n         * query.\n         *\n         * Default value is `false`, which means that the filter uses the `OR` operator. Thus, by default, items must\n         * have at least one of the selected values to match the query.\n         */\n        useAnd: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Filtering' }), \n        /**\n         * Specifies whether to allow the user to toggle between the `OR` and `AND` modes in the facet.\n         *\n         * Setting this option to `true` displays an icon in the top right corner of the facet. The user can click this icon\n         * to toggle between between the two modes.\n         *\n         * Default value is `false`.\n         */\n        enableTogglingOperator: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            defaultValue: false,\n            alias: 'allowTogglingOperator'\n        }), \n        /**\n         * Specifies whether to display a search box at the bottom of the facet for searching among the available facet\n         * [`field`]{@link Facet.options.field} values.\n         *\n         * See also the [`facetSearchDelay`]{@link Facet.options.facetSearchDelay},\n         * [`facetSearchIgnoreAccents`]{@link Facet.options.facetSearchIgnoreAccents}, and\n         * [`numberOfValuesInFacetSearch`]{@link Facet.options.numberOfValuesInFacetSearch} options.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `true`.\n         */\n        enableFacetSearch: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'FacetSearch', priority: 8 }), \n        /**\n         * If the [`enableFacetSearch`]{@link Facet.options.enableFacetSearch} option is `true`, specifies the delay (in\n         * milliseconds) before sending a search request to the server when the user starts typing in the facet search box.\n         *\n         * Specifying a smaller value makes results appear faster. However, chances of having to cancel many requests\n         * sent to the server increase as the user keeps on typing new characters.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `100`. Minimum value is `0`.\n         */\n        facetSearchDelay: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 100, min: 0, depend: 'enableFacetSearch' }), \n        /**\n         * If the [`enableFacetSearch`]{@link Facet.options.enableFacetSearch} option is `true`, specifies whether to ignore\n         * accents in the facet search box.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `false`.\n         */\n        facetSearchIgnoreAccents: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableFacetSearch' }), \n        /**\n         * If the [`enableFacetSearch`]{@link Facet.options.enableFacetSearch} option is `true`, specifies the number of v\n         * alues to display in the facet search results popup.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `15`. Minimum value is `1`.\n         */\n        numberOfValuesInFacetSearch: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 15, min: 1, section: 'FacetSearch' }), \n        /**\n         * Specifies whether [wildcards]{@link AllowedValuesPatternType.wildcards} are used as the [allowedValuesPatternType]{@link IGroupByRequest.allowedValuesPatternType}\n         * in the [groupBy]{@link IGroupByRequest} for the facet search.\n         *\n         * Enabling this option returns results that end with the entered value. For example, searching for `veo` would match with `Coveo`.\n         *\n         * **Note:**\n         * > If you are experiencing slow facet search and/or timeouts when this option is set to `true`, consider enabling the **Use cache for nested queries**\n         * > option on your facet [field]{@link Facet.options.field} in the Coveo Cloud Admninistration Console (see [Add or Edit Fields]{@link https://docs.coveo.com/en/1982/}).\n         */\n        useWildcardsInFacetSearch: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'FacetSearch' }), \n        /**\n         * Specifies whether the facet should push data to the [`Breadcrumb`]{@link Breadcrumb} component.\n         *\n         * See also the [`numberOfValuesInBreadcrumb`]{@link Facet.options.numberOfValuesInBreadcrumb} option.\n         *\n         * Default value is `true`.\n         */\n        includeInBreadcrumb: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }), \n        /**\n         * If the [`includeInBreadcrumb`]{@link Facet.options.includeInBreadcrumb} option is `true`, specifies the maximum\n         * number of values that the facet should display in the [`Breadcrumb`]{@link Breadcrumb} before outputting a\n         * **more...** button.\n         *\n         * Default value is `5` on a desktop computer and `3` on a mobile device. Minimum value is `0`.\n         */\n        numberOfValuesInBreadcrumb: ComponentOptions_1.ComponentOptions.buildNumberOption({\n            defaultFunction: function () { return (DeviceUtils_1.DeviceUtils.isMobileDevice() ? 3 : 5); },\n            min: 0,\n            depend: 'includeInBreadcrumb'\n        }), \n        /**\n         * Specifies whether the Facet should push data to the {@link Omnibox} component.\n         *\n         * See also {@link Facet.options.numberOfValuesInOmnibox}.\n         *\n         * Default value is `false`.\n         *\n         * @deprecated This option is exposed for legacy reasons. It is not recommended to use this option.\n         */\n        includeInOmnibox: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            defaultValue: false,\n            deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n        }), \n        /**\n         * When {@link Facet.options.includeInOmnibox} is `true`, specifies the number of values to populate the\n         * {@link Breadcrumb} with.\n         *\n         * Default value is `5` on desktop computer and `3` on a mobile device. Minimum value is `0`.\n         *\n         * @deprecated This option is exposed for legacy reasons. It is not recommended to use this option.\n         */\n        numberOfValuesInOmnibox: ComponentOptions_1.ComponentOptions.buildNumberOption({\n            defaultFunction: function () { return (DeviceUtils_1.DeviceUtils.isMobileDevice() ? 3 : 5); },\n            min: 0,\n            depend: 'includeInOmnibox',\n            deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n        }), \n        /**\n         * Specifies the name of a field on which to execute an aggregate operation for all distinct values of the facet\n         * [`field`]{@link Facet.options.field}.\n         *\n         * The facet displays the result of the operation along with the number of occurrences for each value.\n         *\n         * You can use this option to compute the sum of a field (like a money amount) for each listed facet value.\n         *\n         * Works in conjunction with the [`computedFieldOperation`]{@link Facet.options.computedFieldOperation},\n         * [`computedFieldFormat`]{@link Facet.options.computedFieldFormat}, and\n         * [`computedFieldCaption`]{@link Facet.options.computedFieldCaption} options.\n         * @notSupportedIn salesforcefree\n         */\n        computedField: ComponentOptions_1.ComponentOptions.buildFieldOption({ priority: 7 }), \n        /**\n         * Specifies the type of aggregate operation to perform on the [`computedField`]{@link Facet.options.computedField}.\n         *\n         * The possible values are:\n         * - `sum` - Computes the sum of the computed field values.\n         * - `average` - Computes the average of the computed field values.\n         * - `minimum` - Finds the minimum value of the computed field values.\n         * - `maximum` - Finds the maximum value of the computed field values.\n         *\n         * Default value is `sum`.\n         * @notSupportedIn salesforcefree\n         */\n        computedFieldOperation: ComponentOptions_1.ComponentOptions.buildStringOption({\n            defaultValue: 'sum',\n            section: 'ComputedField'\n        }), \n        /**\n         * Specifies how to format the values resulting from a\n         * [`computedFieldOperation`]{@link Facet.options.computedFieldOperation}.\n         *\n         * The Globalize library defines all available formats (see\n         * [Globalize](https://github.com/klaaspieter/jquery-global#globalizeformat-value-format-culture-)).\n         *\n         * The most commonly used formats are:\n         * - `c0` - Formats the value as a currency.\n         * - `n0` - Formats the value as an integer.\n         * - `n2` - Formats the value as a floating point with 2 decimal digits.\n         *\n         * Default value is `\"c0\"`.\n         * @notSupportedIn salesforcefree\n         */\n        computedFieldFormat: ComponentOptions_1.ComponentOptions.buildStringOption({\n            defaultValue: 'c0',\n            section: 'ComputedField'\n        }), \n        /**\n         * Specifies what the caption of the [`computedField`]{@link Facet.options.computedField} should be in the facet\n         * **Settings** menu for sorting.\n         *\n         * For example, setting this option to `\"Money\"` will display `\"Money Ascending\"` for computed field ascending.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is the localized string for `ComputedField`.\n         * @notSupportedIn salesforcefree\n         */\n        computedFieldCaption: ComponentOptions_1.ComponentOptions.buildLocalizedStringOption({\n            localizedString: function () { return Strings_1.l('ComputedField'); },\n            section: 'ComputedField'\n        }), \n        /**\n         * Specifies whether the facet should remain stable in its current position in the viewport while the mouse cursor\n         * is over it.\n         *\n         * Whenever the value selection changes in a facet, the search interface automatically performs a query. This new\n         * query might cause other elements in the page to resize themselves (typically, other facets above or below the\n         * one the user is interacting with).\n         *\n         * This option is responsible for adding the `<div class='coveo-topSpace'>` and\n         * `<div class='coveo-bottomSpace'>` around the Facet container. The Facet adjusts the scroll amount of the page to\n         * ensure that it does not move relatively to the mouse when the results are updated.\n         *\n         * In some cases, the facet also adds margins to the `scrollContainer`, if scrolling alone is not enough to\n         * preserve position.\n         *\n         * See also the [`paddingContainer`]{@link Facet.options.paddingContainer}, and\n         * [`scrollContainer`]{@link Facet.options.scrollContainer} options.\n         *\n         * Default value is `true`.\n         */\n        preservePosition: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }), \n        /**\n         * Specifies the parent container of the facets.\n         *\n         * Used by the [`preservePosition`]{@link Facet.options.preservePosition} option.\n         *\n         * Default value is `element.parentElement`.\n         */\n        paddingContainer: ComponentOptions_1.ComponentOptions.buildSelectorOption({\n            defaultFunction: function (element) {\n                var standardColumn = Dom_1.$$(element).parent('coveo-facet-column');\n                if (standardColumn != null) {\n                    return standardColumn;\n                }\n                return element.parentElement;\n            }\n        }), \n        /**\n         * Specifies the HTML element (through a CSS selector) whose scroll amount the facet should adjust to preserve its\n         * position when results are updated.\n         *\n         * Used by the [`preservePosition`]{@link Facet.options.preservePosition} option.\n         *\n         * Default value is `document.body`.\n         */\n        scrollContainer: ComponentOptions_1.ComponentOptions.buildSelectorOption({ defaultFunction: function (element) { return document.body; } }), \n        /**\n         * Specifies whether to enable the **More** and **Less** buttons in the Facet.\n         *\n         * See also the [`pageSize`]{@link Facet.options.pageSize} option.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `true`.\n         */\n        enableMoreLess: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }), \n        /**\n         * If the [`enableMoreLess`]{@link Facet.options.enableMoreLess} option is `true`, specifies the number of\n         * additional results to fetch when clicking the **More** button.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `10`. Minimum value is `1`.\n         */\n        pageSize: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 10, min: 1, depend: 'enableMoreLess' }), \n        /**\n         * If the [`enableSettings`]{@link Facet.options.enableSettings} option is `true`, specifies whether the\n         * **Collapse \\ Expand** menu option is available in the facet **Settings** menu.\n         *\n         * **Note:**\n         * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n         *\n         * Default value is `true`.\n         */\n        enableCollapse: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, depend: 'enableSettings' }), \n        /**\n         * Specifies an explicit list of [`allowedValues`]{@link IGroupByRequest.allowedValues} in the\n         * [`GroupByRequest`]{@link IGroupByRequest}.\n         *\n         * If you specify a list of values for this option, the facet uses only these values (if they are available in\n         * the current result set).\n         *\n         * **Example:**\n         *\n         * The following facet only uses the `Contact`, `Account`, and `File` values of the `@objecttype` field. Even if the\n         * current result set contains other `@objecttype` values, such as `Message`, or `Product`, the facet does not use\n         * those other values.\n         *\n         * ```html\n         *\n         * <div class=\"CoveoFacet\" data-field=\"@objecttype\" data-title=\"Object Type\" data-tab=\"All\" data-allowed-values=\"Contact,Account,File\"></div>\n         * ```\n         *\n         * Default value is `undefined`, and the facet uses all available values for its\n         * [`field`]{@link Facet.options.field} in the current result set.\n         */\n        allowedValues: ComponentOptions_1.ComponentOptions.buildListOption(), \n        /**\n         * Specifies an additional query expression (query override) to add to each\n         * [`GroupByRequest`]{@link IGroupByRequest} that this facet performs.\n         *\n         * Example: `@date>=2014/01/01`\n         * @notSupportedIn salesforcefree\n         */\n        additionalFilter: ComponentOptions_1.ComponentOptions.buildQueryExpressionOption(), \n        /**\n         * Specifies whether this facet only appears when a value is selected in its \"parent\" facet.\n         *\n         * To specify the parent facet, use its [`id`]{@link Facet.options.id}.\n         *\n         * Remember that by default, a facet `id` value is the same as its [`field`]{@link Facet.options.field} option\n         * value.\n         *\n         * **Examples:**\n         *\n         * First case: the \"parent\" facet has no custom `id`:\n         * ```html\n         * <!-- \"Parent\" Facet: -->\n         * <div class='CoveoFacet' data-field='@myfield' data-title='My Parent Facet'></div>\n         *\n         * <!-- The \"dependent\" Facet must refer to the default `id` of its \"parent\" Facet, which is the name of its field. -->\n         * <div class='CoveoFacet' data-field='@myotherfield' data-title='My Dependent Facet' data-depends-on='@myfield'></div>\n         * ```\n         *\n         * Second case: the \"parent\" facet has a custom `id`:\n         * ```html\n         * <!-- \"Parent\" Facet: -->\n         * <div class='CoveoFacet' data-field='@myfield' data-title='My Parent Facet' data-id='myParentCustomId'></div>\n         *\n         * <!-- The \"dependent\" Facet must refer to the custom `id` of its \"parent\" Facet, which is 'myParentCustomId'. -->\n         * <div class='CoveoFacet' data-field='@myotherfield' data-title='My Dependent Facet' data-depends-on='myParentCustomId'></div>\n         * ```\n         *\n         * Default value is `undefined`\n         */\n        dependsOn: ComponentOptions_1.ComponentOptions.buildStringOption(), \n        /**\n         * A function that verifies whether the current state of the `dependsOn` facet allows the dependent facet to be displayed.\n         *\n         * If specified, the function receives a reference to the resolved `dependsOn` facet component instance as an argument, and must return a boolean.\n         * The function's argument should typically be treated as read-only.\n         *\n         * By default, the dependent facet is displayed whenever one or more values are selected in its `dependsOn` facet.\n         *\n         * @externaldocs [Defining Dependent Facets](https://docs.coveo.com/3210/)\n         */\n        dependsOnCondition: ComponentOptions_1.ComponentOptions.buildCustomOption(function () {\n            return null;\n        }, { depend: 'dependsOn', section: 'CommonOptions' }), \n        /**\n         * Specifies a JSON object describing a mapping of facet values to their desired captions. See\n         * [Normalizing Facet Value Captions](https://docs.coveo.com/en/368/).\n         *\n         * **Examples:**\n         *\n         * You can set the option in the ['init']{@link init} call:\n         * ```javascript\n         * var myValueCaptions = {\n         *   \"txt\" : \"Text files\",\n         *   \"html\" : \"Web page\",\n         *   [ ... ]\n         * };\n         *\n         * Coveo.init(document.querySelector(\"#search\"), {\n         *   Facet : {\n         *     valueCaption : myValueCaptions\n         *   }\n         * });\n         * ```\n         *\n         * Or before the `init` call, using the ['options']{@link options} top-level function:\n         * ```javascript\n         * Coveo.options(document.querySelector(\"#search\"), {\n         *   Facet : {\n         *     valueCaption : myValueCaptions\n         *   }\n         * });\n         * ```\n         *\n         * Or directly in the markup:\n         * ```html\n         * <!-- Ensure that the double quotes are properly handled in data-value-caption. -->\n         * <div class='CoveoFacet' data-field='@myotherfield' data-value-caption='{\"txt\":\"Text files\",\"html\":\"Web page\"}'></div>\n         * ```\n         *\n         * **Note:**\n         * > Using value captions will disable alphabetical sorts (see the [availableSorts]{@link Facet.options.availableSorts} option).\n         */\n        valueCaption: ComponentOptions_1.ComponentOptions.buildJsonOption() }, ResponsiveFacetOptions_1.ResponsiveFacetOptions);\n    return Facet;\n}(Component_1.Component));\nexports.Facet = Facet;\nInitialization_1.Initialization.registerAutoCreateComponent(Facet);\nFacet.doExport();\n\n\n/***/ }),\n\n/***/ 82:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ComponentOptions_1 = __webpack_require__(8);\n/**\n * ResponsiveFacets options\n */\nexports.ResponsiveFacetOptions = {\n    /**\n     * Specifies whether to enable *responsive mode* for facets. Setting this options to `false` on any `Facet`, or\n     * [`FacetSlider`]{@link FacetSlider} component in a search interface disables responsive mode for all other facets\n     * in the search interface.\n     *\n     * Responsive mode displays all facets under a single dropdown button whenever the width of the HTML element which\n     * the search interface is bound to reaches or falls behind a certain threshold (see\n     * {@link SearchInterface.responsiveComponents}).\n     *\n     * See also the [`dropdownHeaderLabel`]{@link Facet.options.dropdownHeaderLabel} option.\n     *\n     * Default value is `true`.\n     */\n    enableResponsiveMode: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'ResponsiveOptions' }),\n    responsiveBreakpoint: ComponentOptions_1.ComponentOptions.buildNumberOption({\n        deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option. Instead, use `SearchInterface.options.responsiveMediumBreakpoint` options exposed on the `SearchInterface`.'\n    }),\n    /**\n     * If the [`enableResponsiveMode`]{@link Facet.options.enableResponsiveMode} option is `true` for all facets and\n     * {@link FacetSlider.options.enableResponsiveMode} is also `true` for all sliders, specifies the label of the\n     * dropdown button that allows to display the facets when in responsive mode.\n     *\n     * If more than one `Facet` or {@link FacetSlider} component in the search interface specifies a value for this\n     * option, the framework uses the first occurrence of the option.\n     *\n     * Default value is `Filters`.\n     */\n    dropdownHeaderLabel: ComponentOptions_1.ComponentOptions.buildLocalizedStringOption({ section: 'ResponsiveOptions' })\n};\n\n\n/***/ }),\n\n/***/ 90:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(527);\n__webpack_require__(528);\n__webpack_require__(529);\nvar underscore_1 = __webpack_require__(0);\nvar QueryEvents_1 = __webpack_require__(11);\nvar ResultLayoutEvents_1 = __webpack_require__(130);\nvar ResultListEvents_1 = __webpack_require__(30);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Assert_1 = __webpack_require__(5);\nvar Defer_1 = __webpack_require__(29);\nvar Model_1 = __webpack_require__(18);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar DeviceUtils_1 = __webpack_require__(24);\nvar Dom_1 = __webpack_require__(1);\nvar DomUtils_1 = __webpack_require__(93);\nvar Utils_1 = __webpack_require__(4);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\nvar InitializationPlaceholder_1 = __webpack_require__(175);\nvar TemplateComponentOptions_1 = __webpack_require__(60);\nvar ResponsiveDefaultResultTemplate_1 = __webpack_require__(530);\nvar CoreHelpers_1 = __webpack_require__(471);\nvar DefaultRecommendationTemplate_1 = __webpack_require__(469);\nvar DefaultResultTemplate_1 = __webpack_require__(118);\nvar TableTemplate_1 = __webpack_require__(468);\nvar TemplateCache_1 = __webpack_require__(67);\nvar TemplateList_1 = __webpack_require__(92);\nvar ResultContainer_1 = __webpack_require__(531);\nvar ResultListCardRenderer_1 = __webpack_require__(532);\nvar ResultListRenderer_1 = __webpack_require__(213);\nvar ResultListTableRenderer_1 = __webpack_require__(533);\nvar ResultListUtils_1 = __webpack_require__(113);\nvar TemplateToHtml_1 = __webpack_require__(470);\nCoreHelpers_1.CoreHelpers.exportAllHelpersGlobally(window['Coveo']);\n/**\n * The `ResultList` component is responsible for displaying query results by applying one or several result templates\n * (see [Result Templates](https://docs.coveo.com/en/413/)).\n *\n * It is possible to include multiple `ResultList` components along with a single `ResultLayout`\n * component in a search page to provide different result layouts (see\n * [Result Layouts](https://docs.coveo.com/en/360/)).\n *\n * This component supports infinite scrolling (see the\n * [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll} option).\n */\nvar ResultList = /** @class */ (function (_super) {\n    __extends(ResultList, _super);\n    /**\n     * Creates a new `ResultList` component. Binds various event related to queries (e.g., on querySuccess ->\n     * renderResults). Binds scroll event if the [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll}\n     * option is `true`.\n     * @param element The HTMLElement on which to instantiate the component.\n     * @param options The options for the `ResultList` component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time).\n     * @param elementClassId The class that this component should instantiate. Components that extend the base ResultList\n     * use this. Default value is `CoveoResultList`.\n     */\n    function ResultList(element, options, bindings, elementClassId) {\n        if (elementClassId === void 0) { elementClassId = ResultList.ID; }\n        var _this = _super.call(this, element, elementClassId, bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.bindings = bindings;\n        _this.currentlyDisplayedResults = [];\n        _this.reachedTheEndOfResults = false;\n        _this.disableLayoutChange = false;\n        // This variable serves to block some setup where the framework fails to correctly identify the \"real\" scrolling container.\n        // Since it's not technically feasible to correctly identify the scrolling container in every possible scenario without some very complex logic, we instead try to add some kind of mechanism to\n        // block runaway requests where UI will keep asking more results in the index, eventually bringing the browser to it's knee.\n        // Those successive request are needed in \"displayMoreResults\" to ensure we fill the scrolling container correctly.\n        // Since the container is not identified correctly, it is never \"full\", so we keep asking for more.\n        // It is reset every time the user actually scroll the container manually.\n        _this.successiveScrollCount = 0;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, ResultList, options);\n        Assert_1.Assert.exists(element);\n        Assert_1.Assert.exists(_this.options);\n        Assert_1.Assert.exists(_this.options.resultTemplate);\n        Assert_1.Assert.exists(_this.options.infiniteScrollContainer);\n        _this.showOrHideElementsDependingOnState(false, false);\n        _this.addListeners();\n        _this.resultContainer = _this.initResultContainer();\n        Assert_1.Assert.exists(_this.options.resultsContainer);\n        _this.initWaitAnimationContainer();\n        Assert_1.Assert.exists(_this.options.waitAnimationContainer);\n        _this.setupTemplatesVersusLayouts();\n        Dom_1.$$(_this.root).on(ResultLayoutEvents_1.ResultLayoutEvents.populateResultLayout, function (e, args) {\n            return args.layouts.push(_this.options.layout);\n        });\n        _this.setupRenderer();\n        _this.makeElementFocusable();\n        _this.ensureHasId();\n        return _this;\n    }\n    ResultList.getDefaultTemplate = function (e) {\n        var template = ResultList.loadTemplatesFromCache();\n        if (template != null) {\n            return template;\n        }\n        var component = Component_1.Component.get(e);\n        if (Coveo['Recommendation'] && component.searchInterface instanceof Coveo['Recommendation']) {\n            return new DefaultRecommendationTemplate_1.DefaultRecommendationTemplate();\n        }\n        return new DefaultResultTemplate_1.DefaultResultTemplate();\n    };\n    ResultList.loadTemplatesFromCache = function () {\n        var pageTemplateNames = TemplateCache_1.TemplateCache.getResultListTemplateNames();\n        if (pageTemplateNames.length > 0) {\n            return new TemplateList_1.TemplateList(underscore_1.compact(underscore_1.map(pageTemplateNames, function (templateName) { return TemplateCache_1.TemplateCache.getTemplate(templateName); })));\n        }\n        return null;\n    };\n    ResultList.prototype.addListeners = function () {\n        var _this = this;\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.newQuery, function (args) { return _this.handleNewQuery(); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) {\n            return _this.handleBuildingQuery(args);\n        });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.querySuccess, function (args) {\n            return _this.handleQuerySuccess(args);\n        });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.duringQuery, function (args) { return _this.handleDuringQuery(); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.queryError, function (args) { return _this.handleQueryError(); });\n        Dom_1.$$(this.root).on(ResultListEvents_1.ResultListEvents.changeLayout, function (e, args) { return _this.handleChangeLayout(args); });\n        if (this.options.enableInfiniteScroll) {\n            this.addInfiniteScrollListeners();\n        }\n        else {\n            this.addPagerListeners();\n        }\n    };\n    ResultList.prototype.addInfiniteScrollListeners = function () {\n        var _this = this;\n        this.bind.on(this.options.infiniteScrollContainer, 'scroll', function () {\n            _this.successiveScrollCount = 0;\n            _this.handleScrollOfResultList();\n        });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function () {\n            setTimeout(function () {\n                _this.scrollToTopIfEnabled();\n            }, 0);\n        });\n    };\n    ResultList.prototype.addPagerListeners = function () {\n        var _this = this;\n        this.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE_ONE, QueryStateModel_1.QUERY_STATE_ATTRIBUTES.FIRST, function () {\n            _this.bind.oneRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function () {\n                setTimeout(function () {\n                    _this.scrollToTopIfEnabled();\n                }, 0);\n            });\n        });\n    };\n    /**\n     * Get the fields needed to be automatically included in the query for this result list.\n     * @returns {string[]}\n     */\n    ResultList.prototype.getAutoSelectedFieldsToInclude = function () {\n        return underscore_1.chain(this.options.resultTemplate.getFields()).concat(this.getMinimalFieldsToInclude()).compact().unique().value();\n    };\n    ResultList.prototype.setupTemplatesVersusLayouts = function () {\n        var _this = this;\n        var layoutClassToAdd = \"coveo-\" + this.options.layout + \"-layout-container\";\n        this.resultContainer.addClass(layoutClassToAdd);\n        if (this.options.layout === 'table') {\n            this.options.resultTemplate = new TableTemplate_1.TableTemplate(this.options.resultTemplate.templates || []);\n        }\n        // A TemplateList is the scenario where the result template are directly embedded inside the ResultList\n        // This is the typical scenario when a page gets created by the interface editor, for example.\n        // In that case, we try to stick closely that what is actually configured inside the page, and do no \"special magic\".\n        // Stick to the \"hardcoded\" configuration present in the page.\n        // We only add the correct layout options if it has not been set manually.\n        if (this.options.resultTemplate instanceof TemplateList_1.TemplateList) {\n            underscore_1.each(this.options.resultTemplate.templates, function (tmpl) {\n                if (!tmpl.layout) {\n                    tmpl.layout = _this.options.layout;\n                }\n            });\n        }\n        else if (this.options.resultTemplate instanceof DefaultResultTemplate_1.DefaultResultTemplate && this.options.layout == 'list') {\n            ResponsiveDefaultResultTemplate_1.ResponsiveDefaultResultTemplate.init(this.root, this, {});\n        }\n    };\n    /**\n     * Empties the current result list content and appends the given array of HTMLElement.\n     *\n     * Can append to existing elements in the result list, or replace them.\n     *\n     * Triggers the `newResultsDisplayed` and `newResultDisplayed` events.\n     * @param resultsElement\n     * @param append\n     */\n    ResultList.prototype.renderResults = function (resultElements, append) {\n        var _this = this;\n        if (append === void 0) { append = false; }\n        if (!append) {\n            this.resultContainer.empty();\n        }\n        return this.renderer\n            .renderResults(resultElements, append, this.triggerNewResultDisplayed.bind(this))\n            .then(function () { return _this.triggerNewResultsDisplayed(); });\n    };\n    /**\n     * Builds and returns an array of HTMLElement with the given result set.\n     * @param results the result set to build an array of HTMLElement from.\n     */\n    ResultList.prototype.buildResults = function (results) {\n        var layout = this.options.layout;\n        return this.templateToHtml.buildResults(results, layout, this.currentlyDisplayedResults);\n    };\n    /**\n     * Builds and returns an HTMLElement for the given result.\n     * @param result the result to build an HTMLElement from.\n     * @returns {HTMLElement}\n     */\n    ResultList.prototype.buildResult = function (result) {\n        var layout = this.options.layout;\n        return this.templateToHtml.buildResult(result, layout, this.currentlyDisplayedResults);\n    };\n    /**\n     * Executes a query to fetch new results. After the query returns, renders the new results.\n     *\n     * Asserts that there are more results to display by verifying whether the last query has returned as many results as\n     * requested.\n     *\n     * Asserts that the `ResultList` is not currently fetching results.\n     * @param count The number of results to fetch and display.\n     */\n    ResultList.prototype.displayMoreResults = function (count) {\n        Assert_1.Assert.isLargerOrEqualsThan(1, count);\n        if (this.isCurrentlyFetchingMoreResults()) {\n            this.logger.warn(\"Ignoring request to display more results since we're already doing so\");\n            return;\n        }\n        if (!this.hasPotentiallyMoreResultsToDisplay()) {\n            this.logger.warn(\"Ignoring request to display more results since we know there aren't more to display\");\n            return;\n        }\n        if (this.options.enableInfiniteScrollWaitingAnimation) {\n            this.showWaitingAnimationForInfiniteScrolling();\n        }\n        return this.fetchAndRenderMoreResults(count);\n    };\n    Object.defineProperty(ResultList.prototype, \"templateToHtml\", {\n        get: function () {\n            var templateToHtmlArgs = {\n                resultTemplate: this.options.resultTemplate,\n                searchInterface: this.searchInterface,\n                queryStateModel: this.queryStateModel\n            };\n            return new TemplateToHtml_1.TemplateToHtml(templateToHtmlArgs);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Gets the list of currently displayed result.\n     * @returns {IQueryResult[]}\n     */\n    ResultList.prototype.getDisplayedResults = function () {\n        return this.currentlyDisplayedResults;\n    };\n    /**\n     * Gets the list of currently displayed result HTMLElement.\n     * @returns {HTMLElement[]}\n     */\n    ResultList.prototype.getDisplayedResultsElements = function () {\n        return this.resultContainer.getResultElements();\n    };\n    ResultList.prototype.enable = function () {\n        this.disableLayoutChange = false;\n        if (this.resultLayoutSelectors.length > 0) {\n            this.enableBasedOnActiveLayouts();\n        }\n        else {\n            _super.prototype.enable.call(this);\n            Dom_1.$$(this.element).removeClass('coveo-hidden');\n        }\n    };\n    ResultList.prototype.disable = function () {\n        var _this = this;\n        _super.prototype.disable.call(this);\n        var otherLayoutsStillActive = underscore_1.map(this.otherResultLists, function (otherResultList) { return otherResultList.options.layout; });\n        if (!underscore_1.contains(otherLayoutsStillActive, this.options.layout) && !this.disableLayoutChange) {\n            underscore_1.each(this.resultLayoutSelectors, function (resultLayoutSelector) {\n                resultLayoutSelector.disableLayouts([_this.options.layout]);\n            });\n        }\n        this.disableLayoutChange = false;\n        Dom_1.$$(this.element).addClass('coveo-hidden');\n    };\n    ResultList.prototype.autoCreateComponentsInsideResult = function (element, result) {\n        return this.templateToHtml.autoCreateComponentsInsideResult(element, result);\n    };\n    ResultList.prototype.triggerNewResultDisplayed = function (result, resultElement) {\n        var args = {\n            result: result,\n            item: resultElement\n        };\n        Dom_1.$$(this.element).trigger(ResultListEvents_1.ResultListEvents.newResultDisplayed, args);\n    };\n    ResultList.prototype.triggerNewResultsDisplayed = function () {\n        var args = {\n            isInfiniteScrollEnabled: this.options.enableInfiniteScroll\n        };\n        Dom_1.$$(this.element).trigger(ResultListEvents_1.ResultListEvents.newResultsDisplayed, args);\n    };\n    ResultList.prototype.fetchAndRenderMoreResults = function (count) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.fetchingMoreResults = this.queryController.fetchMore(count);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.fetchingMoreResults];\n                    case 2:\n                        data = _a.sent();\n                        Assert_1.Assert.exists(data);\n                        this.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.pagerScrolling, {}, this.element);\n                        this.reachedTheEndOfResults = count > data.results.length;\n                        this.renderNewResults(data);\n                        this.resetStateAfterFetchingMoreResults();\n                        return [2 /*return*/, data];\n                    case 3:\n                        e_1 = _a.sent();\n                        this.resetStateAfterFetchingMoreResults();\n                        return [2 /*return*/, Promise.reject(e_1)];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ResultList.prototype.renderNewResults = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            var elements, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.buildResults(data)];\n                    case 1:\n                        elements = _b.sent();\n                        this.renderResults(elements, true);\n                        (_a = this.currentlyDisplayedResults).push.apply(_a, data.results);\n                        this.triggerNewResultsDisplayed();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ResultList.prototype.resetStateAfterFetchingMoreResults = function () {\n        var _this = this;\n        this.hideWaitingAnimationForInfiniteScrolling();\n        this.fetchingMoreResults = undefined;\n        Defer_1.Defer.defer(function () {\n            _this.successiveScrollCount++;\n            if (_this.successiveScrollCount <= ResultList.MAX_AMOUNT_OF_SUCESSIVE_REQUESTS) {\n                _this.handleScrollOfResultList();\n            }\n            else {\n                _this.logger.info(\"Result list has triggered 5 consecutive queries to try and fill up the scrolling container, but it is still unable to do so.\\n          Try explicitly setting the 'data-infinite-scroll-container-selector' option on the result list. See: https://coveo.github.io/search-ui/components/resultlist.html#options.infinitescrollcontainer\");\n            }\n        });\n    };\n    ResultList.prototype.handleDuringQuery = function () {\n        this.logger.trace('Emptying the result container');\n        this.cancelFetchingMoreResultsIfNeeded();\n        this.showWaitingAnimation();\n        this.showOrHideElementsDependingOnState(false, false);\n    };\n    ResultList.prototype.handleQueryError = function () {\n        this.hideWaitingAnimation();\n        this.resultContainer.empty();\n        this.currentlyDisplayedResults = [];\n        this.reachedTheEndOfResults = true;\n    };\n    ResultList.prototype.handleQuerySuccess = function (data) {\n        var _this = this;\n        Assert_1.Assert.exists(data);\n        Assert_1.Assert.exists(data.results);\n        var results = data.results;\n        this.logger.trace('Received query results from new query', results);\n        this.hideWaitingAnimation();\n        ResultList.resultCurrentlyBeingRendered = undefined;\n        this.reachedTheEndOfResults = data.query.numberOfResults > data.results.results.length;\n        this.currentlyDisplayedResults = [];\n        this.buildResults(data.results).then(function (elements) { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.renderResults(elements)];\n                    case 1:\n                        _a.sent();\n                        this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length != 0);\n                        if (DeviceUtils_1.DeviceUtils.isMobileDevice() && this.options.mobileScrollContainer != undefined) {\n                            this.options.mobileScrollContainer.scrollTop = 0;\n                        }\n                        if (this.options.enableInfiniteScroll && results.results.length == data.queryBuilder.numberOfResults) {\n                            // This will check right away if we need to add more results to make the scroll container full & scrolling.\n                            this.scrollToTopIfEnabled();\n                            this.handleScrollOfResultList();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    };\n    ResultList.prototype.handleScrollOfResultList = function () {\n        if (this.isCurrentlyFetchingMoreResults() || !this.options.enableInfiniteScroll) {\n            return;\n        }\n        if (this.isScrollingOfResultListAlmostAtTheBottom() && this.hasPotentiallyMoreResultsToDisplay()) {\n            this.displayMoreResults(this.options.infiniteScrollPageSize);\n        }\n    };\n    ResultList.prototype.scrollToTopIfEnabled = function () {\n        if (!this.options.enableScrollToTop) {\n            return;\n        }\n        ResultListUtils_1.ResultListUtils.scrollToTop(this.root);\n    };\n    ResultList.prototype.handleNewQuery = function () {\n        Dom_1.$$(this.element).removeClass('coveo-hidden');\n        ResultList.resultCurrentlyBeingRendered = undefined;\n    };\n    Object.defineProperty(ResultList.prototype, \"otherResultLists\", {\n        get: function () {\n            var allResultLists = this.searchInterface.getComponents(ResultList.ID);\n            return underscore_1.without(allResultLists, this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultList.prototype, \"resultLayoutSelectors\", {\n        get: function () {\n            return this.searchInterface.getComponents('ResultLayoutSelector');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResultList.prototype.handleBuildingQuery = function (args) {\n        if (this.options.fieldsToInclude != null) {\n            // remove the @\n            args.queryBuilder.addFieldsToInclude(underscore_1.map(this.options.fieldsToInclude, function (field) { return field.substr(1); }));\n        }\n        if (this.options.autoSelectFieldsToInclude) {\n            var otherFields = underscore_1.flatten(underscore_1.map(this.otherResultLists, function (otherResultList) {\n                return otherResultList.getAutoSelectedFieldsToInclude();\n            }));\n            args.queryBuilder.addRequiredFields(underscore_1.unique(otherFields.concat(this.getAutoSelectedFieldsToInclude())));\n            args.queryBuilder.includeRequiredFields = true;\n        }\n    };\n    ResultList.prototype.handleChangeLayout = function (args) {\n        var _this = this;\n        if (args.layout === this.options.layout) {\n            this.disableLayoutChange = false;\n            this.enable();\n            this.options.resultTemplate.layout = this.options.layout;\n            if (args.results) {\n                // Prevent flickering when switching to a new layout that is empty\n                // add a temporary placeholder, the same that is used on initialization\n                if (this.resultContainer.isEmpty()) {\n                    new InitializationPlaceholder_1.InitializationPlaceholder(this.root).withVisibleRootElement().withPlaceholderForResultList();\n                }\n                Defer_1.Defer.defer(function () { return __awaiter(_this, void 0, void 0, function () {\n                    var elements;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0: return [4 /*yield*/, this.buildResults(args.results)];\n                            case 1:\n                                elements = _a.sent();\n                                this.renderResults(elements);\n                                this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length !== 0);\n                                return [2 /*return*/];\n                        }\n                    });\n                }); });\n            }\n        }\n        else {\n            this.disableLayoutChange = true;\n            this.disable();\n            this.resultContainer.empty();\n        }\n    };\n    ResultList.prototype.isCurrentlyFetchingMoreResults = function () {\n        return Utils_1.Utils.exists(this.fetchingMoreResults);\n    };\n    ResultList.prototype.getMinimalFieldsToInclude = function () {\n        // these fields are needed for analytics click event\n        return ['author', 'language', 'urihash', 'objecttype', 'collection', 'source', 'language', 'permanentid'];\n    };\n    ResultList.prototype.isScrollingOfResultListAlmostAtTheBottom = function () {\n        // this is in a try catch because the unit test fail otherwise (Window does not exist for phantom js in the console)\n        var isWindow;\n        try {\n            isWindow = this.options.infiniteScrollContainer instanceof Window;\n        }\n        catch (e) {\n            isWindow = false;\n        }\n        return isWindow ? this.isScrollAtBottomForWindowElement() : this.isScrollAtBottomForHtmlElement();\n    };\n    ResultList.prototype.isScrollAtBottomForWindowElement = function () {\n        var win = new Dom_1.Win(window);\n        var windowHeight = win.height();\n        var scrollTop = win.scrollY();\n        var bodyHeight = new Dom_1.Doc(document).height();\n        return bodyHeight - (windowHeight + scrollTop) < windowHeight / 2;\n    };\n    ResultList.prototype.isScrollAtBottomForHtmlElement = function () {\n        var el = this.options.infiniteScrollContainer;\n        var elementHeight = el.clientHeight;\n        var scrollHeight = el.scrollHeight;\n        var bottomPosition = el.scrollTop + elementHeight;\n        return scrollHeight - bottomPosition < elementHeight / 2;\n    };\n    ResultList.prototype.hasPotentiallyMoreResultsToDisplay = function () {\n        return this.currentlyDisplayedResults.length > 0 && !this.reachedTheEndOfResults;\n    };\n    ResultList.prototype.cancelFetchingMoreResultsIfNeeded = function () {\n        if (this.isCurrentlyFetchingMoreResults()) {\n            this.logger.trace('Cancelling fetching more results');\n            Promise.reject(this.fetchingMoreResults);\n            this.fetchingMoreResults = undefined;\n        }\n    };\n    ResultList.prototype.showOrHideElementsDependingOnState = function (hasQuery, hasResults) {\n        var showIfQuery = Dom_1.$$(this.element).findAll('.coveo-show-if-query');\n        var showIfNoQuery = Dom_1.$$(this.element).findAll('.coveo-show-if-no-query');\n        var showIfResults = Dom_1.$$(this.element).findAll('.coveo-show-if-results');\n        var showIfNoResults = Dom_1.$$(this.element).findAll('.coveo-show-if-no-results');\n        underscore_1.each(showIfQuery, function (s) {\n            Dom_1.$$(s).toggle(hasQuery);\n        });\n        underscore_1.each(showIfNoQuery, function (s) {\n            Dom_1.$$(s).toggle(!hasQuery);\n        });\n        underscore_1.each(showIfResults, function (s) {\n            Dom_1.$$(s).toggle(hasQuery && hasResults);\n        });\n        underscore_1.each(showIfNoResults, function (s) {\n            Dom_1.$$(s).toggle(hasQuery && !hasResults);\n        });\n    };\n    Object.defineProperty(ResultList.prototype, \"waitAnimation\", {\n        get: function () {\n            return this.options.waitAnimation.toLowerCase();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResultList.prototype.showWaitingAnimation = function () {\n        switch (this.waitAnimation) {\n            case 'fade':\n                Dom_1.$$(this.options.waitAnimationContainer).addClass('coveo-fade-out');\n                break;\n            case 'spinner':\n                this.resultContainer.hideChildren();\n                if (Dom_1.$$(this.options.waitAnimationContainer).find('.coveo-wait-animation') == undefined) {\n                    this.options.waitAnimationContainer.appendChild(DomUtils_1.DomUtils.getBasicLoadingAnimation());\n                }\n                break;\n        }\n    };\n    ResultList.prototype.hideWaitingAnimation = function () {\n        switch (this.waitAnimation) {\n            case 'fade':\n                Dom_1.$$(this.options.waitAnimationContainer).removeClass('coveo-fade-out');\n                break;\n            case 'spinner':\n                var spinner = Dom_1.$$(this.options.waitAnimationContainer).find('.coveo-loading-spinner');\n                if (spinner) {\n                    Dom_1.$$(spinner).detach();\n                }\n                break;\n        }\n    };\n    ResultList.prototype.showWaitingAnimationForInfiniteScrolling = function () {\n        var spinner = DomUtils_1.DomUtils.getLoadingSpinner();\n        if (this.options.layout == 'card' && this.options.enableInfiniteScroll) {\n            var previousSpinnerContainer = Dom_1.$$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n            underscore_1.each(previousSpinnerContainer, function (previousSpinner) { return Dom_1.$$(previousSpinner).remove(); });\n            var spinnerContainer = Dom_1.$$('div', {\n                className: 'coveo-loading-spinner-container'\n            });\n            spinnerContainer.append(spinner);\n            this.options.waitAnimationContainer.appendChild(spinnerContainer.el);\n        }\n        else {\n            this.options.waitAnimationContainer.appendChild(DomUtils_1.DomUtils.getLoadingSpinner());\n        }\n    };\n    ResultList.prototype.hideWaitingAnimationForInfiniteScrolling = function () {\n        var spinners = Dom_1.$$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner');\n        var containers = Dom_1.$$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n        underscore_1.each(spinners, function (spinner) { return Dom_1.$$(spinner).remove(); });\n        underscore_1.each(containers, function (container) { return Dom_1.$$(container).remove(); });\n    };\n    ResultList.prototype.initResultContainer = function () {\n        if (!this.options.resultsContainer) {\n            var elemType = this.options.layout === 'table' ? 'table' : 'div';\n            this.options.resultsContainer = Dom_1.$$(elemType, { className: 'coveo-result-list-container' }).el;\n            this.initResultContainerAddToDom();\n        }\n        return new ResultContainer_1.ResultContainer(this.options.resultsContainer, this.searchInterface);\n    };\n    ResultList.prototype.initResultContainerAddToDom = function () {\n        this.element.appendChild(this.options.resultsContainer);\n    };\n    ResultList.prototype.initWaitAnimationContainer = function () {\n        if (!this.options.waitAnimationContainer) {\n            this.options.waitAnimationContainer = this.resultContainer.el;\n        }\n    };\n    ResultList.prototype.setupRenderer = function () {\n        var initParameters = {\n            options: this.searchInterface.options.originalOptionsObject,\n            bindings: this.bindings\n        };\n        var autoCreateComponentsFn = function (elem) { return Initialization_1.Initialization.automaticallyCreateComponentsInside(elem, initParameters); };\n        switch (this.options.layout) {\n            case 'card':\n                this.renderer = new ResultListCardRenderer_1.ResultListCardRenderer(this.options, autoCreateComponentsFn);\n                break;\n            case 'table':\n                this.renderer = new ResultListTableRenderer_1.ResultListTableRenderer(this.options, autoCreateComponentsFn);\n                break;\n            case 'list':\n            default:\n                this.renderer = new ResultListRenderer_1.ResultListRenderer(this.options, autoCreateComponentsFn);\n                break;\n        }\n    };\n    ResultList.prototype.makeElementFocusable = function () {\n        Dom_1.$$(this.element).setAttribute('tabindex', '-1');\n    };\n    ResultList.prototype.ensureHasId = function () {\n        var currentId = this.element.id;\n        if (currentId === '') {\n            this.element.id = underscore_1.uniqueId('coveo-result-list');\n        }\n    };\n    ResultList.prototype.enableBasedOnActiveLayouts = function () {\n        var _this = this;\n        // We should try to enable a result list only when the result layout selector currently allow that result list layout to be displayed.\n        underscore_1.each(this.resultLayoutSelectors, function (resultLayoutSelector) {\n            var found = underscore_1.find(resultLayoutSelector.activeLayouts, function (activeLayout, activeLayoutKey) { return activeLayoutKey == _this.options.layout; });\n            if (found) {\n                _super.prototype.enable.call(_this);\n                resultLayoutSelector.enableLayouts([_this.options.layout]);\n                Dom_1.$$(_this.element).removeClass('coveo-hidden');\n            }\n        });\n    };\n    ResultList.ID = 'ResultList';\n    ResultList.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            ResultList: ResultList\n        });\n    };\n    /**\n     * The options for the ResultList\n     * @componentOptions\n     */\n    ResultList.options = {\n        /**\n         * The element inside which to insert the rendered result templates.\n         *\n         * Performing a new query clears the content of this element.\n         *\n         * You can change the container by specifying its selector (e.g.,\n         * `data-result-container-selector='#someCssSelector'`).\n         *\n         * If you specify no value for this option, a `div` element will be dynamically created and appended to the result\n         * list. This element will then be used as a result container.\n         */\n        resultsContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({ alias: 'resultContainerSelector' }),\n        resultTemplate: TemplateComponentOptions_1.TemplateComponentOptions.buildTemplateOption({ defaultFunction: ResultList.getDefaultTemplate }),\n        /**\n         * The type of animation to display while waiting for a query to return.\n         *\n         * The possible values are:\n         * - `fade`: Fades out the current list of results while the query is executing.\n         * - `spinner`: Shows a spinning animation while the query is executing.\n         * - `none`: Use no animation during queries.\n         *\n         * See also the [`waitAnimationContainer`]{@link ResultList.options.waitAnimationContainer} option.\n         *\n         * @examples spinner\n         */\n        waitAnimation: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: 'none' }),\n        /**\n         * The element inside which to display the [`waitAnimation`]{@link ResultList.options.waitAnimation}.\n         *\n         * You can change this by specifying a CSS selector (e.g.,\n         * `data-wait-animation-container-selector='#someCssSelector'`).\n         *\n         * Defaults to the value of the [`resultsContainer`]{@link ResultList.options.resultsContainer} option.\n         */\n        waitAnimationContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({\n            postProcessing: function (value, options) { return value || options.resultsContainer; }\n        }),\n        /**\n         * Whether to automatically retrieve an additional page of results and append it to the\n         * results that the `ResultList` is currently displaying when the user scrolls down to the bottom of the\n         * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n         *\n         * See also the [`infiniteScrollPageSize`]{@link ResultList.options.infiniteScrollPageSize} and\n         * [`enableInfiniteScrollWaitingAnimation`]{@link ResultList.options.enableInfiniteScrollWaitingAnimation} options.\n         *\n         * It is important to specify the `infiniteScrollContainer` option manually if you want the scrolling element to be\n         * something else than the default `window` element. Otherwise, you might find yourself in a strange state where the\n         * framework rapidly triggers multiple successive query.\n         */\n        enableInfiniteScroll: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\n        /**\n         * The number of additional results to fetch when the user scrolls down to the bottom of the\n         * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n         *\n         * @examples 5\n         */\n        infiniteScrollPageSize: ComponentOptions_1.ComponentOptions.buildNumberOption({\n            defaultValue: 10,\n            min: 1,\n            depend: 'enableInfiniteScroll'\n        }),\n        /**\n         * The element that triggers fetching additional results when the end user scrolls down to its bottom.\n         *\n         * You can change the container by specifying its selector (e.g.,\n         * `data-infinite-scroll-container-selector='#someCssSelector'`).\n         *\n         * By default, the framework uses the first vertically scrollable parent element it finds, starting from the\n         * `ResultList` element itself. A vertically scrollable element is an element whose CSS `overflow-y` attribute is\n         * `scroll`.\n         *\n         * This implies that if the framework can find no scrollable parent, it uses the `window` itself as a scrollable\n         * container.\n         *\n         * This heuristic is not perfect, for technical reasons. There are always some corner case CSS combination which the\n         * framework will not be able to correctly detect as 'scrollable'.\n         *\n         * It is highly recommended that you manually set this option if you wish something else than the `window` to be the\n         * scrollable element.\n         */\n        infiniteScrollContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({\n            depend: 'enableInfiniteScroll',\n            defaultFunction: function (element) { return ComponentOptions_1.ComponentOptions.findParentScrolling(element); }\n        }),\n        /**\n         * Whether to display the [`waitingAnimation`]{@link ResultList.options.waitAnimation} while fetching additional\n         * results.\n         */\n        enableInfiniteScrollWaitingAnimation: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            depend: 'enableInfiniteScroll',\n            defaultValue: true\n        }),\n        mobileScrollContainer: ComponentOptions_1.ComponentOptions.buildSelectorOption({\n            defaultFunction: function () { return document.querySelector('.coveo-results-column'); }\n        }),\n        /**\n         * Whether the `ResultList` should scan its result templates to discover which fields it must request to\n         * be able to render all results.\n         *\n         * Setting this option to `true` ensures that the Coveo Search API does not return fields that are unnecessary for\n         * the UI to function.\n         *\n         * If you set this option to `true`, the fields referenced in your result folding templates won't be automatically resolved.\n         * In such a case, you must manually specify those fields using the [`fieldsToInclude`]{@link ResultList.options.fieldsToInclude} option.\n         *\n         * **Notes:**\n         *\n         * - Many interfaces created with the JavaScript Search Interface Editor explicitly set this option to `true`.\n         * - You cannot set this option to `true` in the Coveo for Sitecore integration.\n         */\n        autoSelectFieldsToInclude: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\n        /**\n         * A list of fields to include in the query results.\n         *\n         * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n         * `true`, the Coveo Search API returns the fields you specify for this option (if those fields are available) in\n         * addition to the fields which the `ResultList` automatically requests. Note that the `autoSelectFieldsToInclude`\n         * option doesn't automatically request fields for folding templates; in such a case, you must manually specify\n         * fields using this option to avoid empty results.\n         *\n         * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n         * `false`, the Coveo Search API only returns the fields you specify for this option (if those fields are\n         * available).\n         *\n         * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n         * `false` and leave this option undefined, the Coveo Search API returns all available fields.\n         */\n        fieldsToInclude: ComponentOptions_1.ComponentOptions.buildFieldsOption({ includeInResults: true }),\n        /**\n         * Specifies the layout to use when displaying results in this `ResultList` (see\n         * [Result Layouts](https://docs.coveo.com/en/360/)). Specifying a value for this option automatically\n         * populates a [`ResultLayout`]{@link ResultLayout} component with a switcher for the layout.\n         *\n         * For example, if there are two `ResultList` components in the page, one with its `layout` set to `list` and the\n         * other with the same option set to `card`, then the `ResultLayout` component will render two buttons respectively\n         * entitled **List** and **Card**.\n         *\n         * See the [`ValidLayout`]{@link ValidLayout} type for the list of possible values.\n         *\n         * @examples card\n         */\n        layout: ComponentOptions_1.ComponentOptions.buildStringOption({\n            defaultValue: 'list',\n            required: true\n        }),\n        /**\n         * Whether to scroll back to the top of the page when the end-user:\n         *  - interacts with a facet when [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer} is set to `true`\n         *  - interacts with the [`Pager`]{@link Pager} component when [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer} is set to `false`\n         *\n         * **Note:** Setting this option to `false` has no effect on dynamic facets. To disable this behavior on a `DynamicFacet` component, you must set its own [`enableScrollToTop`]{@link DynamicFacet.options.enableScrollToTop} option to `false`.\n         *\n         * @availablesince [July 2019 Release (v2.6459)](https://docs.coveo.com/en/2938/)\n         */\n        enableScrollToTop: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            defaultValue: true\n        })\n    };\n    ResultList.resultCurrentlyBeingRendered = null;\n    ResultList.MAX_AMOUNT_OF_SUCESSIVE_REQUESTS = 5;\n    return ResultList;\n}(Component_1.Component));\nexports.ResultList = ResultList;\nInitialization_1.Initialization.registerAutoCreateComponent(ResultList);\n\n\n/***/ }),\n\n/***/ 91:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar Strings_1 = __webpack_require__(6);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Dom_1 = __webpack_require__(1);\nvar Initialization_1 = __webpack_require__(2);\nvar GlobalExports_1 = __webpack_require__(3);\nvar CategoryFacetTemplates_1 = __webpack_require__(547);\nvar CategoryValueRoot_1 = __webpack_require__(548);\nvar CategoryFacetQueryController_1 = __webpack_require__(550);\nvar SVGDom_1 = __webpack_require__(15);\nvar SVGIcons_1 = __webpack_require__(12);\nvar QueryStateModel_1 = __webpack_require__(13);\n__webpack_require__(551);\nvar Model_1 = __webpack_require__(18);\nvar Utils_1 = __webpack_require__(4);\nvar underscore_1 = __webpack_require__(0);\nvar Assert_1 = __webpack_require__(5);\nvar QueryEvents_1 = __webpack_require__(11);\nvar CategoryFacetSearch_1 = __webpack_require__(552);\nvar BreadcrumbEvents_1 = __webpack_require__(35);\nvar CategoryFacetBreadcrumb_1 = __webpack_require__(554);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar CategoryFacetDebug_1 = __webpack_require__(555);\nvar QueryBuilder_1 = __webpack_require__(48);\nvar ResponsiveFacets_1 = __webpack_require__(171);\nvar ResponsiveFacetOptions_1 = __webpack_require__(82);\nvar CategoryFacetHeader_1 = __webpack_require__(556);\nvar AccessibleButton_1 = __webpack_require__(16);\nvar DependsOnManager_1 = __webpack_require__(170);\nvar ResultListUtils_1 = __webpack_require__(113);\nvar CategoryFacetValuesTree_1 = __webpack_require__(557);\n/**\n * The `CategoryFacet` component is a facet that renders values in a hierarchical fashion. It determines the filter to apply depending on the\n * current selected path of values.\n *\n * The path is a sequence of values that leads to a specific value in the hierarchy.\n * It is an array listing all the parents of a file (e.g., `['c', 'folder1']` for the `c:\\folder1\\text1.txt` file).\n *\n * This facet requires a [`field`]{@link CategoryFacet.options.field} with a special format to work correctly (see [Using the Category Facet Component](https://docs.coveo.com/en/2667)).\n *\n * @notSupportedIn salesforcefree\n * @availablesince [January 2019 Release (v2.5395.12)]({{ site.baseurl }}/2938/)\n */\nvar CategoryFacet = /** @class */ (function (_super) {\n    __extends(CategoryFacet, _super);\n    function CategoryFacet(element, options, bindings) {\n        var _this = _super.call(this, element, 'CategoryFacet', bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.listenToQueryStateChange = true;\n        _this.moreValuesToFetch = true;\n        _this.showingWaitAnimation = false;\n        _this.numberOfChildValuesCurrentlyDisplayed = 0;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, CategoryFacet, options);\n        _this.categoryFacetQueryController = new CategoryFacetQueryController_1.CategoryFacetQueryController(_this);\n        _this.categoryFacetTemplates = new CategoryFacetTemplates_1.CategoryFacetTemplates();\n        _this.categoryValueRoot = new CategoryValueRoot_1.CategoryValueRoot(Dom_1.$$(_this.element), _this.categoryFacetTemplates, _this);\n        _this.categoryValueRoot.path = _this.activePath;\n        _this.currentPage = 0;\n        _this.numberOfValues = _this.options.numberOfValues;\n        _this.categoryFacetValuesTree = new CategoryFacetValuesTree_1.CategoryFacetValuesTree();\n        _this.tryToInitFacetSearch();\n        if (_this.options.debug) {\n            new CategoryFacetDebug_1.CategoryFacetDebug(_this);\n        }\n        ResponsiveFacets_1.ResponsiveFacets.init(_this.root, _this, _this.options);\n        _this.initDependsOnManager();\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) { return _this.handleBuildingQuery(args); });\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.querySuccess, function (args) { return _this.handleQuerySuccess(args); });\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.duringQuery, function () { return _this.addFading(); });\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function () { return _this.handleDeferredQuerySuccess(); });\n        _this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.populateBreadcrumb, function (args) { return _this.handlePopulateBreadCrumb(args); });\n        _this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.clearBreadcrumb, function () { return _this.handleClearBreadcrumb(); });\n        _this.buildFacetHeader();\n        _this.initQueryStateEvents();\n        return _this;\n    }\n    CategoryFacet.prototype.isCurrentlyDisplayed = function () {\n        return Dom_1.$$(this.element).isVisible();\n    };\n    Object.defineProperty(CategoryFacet.prototype, \"activePath\", {\n        get: function () {\n            return this.queryStateModel.get(this.queryStateAttribute) || this.options.basePath;\n        },\n        set: function (newPath) {\n            this.listenToQueryStateChange = false;\n            this.queryStateModel.set(this.queryStateAttribute, newPath);\n            this.listenToQueryStateChange = true;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CategoryFacet.prototype, \"queryStateAttribute\", {\n        get: function () {\n            return QueryStateModel_1.QueryStateModel.getFacetId(this.options.id);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CategoryFacet.prototype.handleBuildingQuery = function (args) {\n        this.positionInQuery = this.categoryFacetQueryController.putCategoryFacetInQueryBuilder(args.queryBuilder, this.activePath, this.numberOfValues + 1);\n    };\n    CategoryFacet.prototype.scrollToTop = function () {\n        ResultListUtils_1.ResultListUtils.scrollToTop(this.root);\n    };\n    CategoryFacet.prototype.tryToInitFacetSearch = function () {\n        if (!this.isFacetSearchAvailable) {\n            return this.logDisabledFacetSearchWarning();\n        }\n        this.categoryFacetSearch = new CategoryFacetSearch_1.CategoryFacetSearch(this, this.options.displaySearchButton);\n    };\n    CategoryFacet.prototype.logDisabledFacetSearchWarning = function () {\n        if (this.isEnableFacetSearchFalsy) {\n            return;\n        }\n        var valueCaptionAttributeName = this.getOptionAttributeName('valueCaption');\n        var enableFacetSearchAttributeName = this.getOptionAttributeName('enableFacetSearch');\n        var field = this.options.field;\n        this.logger.warn(\"The search box is disabled on the \" + field + \" CategoryFacet. To hide this warning,\\n    either remove the \" + valueCaptionAttributeName + \" option or set the \" + enableFacetSearchAttributeName + \" option to \\\"false\\\".\");\n    };\n    CategoryFacet.prototype.getOptionAttributeName = function (optionName) {\n        return ComponentOptions_1.ComponentOptions.attrNameFromName(optionName);\n    };\n    Object.defineProperty(CategoryFacet.prototype, \"isFacetSearchAvailable\", {\n        get: function () {\n            if (this.areValueCaptionsSpecified) {\n                return false;\n            }\n            if (this.isEnableFacetSearchFalsy) {\n                return false;\n            }\n            return true;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CategoryFacet.prototype, \"areValueCaptionsSpecified\", {\n        get: function () {\n            var valueCaptions = this.options.valueCaption;\n            return underscore_1.keys(valueCaptions).length !== 0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CategoryFacet.prototype, \"isEnableFacetSearchFalsy\", {\n        get: function () {\n            return !this.options.enableFacetSearch;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CategoryFacet.prototype, \"isCategoryEmpty\", {\n        get: function () {\n            return !this.categoryValueRoot.children.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CategoryFacet.prototype.updateAppearance = function () {\n        if (this.disabled || this.isCategoryEmpty) {\n            return this.hide();\n        }\n        this.show();\n    };\n    CategoryFacet.prototype.handleQuerySuccess = function (args) {\n        if (Utils_1.Utils.isNullOrUndefined(args.results.categoryFacets)) {\n            return this.notImplementedError();\n        }\n        if (Utils_1.Utils.isNullOrUndefined(args.results.categoryFacets[this.positionInQuery])) {\n            return;\n        }\n        var numberOfRequestedValues = args.query.categoryFacets[this.positionInQuery].maximumNumberOfValues;\n        var categoryFacetResult = args.results.categoryFacets[this.positionInQuery];\n        this.moreValuesToFetch = numberOfRequestedValues == categoryFacetResult.values.length;\n        this.clear();\n        if (categoryFacetResult.notImplemented) {\n            return this.notImplementedError();\n        }\n        if (!categoryFacetResult.values.length && !categoryFacetResult.parentValues.length) {\n            return;\n        }\n        this.renderValues(categoryFacetResult, numberOfRequestedValues);\n        if (this.isFacetSearchAvailable) {\n            var facetSearch = this.categoryFacetSearch.build();\n            this.options.displaySearchOnTop\n                ? Dom_1.$$(facetSearch).insertBefore(this.categoryValueRoot.listRoot.el)\n                : Dom_1.$$(facetSearch).insertAfter(this.categoryValueRoot.listRoot.el);\n        }\n        this.moreLessContainer = Dom_1.$$('div', { className: 'coveo-category-facet-more-less-container' });\n        Dom_1.$$(this.element).append(this.moreLessContainer.el);\n        if (this.options.enableMoreLess) {\n            this.renderMoreLess();\n        }\n        if (!this.isPristine()) {\n            Dom_1.$$(this.element).addClass('coveo-category-facet-non-empty-path');\n        }\n    };\n    /**\n     * Changes the active path.\n     *\n     */\n    CategoryFacet.prototype.changeActivePath = function (path) {\n        this.activePath = path;\n    };\n    CategoryFacet.prototype.executeQuery = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.showWaitingAnimation();\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, , 3, 4]);\n                        return [4 /*yield*/, this.queryController.executeQuery()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        this.hideWaitingAnimation();\n                        return [7 /*endfinally*/];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Reloads the facet with the same path.\n     */\n    CategoryFacet.prototype.reload = function () {\n        this.changeActivePath(this.activePath);\n        this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetReload);\n        this.executeQuery();\n    };\n    /**\n     * Returns all the visible parent values.\n     * @returns simple object with three fields: `value`, `count` and `path`.\n     */\n    CategoryFacet.prototype.getVisibleParentValues = function () {\n        return this.getVisibleParentCategoryValues().map(function (categoryValue) { return categoryValue.getDescriptor(); });\n    };\n    CategoryFacet.prototype.getVisibleParentCategoryValues = function () {\n        if (this.categoryValueRoot.children.length == 0 || this.categoryValueRoot.children[0].children.length == 0) {\n            return [];\n        }\n        var currentParentvalue = this.categoryValueRoot.children[0];\n        var parentValues = [currentParentvalue];\n        while (currentParentvalue.children.length != 0 && !Utils_1.Utils.arrayEqual(currentParentvalue.path, this.activePath)) {\n            currentParentvalue = currentParentvalue.children[0];\n            parentValues.push(currentParentvalue);\n        }\n        return parentValues;\n    };\n    /**\n     * Shows more values according to {@link CategoryFacet.options.pageSize}.\n     *\n     * See the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess}, and\n     * [`numberOfValues`]{@link CategoryFacet.options.numberOfValues} options.\n     */\n    CategoryFacet.prototype.showMore = function () {\n        if (this.moreValuesToFetch) {\n            this.currentPage++;\n            this.numberOfValues = this.options.numberOfValues + this.currentPage * this.options.pageSize;\n            this.reload();\n            this.logAnalyticsFacetShowMoreLess(AnalyticsActionListMeta_1.analyticsActionCauseList.facetShowMore);\n        }\n    };\n    /**\n     * Shows less values, up to the original number of values.\n     *\n     * See the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess}, and\n     * [`numberOfValues`]{@link CategoryFacet.options.numberOfValues} options.\n     */\n    CategoryFacet.prototype.showLess = function () {\n        if (this.currentPage > 0) {\n            this.currentPage--;\n            this.numberOfValues = this.options.numberOfValues + this.currentPage * this.options.pageSize;\n            this.reload();\n            this.logAnalyticsFacetShowMoreLess(AnalyticsActionListMeta_1.analyticsActionCauseList.facetShowLess);\n        }\n    };\n    /**\n     * Returns the values at the bottom of the hierarchy. These are the values that are not yet applied to the query.\n     * @returns simple object with three fields: `value`, `count` and `path`.\n     */\n    CategoryFacet.prototype.getAvailableValues = function () {\n        if (!this.activeCategoryValue) {\n            return [];\n        }\n        return this.activeCategoryValue.children.map(function (categoryValue) {\n            return {\n                value: categoryValue.categoryValueDescriptor.value,\n                count: categoryValue.categoryValueDescriptor.count,\n                path: categoryValue.path\n            };\n        });\n    };\n    /**\n     * Selects a value from the currently available values.\n     * If the given value to select is not in the available values, it will throw an error.\n     */\n    CategoryFacet.prototype.selectValue = function (value) {\n        Assert_1.Assert.check(underscore_1.contains(underscore_1.pluck(this.getAvailableValues(), 'value'), value), 'Failed while trying to select a value that is not available.');\n        var newPath = this.activePath.slice(0);\n        newPath.push(value);\n        this.changeActivePath(newPath);\n        this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetSelect);\n        this.executeQuery();\n    };\n    /**\n     * Deselects the last value in the hierarchy that is applied to the query. When at the top of the hierarchy, this method does nothing.\n     */\n    CategoryFacet.prototype.deselectCurrentValue = function () {\n        if (this.activePath.length == 0) {\n            return;\n        }\n        var newPath = this.activePath.slice(0);\n        newPath.pop();\n        this.changeActivePath(newPath);\n        this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetSelect);\n        this.executeQuery();\n    };\n    CategoryFacet.prototype.resetPath = function () {\n        this.changeActivePath(this.options.basePath);\n    };\n    /**\n     * Resets the facet to its initial state.\n     */\n    CategoryFacet.prototype.reset = function () {\n        this.resetPath();\n        this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.categoryFacetClear);\n        this.executeQuery();\n    };\n    /**\n     * Hides the component.\n     */\n    CategoryFacet.prototype.hide = function () {\n        Dom_1.$$(this.element).addClass('coveo-hidden');\n    };\n    /**\n     * Shows the component.\n     */\n    CategoryFacet.prototype.show = function () {\n        Dom_1.$$(this.element).removeClass('coveo-hidden');\n    };\n    CategoryFacet.prototype.enable = function () {\n        _super.prototype.enable.call(this);\n        this.updateAppearance();\n    };\n    CategoryFacet.prototype.disable = function () {\n        _super.prototype.disable.call(this);\n        this.updateAppearance();\n    };\n    /**\n     * Goes through any value that contains the value parameter, and verifies whether there are missing parents.\n     * Issues are then logged in the console.\n     * If you do not want to specify a value, you can simply enable {@link CategoryFacet.options.debug} and do an empty query.\n     */\n    CategoryFacet.prototype.debugValue = function (value) {\n        return __awaiter(this, void 0, void 0, function () {\n            var queryBuilder, queryResults;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        queryBuilder = new QueryBuilder_1.QueryBuilder();\n                        this.categoryFacetQueryController.addDebugGroupBy(queryBuilder, value);\n                        return [4 /*yield*/, this.queryController.getEndpoint().search(queryBuilder.build())];\n                    case 1:\n                        queryResults = _a.sent();\n                        CategoryFacetDebug_1.CategoryFacetDebug.analyzeResults(queryResults.groupByResults[0], this.options.delimitingCharacter);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     *\n     * @param value The string to find a caption for.\n     * Returns the caption for a value or the value itself if no caption is available.\n     */\n    CategoryFacet.prototype.getCaption = function (value) {\n        var valueCaptions = this.options.valueCaption;\n        var caption = valueCaptions[value];\n        return caption ? caption : value;\n    };\n    CategoryFacet.prototype.showWaitingAnimation = function () {\n        this.ensureDom();\n        if (!this.showingWaitAnimation) {\n            Dom_1.$$(this.headerElement).find('.coveo-category-facet-header-wait-animation').style.visibility = 'visible';\n            this.showingWaitAnimation = true;\n        }\n    };\n    CategoryFacet.prototype.hideWaitingAnimation = function () {\n        this.ensureDom();\n        if (this.showingWaitAnimation) {\n            Dom_1.$$(this.headerElement).find('.coveo-category-facet-header-wait-animation').style.visibility = 'hidden';\n            this.showingWaitAnimation = false;\n        }\n    };\n    CategoryFacet.prototype.logAnalyticsEvent = function (eventName, path) {\n        if (path === void 0) { path = this.activePath; }\n        this.usageAnalytics.logSearchEvent(eventName, {\n            categoryFacetId: this.options.id,\n            categoryFacetField: this.options.field.toString(),\n            categoryFacetPath: path,\n            categoryFacetTitle: this.options.title\n        });\n    };\n    CategoryFacet.prototype.getEndpoint = function () {\n        return this.queryController.getEndpoint();\n    };\n    Object.defineProperty(CategoryFacet.prototype, \"children\", {\n        get: function () {\n            return this.categoryValueRoot.children;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CategoryFacet.prototype.renderValues = function (categoryFacetResult, numberOfRequestedValues) {\n        this.categoryFacetValuesTree.storeNewValues(categoryFacetResult);\n        var sortedParentValues = this.sortParentValues(categoryFacetResult.parentValues);\n        var currentParentValue = this.categoryValueRoot;\n        var needToTruncate = false;\n        var pathOfLastTruncatedParentValue;\n        var numberOfItemsInFirstSlice = Math.floor(CategoryFacet.NUMBER_OF_VALUES_TO_KEEP_AFTER_TRUNCATING / 2);\n        var numberOfItemsInSecondSlice = Math.ceil(CategoryFacet.NUMBER_OF_VALUES_TO_KEEP_AFTER_TRUNCATING / 2);\n        sortedParentValues = this.hideBasePathInParentValues(sortedParentValues);\n        if (this.shouldTruncate(sortedParentValues)) {\n            pathOfLastTruncatedParentValue = this.findPathOfLastTruncatedParentValue(sortedParentValues, numberOfItemsInSecondSlice);\n            needToTruncate = true;\n            sortedParentValues = underscore_1.first(sortedParentValues, numberOfItemsInFirstSlice).concat(underscore_1.last(sortedParentValues, numberOfItemsInSecondSlice));\n        }\n        if (!this.isPristine()) {\n            this.addAllCategoriesButton();\n        }\n        for (var i = 0; i < sortedParentValues.length; i++) {\n            currentParentValue = currentParentValue.renderAsParent(sortedParentValues[i]);\n            // We do not want to make the \"last\" parent selectable, as clicking it would be a noop (re-selecting the same filter)\n            var isLastParent = i == sortedParentValues.length - 1;\n            if (!isLastParent) {\n                currentParentValue.makeSelectable().showCollapseArrow();\n            }\n            if (needToTruncate) {\n                if (i == numberOfItemsInFirstSlice - 1) {\n                    this.addEllipsis();\n                }\n                if (i == numberOfItemsInFirstSlice) {\n                    currentParentValue.path = pathOfLastTruncatedParentValue.concat([sortedParentValues[i].value]);\n                }\n            }\n        }\n        var childrenValuesToRender = this.moreValuesToFetch\n            ? categoryFacetResult.values.slice(0, numberOfRequestedValues - 1)\n            : categoryFacetResult.values.slice(0, numberOfRequestedValues);\n        this.numberOfChildValuesCurrentlyDisplayed = childrenValuesToRender.length;\n        currentParentValue.renderChildren(childrenValuesToRender);\n        this.activeCategoryValue = currentParentValue;\n    };\n    CategoryFacet.prototype.hideBasePathInParentValues = function (parentValues) {\n        if (Utils_1.Utils.arrayEqual(underscore_1.first(this.activePath, this.options.basePath.length), this.options.basePath)) {\n            parentValues = underscore_1.last(parentValues, parentValues.length - this.options.basePath.length);\n        }\n        return parentValues;\n    };\n    CategoryFacet.prototype.shouldTruncate = function (parentValues) {\n        return parentValues.length > CategoryFacet.MAXIMUM_NUMBER_OF_VALUES_BEFORE_TRUNCATING;\n    };\n    CategoryFacet.prototype.addEllipsis = function () {\n        this.categoryValueRoot.listRoot.append(this.categoryFacetTemplates.buildEllipsis().el);\n    };\n    CategoryFacet.prototype.findPathOfLastTruncatedParentValue = function (sortedParentValues, numberOfItemsInSecondSlice) {\n        var indexOfLastTruncatedParentValue = sortedParentValues.length - numberOfItemsInSecondSlice - 1;\n        return underscore_1.reduce(underscore_1.first(sortedParentValues, indexOfLastTruncatedParentValue + 1), function (path, parentValue) { return path.concat([parentValue.value]); }, []);\n    };\n    CategoryFacet.prototype.addAllCategoriesButton = function () {\n        var _this = this;\n        var allCategories = this.categoryFacetTemplates.buildAllCategoriesButton();\n        new AccessibleButton_1.AccessibleButton()\n            .withLabel(Strings_1.l('AllCategories'))\n            .withElement(allCategories)\n            .withSelectAction(function () {\n            _this.reset();\n            _this.scrollToTop();\n        })\n            .build();\n        this.categoryValueRoot.listRoot.append(allCategories.el);\n    };\n    CategoryFacet.prototype.isPristine = function () {\n        return Utils_1.Utils.arrayEqual(this.activePath, this.options.basePath);\n    };\n    CategoryFacet.prototype.buildFacetHeader = function () {\n        var facetHeader = new CategoryFacetHeader_1.CategoryFacetHeader({ categoryFacet: this, title: this.options.title });\n        this.headerElement = facetHeader.build();\n        Dom_1.$$(this.element).prepend(this.headerElement);\n    };\n    CategoryFacet.prototype.handleQueryStateChanged = function (data) {\n        if (this.listenToQueryStateChange) {\n            var path = data.attributes[this.queryStateAttribute];\n            if (!Utils_1.Utils.isNullOrUndefined(path) && underscore_1.isArray(path) && path.length != 0) {\n                this.activePath = path;\n            }\n        }\n    };\n    CategoryFacet.prototype.initQueryStateEvents = function () {\n        var _this = this;\n        this.queryStateModel.registerNewAttribute(this.queryStateAttribute, this.options.basePath);\n        this.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE, undefined, function (data) { return _this.handleQueryStateChanged(data); });\n    };\n    CategoryFacet.prototype.initDependsOnManager = function () {\n        var _this = this;\n        var facetInfo = {\n            reset: function () { return _this.dependsOnReset(); },\n            ref: this\n        };\n        this.dependsOnManager = new DependsOnManager_1.DependsOnManager(facetInfo);\n    };\n    CategoryFacet.prototype.dependsOnReset = function () {\n        this.changeActivePath(this.options.basePath);\n        this.clear();\n    };\n    CategoryFacet.prototype.addFading = function () {\n        Dom_1.$$(this.element).addClass('coveo-category-facet-values-fade');\n    };\n    CategoryFacet.prototype.handleDeferredQuerySuccess = function () {\n        this.updateAppearance();\n        this.removeFading();\n    };\n    CategoryFacet.prototype.removeFading = function () {\n        Dom_1.$$(this.element).removeClass('coveo-category-facet-values-fade');\n    };\n    CategoryFacet.prototype.notImplementedError = function () {\n        var errorMessage = 'Category Facets are not supported by your current search endpoint. Disabling this component.';\n        this.logger.error(errorMessage);\n        this.disable();\n    };\n    CategoryFacet.prototype.sortParentValues = function (parentValues) {\n        if (this.activePath.length != parentValues.length) {\n            this.logger.warn('Inconsistent CategoryFacet results: Number of parent values results does not equal length of active path');\n            return parentValues;\n        }\n        var sortedParentvalues = [];\n        var _loop_1 = function (pathElement) {\n            var currentParentValue = underscore_1.find(parentValues, function (parentValue) { return parentValue.value.toLowerCase() == pathElement.toLowerCase(); });\n            if (!currentParentValue) {\n                this_1.logger.warn('Inconsistent CategoryFacet results: path not consistent with parent values results');\n                return { value: parentValues };\n            }\n            sortedParentvalues.push(currentParentValue);\n        };\n        var this_1 = this;\n        for (var _i = 0, _a = this.activePath; _i < _a.length; _i++) {\n            var pathElement = _a[_i];\n            var state_1 = _loop_1(pathElement);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n        }\n        return sortedParentvalues;\n    };\n    CategoryFacet.prototype.renderMoreLess = function () {\n        if (this.numberOfChildValuesCurrentlyDisplayed > this.options.numberOfValues) {\n            this.moreLessContainer.append(this.buildLessButton());\n        }\n        if (this.moreValuesToFetch) {\n            this.moreLessContainer.append(this.buildMoreButton());\n        }\n    };\n    CategoryFacet.prototype.clear = function () {\n        this.categoryValueRoot.clear();\n        if (this.isFacetSearchAvailable) {\n            this.categoryFacetSearch.clear();\n        }\n        this.moreLessContainer && this.moreLessContainer.detach();\n        Dom_1.$$(this.element).removeClass('coveo-category-facet-non-empty-path');\n    };\n    CategoryFacet.prototype.buildMoreButton = function () {\n        var _this = this;\n        var svgContainer = Dom_1.$$('span', { className: 'coveo-facet-more-icon' }, SVGIcons_1.SVGIcons.icons.arrowDown).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-more-icon-svg');\n        var more = Dom_1.$$('div', { className: 'coveo-category-facet-more' }, svgContainer);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(more)\n            .withSelectAction(function () { return _this.showMore(); })\n            .withLabel(Strings_1.l('ShowMoreFacetResults', this.options.title))\n            .build();\n        return more.el;\n    };\n    CategoryFacet.prototype.buildLessButton = function () {\n        var _this = this;\n        var svgContainer = Dom_1.$$('span', { className: 'coveo-facet-less-icon' }, SVGIcons_1.SVGIcons.icons.arrowUp).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-less-icon-svg');\n        var less = Dom_1.$$('div', { className: 'coveo-category-facet-less' }, svgContainer);\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(less)\n            .withSelectAction(function () { return _this.showLess(); })\n            .withLabel(Strings_1.l('ShowLessFacetResults', this.options.title))\n            .build();\n        return less.el;\n    };\n    CategoryFacet.prototype.handlePopulateBreadCrumb = function (args) {\n        var _this = this;\n        if (this.isPristine()) {\n            return;\n        }\n        var lastParentValue = this.categoryFacetValuesTree.getValueForLastPartInPath(this.activePath);\n        var descriptor = {\n            path: this.activePath,\n            count: lastParentValue.numberOfResults,\n            value: lastParentValue.value\n        };\n        var resetFacet = function () {\n            _this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.breadcrumbFacet);\n            _this.reset();\n        };\n        var categoryFacetBreadcrumbBuilder = new CategoryFacetBreadcrumb_1.CategoryFacetBreadcrumb(this, resetFacet, descriptor);\n        args.breadcrumbs.push({ element: categoryFacetBreadcrumbBuilder.build() });\n    };\n    CategoryFacet.prototype.handleClearBreadcrumb = function () {\n        this.changeActivePath(this.options.basePath);\n    };\n    CategoryFacet.prototype.logAnalyticsFacetShowMoreLess = function (cause) {\n        this.usageAnalytics.logCustomEvent(cause, {\n            facetId: this.options.id,\n            facetField: this.options.field.toString(),\n            facetTitle: this.options.title\n        }, this.element);\n    };\n    CategoryFacet.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            CategoryFacet: CategoryFacet\n        });\n    };\n    CategoryFacet.ID = 'CategoryFacet';\n    /**\n     * The options for the component\n     * @componentOptions\n     */\n    CategoryFacet.options = __assign({ \n        /**\n         * The index field whose values the facet should use. The field values should have the form:\n         * `the; the|path; the|path|to; the|path|to|given; the|path|to|given|item;`\n         * where the delimiting character is `|`. This default delimiting character can be changed using the [delimitingCharacter]{@link CategoryFacet.options.delimitingCharacter} option.\n         *\n         * To help you verify whether your fields are setup correctly, see the {@link CategoryFacet.options.debug} option\n         * and the {@link CategoryFacet.debugValue} method.\n         *\n         * See [Using the Category Facet Component](https://docs.coveo.com/en/2667).\n         */\n        field: ComponentOptions_1.ComponentOptions.buildFieldOption({ required: true }), \n        /**\n         * The title to display at the top of the facet.\n         *\n         * Default value is the localized string for `NoTitle`.\n         */\n        title: ComponentOptions_1.ComponentOptions.buildLocalizedStringOption({\n            localizedString: function () { return Strings_1.l('NoTitle'); }\n        }), \n        /**\n         * The maximum number of field values to display by default in the facet before the user\n         * clicks the arrow to show more.\n         *\n         * See also the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess} option.\n         */\n        numberOfValues: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0, section: 'CommonOptions' }), \n        /**\n         * Whether to display a search box at the bottom of the facet for searching among the available facet\n         * [`field`]{@link CategoryFacet.options.field} values.\n         *\n         * See also the [`facetSearchDelay`]{@link CategoryFacet.options.facetSearchDelay}, and\n         * [`numberOfResultsInFacetSearch`]{@link CategoryFacet.options.numberOfResultsInFacetSearch} options.\n         *\n         *\n         * Default value is `true`.\n         */\n        enableFacetSearch: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }), \n        /**\n         * A unique identifier for the facet. Among other things, this identifier serves the purpose of saving\n         * the facet state in the URL hash.\n         *\n         * If you have two facets with the same field on the same page, you should specify an `id` value for at least one of\n         * those two facets. This `id` must be unique among the facets.\n         *\n         * Default value is the [`field`]{@link CategoryFacet.options.field} option value.\n         */\n        id: ComponentOptions_1.ComponentOptions.buildStringOption({\n            postProcessing: function (value, options) { return value || options.field; }\n        }), \n        /**\n         * The *injection depth* to use.\n         *\n         * The injection depth determines how many results to scan in the index to ensure that the category facet lists all potential\n         * facet values. Increasing this value enhances the accuracy of the listed values at the cost of performance.\n         *\n         * Default value is `1000`. Minimum value is `0`.\n         * @notSupportedIn salesforcefree\n         */\n        injectionDepth: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 1000, min: 0 }), \n        /**\n         * If the [`enableFacetSearch`]{@link CategoryFacet.options.enableFacetSearch} option is `true`, specifies the number of\n         * values to display in the facet search results popup.\n         *\n         * Default value is `15`. Minimum value is `1`.\n         */\n        numberOfResultsInFacetSearch: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 15, min: 1 }), \n        /**\n         * If the [`enableFacetSearch`]{@link CategoryFacet.options.enableFacetSearch} option is `true`, specifies the delay (in\n         * milliseconds) before sending a search request to the server when the user starts typing in the category facet search box.\n         *\n         * Specifying a smaller value makes results appear faster. However, chances of having to cancel many requests\n         * sent to the server increase as the user keeps on typing new characters.\n         *\n         * Default value is `100`. Minimum value is `0`.\n         */\n        facetSearchDelay: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 100, min: 0 }), \n        /**\n         * Whether to enable the **More** and **Less** buttons in the Facet.\n         *\n         * See also the [`pageSize`]{@link CategoryFacet.options.pageSize} option.\n         *\n         * Default value is `true`.\n         */\n        enableMoreLess: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }), \n        /**\n         * If the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess} option is `true`, specifies the number of\n         * additional results to fetch when clicking the **More** button.\n         *\n         * Default value is `10`. Minimum value is `1`.\n         */\n        pageSize: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 10, min: 1, depend: 'enableMoreLess' }), \n        /**\n         * The character that specifies the hierarchical dependency.\n         *\n         * **Example:**\n         *\n         * If your field has the following values:\n         *\n         * `@field: c; c>folder2; c>folder2>folder3;`\n         *\n         * The delimiting character is `>`.\n         *\n         * Default value is `|`.\n         */\n        delimitingCharacter: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: '|' }), \n        /**\n         * The path to use as the path prefix for every query.\n         *\n         * **Example:**\n         *\n         * You have the following files indexed on a file system:\n         * ```\n         * c:\\\n         *    folder1\\\n         *      text1.txt\n         *    folder2\\\n         *      folder3\\\n         *        text2.txt\n         * ```\n         * Setting the `basePath` to `c` would display `folder1` and `folder2` in the `CategoryFacet`, but omit `c`.\n         *\n         * This options accepts an array of values. To specify a \"deeper\" starting path in your tree, you need to use comma-separated values.\n         *\n         * For example, setting `data-base-path=\"c,folder1\"` on the component markup would display `folder3` in the `CategoryFacet`, but omit `c` and `folder1`.\n         *\n         */\n        basePath: ComponentOptions_1.ComponentOptions.buildListOption({ defaultValue: [] }), \n        /**\n         * The maximum number of levels to traverse in the hierarchy.\n         * This option does not count the length of the base path. The depth depends on what is shown in the interface.\n         *\n         * Default value is `Number.MAX_VALUE`.\n         */\n        maximumDepth: ComponentOptions_1.ComponentOptions.buildNumberOption({ min: 1, defaultValue: Number.MAX_VALUE }), \n        /**\n         * Whether to activate field format debugging.\n         * This options logs messages in the console for any potential encountered issues.\n         * This option can have negative effects on performance, and should only be activated when debugging.\n         */\n        debug: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }), \n        /**\n         * Specifies a JSON object describing a mapping of facet values to their desired captions. See\n         * [Normalizing Facet Value Captions](https://developers.coveo.com/x/jBsvAg).\n         *\n         * **Note:**\n         * If this option is specified, the facet search box will be unavailable.\n         *\n         * **Examples:**\n         *\n         * You can set the option in the ['init']{@link init} call:\n         * ```javascript\n         * var myValueCaptions = {\n         *   \"txt\" : \"Text files\",\n         *   \"html\" : \"Web page\",\n         *   [ ... ]\n         * };\n         *\n         * Coveo.init(document.querySelector(\"#search\"), {\n         *   Facet : {\n         *     valueCaption : myValueCaptions\n         *   }\n         * });\n         * ```\n         *\n         * Or before the `init` call, using the ['options']{@link options} top-level function:\n         * ```javascript\n         * Coveo.options(document.querySelector(\"#search\"), {\n         *   Facet : {\n         *     valueCaption : myValueCaptions\n         *   }\n         * });\n         * ```\n         *\n         * Or directly in the markup:\n         * ```html\n         * <!-- Ensure that the double quotes are properly handled in data-value-caption. -->\n         * <div class='CoveoCategoryFacet' data-field='@myotherfield' data-value-caption='{\"txt\":\"Text files\",\"html\":\"Web page\"}'></div>\n         * ```\n         */\n        valueCaption: ComponentOptions_1.ComponentOptions.buildJsonOption({ defaultValue: {} }), \n        /**\n         * The [id](@link Facet.options.id) of another facet in which at least one value must be selected in order\n         * for the dependent category facet to be visible.\n         *\n         * **Default:** `undefined` and the category facet does not depend on any other facet to be displayed.\n         *\n         * @availablesince [September 2019 Release (v2.7023)](https://docs.coveo.com/en/2990/)\n         */\n        dependsOn: ComponentOptions_1.ComponentOptions.buildStringOption(), \n        /**\n         * A function that verifies whether the current state of the `dependsOn` facet allows the dependent facet to be displayed.\n         *\n         * If specified, the function receives a reference to the resolved `dependsOn` facet component instance as an argument, and must return a boolean.\n         * The function's argument should typically be treated as read-only.\n         *\n         * By default, the dependent facet is displayed whenever one or more values are selected in its `dependsOn` facet.\n         *\n         * @externaldocs [Defining Dependent Facets](https://docs.coveo.com/3210/)\n         */\n        dependsOnCondition: ComponentOptions_1.ComponentOptions.buildCustomOption(function () {\n            return null;\n        }, { depend: 'dependsOn', section: 'CommonOptions' }), \n        /**\n         * Whether to display the facet search widget above the facet values instead of below them.\n         *\n         * @availablesince [July 2020 Release (v2.9373)](https://docs.coveo.com/3293/)\n         */\n        displaySearchOnTop: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }), \n        /**\n         * Whether to display the facet search widget as a button instead of a search bar.\n         *\n         * @availablesince [July 2020 Release (v2.9373)](https://docs.coveo.com/3293/)\n         */\n        displaySearchButton: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }) }, ResponsiveFacetOptions_1.ResponsiveFacetOptions);\n    CategoryFacet.MAXIMUM_NUMBER_OF_VALUES_BEFORE_TRUNCATING = 15;\n    CategoryFacet.NUMBER_OF_VALUES_TO_KEEP_AFTER_TRUNCATING = 10;\n    CategoryFacet.WAIT_ELEMENT_CLASS = 'coveo-category-facet-header-wait-animation';\n    return CategoryFacet;\n}(Component_1.Component));\nexports.CategoryFacet = CategoryFacet;\nInitialization_1.Initialization.registerAutoCreateComponent(CategoryFacet);\nCategoryFacet.doExport();\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// HierarchicalFacet.min__aec9a3688de9d25c6748.js","import { Component } from '../ui/Base/Component';\nimport { ResultList } from '../ui/ResultList/ResultList';\nimport { $$ } from './Dom';\nimport { find } from 'underscore';\nimport { Logger } from '../misc/Logger';\n\nexport class ResultListUtils {\n  public static hideIfInfiniteScrollEnabled(cmp: Component) {\n    const infiniteScrollEnabled = ResultListUtils.isInfiniteScrollEnabled(cmp.searchInterface.element);\n\n    if (infiniteScrollEnabled) {\n      cmp.disable();\n      $$(cmp.element).hide();\n      ResultListUtils.warnIfComponentNotNeeded(cmp);\n    } else {\n      cmp.enable();\n      $$(cmp.element).unhide();\n    }\n  }\n\n  public static isInfiniteScrollEnabled(root: HTMLElement) {\n    const resultList = ResultListUtils.getActiveResultList(root);\n    return resultList ? !!resultList.options.enableInfiniteScroll : false;\n  }\n\n  public static scrollToTop(root: HTMLElement) {\n    const resultList = ResultListUtils.getActiveResultList(root);\n    if (!resultList) {\n      new Logger(this).warn('No active ResultList, scrolling to the top of the Window');\n      return window.scrollTo(0, 0);\n    }\n\n    const searchInterfacePosition = resultList.searchInterface.element.getBoundingClientRect().top;\n    if (searchInterfacePosition > 0) {\n      return;\n    }\n\n    window.scrollTo(0, window.pageYOffset + searchInterfacePosition);\n  }\n\n  private static getActiveResultList(root: HTMLElement) {\n    const resultLists = ResultListUtils.getResultLists(root);\n    return find(resultLists, resultList => !resultList.disabled);\n  }\n\n  private static getResultLists(root: HTMLElement) {\n    return $$(root)\n      .findAll(`.${ResultListUtils.cssClass()}`)\n      .map(el => <ResultList>Component.get(el, ResultList));\n  }\n\n  private static cssClass() {\n    return Component.computeCssClassName(ResultList);\n  }\n\n  private static warnIfComponentNotNeeded(cmp: Component) {\n    const root = cmp.searchInterface.root;\n    const allListsUseInfiniteScroll = ResultListUtils.allResultListsUseInfiniteScroll(root);\n\n    allListsUseInfiniteScroll && ResultListUtils.notNeededComponentWarning(cmp);\n  }\n\n  private static allResultListsUseInfiniteScroll(root: HTMLElement) {\n    const listsWithInfiniteScrollDisabled = ResultListUtils.getResultLists(root).filter(\n      resultList => !resultList.options.enableInfiniteScroll\n    );\n\n    return listsWithInfiniteScrollDisabled.length === 0;\n  }\n\n  private static notNeededComponentWarning(cmp: Component) {\n    const cmpCssClass = Component.computeCssClassNameForType(cmp.type);\n    const message = `The ${cmpCssClass} component is not needed because all ${ResultListUtils.cssClass()} components have enableInfiniteScroll set to 'true'.\n    For the best performance, remove the ${cmpCssClass} component from your search page.`;\n\n    new Logger(cmp).warn(message);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/ResultListUtils.ts","import { Assert } from '../../misc/Assert';\nimport { Utils } from '../../utils/Utils';\nimport { IGroupByValue } from '../../rest/GroupByValue';\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport * as Globalize from 'globalize';\nimport { isString, isObject } from 'underscore';\n\n/**\n * A class which holds information and operation available on a single facet value returned by a {@link IGroupByRequest}.<br/>\n * This class is used extensively in the {@link Facet} component.\n */\nexport class FacetValue {\n  value: string;\n  lookupValue: string;\n  occurrences: number;\n  computedField: number;\n  delta: number;\n  score: number;\n  selected: boolean = false;\n  excluded: boolean = false;\n  waitingForDelta: boolean = false;\n\n  reset() {\n    this.selected = false;\n    this.excluded = false;\n  }\n\n  updateCountsFromNewValue(newValue: FacetValue) {\n    Assert.exists(newValue);\n    this.occurrences = newValue.occurrences;\n    this.delta = newValue.delta;\n    this.computedField = newValue.computedField;\n  }\n\n  clone(): FacetValue {\n    this.computedField = undefined;\n    this.delta = undefined;\n    return this;\n  }\n\n  cloneWithZeroOccurrences(): FacetValue {\n    this.occurrences = 0;\n    return this.clone();\n  }\n\n  cloneWithDelta(count: number, delta: number): FacetValue {\n    Assert.isLargerOrEqualsThan(0, count);\n    var clone = this.cloneWithZeroOccurrences();\n    clone.delta = delta;\n    clone.occurrences = count;\n    return clone;\n  }\n\n  getFormattedCount() {\n    var count: string = undefined;\n    if (Utils.exists(this.delta) && this.delta > 0) {\n      count = '+' + Globalize.format(this.delta, 'n0');\n    } else {\n      if (this.occurrences > 0) {\n        count = Globalize.format(this.occurrences, 'n0');\n      }\n    }\n    return count;\n  }\n\n  getFormattedComputedField(format: string) {\n    if (this.computedField != 0) {\n      return Globalize.format(this.computedField, format);\n    } else {\n      return undefined;\n    }\n  }\n\n  static create(value: any): FacetValue {\n    if (isString(value)) {\n      return FacetValue.createFromValue(value);\n    } else if (isObject(value)) {\n      if ('computedFieldResults' in value) {\n        return FacetValue.createFromGroupByValue(value);\n      } else {\n        return FacetValue.createFromFieldValue(value);\n      }\n    } else {\n      throw new Error(\"Can't create value from \" + value);\n    }\n  }\n\n  static createFromValue(value: string): FacetValue {\n    Assert.isNonEmptyString(value);\n\n    var facetValue = new FacetValue();\n    facetValue.value = value;\n    facetValue.lookupValue = value;\n\n    return facetValue;\n  }\n\n  static createFromGroupByValue(groupByValue: IGroupByValue): FacetValue {\n    Assert.exists(groupByValue);\n\n    Assert.exists(groupByValue);\n\n    var facetValue = new FacetValue();\n    facetValue.value = groupByValue.value;\n    facetValue.lookupValue = Utils.exists(groupByValue.lookupValue) ? groupByValue.lookupValue : groupByValue.value;\n    facetValue.occurrences = groupByValue.numberOfResults;\n    facetValue.computedField = Utils.isNonEmptyArray(groupByValue.computedFieldResults) ? groupByValue.computedFieldResults[0] : undefined;\n    facetValue.score = groupByValue.score;\n\n    return facetValue;\n  }\n\n  static createFromFieldValue(fieldValue: IIndexFieldValue): FacetValue {\n    Assert.exists(fieldValue);\n\n    var facetValue = new FacetValue();\n    facetValue.value = fieldValue.value;\n    facetValue.lookupValue = fieldValue.lookupValue;\n    facetValue.occurrences = fieldValue.numberOfResults;\n\n    return facetValue;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetValue.ts","import { Dom } from '../../utils/Dom';\nimport { ResponsiveDropdownContent } from './ResponsiveDropdown/ResponsiveDropdownContent';\n\nexport class ResponsiveComponentsUtils {\n  private static smallTabsClassName: string = 'coveo-small-tabs';\n  private static smallFacetClassName: string = 'coveo-small-facets';\n  private static smallRecommendationClassName: string = 'coveo-small-recommendation';\n\n  static shouldDrawFacetSlider(root: Dom, facetSliderElement: Dom): boolean {\n    return ResponsiveDropdownContent.isTargetInsideOpenedDropdown(facetSliderElement) || !this.isSmallFacetActivated(root);\n  }\n\n  static isSmallTabsActivated(root: Dom): boolean {\n    return root.hasClass(this.smallTabsClassName);\n  }\n\n  static isSmallFacetActivated(root: Dom): boolean {\n    return root.hasClass(this.smallFacetClassName);\n  }\n\n  static isSmallRecommendationActivated(root: Dom): boolean {\n    return root.hasClass(this.smallRecommendationClassName);\n  }\n\n  static activateSmallTabs(root: Dom): void {\n    root.addClass(this.smallTabsClassName);\n  }\n\n  static deactivateSmallTabs(root: Dom): void {\n    root.removeClass(this.smallTabsClassName);\n  }\n\n  static activateSmallFacet(root: Dom): void {\n    root.addClass(this.smallFacetClassName);\n  }\n\n  static deactivateSmallFacet(root: Dom): void {\n    root.removeClass(this.smallFacetClassName);\n  }\n\n  static activateSmallRecommendation(root: Dom): void {\n    root.addClass(this.smallRecommendationClassName);\n  }\n\n  static deactivateSmallRecommendation(root: Dom): void {\n    root.removeClass(this.smallRecommendationClassName);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveComponentsUtils.ts","/// <reference path=\"Facet.ts\" />\n\nimport { Facet } from './Facet';\nimport { FacetValue } from './FacetValue';\nimport { ValueElement } from './ValueElement';\n\nexport interface IFacetValueElementKlass {\n  new (facet: Facet, facetValue: FacetValue, displayNextTime?: boolean): FacetValueElement;\n}\n\nexport class FacetValueElement extends ValueElement {\n  constructor(public facet: Facet, public facetValue: FacetValue, public keepDisplayedValueNextTime: boolean) {\n    super(facet, facetValue);\n  }\n\n  public bindEvent() {\n    super.bindEvent({\n      displayNextTime: this.keepDisplayedValueNextTime,\n      pinFacet: this.facet.options.preservePosition\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetValueElement.ts","/// <reference path=\"Facet.ts\" />\n\nimport { Facet } from './Facet';\nimport { Utils } from '../../utils/Utils';\nimport { FacetUtils } from './FacetUtils';\nimport { IGroupByRequest } from '../../rest/GroupByRequest';\nimport { IQuery } from '../../rest/Query';\nimport { QueryBuilder } from '../Base/QueryBuilder';\nimport { $$ } from '../../utils/Dom';\nimport * as _ from 'underscore';\nimport { AllowedValuesPatternType } from '../../rest/AllowedValuesPatternType';\n\nexport class FacetSearchParameters {\n  public nbResults: number;\n  public ignoreAccents: boolean;\n  public valueToSearch: string = '';\n  public alwaysInclude: string[] = [];\n  public alwaysExclude: string[] = [];\n  public sortCriteria = 'occurrences';\n  public fetchMore = false;\n  public completeFacetWithStandardValues = true;\n\n  constructor(public facet: Facet) {\n    this.nbResults = facet.options.numberOfValuesInFacetSearch;\n    this.ignoreAccents = facet.options.facetSearchIgnoreAccents;\n  }\n\n  public setValueToSearch(value: string) {\n    this.valueToSearch = value;\n    if (Utils.isNonEmptyString(value)) {\n      this.valueToSearch = this.valueToSearch.trim();\n      this.alwaysInclude = this.alwaysInclude.concat(FacetUtils.getValuesToUseForSearchInFacet(this.valueToSearch, this.facet));\n    }\n    return this;\n  }\n\n  public excludeCurrentlyDisplayedValuesInSearch(searchResults: HTMLElement) {\n    _.each(this.getCurrentlyShowedValueInSearch(searchResults), v => {\n      const expandedValues = FacetUtils.getValuesToUseForSearchInFacet(v, this.facet);\n      _.each(expandedValues, expanded => {\n        this.alwaysExclude.push(expanded);\n      });\n    });\n    _.each(this.facet.getDisplayedFacetValues(), v => {\n      this.alwaysExclude.push(v.value);\n    });\n  }\n\n  public getGroupByRequest(): IGroupByRequest {\n    this.lowerCaseAll();\n    let nbResults = this.nbResults;\n    nbResults += this.alwaysExclude.length;\n\n    let typedByUser = [];\n    if (this.valueToSearch) {\n      typedByUser = ['*' + this.valueToSearch + '*'];\n    }\n\n    let allowedValues;\n    if (this.valueToSearch) {\n      allowedValues = typedByUser.concat(this.alwaysInclude).concat(this.alwaysExclude);\n    } else {\n      allowedValues = _.compact(typedByUser.concat(this.alwaysInclude).concat(this.facet.options.allowedValues));\n    }\n\n    let completeFacetWithStandardValues = this.completeFacetWithStandardValues;\n    if (this.facet.options.lookupField != null) {\n      completeFacetWithStandardValues = false;\n    }\n\n    const request: IGroupByRequest = {\n      allowedValues,\n      allowedValuesPatternType: this.facet.options.useWildcardsInFacetSearch\n        ? AllowedValuesPatternType.Wildcards\n        : AllowedValuesPatternType.Legacy,\n      maximumNumberOfValues: nbResults,\n      completeFacetWithStandardValues: completeFacetWithStandardValues,\n      field: <string>this.facet.options.field,\n      sortCriteria: this.facet.options.sortCriteria || this.sortCriteria,\n      injectionDepth: this.facet.options.injectionDepth\n    };\n\n    if (this.facet.options.lookupField) {\n      request.lookupField = <string>this.facet.options.lookupField;\n    }\n\n    if (this.facet.options.computedField) {\n      request.computedFields = [\n        {\n          field: <string>this.facet.options.computedField,\n          operation: this.facet.options.computedFieldOperation\n        }\n      ];\n    }\n    return request;\n  }\n\n  public getQuery(): IQuery {\n    let lastQuery = _.clone(this.facet.queryController.getLastQuery());\n    if (!lastQuery) {\n      // There should normally always be a last query available\n      // If not, just create an empty one.\n      lastQuery = new QueryBuilder().build();\n    }\n    // We want to always force query syntax to true for a facet search,\n    // but arrange for the basic expression to adapt itself with no syntax block\n    if (lastQuery.enableQuerySyntax) {\n      lastQuery.q = this.facet.facetQueryController.basicExpressionToUseForFacetSearch;\n    } else if (Utils.isNonEmptyString(this.facet.facetQueryController.basicExpressionToUseForFacetSearch)) {\n      lastQuery.q = `<@- ${this.facet.facetQueryController.basicExpressionToUseForFacetSearch} -@>`;\n    } else {\n      lastQuery.q = '';\n    }\n\n    lastQuery.enableQuerySyntax = true;\n    lastQuery.cq = this.facet.facetQueryController.constantExpressionToUseForFacetSearch;\n    lastQuery.aq = this.facet.facetQueryController.advancedExpressionToUseForFacetSearch;\n    lastQuery.enableDidYouMean = false;\n    lastQuery.firstResult = 0;\n    lastQuery.numberOfResults = 0;\n    lastQuery.fieldsToInclude = [];\n    lastQuery.groupBy = [this.getGroupByRequest()];\n    return lastQuery;\n  }\n\n  private getCurrentlyShowedValueInSearch(searchResults: HTMLElement) {\n    return _.map($$(searchResults).findAll('.coveo-facet-value-caption'), val => {\n      return $$(val).getAttribute('data-original-value') || $$(val).text();\n    });\n  }\n\n  private lowerCaseAll() {\n    this.alwaysExclude = _.chain(this.alwaysExclude)\n      .map(v => {\n        return v.toLowerCase();\n      })\n      .uniq()\n      .value();\n\n    this.alwaysInclude = _.chain(this.alwaysInclude)\n      .map(v => {\n        return v.toLowerCase();\n      })\n      .uniq()\n      .value();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearchParameters.ts","import { isFunction } from 'underscore';\nimport { QueryStateModel, QueryEvents, Component } from '../Core';\nimport { MODEL_EVENTS } from '../models/Model';\nimport { ComponentsTypes } from './ComponentsTypes';\nimport { $$ } from './Dom';\nimport { InitializationEvents } from '../events/InitializationEvents';\n\nexport interface IDependsOnCompatibleFacetOptions {\n  id?: string;\n  dependsOn?: string;\n  dependsOnCondition?: IDependentFacetCondition;\n}\n\nexport interface IDependsOnCompatibleFacet extends Component {\n  options: IDependsOnCompatibleFacetOptions;\n}\n\nexport interface IDependentFacet {\n  reset: () => void;\n  ref: IDependsOnCompatibleFacet;\n}\n\nexport interface IDependentFacetCondition {\n  (facet: IDependsOnCompatibleFacet): boolean;\n}\n\nexport class DependsOnManager {\n  private parentFacetRef: IDependsOnCompatibleFacet;\n\n  constructor(private facet: IDependentFacet) {\n    $$(this.facet.ref.searchInterface.element).on(QueryEvents.buildingQuery, () => this.handleBuildingQuery());\n\n    if (this.getDependsOn(this.facet.ref)) {\n      this.facet.ref.bind.onRootElement(InitializationEvents.afterComponentsInitialization, () => this.setupDependentFacet());\n    }\n  }\n\n  private setupDependentFacet() {\n    $$(this.facet.ref.element).addClass('coveo-hidden-dependant-facet');\n    this.parentFacetRef = this.getParentFacet(this.facet.ref);\n\n    if (this.parentFacetRef) {\n      this.facet.ref.bind.onQueryState(MODEL_EVENTS.CHANGE, undefined, () => this.resetIfConditionUnfullfiled());\n    }\n  }\n\n  private resetIfConditionUnfullfiled() {\n    const condition = this.getDependsOnCondition(this.facet.ref);\n\n    if (!condition(this.parentFacetRef)) {\n      this.facet.reset();\n    }\n  }\n\n  private getId(component: IDependsOnCompatibleFacet) {\n    const id = component.options.id;\n    return id ? `${id}` : null;\n  }\n\n  private getDependsOn(component: IDependsOnCompatibleFacet) {\n    const dependsOn = component.options.dependsOn;\n    return dependsOn ? `${dependsOn}` : null;\n  }\n\n  private getDependsOnCondition(component: IDependsOnCompatibleFacet): IDependentFacetCondition {\n    const conditionOption = component.options.dependsOnCondition;\n    return conditionOption && isFunction(conditionOption) ? conditionOption : () => this.parentHasSelectedValues(component);\n  }\n\n  private parentHasSelectedValues(component: IDependsOnCompatibleFacet) {\n    const parent = this.getParentFacet(component);\n    return parent && this.valuesExistForFacetWithId(this.getId(parent));\n  }\n\n  private valuesExistForFacetWithId(facetId: string) {\n    const values = this.facet.ref.queryStateModel.get(QueryStateModel.getFacetId(facetId));\n    return !!values && !!values.length;\n  }\n\n  private get allFacetsInInterface() {\n    return ComponentsTypes.getAllFacetsFromSearchInterface(this.facet.ref.searchInterface) as IDependsOnCompatibleFacet[];\n  }\n\n  private getParentFacet(component: IDependsOnCompatibleFacet) {\n    const parent = this.allFacetsInInterface.filter(\n      potentialParentFacet => this.getId(potentialParentFacet) === this.getDependsOn(component)\n    );\n\n    if (!parent.length) {\n      component.logger.warn('DependsOn reference does not exist', this.getDependsOn(this.facet.ref));\n      return null;\n    }\n\n    return parent[0];\n  }\n\n  private get dependentFacets() {\n    return this.allFacetsInInterface.filter(\n      potentialDependentFacet => this.getId(this.facet.ref) === this.getDependsOn(potentialDependentFacet)\n    );\n  }\n\n  private handleBuildingQuery() {\n    this.dependentFacets.forEach(dependentFacet => {\n      const condition = this.getDependsOnCondition(dependentFacet);\n      if (condition(this.facet.ref)) {\n        $$(dependentFacet.element).removeClass('coveo-hidden-dependant-facet');\n        return dependentFacet.enable();\n      }\n\n      dependentFacet.disable();\n      $$(dependentFacet.element).addClass('coveo-hidden-dependant-facet');\n    });\n  }\n\n  public get hasDependentFacets() {\n    return !!this.dependentFacets.length;\n  }\n\n  public get dependentFacetsHaveSelectedValues() {\n    return this.dependentFacets.some(dependentFacet => this.valuesExistForFacetWithId(this.getId(dependentFacet)));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/DependsOnManager.ts","import { ResponsiveFacetColumn } from './ResponsiveFacetColumn';\nimport { IResponsiveComponentOptions } from './ResponsiveComponentsManager';\nimport { Facet } from '../Facet/Facet';\n\nexport class ResponsiveFacets extends ResponsiveFacetColumn {\n  public static init(root: HTMLElement, component, options: IResponsiveComponentOptions) {\n    ResponsiveFacetColumn.init(ResponsiveFacets, root, component, options, Facet.ID);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveFacets.ts","import { Component } from '../Base/Component';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Utils } from '../../Core';\nimport { Initialization } from '../Base/Initialization';\n\nexport interface IFacetsMobileModeOptions {\n  breakpoint?: number;\n  isModal?: boolean;\n  displayOverlayWhileOpen?: boolean;\n  preventScrolling?: boolean;\n  scrollContainer?: HTMLElement;\n}\n\n/**\n * This component lets you customize the mobile responsive behavior of facets in your search interface.\n *\n * **Notes:**\n * - You can include this component anywhere under the root element of your search interface.\n * - You should only include this component once in your search interface.\n * - If you do not include this component in your search interface, facets will still have a default mobile responsive behavior.\n */\nexport class FacetsMobileMode extends Component {\n  static ID = 'FacetsMobileMode';\n\n  /**\n   * @componentOptions\n   */\n  static options: IFacetsMobileModeOptions = {\n    /**\n     * The screen width (in number of pixels) at which facets should enter mobile responsive mode and be collapsed under a single button.\n     *\n     * **Default:** `800`\n     */\n    breakpoint: ComponentOptions.buildNumberOption(),\n    /**\n     * Whether to display the facets in a modal instead of a pop-up when the end user expands them in mobile responsive mode.\n     */\n    isModal: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n    /**\n     * Whether to display an overlay behind the facets when the end user expands them in mobile responsive mode.\n     *\n     * By default, the following behavior applies:\n     * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n     * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n     */\n    displayOverlayWhileOpen: ComponentOptions.buildBooleanOption({\n      postProcessing: (value, options: IFacetsMobileModeOptions) => (Utils.isNullOrUndefined(value) ? !options.isModal : value)\n    }),\n    /**\n     * Whether to disable vertical scrolling on the specified or resolved [`scrollContainer`]{@link FacetsMobileMode.options.scrollContainer} while facets are expanded in mobile responsive mode.\n     *\n     * By default, the following behavior applies:\n     * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n     * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n     */\n    preventScrolling: ComponentOptions.buildBooleanOption({\n      postProcessing: (value, options: IFacetsMobileModeOptions) => (Utils.isNullOrUndefined(value) ? options.isModal : value)\n    }),\n    /**\n     * The HTML element whose vertical scrolling should be locked while facets are expanded in mobile responsive mode.\n     *\n     * By default, the component tries to detect and use the first ancestor element whose CSS `overflow-y` attribute is set to `scroll`, starting from the `FacetsMobileMode`'s element itself. If no such element is found, the `document.body` element is used.\n     *\n     * Since this heuristic is not perfect, we strongly recommend that you manually set this option by explicitly specifying the desired CSS selector.\n     *\n     * **Example:** `data-scroll-container-selector='#someCssSelector'`\n     */\n    scrollContainer: ComponentOptions.buildChildHtmlElementOption({ depend: 'preventScrolling' })\n  };\n\n  static doExport = () => {\n    exportGlobally({\n      FacetsMobileMode: FacetsMobileMode\n    });\n  };\n\n  public options: IFacetsMobileModeOptions;\n\n  constructor(public element: HTMLElement, options?: IFacetsMobileModeOptions, bindings?: IComponentBindings) {\n    super(element, FacetsMobileMode.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, FacetsMobileMode, options);\n    if (this.options.preventScrolling) {\n      const scrollContainer = this.options.scrollContainer || this.searchInterface.element;\n      this.options.scrollContainer = ComponentOptions.findParentScrollLockable(scrollContainer);\n    }\n  }\n}\n\nInitialization.registerAutoCreateComponent(FacetsMobileMode);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/FacetsMobileMode/FacetsMobileMode.ts","/**!\n * @fileOverview Kickass library to create and place poppers near their reference elements.\n * @version 1.14.3\n * @license\n * Copyright (c) 2016 Federico Zivolo and contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\n\nvar longerTimeoutBrowsers = ['Edge', 'Trident', 'Firefox'];\nvar timeoutDuration = 0;\nfor (var i = 0; i < longerTimeoutBrowsers.length; i += 1) {\n  if (isBrowser && navigator.userAgent.indexOf(longerTimeoutBrowsers[i]) >= 0) {\n    timeoutDuration = 1;\n    break;\n  }\n}\n\nfunction microtaskDebounce(fn) {\n  var called = false;\n  return function () {\n    if (called) {\n      return;\n    }\n    called = true;\n    window.Promise.resolve().then(function () {\n      called = false;\n      fn();\n    });\n  };\n}\n\nfunction taskDebounce(fn) {\n  var scheduled = false;\n  return function () {\n    if (!scheduled) {\n      scheduled = true;\n      setTimeout(function () {\n        scheduled = false;\n        fn();\n      }, timeoutDuration);\n    }\n  };\n}\n\nvar supportsMicroTasks = isBrowser && window.Promise;\n\n/**\n* Create a debounced version of a method, that's asynchronously deferred\n* but called in the minimum time possible.\n*\n* @method\n* @memberof Popper.Utils\n* @argument {Function} fn\n* @returns {Function}\n*/\nvar debounce = supportsMicroTasks ? microtaskDebounce : taskDebounce;\n\n/**\n * Check if the given variable is a function\n * @method\n * @memberof Popper.Utils\n * @argument {Any} functionToCheck - variable to check\n * @returns {Boolean} answer to: is a function?\n */\nfunction isFunction(functionToCheck) {\n  var getType = {};\n  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n}\n\n/**\n * Get CSS computed property of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Eement} element\n * @argument {String} property\n */\nfunction getStyleComputedProperty(element, property) {\n  if (element.nodeType !== 1) {\n    return [];\n  }\n  // NOTE: 1 DOM access here\n  var css = getComputedStyle(element, null);\n  return property ? css[property] : css;\n}\n\n/**\n * Returns the parentNode or the host of the element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} parent\n */\nfunction getParentNode(element) {\n  if (element.nodeName === 'HTML') {\n    return element;\n  }\n  return element.parentNode || element.host;\n}\n\n/**\n * Returns the scrolling parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} scroll parent\n */\nfunction getScrollParent(element) {\n  // Return body, `getScroll` will take care to get the correct `scrollTop` from it\n  if (!element) {\n    return document.body;\n  }\n\n  switch (element.nodeName) {\n    case 'HTML':\n    case 'BODY':\n      return element.ownerDocument.body;\n    case '#document':\n      return element.body;\n  }\n\n  // Firefox want us to check `-x` and `-y` variations as well\n\n  var _getStyleComputedProp = getStyleComputedProperty(element),\n      overflow = _getStyleComputedProp.overflow,\n      overflowX = _getStyleComputedProp.overflowX,\n      overflowY = _getStyleComputedProp.overflowY;\n\n  if (/(auto|scroll|overlay)/.test(overflow + overflowY + overflowX)) {\n    return element;\n  }\n\n  return getScrollParent(getParentNode(element));\n}\n\nvar isIE11 = isBrowser && !!(window.MSInputMethodContext && document.documentMode);\nvar isIE10 = isBrowser && /MSIE 10/.test(navigator.userAgent);\n\n/**\n * Determines if the browser is Internet Explorer\n * @method\n * @memberof Popper.Utils\n * @param {Number} version to check\n * @returns {Boolean} isIE\n */\nfunction isIE(version) {\n  if (version === 11) {\n    return isIE11;\n  }\n  if (version === 10) {\n    return isIE10;\n  }\n  return isIE11 || isIE10;\n}\n\n/**\n * Returns the offset parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} offset parent\n */\nfunction getOffsetParent(element) {\n  if (!element) {\n    return document.documentElement;\n  }\n\n  var noOffsetParent = isIE(10) ? document.body : null;\n\n  // NOTE: 1 DOM access here\n  var offsetParent = element.offsetParent;\n  // Skip hidden elements which don't have an offsetParent\n  while (offsetParent === noOffsetParent && element.nextElementSibling) {\n    offsetParent = (element = element.nextElementSibling).offsetParent;\n  }\n\n  var nodeName = offsetParent && offsetParent.nodeName;\n\n  if (!nodeName || nodeName === 'BODY' || nodeName === 'HTML') {\n    return element ? element.ownerDocument.documentElement : document.documentElement;\n  }\n\n  // .offsetParent will return the closest TD or TABLE in case\n  // no offsetParent is present, I hate this job...\n  if (['TD', 'TABLE'].indexOf(offsetParent.nodeName) !== -1 && getStyleComputedProperty(offsetParent, 'position') === 'static') {\n    return getOffsetParent(offsetParent);\n  }\n\n  return offsetParent;\n}\n\nfunction isOffsetContainer(element) {\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY') {\n    return false;\n  }\n  return nodeName === 'HTML' || getOffsetParent(element.firstElementChild) === element;\n}\n\n/**\n * Finds the root node (document, shadowDOM root) of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} node\n * @returns {Element} root node\n */\nfunction getRoot(node) {\n  if (node.parentNode !== null) {\n    return getRoot(node.parentNode);\n  }\n\n  return node;\n}\n\n/**\n * Finds the offset parent common to the two provided nodes\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element1\n * @argument {Element} element2\n * @returns {Element} common offset parent\n */\nfunction findCommonOffsetParent(element1, element2) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element1 || !element1.nodeType || !element2 || !element2.nodeType) {\n    return document.documentElement;\n  }\n\n  // Here we make sure to give as \"start\" the element that comes first in the DOM\n  var order = element1.compareDocumentPosition(element2) & Node.DOCUMENT_POSITION_FOLLOWING;\n  var start = order ? element1 : element2;\n  var end = order ? element2 : element1;\n\n  // Get common ancestor container\n  var range = document.createRange();\n  range.setStart(start, 0);\n  range.setEnd(end, 0);\n  var commonAncestorContainer = range.commonAncestorContainer;\n\n  // Both nodes are inside #document\n\n  if (element1 !== commonAncestorContainer && element2 !== commonAncestorContainer || start.contains(end)) {\n    if (isOffsetContainer(commonAncestorContainer)) {\n      return commonAncestorContainer;\n    }\n\n    return getOffsetParent(commonAncestorContainer);\n  }\n\n  // one of the nodes is inside shadowDOM, find which one\n  var element1root = getRoot(element1);\n  if (element1root.host) {\n    return findCommonOffsetParent(element1root.host, element2);\n  } else {\n    return findCommonOffsetParent(element1, getRoot(element2).host);\n  }\n}\n\n/**\n * Gets the scroll value of the given element in the given side (top and left)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {String} side `top` or `left`\n * @returns {number} amount of scrolled pixels\n */\nfunction getScroll(element) {\n  var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n  var upperSide = side === 'top' ? 'scrollTop' : 'scrollLeft';\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    var html = element.ownerDocument.documentElement;\n    var scrollingElement = element.ownerDocument.scrollingElement || html;\n    return scrollingElement[upperSide];\n  }\n\n  return element[upperSide];\n}\n\n/*\n * Sum or subtract the element scroll values (left and top) from a given rect object\n * @method\n * @memberof Popper.Utils\n * @param {Object} rect - Rect object you want to change\n * @param {HTMLElement} element - The element from the function reads the scroll values\n * @param {Boolean} subtract - set to true if you want to subtract the scroll values\n * @return {Object} rect - The modifier rect object\n */\nfunction includeScroll(rect, element) {\n  var subtract = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var scrollTop = getScroll(element, 'top');\n  var scrollLeft = getScroll(element, 'left');\n  var modifier = subtract ? -1 : 1;\n  rect.top += scrollTop * modifier;\n  rect.bottom += scrollTop * modifier;\n  rect.left += scrollLeft * modifier;\n  rect.right += scrollLeft * modifier;\n  return rect;\n}\n\n/*\n * Helper to detect borders of a given element\n * @method\n * @memberof Popper.Utils\n * @param {CSSStyleDeclaration} styles\n * Result of `getStyleComputedProperty` on the given element\n * @param {String} axis - `x` or `y`\n * @return {number} borders - The borders size of the given axis\n */\n\nfunction getBordersSize(styles, axis) {\n  var sideA = axis === 'x' ? 'Left' : 'Top';\n  var sideB = sideA === 'Left' ? 'Right' : 'Bottom';\n\n  return parseFloat(styles['border' + sideA + 'Width'], 10) + parseFloat(styles['border' + sideB + 'Width'], 10);\n}\n\nfunction getSize(axis, body, html, computedStyle) {\n  return Math.max(body['offset' + axis], body['scroll' + axis], html['client' + axis], html['offset' + axis], html['scroll' + axis], isIE(10) ? html['offset' + axis] + computedStyle['margin' + (axis === 'Height' ? 'Top' : 'Left')] + computedStyle['margin' + (axis === 'Height' ? 'Bottom' : 'Right')] : 0);\n}\n\nfunction getWindowSizes() {\n  var body = document.body;\n  var html = document.documentElement;\n  var computedStyle = isIE(10) && getComputedStyle(html);\n\n  return {\n    height: getSize('Height', body, html, computedStyle),\n    width: getSize('Width', body, html, computedStyle)\n  };\n}\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\nvar defineProperty = function (obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n/**\n * Given element offsets, generate an output similar to getBoundingClientRect\n * @method\n * @memberof Popper.Utils\n * @argument {Object} offsets\n * @returns {Object} ClientRect like output\n */\nfunction getClientRect(offsets) {\n  return _extends({}, offsets, {\n    right: offsets.left + offsets.width,\n    bottom: offsets.top + offsets.height\n  });\n}\n\n/**\n * Get bounding client rect of given element\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} element\n * @return {Object} client rect\n */\nfunction getBoundingClientRect(element) {\n  var rect = {};\n\n  // IE10 10 FIX: Please, don't ask, the element isn't\n  // considered in DOM in some circumstances...\n  // This isn't reproducible in IE10 compatibility mode of IE11\n  try {\n    if (isIE(10)) {\n      rect = element.getBoundingClientRect();\n      var scrollTop = getScroll(element, 'top');\n      var scrollLeft = getScroll(element, 'left');\n      rect.top += scrollTop;\n      rect.left += scrollLeft;\n      rect.bottom += scrollTop;\n      rect.right += scrollLeft;\n    } else {\n      rect = element.getBoundingClientRect();\n    }\n  } catch (e) {}\n\n  var result = {\n    left: rect.left,\n    top: rect.top,\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top\n  };\n\n  // subtract scrollbar size from sizes\n  var sizes = element.nodeName === 'HTML' ? getWindowSizes() : {};\n  var width = sizes.width || element.clientWidth || result.right - result.left;\n  var height = sizes.height || element.clientHeight || result.bottom - result.top;\n\n  var horizScrollbar = element.offsetWidth - width;\n  var vertScrollbar = element.offsetHeight - height;\n\n  // if an hypothetical scrollbar is detected, we must be sure it's not a `border`\n  // we make this check conditional for performance reasons\n  if (horizScrollbar || vertScrollbar) {\n    var styles = getStyleComputedProperty(element);\n    horizScrollbar -= getBordersSize(styles, 'x');\n    vertScrollbar -= getBordersSize(styles, 'y');\n\n    result.width -= horizScrollbar;\n    result.height -= vertScrollbar;\n  }\n\n  return getClientRect(result);\n}\n\nfunction getOffsetRectRelativeToArbitraryNode(children, parent) {\n  var fixedPosition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var isIE10 = isIE(10);\n  var isHTML = parent.nodeName === 'HTML';\n  var childrenRect = getBoundingClientRect(children);\n  var parentRect = getBoundingClientRect(parent);\n  var scrollParent = getScrollParent(children);\n\n  var styles = getStyleComputedProperty(parent);\n  var borderTopWidth = parseFloat(styles.borderTopWidth, 10);\n  var borderLeftWidth = parseFloat(styles.borderLeftWidth, 10);\n\n  // In cases where the parent is fixed, we must ignore negative scroll in offset calc\n  if (fixedPosition && parent.nodeName === 'HTML') {\n    parentRect.top = Math.max(parentRect.top, 0);\n    parentRect.left = Math.max(parentRect.left, 0);\n  }\n  var offsets = getClientRect({\n    top: childrenRect.top - parentRect.top - borderTopWidth,\n    left: childrenRect.left - parentRect.left - borderLeftWidth,\n    width: childrenRect.width,\n    height: childrenRect.height\n  });\n  offsets.marginTop = 0;\n  offsets.marginLeft = 0;\n\n  // Subtract margins of documentElement in case it's being used as parent\n  // we do this only on HTML because it's the only element that behaves\n  // differently when margins are applied to it. The margins are included in\n  // the box of the documentElement, in the other cases not.\n  if (!isIE10 && isHTML) {\n    var marginTop = parseFloat(styles.marginTop, 10);\n    var marginLeft = parseFloat(styles.marginLeft, 10);\n\n    offsets.top -= borderTopWidth - marginTop;\n    offsets.bottom -= borderTopWidth - marginTop;\n    offsets.left -= borderLeftWidth - marginLeft;\n    offsets.right -= borderLeftWidth - marginLeft;\n\n    // Attach marginTop and marginLeft because in some circumstances we may need them\n    offsets.marginTop = marginTop;\n    offsets.marginLeft = marginLeft;\n  }\n\n  if (isIE10 && !fixedPosition ? parent.contains(scrollParent) : parent === scrollParent && scrollParent.nodeName !== 'BODY') {\n    offsets = includeScroll(offsets, parent);\n  }\n\n  return offsets;\n}\n\nfunction getViewportOffsetRectRelativeToArtbitraryNode(element) {\n  var excludeScroll = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var html = element.ownerDocument.documentElement;\n  var relativeOffset = getOffsetRectRelativeToArbitraryNode(element, html);\n  var width = Math.max(html.clientWidth, window.innerWidth || 0);\n  var height = Math.max(html.clientHeight, window.innerHeight || 0);\n\n  var scrollTop = !excludeScroll ? getScroll(html) : 0;\n  var scrollLeft = !excludeScroll ? getScroll(html, 'left') : 0;\n\n  var offset = {\n    top: scrollTop - relativeOffset.top + relativeOffset.marginTop,\n    left: scrollLeft - relativeOffset.left + relativeOffset.marginLeft,\n    width: width,\n    height: height\n  };\n\n  return getClientRect(offset);\n}\n\n/**\n * Check if the given element is fixed or is inside a fixed parent\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {Element} customContainer\n * @returns {Boolean} answer to \"isFixed?\"\n */\nfunction isFixed(element) {\n  var nodeName = element.nodeName;\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    return false;\n  }\n  if (getStyleComputedProperty(element, 'position') === 'fixed') {\n    return true;\n  }\n  return isFixed(getParentNode(element));\n}\n\n/**\n * Finds the first parent of an element that has a transformed property defined\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} first transformed parent or documentElement\n */\n\nfunction getFixedPositionOffsetParent(element) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element || !element.parentElement || isIE()) {\n    return document.documentElement;\n  }\n  var el = element.parentElement;\n  while (el && getStyleComputedProperty(el, 'transform') === 'none') {\n    el = el.parentElement;\n  }\n  return el || document.documentElement;\n}\n\n/**\n * Computed the boundaries limits and return them\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} popper\n * @param {HTMLElement} reference\n * @param {number} padding\n * @param {HTMLElement} boundariesElement - Element used to define the boundaries\n * @param {Boolean} fixedPosition - Is in fixed position mode\n * @returns {Object} Coordinates of the boundaries\n */\nfunction getBoundaries(popper, reference, padding, boundariesElement) {\n  var fixedPosition = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n  // NOTE: 1 DOM access here\n\n  var boundaries = { top: 0, left: 0 };\n  var offsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n\n  // Handle viewport case\n  if (boundariesElement === 'viewport') {\n    boundaries = getViewportOffsetRectRelativeToArtbitraryNode(offsetParent, fixedPosition);\n  } else {\n    // Handle other cases based on DOM element used as boundaries\n    var boundariesNode = void 0;\n    if (boundariesElement === 'scrollParent') {\n      boundariesNode = getScrollParent(getParentNode(reference));\n      if (boundariesNode.nodeName === 'BODY') {\n        boundariesNode = popper.ownerDocument.documentElement;\n      }\n    } else if (boundariesElement === 'window') {\n      boundariesNode = popper.ownerDocument.documentElement;\n    } else {\n      boundariesNode = boundariesElement;\n    }\n\n    var offsets = getOffsetRectRelativeToArbitraryNode(boundariesNode, offsetParent, fixedPosition);\n\n    // In case of HTML, we need a different computation\n    if (boundariesNode.nodeName === 'HTML' && !isFixed(offsetParent)) {\n      var _getWindowSizes = getWindowSizes(),\n          height = _getWindowSizes.height,\n          width = _getWindowSizes.width;\n\n      boundaries.top += offsets.top - offsets.marginTop;\n      boundaries.bottom = height + offsets.top;\n      boundaries.left += offsets.left - offsets.marginLeft;\n      boundaries.right = width + offsets.left;\n    } else {\n      // for all the other DOM elements, this one is good\n      boundaries = offsets;\n    }\n  }\n\n  // Add paddings\n  boundaries.left += padding;\n  boundaries.top += padding;\n  boundaries.right -= padding;\n  boundaries.bottom -= padding;\n\n  return boundaries;\n}\n\nfunction getArea(_ref) {\n  var width = _ref.width,\n      height = _ref.height;\n\n  return width * height;\n}\n\n/**\n * Utility used to transform the `auto` placement to the placement with more\n * available space.\n * @method\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeAutoPlacement(placement, refRect, popper, reference, boundariesElement) {\n  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n  if (placement.indexOf('auto') === -1) {\n    return placement;\n  }\n\n  var boundaries = getBoundaries(popper, reference, padding, boundariesElement);\n\n  var rects = {\n    top: {\n      width: boundaries.width,\n      height: refRect.top - boundaries.top\n    },\n    right: {\n      width: boundaries.right - refRect.right,\n      height: boundaries.height\n    },\n    bottom: {\n      width: boundaries.width,\n      height: boundaries.bottom - refRect.bottom\n    },\n    left: {\n      width: refRect.left - boundaries.left,\n      height: boundaries.height\n    }\n  };\n\n  var sortedAreas = Object.keys(rects).map(function (key) {\n    return _extends({\n      key: key\n    }, rects[key], {\n      area: getArea(rects[key])\n    });\n  }).sort(function (a, b) {\n    return b.area - a.area;\n  });\n\n  var filteredAreas = sortedAreas.filter(function (_ref2) {\n    var width = _ref2.width,\n        height = _ref2.height;\n    return width >= popper.clientWidth && height >= popper.clientHeight;\n  });\n\n  var computedPlacement = filteredAreas.length > 0 ? filteredAreas[0].key : sortedAreas[0].key;\n\n  var variation = placement.split('-')[1];\n\n  return computedPlacement + (variation ? '-' + variation : '');\n}\n\n/**\n * Get offsets to the reference element\n * @method\n * @memberof Popper.Utils\n * @param {Object} state\n * @param {Element} popper - the popper element\n * @param {Element} reference - the reference element (the popper will be relative to this)\n * @param {Element} fixedPosition - is in fixed position mode\n * @returns {Object} An object containing the offsets which will be applied to the popper\n */\nfunction getReferenceOffsets(state, popper, reference) {\n  var fixedPosition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var commonOffsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n  return getOffsetRectRelativeToArbitraryNode(reference, commonOffsetParent, fixedPosition);\n}\n\n/**\n * Get the outer sizes of the given element (offset size + margins)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Object} object containing width and height properties\n */\nfunction getOuterSizes(element) {\n  var styles = getComputedStyle(element);\n  var x = parseFloat(styles.marginTop) + parseFloat(styles.marginBottom);\n  var y = parseFloat(styles.marginLeft) + parseFloat(styles.marginRight);\n  var result = {\n    width: element.offsetWidth + y,\n    height: element.offsetHeight + x\n  };\n  return result;\n}\n\n/**\n * Get the opposite placement of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement\n * @returns {String} flipped placement\n */\nfunction getOppositePlacement(placement) {\n  var hash = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' };\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}\n\n/**\n * Get offsets to the popper\n * @method\n * @memberof Popper.Utils\n * @param {Object} position - CSS position the Popper will get applied\n * @param {HTMLElement} popper - the popper element\n * @param {Object} referenceOffsets - the reference offsets (the popper will be relative to this)\n * @param {String} placement - one of the valid placement options\n * @returns {Object} popperOffsets - An object containing the offsets which will be applied to the popper\n */\nfunction getPopperOffsets(popper, referenceOffsets, placement) {\n  placement = placement.split('-')[0];\n\n  // Get popper node sizes\n  var popperRect = getOuterSizes(popper);\n\n  // Add position, width and height to our offsets object\n  var popperOffsets = {\n    width: popperRect.width,\n    height: popperRect.height\n  };\n\n  // depending by the popper placement we have to compute its offsets slightly differently\n  var isHoriz = ['right', 'left'].indexOf(placement) !== -1;\n  var mainSide = isHoriz ? 'top' : 'left';\n  var secondarySide = isHoriz ? 'left' : 'top';\n  var measurement = isHoriz ? 'height' : 'width';\n  var secondaryMeasurement = !isHoriz ? 'height' : 'width';\n\n  popperOffsets[mainSide] = referenceOffsets[mainSide] + referenceOffsets[measurement] / 2 - popperRect[measurement] / 2;\n  if (placement === secondarySide) {\n    popperOffsets[secondarySide] = referenceOffsets[secondarySide] - popperRect[secondaryMeasurement];\n  } else {\n    popperOffsets[secondarySide] = referenceOffsets[getOppositePlacement(secondarySide)];\n  }\n\n  return popperOffsets;\n}\n\n/**\n * Mimics the `find` method of Array\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction find(arr, check) {\n  // use native find if supported\n  if (Array.prototype.find) {\n    return arr.find(check);\n  }\n\n  // use `filter` to obtain the same behavior of `find`\n  return arr.filter(check)[0];\n}\n\n/**\n * Return the index of the matching object\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction findIndex(arr, prop, value) {\n  // use native findIndex if supported\n  if (Array.prototype.findIndex) {\n    return arr.findIndex(function (cur) {\n      return cur[prop] === value;\n    });\n  }\n\n  // use `find` + `indexOf` if `findIndex` isn't supported\n  var match = find(arr, function (obj) {\n    return obj[prop] === value;\n  });\n  return arr.indexOf(match);\n}\n\n/**\n * Loop trough the list of modifiers and run them in order,\n * each of them will then edit the data object.\n * @method\n * @memberof Popper.Utils\n * @param {dataObject} data\n * @param {Array} modifiers\n * @param {String} ends - Optional modifier name used as stopper\n * @returns {dataObject}\n */\nfunction runModifiers(modifiers, data, ends) {\n  var modifiersToRun = ends === undefined ? modifiers : modifiers.slice(0, findIndex(modifiers, 'name', ends));\n\n  modifiersToRun.forEach(function (modifier) {\n    if (modifier['function']) {\n      // eslint-disable-line dot-notation\n      console.warn('`modifier.function` is deprecated, use `modifier.fn`!');\n    }\n    var fn = modifier['function'] || modifier.fn; // eslint-disable-line dot-notation\n    if (modifier.enabled && isFunction(fn)) {\n      // Add properties to offsets to make them a complete clientRect object\n      // we do this before each modifier to make sure the previous one doesn't\n      // mess with these values\n      data.offsets.popper = getClientRect(data.offsets.popper);\n      data.offsets.reference = getClientRect(data.offsets.reference);\n\n      data = fn(data, modifier);\n    }\n  });\n\n  return data;\n}\n\n/**\n * Updates the position of the popper, computing the new offsets and applying\n * the new style.<br />\n * Prefer `scheduleUpdate` over `update` because of performance reasons.\n * @method\n * @memberof Popper\n */\nfunction update() {\n  // if popper is destroyed, don't perform any further update\n  if (this.state.isDestroyed) {\n    return;\n  }\n\n  var data = {\n    instance: this,\n    styles: {},\n    arrowStyles: {},\n    attributes: {},\n    flipped: false,\n    offsets: {}\n  };\n\n  // compute reference element offsets\n  data.offsets.reference = getReferenceOffsets(this.state, this.popper, this.reference, this.options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  data.placement = computeAutoPlacement(this.options.placement, data.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding);\n\n  // store the computed placement inside `originalPlacement`\n  data.originalPlacement = data.placement;\n\n  data.positionFixed = this.options.positionFixed;\n\n  // compute the popper offsets\n  data.offsets.popper = getPopperOffsets(this.popper, data.offsets.reference, data.placement);\n\n  data.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute';\n\n  // run the modifiers\n  data = runModifiers(this.modifiers, data);\n\n  // the first `update` will call `onCreate` callback\n  // the other ones will call `onUpdate` callback\n  if (!this.state.isCreated) {\n    this.state.isCreated = true;\n    this.options.onCreate(data);\n  } else {\n    this.options.onUpdate(data);\n  }\n}\n\n/**\n * Helper used to know if the given modifier is enabled.\n * @method\n * @memberof Popper.Utils\n * @returns {Boolean}\n */\nfunction isModifierEnabled(modifiers, modifierName) {\n  return modifiers.some(function (_ref) {\n    var name = _ref.name,\n        enabled = _ref.enabled;\n    return enabled && name === modifierName;\n  });\n}\n\n/**\n * Get the prefixed supported property name\n * @method\n * @memberof Popper.Utils\n * @argument {String} property (camelCase)\n * @returns {String} prefixed property (camelCase or PascalCase, depending on the vendor prefix)\n */\nfunction getSupportedPropertyName(property) {\n  var prefixes = [false, 'ms', 'Webkit', 'Moz', 'O'];\n  var upperProp = property.charAt(0).toUpperCase() + property.slice(1);\n\n  for (var i = 0; i < prefixes.length; i++) {\n    var prefix = prefixes[i];\n    var toCheck = prefix ? '' + prefix + upperProp : property;\n    if (typeof document.body.style[toCheck] !== 'undefined') {\n      return toCheck;\n    }\n  }\n  return null;\n}\n\n/**\n * Destroy the popper\n * @method\n * @memberof Popper\n */\nfunction destroy() {\n  this.state.isDestroyed = true;\n\n  // touch DOM only if `applyStyle` modifier is enabled\n  if (isModifierEnabled(this.modifiers, 'applyStyle')) {\n    this.popper.removeAttribute('x-placement');\n    this.popper.style.position = '';\n    this.popper.style.top = '';\n    this.popper.style.left = '';\n    this.popper.style.right = '';\n    this.popper.style.bottom = '';\n    this.popper.style.willChange = '';\n    this.popper.style[getSupportedPropertyName('transform')] = '';\n  }\n\n  this.disableEventListeners();\n\n  // remove the popper if user explicity asked for the deletion on destroy\n  // do not use `remove` because IE11 doesn't support it\n  if (this.options.removeOnDestroy) {\n    this.popper.parentNode.removeChild(this.popper);\n  }\n  return this;\n}\n\n/**\n * Get the window associated with the element\n * @argument {Element} element\n * @returns {Window}\n */\nfunction getWindow(element) {\n  var ownerDocument = element.ownerDocument;\n  return ownerDocument ? ownerDocument.defaultView : window;\n}\n\nfunction attachToScrollParents(scrollParent, event, callback, scrollParents) {\n  var isBody = scrollParent.nodeName === 'BODY';\n  var target = isBody ? scrollParent.ownerDocument.defaultView : scrollParent;\n  target.addEventListener(event, callback, { passive: true });\n\n  if (!isBody) {\n    attachToScrollParents(getScrollParent(target.parentNode), event, callback, scrollParents);\n  }\n  scrollParents.push(target);\n}\n\n/**\n * Setup needed event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction setupEventListeners(reference, options, state, updateBound) {\n  // Resize event listener on window\n  state.updateBound = updateBound;\n  getWindow(reference).addEventListener('resize', state.updateBound, { passive: true });\n\n  // Scroll event listener on scroll parents\n  var scrollElement = getScrollParent(reference);\n  attachToScrollParents(scrollElement, 'scroll', state.updateBound, state.scrollParents);\n  state.scrollElement = scrollElement;\n  state.eventsEnabled = true;\n\n  return state;\n}\n\n/**\n * It will add resize/scroll events and start recalculating\n * position of the popper element when they are triggered.\n * @method\n * @memberof Popper\n */\nfunction enableEventListeners() {\n  if (!this.state.eventsEnabled) {\n    this.state = setupEventListeners(this.reference, this.options, this.state, this.scheduleUpdate);\n  }\n}\n\n/**\n * Remove event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction removeEventListeners(reference, state) {\n  // Remove resize event listener on window\n  getWindow(reference).removeEventListener('resize', state.updateBound);\n\n  // Remove scroll event listener on scroll parents\n  state.scrollParents.forEach(function (target) {\n    target.removeEventListener('scroll', state.updateBound);\n  });\n\n  // Reset state\n  state.updateBound = null;\n  state.scrollParents = [];\n  state.scrollElement = null;\n  state.eventsEnabled = false;\n  return state;\n}\n\n/**\n * It will remove resize/scroll events and won't recalculate popper position\n * when they are triggered. It also won't trigger onUpdate callback anymore,\n * unless you call `update` method manually.\n * @method\n * @memberof Popper\n */\nfunction disableEventListeners() {\n  if (this.state.eventsEnabled) {\n    cancelAnimationFrame(this.scheduleUpdate);\n    this.state = removeEventListeners(this.reference, this.state);\n  }\n}\n\n/**\n * Tells if a given input is a number\n * @method\n * @memberof Popper.Utils\n * @param {*} input to check\n * @return {Boolean}\n */\nfunction isNumeric(n) {\n  return n !== '' && !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * Set the style to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the style to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setStyles(element, styles) {\n  Object.keys(styles).forEach(function (prop) {\n    var unit = '';\n    // add unit if the value is numeric and is one of the following\n    if (['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(prop) !== -1 && isNumeric(styles[prop])) {\n      unit = 'px';\n    }\n    element.style[prop] = styles[prop] + unit;\n  });\n}\n\n/**\n * Set the attributes to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the attributes to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setAttributes(element, attributes) {\n  Object.keys(attributes).forEach(function (prop) {\n    var value = attributes[prop];\n    if (value !== false) {\n      element.setAttribute(prop, attributes[prop]);\n    } else {\n      element.removeAttribute(prop);\n    }\n  });\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} data.styles - List of style properties - values to apply to popper element\n * @argument {Object} data.attributes - List of attribute properties - values to apply to popper element\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The same data object\n */\nfunction applyStyle(data) {\n  // any property present in `data.styles` will be applied to the popper,\n  // in this way we can make the 3rd party modifiers add custom styles to it\n  // Be aware, modifiers could override the properties defined in the previous\n  // lines of this modifier!\n  setStyles(data.instance.popper, data.styles);\n\n  // any property present in `data.attributes` will be applied to the popper,\n  // they will be set as HTML attributes of the element\n  setAttributes(data.instance.popper, data.attributes);\n\n  // if arrowElement is defined and arrowStyles has some properties\n  if (data.arrowElement && Object.keys(data.arrowStyles).length) {\n    setStyles(data.arrowElement, data.arrowStyles);\n  }\n\n  return data;\n}\n\n/**\n * Set the x-placement attribute before everything else because it could be used\n * to add margins to the popper margins needs to be calculated to get the\n * correct popper offsets.\n * @method\n * @memberof Popper.modifiers\n * @param {HTMLElement} reference - The reference element used to position the popper\n * @param {HTMLElement} popper - The HTML element used as popper\n * @param {Object} options - Popper.js options\n */\nfunction applyStyleOnLoad(reference, popper, options, modifierOptions, state) {\n  // compute reference element offsets\n  var referenceOffsets = getReferenceOffsets(state, popper, reference, options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  var placement = computeAutoPlacement(options.placement, referenceOffsets, popper, reference, options.modifiers.flip.boundariesElement, options.modifiers.flip.padding);\n\n  popper.setAttribute('x-placement', placement);\n\n  // Apply `position` to popper before anything else because\n  // without the position applied we can't guarantee correct computations\n  setStyles(popper, { position: options.positionFixed ? 'fixed' : 'absolute' });\n\n  return options;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeStyle(data, options) {\n  var x = options.x,\n      y = options.y;\n  var popper = data.offsets.popper;\n\n  // Remove this legacy support in Popper.js v2\n\n  var legacyGpuAccelerationOption = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'applyStyle';\n  }).gpuAcceleration;\n  if (legacyGpuAccelerationOption !== undefined) {\n    console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');\n  }\n  var gpuAcceleration = legacyGpuAccelerationOption !== undefined ? legacyGpuAccelerationOption : options.gpuAcceleration;\n\n  var offsetParent = getOffsetParent(data.instance.popper);\n  var offsetParentRect = getBoundingClientRect(offsetParent);\n\n  // Styles\n  var styles = {\n    position: popper.position\n  };\n\n  // Avoid blurry text by using full pixel integers.\n  // For pixel-perfect positioning, top/bottom prefers rounded\n  // values, while left/right prefers floored values.\n  var offsets = {\n    left: Math.floor(popper.left),\n    top: Math.round(popper.top),\n    bottom: Math.round(popper.bottom),\n    right: Math.floor(popper.right)\n  };\n\n  var sideA = x === 'bottom' ? 'top' : 'bottom';\n  var sideB = y === 'right' ? 'left' : 'right';\n\n  // if gpuAcceleration is set to `true` and transform is supported,\n  //  we use `translate3d` to apply the position to the popper we\n  // automatically use the supported prefixed version if needed\n  var prefixedProperty = getSupportedPropertyName('transform');\n\n  // now, let's make a step back and look at this code closely (wtf?)\n  // If the content of the popper grows once it's been positioned, it\n  // may happen that the popper gets misplaced because of the new content\n  // overflowing its reference element\n  // To avoid this problem, we provide two options (x and y), which allow\n  // the consumer to define the offset origin.\n  // If we position a popper on top of a reference element, we can set\n  // `x` to `top` to make the popper grow towards its top instead of\n  // its bottom.\n  var left = void 0,\n      top = void 0;\n  if (sideA === 'bottom') {\n    top = -offsetParentRect.height + offsets.bottom;\n  } else {\n    top = offsets.top;\n  }\n  if (sideB === 'right') {\n    left = -offsetParentRect.width + offsets.right;\n  } else {\n    left = offsets.left;\n  }\n  if (gpuAcceleration && prefixedProperty) {\n    styles[prefixedProperty] = 'translate3d(' + left + 'px, ' + top + 'px, 0)';\n    styles[sideA] = 0;\n    styles[sideB] = 0;\n    styles.willChange = 'transform';\n  } else {\n    // othwerise, we use the standard `top`, `left`, `bottom` and `right` properties\n    var invertTop = sideA === 'bottom' ? -1 : 1;\n    var invertLeft = sideB === 'right' ? -1 : 1;\n    styles[sideA] = top * invertTop;\n    styles[sideB] = left * invertLeft;\n    styles.willChange = sideA + ', ' + sideB;\n  }\n\n  // Attributes\n  var attributes = {\n    'x-placement': data.placement\n  };\n\n  // Update `data` attributes, styles and arrowStyles\n  data.attributes = _extends({}, attributes, data.attributes);\n  data.styles = _extends({}, styles, data.styles);\n  data.arrowStyles = _extends({}, data.offsets.arrow, data.arrowStyles);\n\n  return data;\n}\n\n/**\n * Helper used to know if the given modifier depends from another one.<br />\n * It checks if the needed modifier is listed and enabled.\n * @method\n * @memberof Popper.Utils\n * @param {Array} modifiers - list of modifiers\n * @param {String} requestingName - name of requesting modifier\n * @param {String} requestedName - name of requested modifier\n * @returns {Boolean}\n */\nfunction isModifierRequired(modifiers, requestingName, requestedName) {\n  var requesting = find(modifiers, function (_ref) {\n    var name = _ref.name;\n    return name === requestingName;\n  });\n\n  var isRequired = !!requesting && modifiers.some(function (modifier) {\n    return modifier.name === requestedName && modifier.enabled && modifier.order < requesting.order;\n  });\n\n  if (!isRequired) {\n    var _requesting = '`' + requestingName + '`';\n    var requested = '`' + requestedName + '`';\n    console.warn(requested + ' modifier is required by ' + _requesting + ' modifier in order to work, be sure to include it before ' + _requesting + '!');\n  }\n  return isRequired;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction arrow(data, options) {\n  var _data$offsets$arrow;\n\n  // arrow depends on keepTogether in order to work\n  if (!isModifierRequired(data.instance.modifiers, 'arrow', 'keepTogether')) {\n    return data;\n  }\n\n  var arrowElement = options.element;\n\n  // if arrowElement is a string, suppose it's a CSS selector\n  if (typeof arrowElement === 'string') {\n    arrowElement = data.instance.popper.querySelector(arrowElement);\n\n    // if arrowElement is not found, don't run the modifier\n    if (!arrowElement) {\n      return data;\n    }\n  } else {\n    // if the arrowElement isn't a query selector we must check that the\n    // provided DOM node is child of its popper node\n    if (!data.instance.popper.contains(arrowElement)) {\n      console.warn('WARNING: `arrow.element` must be child of its popper element!');\n      return data;\n    }\n  }\n\n  var placement = data.placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isVertical = ['left', 'right'].indexOf(placement) !== -1;\n\n  var len = isVertical ? 'height' : 'width';\n  var sideCapitalized = isVertical ? 'Top' : 'Left';\n  var side = sideCapitalized.toLowerCase();\n  var altSide = isVertical ? 'left' : 'top';\n  var opSide = isVertical ? 'bottom' : 'right';\n  var arrowElementSize = getOuterSizes(arrowElement)[len];\n\n  //\n  // extends keepTogether behavior making sure the popper and its\n  // reference have enough pixels in conjuction\n  //\n\n  // top/left side\n  if (reference[opSide] - arrowElementSize < popper[side]) {\n    data.offsets.popper[side] -= popper[side] - (reference[opSide] - arrowElementSize);\n  }\n  // bottom/right side\n  if (reference[side] + arrowElementSize > popper[opSide]) {\n    data.offsets.popper[side] += reference[side] + arrowElementSize - popper[opSide];\n  }\n  data.offsets.popper = getClientRect(data.offsets.popper);\n\n  // compute center of the popper\n  var center = reference[side] + reference[len] / 2 - arrowElementSize / 2;\n\n  // Compute the sideValue using the updated popper offsets\n  // take popper margin in account because we don't have this info available\n  var css = getStyleComputedProperty(data.instance.popper);\n  var popperMarginSide = parseFloat(css['margin' + sideCapitalized], 10);\n  var popperBorderSide = parseFloat(css['border' + sideCapitalized + 'Width'], 10);\n  var sideValue = center - data.offsets.popper[side] - popperMarginSide - popperBorderSide;\n\n  // prevent arrowElement from being placed not contiguously to its popper\n  sideValue = Math.max(Math.min(popper[len] - arrowElementSize, sideValue), 0);\n\n  data.arrowElement = arrowElement;\n  data.offsets.arrow = (_data$offsets$arrow = {}, defineProperty(_data$offsets$arrow, side, Math.round(sideValue)), defineProperty(_data$offsets$arrow, altSide, ''), _data$offsets$arrow);\n\n  return data;\n}\n\n/**\n * Get the opposite placement variation of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement variation\n * @returns {String} flipped placement variation\n */\nfunction getOppositeVariation(variation) {\n  if (variation === 'end') {\n    return 'start';\n  } else if (variation === 'start') {\n    return 'end';\n  }\n  return variation;\n}\n\n/**\n * List of accepted placements to use as values of the `placement` option.<br />\n * Valid placements are:\n * - `auto`\n * - `top`\n * - `right`\n * - `bottom`\n * - `left`\n *\n * Each placement can have a variation from this list:\n * - `-start`\n * - `-end`\n *\n * Variations are interpreted easily if you think of them as the left to right\n * written languages. Horizontally (`top` and `bottom`), `start` is left and `end`\n * is right.<br />\n * Vertically (`left` and `right`), `start` is top and `end` is bottom.\n *\n * Some valid examples are:\n * - `top-end` (on top of reference, right aligned)\n * - `right-start` (on right of reference, top aligned)\n * - `bottom` (on bottom, centered)\n * - `auto-right` (on the side with more space available, alignment depends by placement)\n *\n * @static\n * @type {Array}\n * @enum {String}\n * @readonly\n * @method placements\n * @memberof Popper\n */\nvar placements = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'];\n\n// Get rid of `auto` `auto-start` and `auto-end`\nvar validPlacements = placements.slice(3);\n\n/**\n * Given an initial placement, returns all the subsequent placements\n * clockwise (or counter-clockwise).\n *\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement - A valid placement (it accepts variations)\n * @argument {Boolean} counter - Set to true to walk the placements counterclockwise\n * @returns {Array} placements including their variations\n */\nfunction clockwise(placement) {\n  var counter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var index = validPlacements.indexOf(placement);\n  var arr = validPlacements.slice(index + 1).concat(validPlacements.slice(0, index));\n  return counter ? arr.reverse() : arr;\n}\n\nvar BEHAVIORS = {\n  FLIP: 'flip',\n  CLOCKWISE: 'clockwise',\n  COUNTERCLOCKWISE: 'counterclockwise'\n};\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction flip(data, options) {\n  // if `inner` modifier is enabled, we can't use the `flip` modifier\n  if (isModifierEnabled(data.instance.modifiers, 'inner')) {\n    return data;\n  }\n\n  if (data.flipped && data.placement === data.originalPlacement) {\n    // seems like flip is trying to loop, probably there's not enough space on any of the flippable sides\n    return data;\n  }\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, options.boundariesElement, data.positionFixed);\n\n  var placement = data.placement.split('-')[0];\n  var placementOpposite = getOppositePlacement(placement);\n  var variation = data.placement.split('-')[1] || '';\n\n  var flipOrder = [];\n\n  switch (options.behavior) {\n    case BEHAVIORS.FLIP:\n      flipOrder = [placement, placementOpposite];\n      break;\n    case BEHAVIORS.CLOCKWISE:\n      flipOrder = clockwise(placement);\n      break;\n    case BEHAVIORS.COUNTERCLOCKWISE:\n      flipOrder = clockwise(placement, true);\n      break;\n    default:\n      flipOrder = options.behavior;\n  }\n\n  flipOrder.forEach(function (step, index) {\n    if (placement !== step || flipOrder.length === index + 1) {\n      return data;\n    }\n\n    placement = data.placement.split('-')[0];\n    placementOpposite = getOppositePlacement(placement);\n\n    var popperOffsets = data.offsets.popper;\n    var refOffsets = data.offsets.reference;\n\n    // using floor because the reference offsets may contain decimals we are not going to consider here\n    var floor = Math.floor;\n    var overlapsRef = placement === 'left' && floor(popperOffsets.right) > floor(refOffsets.left) || placement === 'right' && floor(popperOffsets.left) < floor(refOffsets.right) || placement === 'top' && floor(popperOffsets.bottom) > floor(refOffsets.top) || placement === 'bottom' && floor(popperOffsets.top) < floor(refOffsets.bottom);\n\n    var overflowsLeft = floor(popperOffsets.left) < floor(boundaries.left);\n    var overflowsRight = floor(popperOffsets.right) > floor(boundaries.right);\n    var overflowsTop = floor(popperOffsets.top) < floor(boundaries.top);\n    var overflowsBottom = floor(popperOffsets.bottom) > floor(boundaries.bottom);\n\n    var overflowsBoundaries = placement === 'left' && overflowsLeft || placement === 'right' && overflowsRight || placement === 'top' && overflowsTop || placement === 'bottom' && overflowsBottom;\n\n    // flip the variation if required\n    var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n    var flippedVariation = !!options.flipVariations && (isVertical && variation === 'start' && overflowsLeft || isVertical && variation === 'end' && overflowsRight || !isVertical && variation === 'start' && overflowsTop || !isVertical && variation === 'end' && overflowsBottom);\n\n    if (overlapsRef || overflowsBoundaries || flippedVariation) {\n      // this boolean to detect any flip loop\n      data.flipped = true;\n\n      if (overlapsRef || overflowsBoundaries) {\n        placement = flipOrder[index + 1];\n      }\n\n      if (flippedVariation) {\n        variation = getOppositeVariation(variation);\n      }\n\n      data.placement = placement + (variation ? '-' + variation : '');\n\n      // this object contains `position`, we want to preserve it along with\n      // any additional property we may add in the future\n      data.offsets.popper = _extends({}, data.offsets.popper, getPopperOffsets(data.instance.popper, data.offsets.reference, data.placement));\n\n      data = runModifiers(data.instance.modifiers, data, 'flip');\n    }\n  });\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction keepTogether(data) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var placement = data.placement.split('-')[0];\n  var floor = Math.floor;\n  var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n  var side = isVertical ? 'right' : 'bottom';\n  var opSide = isVertical ? 'left' : 'top';\n  var measurement = isVertical ? 'width' : 'height';\n\n  if (popper[side] < floor(reference[opSide])) {\n    data.offsets.popper[opSide] = floor(reference[opSide]) - popper[measurement];\n  }\n  if (popper[opSide] > floor(reference[side])) {\n    data.offsets.popper[opSide] = floor(reference[side]);\n  }\n\n  return data;\n}\n\n/**\n * Converts a string containing value + unit into a px value number\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} str - Value + unit string\n * @argument {String} measurement - `height` or `width`\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @returns {Number|String}\n * Value in pixels, or original string if no values were extracted\n */\nfunction toValue(str, measurement, popperOffsets, referenceOffsets) {\n  // separate value from unit\n  var split = str.match(/((?:\\-|\\+)?\\d*\\.?\\d*)(.*)/);\n  var value = +split[1];\n  var unit = split[2];\n\n  // If it's not a number it's an operator, I guess\n  if (!value) {\n    return str;\n  }\n\n  if (unit.indexOf('%') === 0) {\n    var element = void 0;\n    switch (unit) {\n      case '%p':\n        element = popperOffsets;\n        break;\n      case '%':\n      case '%r':\n      default:\n        element = referenceOffsets;\n    }\n\n    var rect = getClientRect(element);\n    return rect[measurement] / 100 * value;\n  } else if (unit === 'vh' || unit === 'vw') {\n    // if is a vh or vw, we calculate the size based on the viewport\n    var size = void 0;\n    if (unit === 'vh') {\n      size = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    } else {\n      size = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n    }\n    return size / 100 * value;\n  } else {\n    // if is an explicit pixel unit, we get rid of the unit and keep the value\n    // if is an implicit unit, it's px, and we return just the value\n    return value;\n  }\n}\n\n/**\n * Parse an `offset` string to extrapolate `x` and `y` numeric offsets.\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} offset\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @argument {String} basePlacement\n * @returns {Array} a two cells array with x and y offsets in numbers\n */\nfunction parseOffset(offset, popperOffsets, referenceOffsets, basePlacement) {\n  var offsets = [0, 0];\n\n  // Use height if placement is left or right and index is 0 otherwise use width\n  // in this way the first offset will use an axis and the second one\n  // will use the other one\n  var useHeight = ['right', 'left'].indexOf(basePlacement) !== -1;\n\n  // Split the offset string to obtain a list of values and operands\n  // The regex addresses values with the plus or minus sign in front (+10, -20, etc)\n  var fragments = offset.split(/(\\+|\\-)/).map(function (frag) {\n    return frag.trim();\n  });\n\n  // Detect if the offset string contains a pair of values or a single one\n  // they could be separated by comma or space\n  var divider = fragments.indexOf(find(fragments, function (frag) {\n    return frag.search(/,|\\s/) !== -1;\n  }));\n\n  if (fragments[divider] && fragments[divider].indexOf(',') === -1) {\n    console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');\n  }\n\n  // If divider is found, we divide the list of values and operands to divide\n  // them by ofset X and Y.\n  var splitRegex = /\\s*,\\s*|\\s+/;\n  var ops = divider !== -1 ? [fragments.slice(0, divider).concat([fragments[divider].split(splitRegex)[0]]), [fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider + 1))] : [fragments];\n\n  // Convert the values with units to absolute pixels to allow our computations\n  ops = ops.map(function (op, index) {\n    // Most of the units rely on the orientation of the popper\n    var measurement = (index === 1 ? !useHeight : useHeight) ? 'height' : 'width';\n    var mergeWithPrevious = false;\n    return op\n    // This aggregates any `+` or `-` sign that aren't considered operators\n    // e.g.: 10 + +5 => [10, +, +5]\n    .reduce(function (a, b) {\n      if (a[a.length - 1] === '' && ['+', '-'].indexOf(b) !== -1) {\n        a[a.length - 1] = b;\n        mergeWithPrevious = true;\n        return a;\n      } else if (mergeWithPrevious) {\n        a[a.length - 1] += b;\n        mergeWithPrevious = false;\n        return a;\n      } else {\n        return a.concat(b);\n      }\n    }, [])\n    // Here we convert the string values into number values (in px)\n    .map(function (str) {\n      return toValue(str, measurement, popperOffsets, referenceOffsets);\n    });\n  });\n\n  // Loop trough the offsets arrays and execute the operations\n  ops.forEach(function (op, index) {\n    op.forEach(function (frag, index2) {\n      if (isNumeric(frag)) {\n        offsets[index] += frag * (op[index2 - 1] === '-' ? -1 : 1);\n      }\n    });\n  });\n  return offsets;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @argument {Number|String} options.offset=0\n * The offset value as described in the modifier description\n * @returns {Object} The data object, properly modified\n */\nfunction offset(data, _ref) {\n  var offset = _ref.offset;\n  var placement = data.placement,\n      _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var basePlacement = placement.split('-')[0];\n\n  var offsets = void 0;\n  if (isNumeric(+offset)) {\n    offsets = [+offset, 0];\n  } else {\n    offsets = parseOffset(offset, popper, reference, basePlacement);\n  }\n\n  if (basePlacement === 'left') {\n    popper.top += offsets[0];\n    popper.left -= offsets[1];\n  } else if (basePlacement === 'right') {\n    popper.top += offsets[0];\n    popper.left += offsets[1];\n  } else if (basePlacement === 'top') {\n    popper.left += offsets[0];\n    popper.top -= offsets[1];\n  } else if (basePlacement === 'bottom') {\n    popper.left += offsets[0];\n    popper.top += offsets[1];\n  }\n\n  data.popper = popper;\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction preventOverflow(data, options) {\n  var boundariesElement = options.boundariesElement || getOffsetParent(data.instance.popper);\n\n  // If offsetParent is the reference element, we really want to\n  // go one step up and use the next offsetParent as reference to\n  // avoid to make this modifier completely useless and look like broken\n  if (data.instance.reference === boundariesElement) {\n    boundariesElement = getOffsetParent(boundariesElement);\n  }\n\n  // NOTE: DOM access here\n  // resets the popper's position so that the document size can be calculated excluding\n  // the size of the popper element itself\n  var transformProp = getSupportedPropertyName('transform');\n  var popperStyles = data.instance.popper.style; // assignment to help minification\n  var top = popperStyles.top,\n      left = popperStyles.left,\n      transform = popperStyles[transformProp];\n\n  popperStyles.top = '';\n  popperStyles.left = '';\n  popperStyles[transformProp] = '';\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, boundariesElement, data.positionFixed);\n\n  // NOTE: DOM access here\n  // restores the original style properties after the offsets have been computed\n  popperStyles.top = top;\n  popperStyles.left = left;\n  popperStyles[transformProp] = transform;\n\n  options.boundaries = boundaries;\n\n  var order = options.priority;\n  var popper = data.offsets.popper;\n\n  var check = {\n    primary: function primary(placement) {\n      var value = popper[placement];\n      if (popper[placement] < boundaries[placement] && !options.escapeWithReference) {\n        value = Math.max(popper[placement], boundaries[placement]);\n      }\n      return defineProperty({}, placement, value);\n    },\n    secondary: function secondary(placement) {\n      var mainSide = placement === 'right' ? 'left' : 'top';\n      var value = popper[mainSide];\n      if (popper[placement] > boundaries[placement] && !options.escapeWithReference) {\n        value = Math.min(popper[mainSide], boundaries[placement] - (placement === 'right' ? popper.width : popper.height));\n      }\n      return defineProperty({}, mainSide, value);\n    }\n  };\n\n  order.forEach(function (placement) {\n    var side = ['left', 'top'].indexOf(placement) !== -1 ? 'primary' : 'secondary';\n    popper = _extends({}, popper, check[side](placement));\n  });\n\n  data.offsets.popper = popper;\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction shift(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var shiftvariation = placement.split('-')[1];\n\n  // if shift shiftvariation is specified, run the modifier\n  if (shiftvariation) {\n    var _data$offsets = data.offsets,\n        reference = _data$offsets.reference,\n        popper = _data$offsets.popper;\n\n    var isVertical = ['bottom', 'top'].indexOf(basePlacement) !== -1;\n    var side = isVertical ? 'left' : 'top';\n    var measurement = isVertical ? 'width' : 'height';\n\n    var shiftOffsets = {\n      start: defineProperty({}, side, reference[side]),\n      end: defineProperty({}, side, reference[side] + reference[measurement] - popper[measurement])\n    };\n\n    data.offsets.popper = _extends({}, popper, shiftOffsets[shiftvariation]);\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction hide(data) {\n  if (!isModifierRequired(data.instance.modifiers, 'hide', 'preventOverflow')) {\n    return data;\n  }\n\n  var refRect = data.offsets.reference;\n  var bound = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'preventOverflow';\n  }).boundaries;\n\n  if (refRect.bottom < bound.top || refRect.left > bound.right || refRect.top > bound.bottom || refRect.right < bound.left) {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === true) {\n      return data;\n    }\n\n    data.hide = true;\n    data.attributes['x-out-of-boundaries'] = '';\n  } else {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === false) {\n      return data;\n    }\n\n    data.hide = false;\n    data.attributes['x-out-of-boundaries'] = false;\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction inner(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isHoriz = ['left', 'right'].indexOf(basePlacement) !== -1;\n\n  var subtractLength = ['top', 'left'].indexOf(basePlacement) === -1;\n\n  popper[isHoriz ? 'left' : 'top'] = reference[basePlacement] - (subtractLength ? popper[isHoriz ? 'width' : 'height'] : 0);\n\n  data.placement = getOppositePlacement(placement);\n  data.offsets.popper = getClientRect(popper);\n\n  return data;\n}\n\n/**\n * Modifier function, each modifier can have a function of this type assigned\n * to its `fn` property.<br />\n * These functions will be called on each update, this means that you must\n * make sure they are performant enough to avoid performance bottlenecks.\n *\n * @function ModifierFn\n * @argument {dataObject} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {dataObject} The data object, properly modified\n */\n\n/**\n * Modifiers are plugins used to alter the behavior of your poppers.<br />\n * Popper.js uses a set of 9 modifiers to provide all the basic functionalities\n * needed by the library.\n *\n * Usually you don't want to override the `order`, `fn` and `onLoad` props.\n * All the other properties are configurations that could be tweaked.\n * @namespace modifiers\n */\nvar modifiers = {\n  /**\n   * Modifier used to shift the popper on the start or end of its reference\n   * element.<br />\n   * It will read the variation of the `placement` property.<br />\n   * It can be one either `-end` or `-start`.\n   * @memberof modifiers\n   * @inner\n   */\n  shift: {\n    /** @prop {number} order=100 - Index used to define the order of execution */\n    order: 100,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: shift\n  },\n\n  /**\n   * The `offset` modifier can shift your popper on both its axis.\n   *\n   * It accepts the following units:\n   * - `px` or unitless, interpreted as pixels\n   * - `%` or `%r`, percentage relative to the length of the reference element\n   * - `%p`, percentage relative to the length of the popper element\n   * - `vw`, CSS viewport width unit\n   * - `vh`, CSS viewport height unit\n   *\n   * For length is intended the main axis relative to the placement of the popper.<br />\n   * This means that if the placement is `top` or `bottom`, the length will be the\n   * `width`. In case of `left` or `right`, it will be the height.\n   *\n   * You can provide a single value (as `Number` or `String`), or a pair of values\n   * as `String` divided by a comma or one (or more) white spaces.<br />\n   * The latter is a deprecated method because it leads to confusion and will be\n   * removed in v2.<br />\n   * Additionally, it accepts additions and subtractions between different units.\n   * Note that multiplications and divisions aren't supported.\n   *\n   * Valid examples are:\n   * ```\n   * 10\n   * '10%'\n   * '10, 10'\n   * '10%, 10'\n   * '10 + 10%'\n   * '10 - 5vh + 3%'\n   * '-10px + 5vh, 5px - 6%'\n   * ```\n   * > **NB**: If you desire to apply offsets to your poppers in a way that may make them overlap\n   * > with their reference element, unfortunately, you will have to disable the `flip` modifier.\n   * > More on this [reading this issue](https://github.com/FezVrasta/popper.js/issues/373)\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  offset: {\n    /** @prop {number} order=200 - Index used to define the order of execution */\n    order: 200,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: offset,\n    /** @prop {Number|String} offset=0\n     * The offset value as described in the modifier description\n     */\n    offset: 0\n  },\n\n  /**\n   * Modifier used to prevent the popper from being positioned outside the boundary.\n   *\n   * An scenario exists where the reference itself is not within the boundaries.<br />\n   * We can say it has \"escaped the boundaries\" — or just \"escaped\".<br />\n   * In this case we need to decide whether the popper should either:\n   *\n   * - detach from the reference and remain \"trapped\" in the boundaries, or\n   * - if it should ignore the boundary and \"escape with its reference\"\n   *\n   * When `escapeWithReference` is set to`true` and reference is completely\n   * outside its boundaries, the popper will overflow (or completely leave)\n   * the boundaries in order to remain attached to the edge of the reference.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  preventOverflow: {\n    /** @prop {number} order=300 - Index used to define the order of execution */\n    order: 300,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: preventOverflow,\n    /**\n     * @prop {Array} [priority=['left','right','top','bottom']]\n     * Popper will try to prevent overflow following these priorities by default,\n     * then, it could overflow on the left and on top of the `boundariesElement`\n     */\n    priority: ['left', 'right', 'top', 'bottom'],\n    /**\n     * @prop {number} padding=5\n     * Amount of pixel used to define a minimum distance between the boundaries\n     * and the popper this makes sure the popper has always a little padding\n     * between the edges of its container\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='scrollParent'\n     * Boundaries used by the modifier, can be `scrollParent`, `window`,\n     * `viewport` or any DOM element.\n     */\n    boundariesElement: 'scrollParent'\n  },\n\n  /**\n   * Modifier used to make sure the reference and its popper stay near eachothers\n   * without leaving any gap between the two. Expecially useful when the arrow is\n   * enabled and you want to assure it to point to its reference element.\n   * It cares only about the first axis, you can still have poppers with margin\n   * between the popper and its reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  keepTogether: {\n    /** @prop {number} order=400 - Index used to define the order of execution */\n    order: 400,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: keepTogether\n  },\n\n  /**\n   * This modifier is used to move the `arrowElement` of the popper to make\n   * sure it is positioned between the reference element and its popper element.\n   * It will read the outer size of the `arrowElement` node to detect how many\n   * pixels of conjuction are needed.\n   *\n   * It has no effect if no `arrowElement` is provided.\n   * @memberof modifiers\n   * @inner\n   */\n  arrow: {\n    /** @prop {number} order=500 - Index used to define the order of execution */\n    order: 500,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: arrow,\n    /** @prop {String|HTMLElement} element='[x-arrow]' - Selector or node used as arrow */\n    element: '[x-arrow]'\n  },\n\n  /**\n   * Modifier used to flip the popper's placement when it starts to overlap its\n   * reference element.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   *\n   * **NOTE:** this modifier will interrupt the current update cycle and will\n   * restart it if it detects the need to flip the placement.\n   * @memberof modifiers\n   * @inner\n   */\n  flip: {\n    /** @prop {number} order=600 - Index used to define the order of execution */\n    order: 600,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: flip,\n    /**\n     * @prop {String|Array} behavior='flip'\n     * The behavior used to change the popper's placement. It can be one of\n     * `flip`, `clockwise`, `counterclockwise` or an array with a list of valid\n     * placements (with optional variations).\n     */\n    behavior: 'flip',\n    /**\n     * @prop {number} padding=5\n     * The popper will flip if it hits the edges of the `boundariesElement`\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='viewport'\n     * The element which will define the boundaries of the popper position,\n     * the popper will never be placed outside of the defined boundaries\n     * (except if keepTogether is enabled)\n     */\n    boundariesElement: 'viewport'\n  },\n\n  /**\n   * Modifier used to make the popper flow toward the inner of the reference element.\n   * By default, when this modifier is disabled, the popper will be placed outside\n   * the reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  inner: {\n    /** @prop {number} order=700 - Index used to define the order of execution */\n    order: 700,\n    /** @prop {Boolean} enabled=false - Whether the modifier is enabled or not */\n    enabled: false,\n    /** @prop {ModifierFn} */\n    fn: inner\n  },\n\n  /**\n   * Modifier used to hide the popper when its reference element is outside of the\n   * popper boundaries. It will set a `x-out-of-boundaries` attribute which can\n   * be used to hide with a CSS selector the popper when its reference is\n   * out of boundaries.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   * @memberof modifiers\n   * @inner\n   */\n  hide: {\n    /** @prop {number} order=800 - Index used to define the order of execution */\n    order: 800,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: hide\n  },\n\n  /**\n   * Computes the style that will be applied to the popper element to gets\n   * properly positioned.\n   *\n   * Note that this modifier will not touch the DOM, it just prepares the styles\n   * so that `applyStyle` modifier can apply it. This separation is useful\n   * in case you need to replace `applyStyle` with a custom implementation.\n   *\n   * This modifier has `850` as `order` value to maintain backward compatibility\n   * with previous versions of Popper.js. Expect the modifiers ordering method\n   * to change in future major versions of the library.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  computeStyle: {\n    /** @prop {number} order=850 - Index used to define the order of execution */\n    order: 850,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: computeStyle,\n    /**\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3d transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties.\n     */\n    gpuAcceleration: true,\n    /**\n     * @prop {string} [x='bottom']\n     * Where to anchor the X axis (`bottom` or `top`). AKA X offset origin.\n     * Change this if your popper should grow in a direction different from `bottom`\n     */\n    x: 'bottom',\n    /**\n     * @prop {string} [x='left']\n     * Where to anchor the Y axis (`left` or `right`). AKA Y offset origin.\n     * Change this if your popper should grow in a direction different from `right`\n     */\n    y: 'right'\n  },\n\n  /**\n   * Applies the computed styles to the popper element.\n   *\n   * All the DOM manipulations are limited to this modifier. This is useful in case\n   * you want to integrate Popper.js inside a framework or view library and you\n   * want to delegate all the DOM manipulations to it.\n   *\n   * Note that if you disable this modifier, you must make sure the popper element\n   * has its position set to `absolute` before Popper.js can do its work!\n   *\n   * Just disable this modifier and define you own to achieve the desired effect.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  applyStyle: {\n    /** @prop {number} order=900 - Index used to define the order of execution */\n    order: 900,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: applyStyle,\n    /** @prop {Function} */\n    onLoad: applyStyleOnLoad,\n    /**\n     * @deprecated since version 1.10.0, the property moved to `computeStyle` modifier\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3d transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties.\n     */\n    gpuAcceleration: undefined\n  }\n};\n\n/**\n * The `dataObject` is an object containing all the informations used by Popper.js\n * this object get passed to modifiers and to the `onCreate` and `onUpdate` callbacks.\n * @name dataObject\n * @property {Object} data.instance The Popper.js instance\n * @property {String} data.placement Placement applied to popper\n * @property {String} data.originalPlacement Placement originally defined on init\n * @property {Boolean} data.flipped True if popper has been flipped by flip modifier\n * @property {Boolean} data.hide True if the reference element is out of boundaries, useful to know when to hide the popper.\n * @property {HTMLElement} data.arrowElement Node used as arrow by arrow modifier\n * @property {Object} data.styles Any CSS property defined here will be applied to the popper, it expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.arrowStyles Any CSS property defined here will be applied to the popper arrow, it expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.boundaries Offsets of the popper boundaries\n * @property {Object} data.offsets The measurements of popper, reference and arrow elements.\n * @property {Object} data.offsets.popper `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.reference `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.arrow] `top` and `left` offsets, only one of them will be different from 0\n */\n\n/**\n * Default options provided to Popper.js constructor.<br />\n * These can be overriden using the `options` argument of Popper.js.<br />\n * To override an option, simply pass as 3rd argument an object with the same\n * structure of this object, example:\n * ```\n * new Popper(ref, pop, {\n *   modifiers: {\n *     preventOverflow: { enabled: false }\n *   }\n * })\n * ```\n * @type {Object}\n * @static\n * @memberof Popper\n */\nvar Defaults = {\n  /**\n   * Popper's placement\n   * @prop {Popper.placements} placement='bottom'\n   */\n  placement: 'bottom',\n\n  /**\n   * Set this to true if you want popper to position it self in 'fixed' mode\n   * @prop {Boolean} positionFixed=false\n   */\n  positionFixed: false,\n\n  /**\n   * Whether events (resize, scroll) are initially enabled\n   * @prop {Boolean} eventsEnabled=true\n   */\n  eventsEnabled: true,\n\n  /**\n   * Set to true if you want to automatically remove the popper when\n   * you call the `destroy` method.\n   * @prop {Boolean} removeOnDestroy=false\n   */\n  removeOnDestroy: false,\n\n  /**\n   * Callback called when the popper is created.<br />\n   * By default, is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onCreate}\n   */\n  onCreate: function onCreate() {},\n\n  /**\n   * Callback called when the popper is updated, this callback is not called\n   * on the initialization/creation of the popper, but only on subsequent\n   * updates.<br />\n   * By default, is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onUpdate}\n   */\n  onUpdate: function onUpdate() {},\n\n  /**\n   * List of modifiers used to modify the offsets before they are applied to the popper.\n   * They provide most of the functionalities of Popper.js\n   * @prop {modifiers}\n   */\n  modifiers: modifiers\n};\n\n/**\n * @callback onCreate\n * @param {dataObject} data\n */\n\n/**\n * @callback onUpdate\n * @param {dataObject} data\n */\n\n// Utils\n// Methods\nvar Popper = function () {\n  /**\n   * Create a new Popper.js instance\n   * @class Popper\n   * @param {HTMLElement|referenceObject} reference - The reference element used to position the popper\n   * @param {HTMLElement} popper - The HTML element used as popper.\n   * @param {Object} options - Your custom options to override the ones defined in [Defaults](#defaults)\n   * @return {Object} instance - The generated Popper.js instance\n   */\n  function Popper(reference, popper) {\n    var _this = this;\n\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    classCallCheck(this, Popper);\n\n    this.scheduleUpdate = function () {\n      return requestAnimationFrame(_this.update);\n    };\n\n    // make update() debounced, so that it only runs at most once-per-tick\n    this.update = debounce(this.update.bind(this));\n\n    // with {} we create a new object with the options inside it\n    this.options = _extends({}, Popper.Defaults, options);\n\n    // init state\n    this.state = {\n      isDestroyed: false,\n      isCreated: false,\n      scrollParents: []\n    };\n\n    // get reference and popper elements (allow jQuery wrappers)\n    this.reference = reference && reference.jquery ? reference[0] : reference;\n    this.popper = popper && popper.jquery ? popper[0] : popper;\n\n    // Deep merge modifiers options\n    this.options.modifiers = {};\n    Object.keys(_extends({}, Popper.Defaults.modifiers, options.modifiers)).forEach(function (name) {\n      _this.options.modifiers[name] = _extends({}, Popper.Defaults.modifiers[name] || {}, options.modifiers ? options.modifiers[name] : {});\n    });\n\n    // Refactoring modifiers' list (Object => Array)\n    this.modifiers = Object.keys(this.options.modifiers).map(function (name) {\n      return _extends({\n        name: name\n      }, _this.options.modifiers[name]);\n    })\n    // sort the modifiers by order\n    .sort(function (a, b) {\n      return a.order - b.order;\n    });\n\n    // modifiers have the ability to execute arbitrary code when Popper.js get inited\n    // such code is executed in the same order of its modifier\n    // they could add new properties to their options configuration\n    // BE AWARE: don't add options to `options.modifiers.name` but to `modifierOptions`!\n    this.modifiers.forEach(function (modifierOptions) {\n      if (modifierOptions.enabled && isFunction(modifierOptions.onLoad)) {\n        modifierOptions.onLoad(_this.reference, _this.popper, _this.options, modifierOptions, _this.state);\n      }\n    });\n\n    // fire the first update to position the popper in the right place\n    this.update();\n\n    var eventsEnabled = this.options.eventsEnabled;\n    if (eventsEnabled) {\n      // setup event listeners, they will take care of update the position in specific situations\n      this.enableEventListeners();\n    }\n\n    this.state.eventsEnabled = eventsEnabled;\n  }\n\n  // We can't use class properties because they don't get listed in the\n  // class prototype and break stuff like Sinon stubs\n\n\n  createClass(Popper, [{\n    key: 'update',\n    value: function update$$1() {\n      return update.call(this);\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy$$1() {\n      return destroy.call(this);\n    }\n  }, {\n    key: 'enableEventListeners',\n    value: function enableEventListeners$$1() {\n      return enableEventListeners.call(this);\n    }\n  }, {\n    key: 'disableEventListeners',\n    value: function disableEventListeners$$1() {\n      return disableEventListeners.call(this);\n    }\n\n    /**\n     * Schedule an update, it will run on the next UI update available\n     * @method scheduleUpdate\n     * @memberof Popper\n     */\n\n\n    /**\n     * Collection of utilities useful when writing custom modifiers.\n     * Starting from version 1.7, this method is available only if you\n     * include `popper-utils.js` before `popper.js`.\n     *\n     * **DEPRECATION**: This way to access PopperUtils is deprecated\n     * and will be removed in v2! Use the PopperUtils module directly instead.\n     * Due to the high instability of the methods contained in Utils, we can't\n     * guarantee them to follow semver. Use them at your own risk!\n     * @static\n     * @private\n     * @type {Object}\n     * @deprecated since version 1.8\n     * @member Utils\n     * @memberof Popper\n     */\n\n  }]);\n  return Popper;\n}();\n\n/**\n * The `referenceObject` is an object that provides an interface compatible with Popper.js\n * and lets you use it as replacement of a real DOM node.<br />\n * You can use this method to position a popper relatively to a set of coordinates\n * in case you don't have a DOM node to use as reference.\n *\n * ```\n * new Popper(referenceObject, popperNode);\n * ```\n *\n * NB: This feature isn't supported in Internet Explorer 10\n * @name referenceObject\n * @property {Function} data.getBoundingClientRect\n * A function that returns a set of coordinates compatible with the native `getBoundingClientRect` method.\n * @property {number} data.clientWidth\n * An ES6 getter that will return the width of the virtual reference element.\n * @property {number} data.clientHeight\n * An ES6 getter that will return the height of the virtual reference element.\n */\n\n\nPopper.Utils = (typeof window !== 'undefined' ? window : global).PopperUtils;\nPopper.placements = placements;\nPopper.Defaults = Defaults;\n\nexport default Popper;\n//# sourceMappingURL=popper.js.map\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/popper.js/dist/esm/popper.js\n// module id = 173\n// module chunks = 1 3 4 5 6 18 22 39 88","import { IQueryResult } from '../../rest/QueryResult';\nimport { Component } from '../Base/Component';\nimport { IResultListOptions } from './ResultListOptions';\nimport _ = require('underscore');\n\nexport class ResultListRenderer {\n  constructor(protected resultListOptions: IResultListOptions, protected autoCreateComponentsFn: Function) {}\n\n  renderResults(\n    resultElements: HTMLElement[],\n    append = false,\n    resultDisplayedCallback: (result: IQueryResult, resultElem: HTMLElement) => any\n  ) {\n    return Promise.all([this.getStartFragment(resultElements, append), this.getEndFragment(resultElements, append)]).then(\n      ([startFrag, endFrag]) => {\n        const resultsFragment = document.createDocumentFragment();\n        if (startFrag) {\n          resultsFragment.appendChild(startFrag);\n        }\n        _.each(resultElements, resultElement => {\n          resultsFragment.appendChild(resultElement);\n          resultDisplayedCallback(Component.getResult(resultElement), resultElement);\n        });\n        if (endFrag) {\n          resultsFragment.appendChild(endFrag);\n        }\n        this.resultListOptions.resultsContainer.appendChild(resultsFragment);\n      }\n    );\n  }\n\n  protected getStartFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    return Promise.resolve(document.createDocumentFragment());\n  }\n\n  protected getEndFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    return Promise.resolve(document.createDocumentFragment());\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultListRenderer.ts","import 'styling/_ResponsiveFacets';\nimport { IQuerySuccessEventArgs, QueryEvents } from '../../events/QueryEvents';\nimport { Logger } from '../../misc/Logger';\nimport { l } from '../../strings/Strings';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Utils } from '../../utils/Utils';\nimport { Component } from '../Base/Component';\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\nimport { ResponsiveComponents } from './ResponsiveComponents';\nimport { IResponsiveComponent, IResponsiveComponentOptions, ResponsiveComponentsManager } from './ResponsiveComponentsManager';\nimport { ResponsiveComponentsUtils } from './ResponsiveComponentsUtils';\nimport { ResponsiveDropdown } from './ResponsiveDropdown/ResponsiveDropdown';\nimport { ResponsiveDropdownContent, IResponsiveDropdownContent } from './ResponsiveDropdown/ResponsiveDropdownContent';\nimport { ResponsiveDropdownHeader } from './ResponsiveDropdown/ResponsiveDropdownHeader';\nimport { each, debounce } from 'underscore';\nimport { ComponentsTypes } from '../../utils/ComponentsTypes';\nimport { ResponsiveDropdownModalContent } from './ResponsiveDropdown/ResponsiveDropdownModalContent';\nimport { FacetsMobileMode, IFacetsMobileModeOptions } from '../FacetsMobileMode/FacetsMobileMode';\nimport { FacetsMobileModeEvents } from '../../events/FacetsMobileModeEvents';\n\nexport class ResponsiveFacetColumn implements IResponsiveComponent {\n  public static DEBOUNCE_SCROLL_WAIT = 250;\n\n  private static DROPDOWN_HEADER_LABEL_DEFAULT_VALUE = 'Filters';\n\n  private searchInterface: SearchInterface;\n  private componentsInFacetColumn: any[] = [];\n  private preservePositionOriginalValues: boolean[] = [];\n  private breakpoint: number;\n  protected dropdown: ResponsiveDropdown;\n  private dropdownHeaderLabel: string;\n\n  public static init(responsiveComponentConstructor, root: HTMLElement, component, options: IResponsiveComponentOptions, ID: string) {\n    const column = this.findColumn(root);\n    if (!column) {\n      return;\n    }\n\n    ResponsiveComponentsManager.register(ResponsiveFacetColumn, $$(root), 'ResponsiveFacetColumn', component, options);\n    ResponsiveComponentsManager.register(responsiveComponentConstructor, $$(root), ID, component, options);\n  }\n\n  private static findColumn(root: HTMLElement) {\n    const column = $$(root).find('.coveo-facet-column');\n    if (!column) {\n      const logger = new Logger('ResponsiveFacets');\n      logger.info('No element with class coveo-facet-column. Responsive facets cannot be enabled');\n    }\n    return column;\n  }\n\n  constructor(public coveoRoot: Dom, public ID: string, options: IResponsiveComponentOptions, responsiveDropdown?: ResponsiveDropdown) {\n    this.searchInterface = <SearchInterface>Component.get(this.coveoRoot.el, SearchInterface, false);\n    this.dropdownHeaderLabel = this.getDropdownHeaderLabel();\n    this.dropdown = this.buildDropdown(responsiveDropdown);\n    this.bindDropdownContentEvents();\n    this.bindFacetsMobileModeEvents();\n    this.registerOnCloseHandler();\n    this.registerQueryEvents();\n    this.initializeBreakpoint(options.responsiveBreakpoint);\n  }\n\n  private get facetsMobileModeComponent() {\n    return this.searchInterface ? this.searchInterface.getComponents<FacetsMobileMode>(FacetsMobileMode.ID)[0] : null;\n  }\n\n  private get facetsMobileModeOptions(): IFacetsMobileModeOptions {\n    const facetsMobileModeComponent = this.facetsMobileModeComponent;\n    if (!facetsMobileModeComponent) {\n      return {\n        isModal: false,\n        preventScrolling: false,\n        displayOverlayWhileOpen: true\n      };\n    }\n    return facetsMobileModeComponent.options;\n  }\n\n  public registerComponent(accept: Component) {\n    this.componentsInFacetColumn.push(accept);\n    this.preservePositionOriginalValues.push(accept.options.preservePosition);\n    return true;\n  }\n\n  public needDropdownWrapper() {\n    return this.needSmallMode();\n  }\n\n  public handleResizeEvent() {\n    if (this.needSmallMode() && !ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n      this.changeToSmallMode();\n    } else if (!this.needSmallMode() && ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n      this.changeToLargeMode();\n    }\n    if (this.dropdown.isOpened) {\n      this.dropdown.dropdownContent.positionDropdown();\n    }\n  }\n\n  public dismissFacetSearches() {\n    each(this.componentsInFacetColumn, component => {\n      if (component.facetSearch && component.facetSearch.currentlyDisplayedResults) {\n        component.facetSearch.dismissSearchResults();\n      }\n    });\n  }\n\n  private needSmallMode(): boolean {\n    if (!this.searchInterface) {\n      return (\n        this.coveoRoot.width() <=\n        (Utils.isNullOrUndefined(this.breakpoint) ? new ResponsiveComponents().getMediumScreenWidth() : this.breakpoint)\n      );\n    }\n    switch (this.searchInterface.responsiveComponents.getResponsiveMode()) {\n      case 'small':\n      case 'medium':\n        return true;\n      case 'auto':\n        return (\n          this.coveoRoot.width() <=\n          (Utils.isNullOrUndefined(this.breakpoint) ? this.searchInterface.responsiveComponents.getMediumScreenWidth() : this.breakpoint)\n        );\n      default:\n        return false;\n    }\n  }\n\n  private changeToSmallMode() {\n    this.dropdown.close();\n    this.disableFacetPreservePosition();\n    $$(this.coveoRoot.find(`.${ResponsiveComponentsManager.DROPDOWN_HEADER_WRAPPER_CSS_CLASS}`)).append(\n      this.dropdown.dropdownHeader.element.el\n    );\n    ResponsiveComponentsUtils.activateSmallFacet(this.coveoRoot);\n  }\n\n  private changeToLargeMode() {\n    this.restoreFacetPreservePositionValue();\n    this.dropdown.cleanUp();\n    ResponsiveComponentsUtils.deactivateSmallFacet(this.coveoRoot);\n  }\n\n  private buildDropdown(responsiveDropdown?: ResponsiveDropdown) {\n    let dropdownContent = this.buildDropdownContent();\n    let dropdownHeader = this.buildDropdownHeader();\n    let dropdown = responsiveDropdown ? responsiveDropdown : new ResponsiveDropdown(dropdownContent, dropdownHeader, this.coveoRoot);\n    return dropdown;\n  }\n\n  private buildDropdownContent(): IResponsiveDropdownContent {\n    let dropdownContentElement = $$(this.coveoRoot.find('.coveo-facet-column'));\n    let filterByContainer = $$('div', { className: 'coveo-facet-header-filter-by-container', style: 'display: none' });\n    let filterBy = $$('div', { className: 'coveo-facet-header-filter-by' });\n    filterBy.text(l('Filter by:'));\n    filterByContainer.append(filterBy.el);\n    dropdownContentElement.prepend(filterByContainer.el);\n    if (this.facetsMobileModeOptions.isModal) {\n      return new ResponsiveDropdownModalContent('facet', dropdownContentElement, l('CloseFiltersDropdown'), () => this.dropdown.close());\n    }\n    return new ResponsiveDropdownContent(dropdownContentElement);\n  }\n\n  private buildDropdownHeader() {\n    let dropdownHeaderElement = $$('a');\n    let content = $$('p');\n    content.text(this.dropdownHeaderLabel);\n    dropdownHeaderElement.el.appendChild(content.el);\n    let dropdownHeader = new ResponsiveDropdownHeader('facet', dropdownHeaderElement);\n    return dropdownHeader;\n  }\n\n  private initializeBreakpoint(defaultBreakpoint: number) {\n    const facetsMobileModeBreakpoint = this.facetsMobileModeOptions.breakpoint;\n    this.breakpoint = Utils.isNullOrUndefined(facetsMobileModeBreakpoint) ? defaultBreakpoint : facetsMobileModeBreakpoint;\n  }\n\n  private registerOnCloseHandler() {\n    this.dropdown.registerOnCloseHandler(this.dismissFacetSearches, this);\n  }\n\n  private registerQueryEvents() {\n    this.coveoRoot.on(QueryEvents.noResults, () => this.handleNoResults());\n    this.coveoRoot.on(QueryEvents.querySuccess, (e: Event, data: IQuerySuccessEventArgs) => this.handleQuerySuccess(data));\n    this.coveoRoot.on(QueryEvents.queryError, () => this.handleQueryError());\n  }\n\n  private bindDropdownContentEvents() {\n    this.dropdown.dropdownContent.element.on(\n      'scroll',\n      debounce(() => {\n        each(this.componentsInFacetColumn, component => {\n          let facetSearch = component.facetSearch;\n          if (facetSearch && facetSearch.currentlyDisplayedResults && !this.isFacetSearchScrolledIntoView(facetSearch.search)) {\n            component.facetSearch.positionSearchResults(this.dropdown.dropdownContent.element.el);\n          } else if (facetSearch && component.facetSearch.currentlyDisplayedResults) {\n            component.facetSearch.positionSearchResults();\n          }\n        });\n      }, ResponsiveFacetColumn.DEBOUNCE_SCROLL_WAIT)\n    );\n  }\n\n  private bindFacetsMobileModeEvents() {\n    const facetsMobileModeComponent = this.facetsMobileModeComponent;\n    if (facetsMobileModeComponent) {\n      this.dropdown.registerOnOpenHandler(\n        () => $$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents.popupOpened),\n        facetsMobileModeComponent\n      );\n      this.dropdown.registerOnCloseHandler(\n        () => $$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents.popupClosed),\n        facetsMobileModeComponent\n      );\n    }\n  }\n\n  private restoreFacetPreservePositionValue() {\n    each(this.componentsInFacetColumn, (component, index) => {\n      if (component.options) {\n        component.options.preservePosition = this.preservePositionOriginalValues[index];\n      }\n    });\n  }\n\n  private disableFacetPreservePosition() {\n    each(this.componentsInFacetColumn, component => {\n      if (component.options) {\n        component.options.preservePosition = false;\n      }\n    });\n  }\n\n  private isFacetSearchScrolledIntoView(facetSearchElement: HTMLElement) {\n    let facetTop = facetSearchElement.getBoundingClientRect().top;\n    let facetBottom = facetSearchElement.getBoundingClientRect().bottom;\n    let dropdownTop = this.dropdown.dropdownContent.element.el.getBoundingClientRect().top;\n    let dropdownBottom = this.dropdown.dropdownContent.element.el.getBoundingClientRect().bottom;\n\n    dropdownTop = dropdownTop >= 0 ? dropdownTop : 0;\n\n    return facetTop >= dropdownTop && facetBottom <= dropdownBottom;\n  }\n\n  private getDropdownHeaderLabel() {\n    let dropdownHeaderLabel: string;\n    ComponentsTypes.getAllFacetInstancesFromElement(this.coveoRoot.find('.coveo-facet-column')).forEach(facet => {\n      const options = facet.options as IResponsiveComponentOptions;\n\n      if (!dropdownHeaderLabel && options.dropdownHeaderLabel) {\n        dropdownHeaderLabel = options.dropdownHeaderLabel;\n      }\n    });\n\n    if (!dropdownHeaderLabel) {\n      dropdownHeaderLabel = l(ResponsiveFacetColumn.DROPDOWN_HEADER_LABEL_DEFAULT_VALUE);\n    }\n\n    return dropdownHeaderLabel;\n  }\n\n  private handleNoResults() {\n    this.dropdown.dropdownHeader.hide();\n  }\n\n  private handleQueryError() {\n    this.dropdown.dropdownHeader.hide();\n  }\n\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\n    if (data.results.totalCount === 0) {\n      this.dropdown.dropdownHeader.hide();\n    } else {\n      this.dropdown.dropdownHeader.show();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveFacetColumn.ts","/// <reference path='../ui/Facet/Facet.ts' />\n\nimport { Facet } from '../ui/Facet/Facet';\nimport { IGroupByRequest } from '../rest/GroupByRequest';\nimport { IGroupByResult } from '../rest/GroupByResult';\nimport { ExpressionBuilder } from '../ui/Base/ExpressionBuilder';\nimport { FacetValue } from '../ui/Facet/FacetValue';\nimport { Utils } from '../utils/Utils';\nimport { QueryBuilder } from '../ui/Base/QueryBuilder';\nimport { FacetSearchParameters } from '../ui/Facet/FacetSearchParameters';\nimport { Assert } from '../misc/Assert';\nimport { IIndexFieldValue } from '../rest/FieldValue';\nimport { FacetUtils } from '../ui/Facet/FacetUtils';\nimport { IQueryResults } from '../rest/QueryResults';\nimport { IGroupByValue } from '../rest/GroupByValue';\nimport { IEndpointError } from '../rest/EndpointError';\nimport * as _ from 'underscore';\nimport { QueryBuilderExpression } from '../ui/Base/QueryBuilderExpression';\n\nexport class FacetQueryController {\n  public expressionToUseForFacetSearch: string;\n  public basicExpressionToUseForFacetSearch: string;\n  public advancedExpressionToUseForFacetSearch: string;\n  public constantExpressionToUseForFacetSearch: string;\n  public lastGroupByRequestIndex: number;\n  public lastGroupByRequest: IGroupByRequest;\n  public lastGroupByResult: IGroupByResult;\n\n  private currentSearchPromise: Promise<IQueryResults>;\n\n  constructor(public facet: Facet) {}\n\n  /**\n   * Reset the expression for the facet search, used when a new query is triggered\n   */\n  public prepareForNewQuery() {\n    this.lastGroupByRequestIndex = undefined;\n    this.expressionToUseForFacetSearch = undefined;\n    this.constantExpressionToUseForFacetSearch = undefined;\n  }\n\n  /**\n   * Compute the filter expression that the facet needs to output for the query\n   * @returns {string}\n   */\n  public computeOurFilterExpression(): string {\n    const builder = new ExpressionBuilder();\n    const selected = this.facet.values.getSelected();\n    if (selected.length > 0) {\n      if (this.facet.options.useAnd) {\n        _.each(selected, (value: FacetValue) => {\n          builder.addFieldExpression(<string>this.facet.options.field, '==', [value.value]);\n        });\n      } else {\n        builder.addFieldExpression(<string>this.facet.options.field, '==', _.map(selected, (value: FacetValue) => value.value));\n      }\n    }\n    const excluded = this.facet.values.getExcluded();\n    if (excluded.length > 0) {\n      builder.addFieldNotEqualExpression(<string>this.facet.options.field, _.map(excluded, (value: FacetValue) => value.value));\n    }\n    if (Utils.isNonEmptyString(this.facet.options.additionalFilter)) {\n      builder.add(this.facet.options.additionalFilter);\n    }\n    return builder.build();\n  }\n\n  /**\n   * Build the group by request for the facet, and insert it in the query builder\n   * @param queryBuilder\n   */\n  public putGroupByIntoQueryBuilder(queryBuilder: QueryBuilder) {\n    Assert.exists(queryBuilder);\n\n    const allowedValues = this.createGroupByAllowedValues();\n    const groupByRequest = this.createBasicGroupByRequest(allowedValues);\n\n    const queryOverrideObject = this.createGroupByQueryOverride(queryBuilder);\n    if (!Utils.isNullOrUndefined(queryOverrideObject) || !QueryBuilderExpression.isEmpty(queryOverrideObject)) {\n      groupByRequest.queryOverride = queryOverrideObject.basic;\n      groupByRequest.advancedQueryOverride = queryOverrideObject.advanced;\n      groupByRequest.constantQueryOverride = queryOverrideObject.constant;\n      this.expressionToUseForFacetSearch = queryOverrideObject.withoutConstant;\n      this.basicExpressionToUseForFacetSearch = queryOverrideObject.basic;\n      this.advancedExpressionToUseForFacetSearch = queryOverrideObject.advanced;\n      this.constantExpressionToUseForFacetSearch = queryOverrideObject.constant;\n    } else {\n      const parts = queryBuilder.computeCompleteExpressionParts();\n      this.expressionToUseForFacetSearch = parts.withoutConstant == null ? '' : parts.withoutConstant;\n      this.basicExpressionToUseForFacetSearch = parts.basic == null ? '' : parts.basic;\n      this.advancedExpressionToUseForFacetSearch = parts.advanced;\n      this.constantExpressionToUseForFacetSearch = parts.constant;\n    }\n    this.lastGroupByRequestIndex = queryBuilder.groupByRequests.length;\n    this.lastGroupByRequest = groupByRequest;\n    queryBuilder.groupByRequests.push(groupByRequest);\n  }\n\n  /**\n   * Search inside the facet, using a group by request\n   * @param params\n   * @param oldLength Optional params, used by the search method to call itself recursively to fetch all required values\n   * @returns {Promise|Promise<T>}\n   */\n  public search(params: FacetSearchParameters, oldLength = params.nbResults): Promise<IIndexFieldValue[]> {\n    // For search, we want to retrieve the exact values we requested, and not additional ones\n    params.completeFacetWithStandardValues = false;\n    return new Promise((resolve, reject) => {\n      const onResult = (fieldValues?: IIndexFieldValue[]) => {\n        const newLength = fieldValues.length;\n        fieldValues = this.checkForFacetSearchValuesToRemove(fieldValues, params.valueToSearch);\n        if (FacetUtils.needAnotherFacetSearch(fieldValues.length, newLength, oldLength, 5)) {\n          // This means that we removed enough values from the returned one that we need to perform a new search with more values requested.\n          params.nbResults += 5;\n          return this.search(params, fieldValues.length);\n        } else {\n          resolve(fieldValues);\n        }\n      };\n\n      const searchPromise = this.facet.getEndpoint().search(params.getQuery());\n      this.currentSearchPromise = searchPromise;\n\n      searchPromise\n        .then((queryResults: IQueryResults) => {\n          if (this.currentSearchPromise == searchPromise) {\n            // params.getQuery() will generate a query for all excluded values + some new values\n            // there is no clean way to do a group by and remove some values\n            // so instead we request more values than we need, and crop all the one we don't want\n            const valuesCropped: IGroupByValue[] = [];\n            if (queryResults.groupByResults && queryResults.groupByResults[0]) {\n              _.each(queryResults.groupByResults[0].values, (v: IGroupByValue) => {\n                if (v.lookupValue) {\n                  if (!_.contains(params.alwaysExclude, v.lookupValue.toLowerCase())) {\n                    valuesCropped.push(v);\n                  }\n                } else {\n                  if (!_.contains(params.alwaysExclude, v.value.toLowerCase())) {\n                    valuesCropped.push(v);\n                  }\n                }\n              });\n            }\n            onResult(_.first(valuesCropped, params.nbResults));\n          } else {\n            reject();\n          }\n        })\n        .catch((error: IEndpointError) => {\n          reject(error);\n        });\n    });\n  }\n\n  public fetchMore(numberOfValuesToFetch: number): Promise<IQueryResults> {\n    const params = new FacetSearchParameters(this.facet);\n    params.alwaysInclude = this.facet.options.allowedValues || _.pluck(this.facet.values.getAll(), 'value');\n    params.nbResults = numberOfValuesToFetch;\n    return this.facet\n      .getEndpoint()\n      .search(params.getQuery())\n      .then((results: IQueryResults) => {\n        if (this.facet.options.allowedValues && results && results.groupByResults && results.groupByResults[0]) {\n          results.groupByResults[0].values = this.filterByAllowedValueOption(results.groupByResults[0].values);\n        }\n        return results;\n      });\n  }\n\n  public searchInFacetToUpdateDelta(facetValues: FacetValue[]): Promise<IQueryResults> {\n    const params = new FacetSearchParameters(this.facet);\n    const query = params.getQuery();\n    query.aq = `${query.aq ? query.aq : ''} ${this.computeOurFilterExpression()}`;\n    _.each(facetValues, (facetValue: FacetValue) => {\n      facetValue.waitingForDelta = true;\n    });\n    query.groupBy = [this.createBasicGroupByRequest(_.map(facetValues, (facetValue: FacetValue) => facetValue.value))];\n    query.groupBy[0].completeFacetWithStandardValues = false;\n    return this.facet.getEndpoint().search(query);\n  }\n\n  protected createGroupByAllowedValues() {\n    // if you want to keep displayed values next time, take all current values as allowed values\n    // otherwise take only the selected value\n    if (this.facet.options.allowedValues != undefined) {\n      return this.facet.options.allowedValues;\n    } else if (this.facet.options.customSort != undefined) {\n      // If there is a custom sort, we still need to add selectedValues to the group by\n      // Filter out duplicates with a lower case comparison on the value\n      return this.getUnionWithCustomSortLowercase(this.facet.options.customSort, this.getAllowedValuesFromSelected());\n    } else {\n      return _.map(this.getAllowedValuesFromSelected(), (facetValue: FacetValue) => facetValue.value);\n    }\n  }\n\n  protected createBasicGroupByRequest(allowedValues?: string[], addComputedField: boolean = true): IGroupByRequest {\n    let nbOfRequestedValues = this.facet.numberOfValues;\n    if (this.facet.options.customSort != null) {\n      // If we have a custom sort, we need to make sure that we always request at least enough values to always receive them\n      const usedValues = this.getUnionWithCustomSortLowercase(\n        this.facet.options.customSort,\n        this.facet.values.getSelected().concat(this.facet.values.getExcluded())\n      );\n      nbOfRequestedValues = Math.max(nbOfRequestedValues, usedValues.length);\n    }\n    const groupByRequest: IGroupByRequest = {\n      field: <string>this.facet.options.field,\n      maximumNumberOfValues: nbOfRequestedValues + (this.facet.options.enableMoreLess ? 1 : 0),\n      sortCriteria: this.facet.options.sortCriteria,\n      injectionDepth: this.facet.options.injectionDepth,\n      completeFacetWithStandardValues: this.facet.options.allowedValues == undefined ? true : false\n    };\n    if (this.facet.options.lookupField) {\n      groupByRequest.lookupField = <string>this.facet.options.lookupField;\n    }\n    if (allowedValues != null) {\n      groupByRequest.allowedValues = allowedValues;\n    }\n\n    if (addComputedField && Utils.isNonEmptyString(<string>this.facet.options.computedField)) {\n      groupByRequest.computedFields = [\n        {\n          field: <string>this.facet.options.computedField,\n          operation: this.facet.options.computedFieldOperation\n        }\n      ];\n    }\n    return groupByRequest;\n  }\n\n  protected getAllowedValuesFromSelected() {\n    let facetValues: FacetValue[] = [];\n    if (this.facet.options.useAnd || !this.facet.keepDisplayedValuesNextTime) {\n      const selected = this.facet.values.getSelected();\n      if (selected.length == 0) {\n        return undefined;\n      }\n      facetValues = this.facet.values.getSelected();\n    } else {\n      facetValues = this.facet.values.getAll();\n    }\n    return facetValues;\n  }\n\n  private get additionalFilter() {\n    return this.facet.options.additionalFilter ? this.facet.options.additionalFilter : '';\n  }\n\n  private getUnionWithCustomSortLowercase(customSort: string[], facetValues: FacetValue[]) {\n    // This will take the custom sort, compare it against the passed in facetValues\n    // The comparison is lowercase.\n    // The union of the 2 arrays with duplicated filtered out is returned.\n\n    const toCompare = _.map(customSort, (val: string) => {\n      return val.toLowerCase();\n    });\n    const filtered = _.chain(facetValues)\n      .filter((facetValue: FacetValue) => {\n        return !_.contains(toCompare, facetValue.value.toLowerCase());\n      })\n      .map((facetValue: FacetValue) => {\n        return facetValue.value;\n      })\n      .value();\n    return _.compact(customSort.concat(filtered));\n  }\n\n  private createGroupByQueryOverride(queryBuilder: QueryBuilder): QueryBuilderExpression {\n    let queryBuilderExpression = queryBuilder.computeCompleteExpressionParts();\n\n    if (this.queryOverrideIsNeededForMultiSelection()) {\n      queryBuilderExpression = this.processQueryOverrideForMultiSelection(queryBuilder, queryBuilderExpression);\n    } else {\n      queryBuilderExpression.reset();\n    }\n    if (this.queryOverrideIsNeededForAdditionalFilter()) {\n      queryBuilderExpression = this.processQueryOverrideForAdditionalFilter(queryBuilder, queryBuilderExpression);\n    }\n\n    queryBuilderExpression = this.processQueryOverrideForEmptyValues(queryBuilder, queryBuilderExpression);\n    if (QueryBuilderExpression.isEmpty(queryBuilderExpression)) {\n      return null;\n    }\n    return queryBuilderExpression;\n  }\n\n  private queryOverrideIsNeededForMultiSelection() {\n    if (this.facet.options.useAnd) {\n      return false;\n    }\n    if (this.facet.values.hasSelectedOrExcludedValues()) {\n      return true;\n    }\n    return false;\n  }\n\n  private queryOverrideIsNeededForAdditionalFilter() {\n    return Utils.isNonEmptyString(this.additionalFilter);\n  }\n\n  private processQueryOverrideForMultiSelection(queryBuilder: QueryBuilder, mergeWith: QueryBuilderExpression) {\n    if (this.facet.values.hasSelectedOrExcludedValues()) {\n      const ourExpression = this.computeOurFilterExpression();\n      mergeWith = queryBuilder.computeCompleteExpressionPartsExcept(ourExpression);\n      if (QueryBuilderExpression.isEmpty(mergeWith)) {\n        mergeWith.advanced = '@uri';\n      }\n    }\n\n    return mergeWith;\n  }\n\n  private processQueryOverrideForAdditionalFilter(queryBuilder: QueryBuilder, mergeWith: QueryBuilderExpression) {\n    if (Utils.isEmptyString(mergeWith.basic)) {\n      mergeWith.basic = queryBuilder.expression.build();\n    }\n    if (Utils.isEmptyString(mergeWith.constant)) {\n      const addExistingConstantExpressionIfNotEmpty = queryBuilder.constantExpression.isEmpty()\n        ? ''\n        : queryBuilder.constantExpression.build() + ' ';\n      mergeWith.constant = `${addExistingConstantExpressionIfNotEmpty}${this.additionalFilter}`;\n    } else {\n      mergeWith.constant = `${mergeWith.constant} ${this.additionalFilter}`;\n    }\n\n    if (!mergeWith.advanced) {\n      mergeWith.advanced = this.getFilterExpressionWithoutOurFilterExpression(queryBuilder);\n    }\n\n    return mergeWith;\n  }\n\n  private getFilterExpressionWithoutOurFilterExpression(queryBuilder: QueryBuilder) {\n    const expression = new ExpressionBuilder();\n    const advancedExpressionParts = queryBuilder.advancedExpression.getParts();\n\n    advancedExpressionParts.forEach(part => expression.add(part));\n\n    const currentFacetAdvancedExpression = this.computeOurFilterExpression();\n    expression.remove(currentFacetAdvancedExpression);\n\n    return expression.build();\n  }\n\n  private processQueryOverrideForEmptyValues(queryBuilder: QueryBuilder, mergeWith: QueryBuilderExpression) {\n    const withoutEmptyValues = _.chain(mergeWith)\n      .keys()\n      .each((key: string) => {\n        if (Utils.isEmptyString(mergeWith[key]) || Utils.isNullOrUndefined(mergeWith[key])) {\n          delete mergeWith[key];\n        }\n      })\n      .value();\n\n    if (_.keys(withoutEmptyValues).length == 0) {\n      mergeWith = undefined;\n    }\n\n    return mergeWith;\n  }\n\n  private checkForFacetSearchValuesToRemove(fieldValues: IIndexFieldValue[], valueToCheckAgainst: string) {\n    const regex = FacetUtils.getRegexToUseForFacetSearch(valueToCheckAgainst, this.facet.options.facetSearchIgnoreAccents);\n\n    return _.filter<IIndexFieldValue>(fieldValues, fieldValue => {\n      const isAllowed = _.isEmpty(this.facet.options.allowedValues) || this.isValueAllowedByAllowedValueOption(fieldValue.value);\n      const value = this.facet.getValueCaption(fieldValue);\n      return isAllowed && regex.test(value);\n    });\n  }\n\n  private filterByAllowedValueOption(values: IGroupByValue[]): IGroupByValue[] {\n    return _.filter(values, (value: IGroupByValue) => this.isValueAllowedByAllowedValueOption(value.value));\n  }\n\n  private isValueAllowedByAllowedValueOption(value: string): boolean {\n    return _.some(this.facet.options.allowedValues, allowedValue => {\n      const regexContent = this.replaceWildcardsWithRegexEquivalent(this.escapeMostRegexCharacters(allowedValue));\n      const regex = new RegExp(`^${regexContent}$`, 'gi');\n      return regex.test(value);\n    });\n  }\n\n  private escapeMostRegexCharacters(text: String) {\n    // Regex taken from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\n    // `*` and `?` were removed because they are used for wildcards\n    return text.replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&');\n  }\n\n  private replaceWildcardsWithRegexEquivalent(text: String) {\n    // Allowed value option on the facet should support * (wildcard searches)\n    // We need to filter values client side the index will completeWithStandardValues\n    // Replace the wildcard (*) for a regex match (.*)\n    // Also replace the (?) with \"any character once\" since it is also supported by the index\n    return text.replace(/\\*/g, '.*').replace(/\\?/g, '.');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/FacetQueryController.ts","/// <reference path=\"../../controllers/HierarchicalFacetQueryController.ts\" />\n/// <reference path=\"HierarchicalFacetValuesList.ts\" />\n/// <reference path=\"HierarchicalFacetSearch.ts\" />\n/// <reference path=\"HierarchicalBreadcrumbValuesList.ts\" />\n/// <reference path=\"HierarchicalFacetValueElement.ts\" />\n\nimport { IFacetOptions } from '../Facet/Facet';\nimport { FacetValue } from '../Facet/FacetValue';\nimport { Facet } from '../Facet/Facet';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { HierarchicalFacetValuesList } from './HierarchicalFacetValuesList';\nimport { HierarchicalFacetQueryController } from '../../controllers/HierarchicalFacetQueryController';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport { Utils } from '../../utils/Utils';\nimport { $$ } from '../../utils/Dom';\nimport { Defer } from '../../misc/Defer';\nimport { HierarchicalFacetSearchValuesList } from './HierarchicalFacetSearchValuesList';\nimport { HierarchicalFacetSearch } from './HierarchicalFacetSearch';\nimport { HierarchicalBreadcrumbValuesList } from './HierarchicalBreadcrumbValuesList';\nimport { IQuerySuccessEventArgs } from '../../events/QueryEvents';\nimport { Assert } from '../../misc/Assert';\nimport { IPopulateBreadcrumbEventArgs } from '../../events/BreadcrumbEvents';\nimport { IPopulateOmniboxEventArgs } from '../../events/OmniboxEvents';\nimport { OmniboxHierarchicalValuesList } from './OmniboxHierarchicalValuesList';\nimport { HierarchicalFacetValueElement } from './HierarchicalFacetValueElement';\nimport { Initialization } from '../Base/Initialization';\nimport { ISearchAlertsPopulateMessageEventArgs } from '../../events/SearchAlertEvents';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\nimport 'styling/_HierarchicalFacet';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { ResponsiveFacetOptions } from '../ResponsiveComponents/ResponsiveFacetOptions';\n\nexport interface IHierarchicalFacetOptions extends IFacetOptions {\n  delimitingCharacter?: string;\n  levelStart?: number;\n  levelEnd?: number;\n  marginByLevel?: number;\n}\n\nexport interface IValueHierarchy {\n  childs?: IValueHierarchy[];\n  parent?: IValueHierarchy;\n  originalPosition?: number;\n  facetValue: FacetValue;\n  level: number;\n  keepOpened: boolean;\n  hasChildSelected: boolean;\n  allChildShouldBeSelected: boolean;\n}\n\ninterface IFlatHierarchy {\n  facetValue: FacetValue;\n  level: number;\n  parent: string;\n  self: string;\n}\n\n/**\n * @deprecated This component is exposed for legacy reasons. Instead, use the {@link CategoryFacet} component, which is more performant and easier to use.\n *\n * The `HierarchicalFacet` component inherits all of its options and behaviors from the [`Facet`]{@link Facet}\n * component, but is meant to be used to render hierarchical values.\n *\n * **Note:**\n * > The `HierarchicalFacet` component does not support the [`customSort`]{@link Facet.options.customSort}\n * > `Facet` option.\n *\n * The `HierarchicalFacet` component can be used to display files in a file system, or categories for items in a\n * hierarchy.\n *\n * This facet requires a group by field with a special format to work correctly.\n *\n * **Example:**\n *\n * You have the following files indexed on a file system:\n * ```\n * c:\\\n *   folder1\\\n *     text1.txt\n *   folder2\\\n *     folder3\\\n *       text2.txt\n * ```\n * The `text1.txt` item would have a field with the following format:\n * `c; c|folder1;`\n *\n * The `text2.txt` item would have a field with the following format:\n * `c; c|folder2; c|folder2|folder3;`\n *\n * By default, the `|` character determines the hierarchy (`folder3` inside `folder2` inside `c`).\n *\n * Since both items contain the `c` value, selecting it value in the facet would return both items.\n *\n * Selecting the `folder3` value in the facet would only return the `text2.txt` item.\n *\n * @notSupportedIn salesforcefree\n *\n * @deprecatedSince [January 2019 Release (v2.5395.12)](https://docs.coveo.com/en/2763/)\n */\nexport class HierarchicalFacet extends Facet implements IComponentBindings {\n  static ID = 'HierarchicalFacet';\n\n  static doExport = () => {\n    exportGlobally({\n      HierarchicalFacet: HierarchicalFacet\n    });\n  };\n\n  /**\n   * The options for the component\n   * @componentOptions\n   */\n  static options: IHierarchicalFacetOptions = {\n    /**\n     * The character that allows to specify the hierarchical dependency.\n     *\n     * **Example:**\n     *\n     * If your field has the following values:\n     *\n     * `@field: c; c>folder2; c>folder2>folder3;`\n     *\n     * The delimiting character is `>`.\n     *\n     * Default value is `|`.\n     */\n    delimitingCharacter: ComponentOptions.buildStringOption({ defaultValue: '|' }),\n\n    /**\n     * Specifies at which level (0-based index) of the hierarchy the `HierarchicalFacet` should start displaying its\n     * values.\n     *\n     * **Example:**\n     *\n     * If you have the following files indexed on a file system:\n     * ```\n     * c:\\\n     *    folder1\\\n     *        text1.txt\n     *    folder2\\\n     *      folder3\\\n     *        text2.txt\n     * ```\n     * Setting `levelStart` to `1` displays `folder1` and `folder2` in the `HierarchicalFacet`, but omits `c:`.\n     *\n     * Default (and minimum) value is `0`.\n     */\n    levelStart: ComponentOptions.buildNumberOption({ defaultValue: 0, min: 0 }),\n\n    /**\n     * Specifies at which level (0-based index) of the hierarchy the `HierarchicalFacet` should stop displaying its\n     * values.\n     *\n     * Default value is `undefined`, which means the `HierarchicalFacet` component renders all hierarchical levels.\n     * Minimum value is `0`.\n     */\n    levelEnd: ComponentOptions.buildNumberOption({ min: 0 }),\n\n    /**\n     * Specifies the margin (in pixels) to display between each hierarchical level when expanding.\n     *\n     * Default value is `10`.\n     */\n    marginByLevel: ComponentOptions.buildNumberOption({ defaultValue: 10, min: 0 }),\n    ...ResponsiveFacetOptions\n  };\n\n  static parent = Facet;\n\n  public options: IHierarchicalFacetOptions;\n  public facetValuesList: HierarchicalFacetValuesList;\n  public numberOfValuesToShow: number;\n  public facetQueryController: HierarchicalFacetQueryController;\n  public topLevelHierarchy: IValueHierarchy[];\n  public shouldReshuffleFacetValuesClientSide = false;\n\n  private valueHierarchy: { [facetValue: string]: IValueHierarchy };\n  private originalNumberOfValuesToShow: number;\n\n  private correctLevels: IFlatHierarchy[] = [];\n\n  /**\n   * Creates a new `HierarchicalFacet` component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `HierarchicalFacet` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   */\n  public constructor(public element: HTMLElement, options: IHierarchicalFacetOptions, public bindings: IComponentBindings) {\n    super(element, options, bindings, HierarchicalFacet.ID);\n    this.options = ComponentOptions.initComponentOptions(element, HierarchicalFacet, this.options);\n    this.numberOfValuesToShow = this.originalNumberOfValuesToShow = this.options.numberOfValues || 5;\n    this.numberOfValues = Math.max(this.options.numberOfValues, 10000);\n    this.options.injectionDepth = Math.max(this.options.injectionDepth, 10000);\n    this.logger.info('Hierarchy facet: Set number of values very high in order to build hierarchy', this.numberOfValues, this);\n    this.logger.info('Hierarchy facet: Set injection depth very high in order to build hierarchy', this.options.injectionDepth);\n  }\n\n  /**\n   * Selects a single value.\n   * @param value The value to select.\n   * @param selectChildren Specifies whether to also select all child values (if any). Default value is the opposite of\n   * the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n   */\n  public selectValue(value: FacetValue | string, selectChildren = !this.options.useAnd) {\n    this.ensureDom();\n    this.ensureValueHierarchyExists([value]);\n    let valueHierarchy = this.getValueFromHierarchy(value);\n    if (selectChildren) {\n      this.selectChilds(valueHierarchy, valueHierarchy.childs);\n    }\n    this.flagParentForSelection(valueHierarchy);\n    super.selectValue(value);\n  }\n\n  /**\n   * Selects multiple values\n   * @param values The array of values to select.\n   * @param selectChildren Specifies whether to also select all child values (if any). Default value is the opposite of\n   * the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n   */\n  public selectMultipleValues(values: FacetValue[] | string[], selectChildren = !this.options.useAnd): void {\n    this.ensureDom();\n    this.ensureValueHierarchyExists(values);\n    _.each(values as FacetValue[], value => {\n      let valueHierarchy = this.getValueFromHierarchy(value);\n      this.flagParentForSelection(valueHierarchy);\n      if (selectChildren) {\n        _.each(valueHierarchy.childs, child => {\n          this.selectValue(child.facetValue);\n        });\n      }\n    });\n    super.selectMultipleValues(values);\n  }\n\n  /**\n   * Deselects a single value\n   * @param value The value to deselect.\n   * @param deselectChildren Specifies whether to also deselect all child values (if any). Default value is `true`.\n   */\n  public deselectValue(value: FacetValue | string, deselectChildren = true) {\n    this.ensureDom();\n    this.ensureValueHierarchyExists([value]);\n    let valueHierarchy = this.getValueFromHierarchy(value);\n    if (deselectChildren) {\n      let hasChilds = valueHierarchy.childs != undefined;\n      if (hasChilds) {\n        let activeChilds = _.filter<IValueHierarchy>(valueHierarchy.childs, child => {\n          let valueToCompare = this.getFacetValueFromHierarchy(child.facetValue);\n          return valueToCompare.selected || valueToCompare.excluded;\n        });\n        valueHierarchy.hasChildSelected = false;\n        if (activeChilds.length == valueHierarchy.childs.length) {\n          this.deselectChilds(valueHierarchy, valueHierarchy.childs);\n        }\n      }\n    }\n    this.deselectParent(valueHierarchy.parent);\n    this.unflagParentForSelection(valueHierarchy);\n    super.deselectValue(value);\n  }\n\n  /**\n   * Excludes a single value.\n   * @param value The value to exclude.\n   * @param excludeChildren Specifies whether to also exclude all child values (if any). Default value is the opposite\n   * of the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n   */\n  public excludeValue(value: FacetValue | string, excludeChildren = !this.options.useAnd): void {\n    this.ensureDom();\n    this.ensureValueHierarchyExists([value]);\n    let valueHierarchy = this.getValueFromHierarchy(value);\n    if (excludeChildren) {\n      this.excludeChilds(valueHierarchy.childs);\n    } else {\n      this.deselectChilds(valueHierarchy, valueHierarchy.childs);\n      this.close(valueHierarchy);\n    }\n    this.flagParentForSelection(valueHierarchy);\n    super.excludeValue(value);\n  }\n\n  /**\n   * Un-excludes a single value.\n   * @param value The value to un-exclude.\n   * @param unexludeChildren Specifies whether to also un-exclude all child values (if any). Default value is the\n   * opposite of the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n   */\n  public unexcludeValue(value: FacetValue | string, unexludeChildren = !this.options.useAnd): void {\n    this.ensureDom();\n    this.ensureValueHierarchyExists([value]);\n    let valueHierarchy = this.getValueFromHierarchy(value);\n    if (unexludeChildren) {\n      this.unexcludeChilds(valueHierarchy.childs);\n    }\n    this.unflagParentForSelection(valueHierarchy);\n    super.unexcludeValue(value);\n  }\n\n  /**\n   * Deselects multiple values.\n   * @param values The array of values to deselect.\n   * @param deselectChildren Specifies whether to also deselect all child values (if any). Default value is the opposite\n   * of the [`useAnd`]{@link Facet.options.useAnd} option value set for this `HierarchicalFacet`.\n   */\n  public deselectMultipleValues(values: FacetValue[] | string[], deselectChildren = !this.options.useAnd): void {\n    this.ensureDom();\n    this.ensureValueHierarchyExists(values);\n    _.each(values as FacetValue[], value => {\n      let valueHierarchy = this.getValueFromHierarchy(value);\n      valueHierarchy.hasChildSelected = false;\n      this.unflagParentForSelection(valueHierarchy);\n      if (deselectChildren) {\n        _.each(valueHierarchy.childs, child => {\n          let childInHierarchy = this.getValueFromHierarchy(child.facetValue);\n          childInHierarchy.hasChildSelected = false;\n          this.deselectValue(child.facetValue);\n        });\n      }\n    });\n    super.deselectMultipleValues(values);\n  }\n\n  /**\n   * Toggles the selection of a single value (selects value if not selected; deselects value if selected).\n   * @param value The value to select or deselect.\n   */\n  public toggleSelectValue(value: FacetValue | string): void {\n    this.ensureDom();\n    this.ensureValueHierarchyExists([value]);\n    if (this.getFacetValueFromHierarchy(value).selected == false) {\n      this.selectValue(value);\n    } else {\n      this.deselectValue(value);\n    }\n  }\n\n  /**\n   * Toggles the exclusion of a single value (excludes value if not excluded; un-excludes value if excluded).\n   * @param value The value to exclude or un-exclude.\n   */\n  public toggleExcludeValue(value: FacetValue | string): void {\n    this.ensureDom();\n    this.ensureValueHierarchyExists([value]);\n    if (this.getFacetValueFromHierarchy(value).excluded == false) {\n      this.excludeValue(value);\n    } else {\n      this.unexcludeValue(value);\n    }\n  }\n\n  /**\n   * Gets the caption of a single value.\n   * @param facetValue The value whose caption the method should return.\n   * @returns {string} The caption of the value.\n   */\n  public getValueCaption(facetValue: IIndexFieldValue | FacetValue): string {\n    let stringValue = this.getSelf(facetValue as FacetValue);\n    let ret = stringValue;\n    if (Utils.exists(this.options.valueCaption)) {\n      if (typeof this.options.valueCaption == 'object') {\n        ret = this.options.valueCaption[stringValue] || ret;\n      }\n      if (typeof this.options.valueCaption == 'function') {\n        ret = this.options.valueCaption.call(this, facetValue);\n      }\n    }\n    return ret;\n  }\n\n  /**\n   * Gets the values that the `HierarchicalFacet` is currently displaying.\n   * @returns {any[]} An array containing all the values that the `HierarchicalFacet` is currently displaying.\n   */\n  public getDisplayedValues(): string[] {\n    let displayed = _.filter(this.values.getAll(), v => {\n      let valFromHierarchy = this.getValueFromHierarchy(v);\n      if (valFromHierarchy) {\n        let elem = this.getElementFromFacetValueList(v);\n        return !$$(elem).hasClass('coveo-inactive');\n      }\n      return false;\n    });\n    return _.pluck(displayed, 'value');\n  }\n\n  /**\n   * Updates the sort criteria for the `HierarchicalFacet`.\n   *\n   * See the [`sortCriteria`]{@link IGroupByRequest.sortCriteria} property of the [`IGroupByRequest`] interface for the\n   * list and description of possible values.\n   *\n   * @param criteria The new sort criteria.\n   */\n  public updateSort(criteria: string) {\n    super.updateSort(criteria);\n  }\n\n  /**\n   * Opens (expands) a single value and shows all its children.\n   * @param value The value to open.\n   */\n  public open(value: FacetValue | IValueHierarchy | string) {\n    let getter;\n    if (_.isString(value)) {\n      getter = this.getValueHierarchy(value);\n    } else if (value instanceof FacetValue) {\n      getter = this.getValueHierarchy(value.value);\n    } else {\n      getter = value;\n    }\n    if (getter != undefined) {\n      $$(this.getElementFromFacetValueList(getter.facetValue.value)).addClass('coveo-open');\n      this.showChilds(getter.childs);\n      if (getter.parent != undefined) {\n        this.open(this.getValueHierarchy(getter.facetValue.value).parent);\n      }\n      this.getValueHierarchy(getter.facetValue.value).keepOpened = true;\n    }\n  }\n\n  /**\n   * Closes (collapses) a single value and hides all its children.\n   * @param value The value to close.\n   */\n  public close(value: FacetValue | IValueHierarchy | string) {\n    let getter;\n    if (_.isString(value)) {\n      getter = this.getValueHierarchy(value);\n    } else if (value instanceof FacetValue) {\n      getter = this.getValueHierarchy(value.value);\n    } else {\n      getter = value;\n    }\n    if (getter != undefined) {\n      $$(this.getElementFromFacetValueList(getter.facetValue)).removeClass('coveo-open');\n      this.hideChilds(getter.childs);\n      _.each(getter.childs, (child: IValueHierarchy) => {\n        this.close(this.getValueHierarchy(child.facetValue.value));\n      });\n      this.getValueHierarchy(getter.facetValue.value).keepOpened = false;\n    }\n  }\n\n  /**\n   * Resets the `HierarchicalFacet` state.\n   */\n  public reset() {\n    _.each(this.getAllValueHierarchy(), valueHierarchy => {\n      valueHierarchy.hasChildSelected = false;\n      valueHierarchy.allChildShouldBeSelected = false;\n    });\n    // Need to close all values, otherwise we might end up with orphan(s)\n    // if a parent value, after reset, is no longer visible.\n    _.each(this.getAllValueHierarchy(), valueHierarchy => {\n      this.close(valueHierarchy);\n    });\n    super.reset();\n  }\n\n  public processFacetSearchAllResultsSelected(facetValues: FacetValue[]): void {\n    this.selectMultipleValues(facetValues);\n    this.triggerNewQuery();\n  }\n\n  protected triggerUpdateDeltaQuery(facetValues: FacetValue[]) {\n    this.shouldReshuffleFacetValuesClientSide = this.keepDisplayedValuesNextTime;\n    super.triggerUpdateDeltaQuery(facetValues);\n  }\n\n  protected updateSearchElement(moreValuesAvailable = true) {\n    // We always want to show search for hierarchical facet :\n    // It's useful since child values are folded under their parent most of the time\n    super.updateSearchElement(true);\n  }\n\n  protected facetValueHasChanged() {\n    this.updateQueryStateModel();\n    Defer.defer(() => {\n      this.updateAppearanceDependingOnState();\n    });\n  }\n\n  protected initFacetQueryController() {\n    this.facetQueryController = new HierarchicalFacetQueryController(this);\n  }\n\n  protected initFacetSearch() {\n    this.facetSearch = new HierarchicalFacetSearch(this, HierarchicalFacetSearchValuesList, this.root);\n    this.element.appendChild(this.facetSearch.build());\n  }\n\n  protected handleDeferredQuerySuccess(data: IQuerySuccessEventArgs) {\n    this.updateAppearanceDependingOnState();\n    super.handleDeferredQuerySuccess(data);\n  }\n\n  protected handlePopulateSearchAlerts(args: ISearchAlertsPopulateMessageEventArgs) {\n    if (this.values.hasSelectedOrExcludedValues()) {\n      args.text.push(\n        new HierarchicalBreadcrumbValuesList(\n          this,\n          this.values.getSelected().concat(this.values.getExcluded()),\n          this.getAllValueHierarchy()\n        ).buildAsString()\n      );\n    }\n  }\n\n  protected handlePopulateBreadcrumb(args: IPopulateBreadcrumbEventArgs) {\n    Assert.exists(args);\n    if (this.values.hasSelectedOrExcludedValues()) {\n      let element = new HierarchicalBreadcrumbValuesList(\n        this,\n        this.values.getSelected().concat(this.values.getExcluded()),\n        this.getAllValueHierarchy()\n      ).build();\n      args.breadcrumbs.push({\n        element: element\n      });\n    }\n  }\n\n  protected handleOmniboxWithStaticValue(eventArg: IPopulateOmniboxEventArgs) {\n    let regex = eventArg.completeQueryExpression.regex;\n    let match = _.first(\n      _.filter<IValueHierarchy>(this.getAllValueHierarchy(), existingValue => {\n        return regex.test(this.getValueCaption(existingValue.facetValue));\n      }),\n      this.options.numberOfValuesInOmnibox\n    );\n    let facetValues = _.compact(\n      _.map(match, gotAMatch => {\n        let fromList = this.getFromFacetValueList(gotAMatch.facetValue);\n        return fromList ? fromList.facetValue : undefined;\n      })\n    );\n    let element = new OmniboxHierarchicalValuesList(this, facetValues, eventArg).build();\n    eventArg.rows.push({\n      element: element,\n      zIndex: this.omniboxZIndex\n    });\n  }\n\n  protected rebuildValueElements() {\n    this.shouldReshuffleFacetValuesClientSide = this.shouldReshuffleFacetValuesClientSide || this.keepDisplayedValuesNextTime;\n    this.numberOfValues = Math.max(this.numberOfValues, 10000);\n    this.processHierarchy();\n    this.setValueListContent();\n    super.rebuildValueElements();\n    this.buildParentChildRelationship();\n    this.checkForOrphans();\n    this.checkForNewUnselectedChild();\n    this.crop();\n    this.shouldReshuffleFacetValuesClientSide = false;\n  }\n\n  protected initFacetValuesList() {\n    this.facetValuesList = new HierarchicalFacetValuesList(this, HierarchicalFacetValueElement);\n    this.element.appendChild(this.facetValuesList.build());\n  }\n\n  protected updateMoreLess() {\n    let moreValuesAvailable = this.numberOfValuesToShow < this.topLevelHierarchy.length;\n    let lessIsShown = this.numberOfValuesToShow > this.originalNumberOfValuesToShow;\n    super.updateMoreLess(lessIsShown, moreValuesAvailable);\n  }\n\n  protected handleClickMore(): void {\n    this.numberOfValuesToShow += this.originalNumberOfValuesToShow;\n    this.numberOfValuesToShow = Math.min(this.numberOfValuesToShow, this.values.size());\n    this.crop();\n    this.updateMoreLess();\n  }\n\n  protected handleClickLess() {\n    this.numberOfValuesToShow = this.originalNumberOfValuesToShow;\n    this.crop();\n    this.updateMoreLess();\n  }\n\n  protected updateNumberOfValues() {\n    this.numberOfValues = Math.max(this.numberOfValues, 10000);\n  }\n\n  private ensureValueHierarchyExists(facetValues: any) {\n    if (facetValues[0] && typeof facetValues[0] == 'string') {\n      facetValues = _.map(facetValues, (value: string) => {\n        return FacetValue.createFromValue(value);\n      });\n    }\n    let atLeastOneDoesNotExists = false;\n    _.each(facetValues, (facetValue: FacetValue) => {\n      if (this.getValueHierarchy(facetValue.value) == undefined) {\n        atLeastOneDoesNotExists = true;\n      }\n    });\n    if (atLeastOneDoesNotExists) {\n      this.processHierarchy(facetValues);\n    }\n  }\n\n  private crop() {\n    // Partition the top level or the facet to only operate on the values that are not selected or excluded\n    let partition = _.partition(this.topLevelHierarchy, (hierarchy: IValueHierarchy) => {\n      return hierarchy.facetValue.selected || hierarchy.facetValue.excluded || hierarchy.hasChildSelected;\n    });\n\n    // Hide and show the partitionned top level values, depending on the numberOfValuesToShow\n    let numberOfValuesLeft = this.numberOfValuesToShow - partition[0].length;\n    _.each(_.last(partition[1], partition[1].length - numberOfValuesLeft), (toHide: IValueHierarchy) => {\n      this.hideFacetValue(toHide);\n      this.hideChilds(toHide.childs);\n    });\n    _.each(_.first(partition[1], numberOfValuesLeft), (toShow: IValueHierarchy) => {\n      this.showFacetValue(toShow);\n    });\n  }\n\n  private placeChildsUnderTheirParent(hierarchy: IValueHierarchy, hierarchyElement: HTMLElement) {\n    let toIterateOver = hierarchy.childs;\n    if (toIterateOver) {\n      let toIterateOverSorted = this.facetValuesList.sortFacetValues(_.pluck(toIterateOver, 'facetValue')).reverse();\n      _.each(toIterateOverSorted, child => {\n        let childFromHierarchy = this.getValueFromHierarchy(child);\n        if (childFromHierarchy) {\n          let childElement = this.getElementFromFacetValueList(child);\n          $$(childElement).insertAfter(hierarchyElement);\n          if (childFromHierarchy.childs && childFromHierarchy.childs.length != 0) {\n            this.placeChildsUnderTheirParent(childFromHierarchy, childElement);\n          }\n        }\n      });\n    }\n\n    if (hierarchy.keepOpened) {\n      this.open(hierarchy);\n      this.showChilds(hierarchy.childs);\n    } else {\n      this.hideChilds(hierarchy.childs);\n    }\n  }\n\n  private addCssClassToParentAndChilds(hierarchy: IValueHierarchy, hierarchyElement: HTMLElement) {\n    $$(hierarchyElement).addClass('coveo-has-childs');\n    if (hierarchy.hasChildSelected) {\n      $$(hierarchyElement).addClass('coveo-has-childs-selected');\n    }\n    const expandChilds = $$('span', { className: 'coveo-hierarchical-facet-expand' }, SVGIcons.icons.facetExpand);\n    const collapseChilds = $$('span', { className: 'coveo-hierarchical-facet-collapse' }, SVGIcons.icons.facetCollapse);\n    SVGDom.addClassToSVGInContainer(expandChilds.el, 'coveo-hierarchical-facet-expand-svg');\n    SVGDom.addClassToSVGInContainer(collapseChilds.el, 'coveo-hierarchical-facet-collapse-svg');\n    let openAndCloseChilds = $$(\n      'div',\n      {\n        className: 'coveo-has-childs-toggle'\n      },\n      expandChilds.el,\n      collapseChilds.el\n    ).el;\n\n    $$(openAndCloseChilds).on('click', () => {\n      $$(hierarchyElement).hasClass('coveo-open') ? this.close(hierarchy) : this.open(hierarchy);\n    });\n\n    $$(hierarchyElement).prepend(openAndCloseChilds);\n  }\n\n  private buildParentChildRelationship() {\n    let fragment = document.createDocumentFragment();\n    fragment.appendChild(this.facetValuesList.valueContainer);\n    let sorted = _.map(this.facetValuesList.sortFacetValues(), (facetValue: FacetValue) => {\n      return this.getValueFromHierarchy(facetValue);\n    });\n    _.each(sorted, (hierarchy: IValueHierarchy) => {\n      let hierarchyElement = this.getElementFromFacetValueList(hierarchy.facetValue);\n      if (Utils.isNonEmptyArray(hierarchy.childs)) {\n        this.placeChildsUnderTheirParent(hierarchy, hierarchyElement);\n        this.addCssClassToParentAndChilds(hierarchy, hierarchyElement);\n      } else {\n        $$(hierarchyElement).addClass('coveo-no-childs');\n      }\n      hierarchyElement.style.marginLeft = this.options.marginByLevel * (hierarchy.level - this.options.levelStart) + 'px';\n    });\n\n    $$(<any>fragment).insertAfter(this.headerElement);\n  }\n\n  private setValueListContent() {\n    this.facetValuesList.hierarchyFacetValues = _.map(this.correctLevels, hierarchy => {\n      if (!this.values.contains(hierarchy.facetValue.value)) {\n        hierarchy.facetValue.occurrences = 0;\n        this.values.add(hierarchy.facetValue);\n      }\n      return hierarchy.facetValue;\n    });\n  }\n\n  private createHierarchy(valuesToBuildWith: FacetValue[]) {\n    let flatHierarchy = _.map(valuesToBuildWith, (value: FacetValue) => {\n      let parent = this.getParent(value);\n      let self = value.lookupValue || value.value;\n      return {\n        facetValue: value,\n        level: this.getLevel(value),\n        parent: parent,\n        self: self\n      };\n    });\n    this.setInHierarchy(flatHierarchy);\n    _.each(this.getAllValueHierarchy(), valueHierarchy => {\n      if (valueHierarchy.facetValue.selected) {\n        this.flagParentForSelection(valueHierarchy);\n      }\n    });\n    return flatHierarchy;\n  }\n\n  private processHierarchy(facetValues = this.values.getAll()) {\n    _.each(this.getAllValueHierarchy(), (hierarchy: IValueHierarchy) => {\n      if (this.values.get(hierarchy.facetValue.value) == undefined) {\n        this.deleteValueHierarchy(this.getLookupOrValue(hierarchy.facetValue));\n      }\n    });\n    this.createHierarchy(facetValues);\n  }\n\n  private setInHierarchy(flatHierarchy: IFlatHierarchy[]) {\n    this.correctLevels = _.filter<IFlatHierarchy>(flatHierarchy, hierarchy => {\n      let isCorrectMinimumLevel = this.options.levelStart == undefined || hierarchy.level >= this.options.levelStart;\n      let isCorrectMaximumLevel = this.options.levelEnd == undefined || hierarchy.level < this.options.levelEnd;\n      return isCorrectMinimumLevel && isCorrectMaximumLevel;\n    });\n    _.each(this.correctLevels, (hierarchy: IFlatHierarchy) => {\n      let childs = _.map(\n        _.filter<IFlatHierarchy>(this.correctLevels, (possibleChild: IFlatHierarchy) => {\n          return possibleChild.parent != null && possibleChild.parent.toLowerCase() == hierarchy.self.toLowerCase();\n        }),\n        (child): IValueHierarchy => {\n          return {\n            facetValue: child.facetValue,\n            level: child.level,\n            keepOpened: false,\n            hasChildSelected: false,\n            allChildShouldBeSelected: false\n          };\n        }\n      );\n\n      let parent =\n        hierarchy.parent != null\n          ? _.find<IFlatHierarchy>(this.correctLevels, possibleParent => {\n              return possibleParent.self.toLowerCase() == hierarchy.parent.toLowerCase();\n            })\n          : null;\n\n      let hierarchyThatAlreadyExists = this.getValueHierarchy(hierarchy.facetValue.value);\n      if (hierarchyThatAlreadyExists && hierarchyThatAlreadyExists.childs.length != childs.length) {\n        hierarchyThatAlreadyExists.childs = childs;\n      }\n      let hierarchyThatAlreadyExistsAtParent;\n      if (parent) {\n        hierarchyThatAlreadyExistsAtParent = this.getValueHierarchy(parent.facetValue.value);\n      }\n      this.setValueHierarchy(hierarchy.facetValue.value, {\n        childs: childs,\n        parent:\n          parent == undefined\n            ? undefined\n            : {\n                facetValue: parent.facetValue,\n                level: parent.level,\n                keepOpened: hierarchyThatAlreadyExistsAtParent ? hierarchyThatAlreadyExistsAtParent.keepOpened : false,\n                hasChildSelected: hierarchyThatAlreadyExistsAtParent ? hierarchyThatAlreadyExistsAtParent.hasChildSelected : false,\n                originalPosition: hierarchyThatAlreadyExistsAtParent ? hierarchyThatAlreadyExistsAtParent.originalPosition : undefined,\n                allChildShouldBeSelected: hierarchyThatAlreadyExistsAtParent\n                  ? hierarchyThatAlreadyExistsAtParent.allChildShouldBeSelected\n                  : false\n              },\n        facetValue: hierarchy.facetValue,\n        level: hierarchy.level,\n        keepOpened: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.keepOpened : false,\n        hasChildSelected: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.hasChildSelected : false,\n        originalPosition: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.originalPosition : undefined,\n        allChildShouldBeSelected: hierarchyThatAlreadyExists ? hierarchyThatAlreadyExists.allChildShouldBeSelected : false\n      });\n    });\n\n    this.topLevelHierarchy = _.chain(this.values.getAll())\n      .filter((value: FacetValue) => {\n        let fromHierarchy = this.getValueFromHierarchy(value);\n        if (fromHierarchy) {\n          return fromHierarchy.level == (this.options.levelStart || 0);\n        } else {\n          return false;\n        }\n      })\n      .map((value: FacetValue) => {\n        return this.getValueFromHierarchy(value);\n      })\n      .value();\n  }\n\n  private getParent(value: FacetValue) {\n    let lastIndexOfDelimiting = this.getLookupOrValue(value).lastIndexOf(this.options.delimitingCharacter);\n    if (lastIndexOfDelimiting != -1) {\n      return this.getLookupOrValue(value).substring(0, lastIndexOfDelimiting);\n    }\n    return undefined;\n  }\n\n  private getSelf(value: FacetValue) {\n    let parent = this.getParent(value);\n    if (parent == undefined) {\n      return this.getLookupOrValue(value);\n    } else {\n      let indexOfParent = this.getLookupOrValue(value).indexOf(parent);\n      return this.getLookupOrValue(value).substring(indexOfParent + parent.length + 1);\n    }\n  }\n\n  private showFacetValue(value: IValueHierarchy) {\n    $$(this.getElementFromFacetValueList(value.facetValue.value)).removeClass('coveo-inactive');\n  }\n\n  private hideFacetValue(value: IValueHierarchy) {\n    $$(this.getElementFromFacetValueList(value.facetValue.value)).addClass('coveo-inactive');\n  }\n\n  private hideChilds(children: IValueHierarchy[]) {\n    _.each(children, child => {\n      this.hideFacetValue(child);\n    });\n  }\n\n  private showChilds(children: IValueHierarchy[]) {\n    _.each(children, child => {\n      this.showFacetValue(child);\n    });\n  }\n\n  private selectChilds(parent: IValueHierarchy, children: IValueHierarchy[]) {\n    this.flagParentForSelection(parent);\n    parent.allChildShouldBeSelected = true;\n    this.selectMultipleValues(\n      _.map(children, child => {\n        return child.facetValue;\n      })\n    );\n  }\n\n  private deselectChilds(parent: IValueHierarchy, children: IValueHierarchy[]) {\n    parent.hasChildSelected = false;\n    parent.allChildShouldBeSelected = false;\n    this.deselectMultipleValues(\n      _.map(children, child => {\n        return child.facetValue;\n      })\n    );\n  }\n\n  private excludeChilds(children: IValueHierarchy[]) {\n    this.excludeMultipleValues(\n      _.map(children, child => {\n        return child.facetValue;\n      })\n    );\n  }\n\n  private unexcludeChilds(children: IValueHierarchy[]) {\n    this.unexcludeMultipleValues(\n      _.map(children, child => {\n        return child.facetValue;\n      })\n    );\n  }\n\n  private deselectParent(parent: IValueHierarchy) {\n    if (parent != undefined) {\n      this.deselectValue(parent.facetValue, false);\n    }\n  }\n\n  private flagParentForSelection(valueHierarchy: IValueHierarchy) {\n    let parent = valueHierarchy.parent;\n    let current = valueHierarchy;\n    while (parent) {\n      let parentInHierarchy = this.getValueHierarchy(parent.facetValue.value);\n      parentInHierarchy.hasChildSelected = true;\n      let found = _.find(parentInHierarchy.childs, (child: IValueHierarchy) => {\n        return child.facetValue.value.toLowerCase() == current.facetValue.value.toLowerCase();\n      });\n      if (found) {\n        if (this.getValueHierarchy(found.facetValue.value).hasChildSelected) {\n          found.hasChildSelected = true;\n        }\n      }\n      parent = parentInHierarchy.parent;\n      current = parentInHierarchy;\n    }\n  }\n\n  private unflagParentForSelection(valueHierarchy: IValueHierarchy) {\n    let parent = valueHierarchy.parent;\n    while (parent) {\n      let parentInHierarchy = this.getValueHierarchy(parent.facetValue.value);\n      let otherSelectedChilds = _.filter<IValueHierarchy>(parentInHierarchy.childs, child => {\n        let childInHierarchy = this.getValueHierarchy(child.facetValue.value);\n        if (childInHierarchy != undefined) {\n          return (\n            childInHierarchy.facetValue.value != valueHierarchy.facetValue.value &&\n            (childInHierarchy.facetValue.selected || childInHierarchy.facetValue.excluded || childInHierarchy.hasChildSelected)\n          );\n        }\n      });\n\n      if (otherSelectedChilds.length == 0) {\n        parentInHierarchy.hasChildSelected = false;\n      }\n      parentInHierarchy.allChildShouldBeSelected = false;\n      parent = parentInHierarchy.parent;\n    }\n  }\n\n  public getValueFromHierarchy(value: any): IValueHierarchy {\n    let getter = value instanceof FacetValue ? value.value : value;\n    return this.getValueHierarchy(getter);\n  }\n\n  private getFacetValueFromHierarchy(value: any): FacetValue {\n    return this.getValueFromHierarchy(value).facetValue;\n  }\n\n  private getLookupOrValue(value: FacetValue) {\n    return value.lookupValue || value.value;\n  }\n\n  private getElementFromFacetValueList(value: any) {\n    let ret = this.getFromFacetValueList(value);\n    if (ret) {\n      return ret.renderer.listItem;\n    } else {\n      return $$('div').el;\n    }\n  }\n\n  private getFromFacetValueList(value: any) {\n    let fromHierarchy = this.getValueFromHierarchy(value);\n    if (fromHierarchy != undefined) {\n      return this.facetValuesList.get(value);\n    } else {\n      return undefined;\n    }\n  }\n\n  private getLevel(value: FacetValue) {\n    return value.value.split(this.options.delimitingCharacter).length - 1;\n  }\n\n  public getAllValueHierarchy(): { [facetValue: string]: IValueHierarchy } {\n    if (this.valueHierarchy == null) {\n      this.valueHierarchy = {};\n    }\n    return this.valueHierarchy;\n  }\n\n  private deleteValueHierarchy(key: string) {\n    if (this.valueHierarchy != null) {\n      delete this.valueHierarchy[key.toLowerCase()];\n    }\n  }\n\n  private getValueHierarchy(key: string): IValueHierarchy {\n    if (this.valueHierarchy == null) {\n      return undefined;\n    }\n    return this.valueHierarchy[key.toLowerCase()];\n  }\n\n  private setValueHierarchy(key: string, value: IValueHierarchy) {\n    if (this.valueHierarchy == null) {\n      this.valueHierarchy = {};\n    }\n    this.valueHierarchy[key.toLowerCase()] = value;\n  }\n\n  private checkForOrphans() {\n    _.each(this.valueHierarchy, (v: IValueHierarchy) => {\n      if (this.getLevel(v.facetValue) != this.options.levelStart) {\n        if (this.getValueHierarchy(this.getParent(v.facetValue)) == undefined) {\n          this.logger.error(\n            `Orphan value found in HierarchicalFacet : ${v.facetValue.value}`,\n            `Needed : ${this.getParent(v.facetValue)} but not found`\n          );\n          this.logger.warn(`Removing incoherent facet value : ${v.facetValue.value}`);\n          this.hideFacetValue(v);\n        }\n      }\n    });\n  }\n\n  private checkForNewUnselectedChild() {\n    // It's possible that after checking a facet value, the index returns new facet values (because of injection depth);\n    _.each(this.valueHierarchy, (v: IValueHierarchy) => {\n      if (v.allChildShouldBeSelected) {\n        let notAlreadySelected = _.find(v.childs, (child: IValueHierarchy) => {\n          return child.facetValue.selected != true;\n        });\n        if (notAlreadySelected) {\n          this.selectValue(v.facetValue, true);\n          this.logger.info('Re-executing query with new facet values returned by index');\n          this.queryController.deferExecuteQuery();\n        }\n      }\n    });\n  }\n}\nInitialization.registerAutoCreateComponent(HierarchicalFacet);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalFacet.ts","/// <reference path='Facet.ts' />\nimport { StringUtils } from '../../utils/StringUtils';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { FileTypes } from '../Misc/FileTypes';\nimport { DateUtils } from '../../utils/DateUtils';\nimport { Utils } from '../../utils/Utils';\nimport { $$ } from '../../utils/Dom';\nimport * as _ from 'underscore';\nimport FacetModuleDefinition = require('./Facet');\nimport { l } from '../../strings/Strings';\n\nexport class FacetUtils {\n  static getRegexToUseForFacetSearch(value: string, ignoreAccent: boolean) {\n    return new RegExp(StringUtils.stringToRegex(value, ignoreAccent), 'i');\n  }\n\n  static getDisplayValueFromValueCaption(value: string, field: string, valueCaption: Record<string, string>) {\n    const returnValue = this.tryToGetTranslatedCaption(field, value, false);\n    return valueCaption[value] || returnValue;\n  }\n\n  static getValuesToUseForSearchInFacet(original: string, facet: FacetModuleDefinition.Facet): string[] {\n    let ret = [original];\n    let regex = this.getRegexToUseForFacetSearch(original, facet.options.facetSearchIgnoreAccents);\n    if (facet.options.valueCaption) {\n      _.chain(facet.options.valueCaption)\n        .pairs()\n        .filter(pair => {\n          return regex.test(pair[1]);\n        })\n        .each(match => {\n          ret.push(match[0]);\n        });\n      if (\n        QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@objecttype') ||\n        QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@filetype')\n      ) {\n        _.each(FileTypes.getFileTypeCaptions(), (value: string, key: string) => {\n          if (!(key in facet.options.valueCaption) && regex.test(value)) {\n            ret.push(key);\n          }\n        });\n      }\n    } else if (\n      QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@objecttype') ||\n      QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@filetype')\n    ) {\n      _.each(\n        _.filter(_.pairs(FileTypes.getFileTypeCaptions()), pair => {\n          return regex.test(pair[1]);\n        }),\n        match => {\n          ret.push(match[0]);\n        }\n      );\n    } else if (QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@month')) {\n      _.each(_.range(1, 13), month => {\n        if (regex.test(DateUtils.monthToString(month - 1))) {\n          ret.push(('0' + month.toString()).substr(-2));\n        }\n      });\n    }\n    return ret;\n  }\n\n  static buildFacetSearchPattern(values: string[]) {\n    values = _.map(values, value => {\n      return Utils.escapeRegexCharacter(value);\n    });\n    values[0] = '.*' + values[0] + '.*';\n    return values.join('|');\n  }\n\n  static needAnotherFacetSearch(\n    currentSearchLength: number,\n    newSearchLength: number,\n    oldSearchLength: number,\n    desiredSearchLength: number\n  ) {\n    // Something was removed (currentSearch < newSearch)\n    // && we might want to display more facet search result(currentSearch < desiredSearch)\n    // && the new query returned more stuff than the old one so there's still more results(currentSearchLength > oldLength)\n    return currentSearchLength < newSearchLength && currentSearchLength < desiredSearchLength && currentSearchLength > oldSearchLength;\n  }\n\n  static addNoStateCssClassToFacetValues(facet: FacetModuleDefinition.Facet, container: HTMLElement) {\n    // This takes care of adding the correct css class on each facet value checkbox (empty white box) if at least one value is selected in that facet\n    if (facet.values.getSelected().length != 0) {\n      let noStates = $$(container).findAll('li:not(.coveo-selected)');\n      _.each(noStates, noState => {\n        $$(noState).addClass('coveo-no-state');\n      });\n    }\n  }\n\n  static tryToGetTranslatedCaption(field: string, value: string, fallbackOnLocalization = true) {\n    let found: string;\n\n    if (QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@filetype')) {\n      found = FileTypes.getFileType(value, fallbackOnLocalization).caption;\n    } else if (QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@objecttype')) {\n      found = FileTypes.getObjectType(value, fallbackOnLocalization).caption;\n    } else if (FacetUtils.isMonthFieldValue(field, value)) {\n      const month = parseInt(value, 10);\n      found = DateUtils.monthToString(month - 1);\n    } else if (fallbackOnLocalization) {\n      found = l(value);\n    }\n    return found != undefined && Utils.isNonEmptyString(found) ? found : value;\n  }\n\n  static isMonthFieldValue(field: string, value: string) {\n    if (!QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@month')) {\n      return false;\n    }\n\n    const asInt = parseInt(value, 10);\n\n    if (isNaN(asInt)) {\n      return false;\n    }\n\n    if (asInt < 1 || asInt > 12) {\n      return false;\n    }\n\n    return true;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetUtils.ts","import { Template, TemplateRole } from './Template';\nimport { TemplateList } from './TemplateList';\nimport _ = require('underscore');\n\nexport class TableTemplate extends TemplateList {\n  instantiateRoleToString(role: TemplateRole) {\n    const roledTemplate = _.find(this.templates, t => t.role === role);\n    if (roledTemplate) {\n      return roledTemplate.instantiateToString(undefined, {});\n    } else {\n      return this.defaultRoledTemplates[role];\n    }\n  }\n  instantiateRoleToElement(role: TemplateRole) {\n    const roledTemplate = _.find(this.templates, t => t.role === role);\n    if (roledTemplate) {\n      return roledTemplate.instantiateToElement(undefined, {});\n    } else {\n      const tmpl = new Template(() => this.defaultRoledTemplates[role]);\n      tmpl.layout = 'table';\n      return tmpl.instantiateToElement(undefined);\n    }\n  }\n\n  private defaultTemplate = `<td><a class=\"CoveoResultLink\"></a></td>\n                             <td><span class=\"CoveoExcerpt\"></span></td>\n                             <td><span class=\"CoveoFieldValue\" data-field=\"@date\" data-helper=\"date\"></span></td>`;\n\n  private defaultRoledTemplates = {\n    'table-header': `<th style=\"width: 40%\">Link</th>\n                     <th>Excerpt</th>\n                     <th style=\"width: 20%\"\n                         class=\"CoveoSort coveo-table-header-sort\"\n                         data-sort-criteria=\"date ascending,date descending\"\n                         data-display-unselected-icon=\"false\">Date</th>`,\n    'table-footer': `<th>Link</th>\n                     <th>Excerpt</th>\n                     <th>Date</th>`\n  };\n\n  protected getFallbackTemplate(): Template {\n    return new Template(() => this.defaultTemplate);\n  }\n\n  hasTemplateWithRole(role: TemplateRole) {\n    return _.find(this.templates, t => t.role === role);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/TableTemplate.ts","import { Template } from './Template';\nimport { IQueryResult } from '../../rest/QueryResult';\n\nexport class DefaultRecommendationTemplate extends Template {\n  instantiateToString(object?: IQueryResult): string {\n    var template = `<div class=\"coveo-result-frame\">\n        <div class=\"coveo-result-row\">\n          <div class=\"coveo-result-cell\" style=\"width:40px;text-align:center;vertical-align:middle;\">\n            <span class=\"CoveoIcon\" data-small=\"true\" data-with-label=\"false\">\n            </span>\n          </div>\n          <div class=\"coveo-result-cell\" style=\"padding:0 0 3px 5px;vertical-align:middle\">\n            <div class=\"coveo-result-row\">\n              <div class=\"coveo-result-cell\" style=\"font-size:10pt;\">\n                <a class=\"CoveoResultLink\" style=\"display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis\">\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>`;\n    return template;\n  }\n\n  instantiateToElement(object?: IQueryResult): Promise<HTMLElement> {\n    return new Promise((resolve, reject) => {\n      var div = document.createElement('div');\n      div.innerHTML = this.instantiateToString(object);\n      resolve(div);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/DefaultRecommendationTemplate.ts","import { IQueryResults } from '../../rest/QueryResults';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { Assert, QueryUtils, Component, Initialization, QueryStateModel } from '../../Core';\nimport { IInitResult } from '../Base/Initialization';\nimport { Template } from './Template';\nimport { SearchInterface } from '../../ui/SearchInterface/SearchInterface';\nimport { ResultList } from '../ResultList/ResultList';\nimport { RendererValidLayout } from '../ResultLayoutSelector/ValidLayout';\nimport { pluck, sortBy, map } from 'underscore';\nimport { $$ } from '../../utils/Dom';\nimport { Logger } from '../../misc/Logger';\n\nexport interface ITemplateToHtml {\n  resultTemplate: Template;\n  queryStateModel: QueryStateModel;\n  searchInterface: SearchInterface;\n}\n\nexport class TemplateToHtml {\n  constructor(public args: ITemplateToHtml) {}\n\n  public async buildResults(\n    results: IQueryResults,\n    layout: RendererValidLayout,\n    currentlyDisplayedResults: IQueryResult[]\n  ): Promise<HTMLElement[]> {\n    const res: { elem: HTMLElement; idx: number }[] = [];\n    const resultsPromises = map(results.results, (result: IQueryResult, index: number) => {\n      return this.buildResult(result, layout, currentlyDisplayedResults).then((resultElement: HTMLElement) => {\n        if (resultElement != null) {\n          res.push({ elem: resultElement, idx: index });\n        }\n        ResultList.resultCurrentlyBeingRendered = null;\n        return resultElement;\n      });\n    });\n\n    // We need to sort by the original index order, because in lazy loading mode, it's possible that results does not gets rendered\n    // in the correct order returned by the index, depending on the time it takes to load all the results component for a given result template\n    return Promise.all(resultsPromises).then(() => {\n      return pluck(sortBy(res, 'idx'), 'elem');\n    });\n  }\n\n  public async buildResult(\n    result: IQueryResult,\n    layout: RendererValidLayout,\n    currentlyDisplayedResults: IQueryResult[]\n  ): Promise<HTMLElement> {\n    Assert.exists(result);\n    QueryUtils.setStateObjectOnQueryResult(this.args.queryStateModel.get(), result);\n    QueryUtils.setSearchInterfaceObjectOnQueryResult(this.args.searchInterface, result);\n    ResultList.resultCurrentlyBeingRendered = result;\n    const resultElement = await this.createHtmlElement(result, layout);\n\n    if (resultElement != null) {\n      Component.bindResultToElement(resultElement, result);\n    }\n    currentlyDisplayedResults.push(result);\n\n    await this.autoCreateComponentsInsideResult(resultElement, result).initResult;\n\n    this.verifyChildren(resultElement);\n    return resultElement;\n  }\n\n  public autoCreateComponentsInsideResult(element: HTMLElement, result: IQueryResult): IInitResult {\n    Assert.exists(element);\n    return Initialization.automaticallyCreateComponentsInsideResult(element, result);\n  }\n\n  private createHtmlElement(result: IQueryResult, layout: RendererValidLayout) {\n    return this.args.resultTemplate.instantiateToElement(result, {\n      wrapInDiv: true,\n      checkCondition: true,\n      currentLayout: layout,\n      responsiveComponents: this.args.searchInterface.responsiveComponents\n    });\n  }\n\n  private verifyChildren(element: HTMLElement) {\n    const containsResultLink = !!$$(element).find('.CoveoResultLink');\n    if (containsResultLink) {\n      return;\n    }\n\n    const msg = `Result does not contain a \"CoveoResultLink\" component, please verify the result template`;\n    new Logger(element).warn(msg, this.args.resultTemplate);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/TemplateToHtml.ts","import { TemplateHelpers, ITemplateHelperFunction } from './TemplateHelpers';\nimport { IHighlight, IHighlightPhrase, IHighlightTerm } from '../../rest/Highlight';\nimport { HighlightUtils, StringAndHoles } from '../../utils/HighlightUtils';\nimport { IStreamHighlightOptions } from '../../utils/StreamHighlightUtils';\nimport { IDateToStringOptions, DateUtils } from '../../utils/DateUtils';\nimport { ICurrencyToStringOptions, CurrencyUtils } from '../../utils/CurrencyUtils';\nimport { IAnchorUtilsOptions, IImageUtilsOptions, AnchorUtils, ImageUtils } from '../../utils/HtmlUtils';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { Utils } from '../../utils/Utils';\nimport { StringUtils } from '../../utils/StringUtils';\nimport { TimeSpan, ITimeSpanUtilsOptions } from '../../utils/TimeSpanUtils';\nimport { EmailUtils } from '../../utils/EmailUtils';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { DeviceUtils } from '../../utils/DeviceUtils';\nimport { $$ } from '../../utils/Dom';\nimport { SearchEndpoint } from '../../rest/SearchEndpoint';\nimport { StreamHighlightUtils } from '../../utils/StreamHighlightUtils';\nimport { FacetUtils } from '../Facet/FacetUtils';\nimport * as Globalize from 'globalize';\nimport { IStringMap } from '../../rest/GenericParam';\nimport * as _ from 'underscore';\nimport { Component } from '../Base/Component';\nimport { TemplateCache } from './TemplateCache';\nimport { INumberFormatOptions } from '../../utils/NumberUtils';\n\n/**\n * The core template helpers provided by default.\n *\n * **Examples:**\n *\n * **HTML**\n *\n * ```html\n * <div class=\"CoveoFieldValue\" data-field=\"@videoduration\" data-helper=\"timeSpan\" data-helper-options-is-milliseconds=\"false\"></div>\n * ```\n *\n * **Underscore**\n *\n * ```erb\n * <%= timeSpan(raw.videoduration, { isMilliseconds: false }) %>\n * ```\n */\nexport interface ICoreHelpers {\n  /**\n   * Shortens a string so that its length does not exceed a specific number of\n   * characters. An ellipsis is appended to the string if it exceeds the\n   * maximum length.\n   *\n   * - `content`: The string to shorten.\n   * - `length`: The maximum length of the resulting string.\n   * - `highlights`: Optional. If provided, the string will be highlighted\n   *   using this highlight information.\n   * - `cssClass`: Optional. When highlighting, the name of the CSS class to use.\n   */\n  shorten: (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Shortens a string using an algorithm suitable for file paths. The helper\n   * will insert an ellipsis in the string where text has been removed when\n   * the path exceeds the maximum length.\n   *\n   * - `content`: The path to shorten.\n   * - `length`: The maximum length of the resulting string.\n   * - `highlights`: Optional. If provided, the string will be highlighted using\n   *   this highlight information.\n   * - `cssClass`: Optional. When highlighting, the name of the CSS class to use.\n   */\n  shortenPath: (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Shortens a string using an algorithm suitable for URIs. The helper will\n   * insert an ellipsis in the string where text has been removed when the URI\n   * exceeds the maximum length.\n   *\n   * - `content`: The URI to shorten.\n   * - `length`: The maximum length of the resulting string.\n   * - `highlights`: Optional. If provided, the string will be highlighted\n   *   using this highlight information.\n   * - `cssClass`: Optional. When highlighting, the name of the CSS class to use.\n   */\n  shortenUri: (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Highlights a string using the provided highlight information.\n   *\n   * - `content`: The URI to shorten.\n   * - `highlights`: Optional. The highlight information to use.\n   * - `cssClass`: Optional. The name of the CSS class to use for highlighting.\n   */\n  highlight: (content: string, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Highlights the provided terms in a given string.<br/>\n   * By default, the terms to highlight are the current query and the\n   * associated stemming words from the index.\n   * The only required parameter is the content, which specify the string that needs to be highlighted.\n   * The other parameters will normally be automatically resolved for you from the current result object.\n   *\n   * - `content`: The string content to highlight\n   * - `termsToHighlight`: The terms to highlight (see {@link IHighlightTerm})\n   * - `phraseToHighlight`: The phrases to highlight (see {@link IHighlightPhrase})\n   * - `options`: Optional. The options defined below as {@link IStreamHighlightOptions}\n   *\n   * **Note:**\n   * > `highlightStreamText` should only be used for very particular/specific use cases (e.g., augmenting the result template with additional information rather than the typical excerpt/title), and is not a proper replacement for actually having the correct title and excerpt on your results.\n   * >\n   * > Using incorrect result titles or excerpts on your search interface also causes relevancy to suffer greatly, as the index uses the title and excerpt to find relevant results. Consequently, end users are more likely to see results whose titles do not match their query.\n   * >\n   * > Moreover, the recommended method to implement simple title and/or excerpt highlighting is to simply use the {@link Excerpt} and {@link ResultLink} components.\n   */\n  highlightStreamText: (\n    content: string,\n    termsToHighlight: IHighlightTerm,\n    phrasesToHighlight: IHighlightPhrase,\n    options?: IStreamHighlightOptions\n  ) => string;\n  /**\n   * This helper operates exactly like the {@link highlightStreamText} helper, except\n   * that it should be used to highlight HTML content. The helper takes care\n   * of not highlighting the HTML markup.\n   *\n   * - `content`: The string content to highlight\n   * - `termsToHighlight`: The terms to highlight (see {@link IHighlightTerm})\n   * - `phraseToHighlight`: The phrases to highlight (see {@link IHighlightPhrase})\n   * - `options`: Optional. The options defined below as {@link IStreamHighlightOptions}\n   *\n   * **Note:**\n   * > `highlightStreamHTML` should only be used for very particular/specific use cases (e.g., augmenting the result template with additional information rather than the typical excerpt/title), and is not a proper replacement for actually having the correct title and excerpt on your results.\n   * >\n   * > Using incorrect result titles or excerpts on your search interface also causes relevancy to suffer greatly, as the index uses the title and excerpt to find relevant results. Consequently, end users are more likely to see results whose titles do not match their query.\n   * >\n   * > Moreover, the recommended method to implement simple title and/or excerpt highlighting is to simply use the {@link Excerpt} and {@link ResultLink} components.\n   */\n  highlightStreamHTML: (\n    content: string,\n    termsToHighlight: IHighlightTerm,\n    phrasesToHighlight: IHighlightPhrase,\n    options?: IStreamHighlightOptions\n  ) => string;\n  /**\n   * Formats a numeric value using the format string.\n   *\n   * - `content`: The numeric value to format.\n   * - `format` Optional. The string format to use. See the <a href=\"https://github.com/klaaspieter/jquery-global#numbers\" target=\"_blank\">Globalize</a> library for the list of available formats.\n   *\n   * When the helper is used in a [`FieldValue`]{@link FieldValue} component, this value is automatically retrieved from the specified [`field`]{@link FieldValue.options.field}.\n   *\n   * **Example:**\n   *\n   *  ```html\n   *  <div class=\"CoveoFieldValue\" data-field=\"@viewcount\" data-text-caption=\"Views\" data-helper=\"number\" data-helper-options-format=\"n0\"></div>\n   *  ```\n   */\n  number: (content: string, format: string | INumberFormatOptions) => string;\n  /**\n   * Formats a date value to a date-only string using the specified options.\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  date: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Formats a date value to a time-only string using the specified options.\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  time: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Formats a date value to a date and time string using the specified\n   * options.\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  dateTime: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Formats a currency value to a string using the specified options.\n   *\n   * - `content`: The number value to format.\n   * - `options`: Optional. The options to use (see {@link ICurrencyToStringOptions}).\n   */\n  currency: (content: any, options?: ICurrencyToStringOptions) => string;\n  /**\n   * Formats a date value to a date and time string using options suitable for\n   * email dates\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  emailDateTime: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Renders one or several email values in `mailto:` hyperlinks.\n   *\n   * - `value`: The string or array of strings that contains a list of semicolon-separated email\n   *   values. When multiple values are passed, each value is displayed in a\n   *   separate hyperlink.\n   * - `companyDomain`: Optional. The string that contains your own domain (e.g.:\n   *   coveo.com). When specified, this parameter allows email addresses\n   *   coming from your own domain to be displayed in a shortened format\n   *   (e.g.: Full Name), whereas email addresses coming from an external\n   *   domain will be displayed in an extended format (e.g.: Full Name\n   *   (domain.com)). If this parameter is not specified, then the shortened\n   *   format will automatically be used.\n   * - `me`: Optional. The string that contains the current username. If it is\n   *   specified, then the email address containing the current username will\n   *   be replaced by the localized string 'Me'.\n   * - `lengthLimit`: Optional. The number of email addresses that you want to display\n   *   before an ellipse is added (e.g.: 'From Joe, John and 5 others').<br/>\n   *   The default value is 2.\n   * - `truncateName`: Optional. When the username is available from the email address,\n   *   then you can specify if you want to truncate the full name. (e.g.:\n   *   'John S.' instead of 'John Smith').<br/>\n   *   The default value is `false`.\n   */\n  email: (value: string | string[], companyDomain?: string, me?: string, lengthLimit?: number, truncateName?: boolean) => string;\n  /**\n   * Formats a clickable HTML link (`<a>`).\n   *\n   * - `href`: The link URI\n   * - `options`: Optional. The options to use (see {@link IAnchorUtilsOptions})\n   */\n  anchor: (href: string, options?: IAnchorUtilsOptions) => string;\n  /**\n   * Formats an HTML image tag (`<img>`).\n   *\n   * - `src`: The image source URI\n   * - `options`: Optional. The options to use (see {@link IImageUtilsOptions})\n   */\n  image: (src: string, options?: IImageUtilsOptions) => string;\n  /**\n   * Formats an HTML image tag (`<img>`), and automatically uses the result\n   * object to query the REST API to get the thumbnail for this result. For\n   * example, this can be used to great effect when designing a template\n   * showing users or previews of files.\n   * - `result`: Optional. The current result object inside your template. In\n   *   underscore, it is referenced as `obj`. By default, the result\n   *   will be resolved automatically from your current template function (\n   *   Meaning the nearest result in the current call stack execution inside\n   *   your template)\n   * - `endpoint`: Optional. The name of the endpoint to use for your\n   *   thumbnail. Default is default.\n   * - `options`: Optional. The options to use (see {@link IImageUtilsOptions}).\n   */\n  thumbnail: (result?: IQueryResult, endpoint?: string, options?: IImageUtilsOptions) => string;\n  /**\n   * Generates an icon based on the file type of the current result. The icon\n   * will be contained inside a `<span>` element with the appropriate CSS\n   * class.\n   *\n   * - `result`: Optional. The current result object inside your template. In\n   *   underscore, it is referenced as `obj`. By default, the result\n   *   will be resolved automatically from your current template function (\n   *   Meaning the nearest result in the current call stack execution inside\n   *   your template)\n   * - `options`: Optional. The options to use (see {@link IIconOptions}).\n   */\n  fromFileTypeToIcon: (result?: IQueryResult, options?: any) => string;\n  /**\n   * Loads a partial template in the current template, by passing the ID of\n   * the template to load, the condition for which this template should be\n   * loaded, and the context object (the object that the loaded template will\n   * use as its data). By default, the context object will be the same as the\n   * template that called this helper function. So, for example, in a\n   * ResultList Component, the contextObject would, by default, be the Query\n   * Results.\n   *\n   * - `templateId`: The ID of the template to load.\n   * - `condition`: Optional. The boolean condition to determine if this template should\n   *   load for this result set. Most of the time this would be a condition of\n   *   the type if raw.somefield == 'something'.\n   * - `contextObject`: Optional. The object that should be used by the loaded template\n   *   as its contextObject.\n   */\n  loadTemplate: (templateId: string, condition?: boolean, contextObject?: any) => string;\n  /**\n   * Given a number, either in millisecond or second, convert to a HH:MM:SS format.\n   *\n   * **Examples**\n   *\n   * >`timeSpan(1, {isMilliseconds: false}) => '00:01'`\n   * >\n   * >`timeSpan(1000, {isMilliseconds: true}) => '00:01'`\n   *\n   * - `value`: The number to convert to a timespan\n   * - `options` : The options to use (see {@link ITimeSpanUtilsOptions})\n   */\n  timeSpan: (value: number, options: ITimeSpanUtilsOptions) => string;\n  /**\n   * Formats a number, which represents a file size in bytes, into a logical unit size.\n   *\n   * **Examples:**\n   *\n   * >`size(1024) => 1024 B`\n   * >\n   * >`size(1025) => 1 KB`\n   * >\n   * >`size(10240) => 10 KB`\n   *\n   * **Examples:**\n   *\n   * >**HTML**\n   * >\n   * > ```html\n   * > <div class=\"CoveoFieldValue\" data-field='@size' data-helper=\"size\" data-helper-options-base=\"1\"></div>\n   * > ```\n   *\n   * >**Underscore**\n   * >\n   * > ```erb\n   * > <%= size(raw.size, {base: 0, precision: 2}) %>\n   * > ```\n   *\n   * - `value`: The number to format\n   * - `options` : The options to use (see {@link ISizeOptions})\n   */\n  size: (value: number, options?: ISizeOptions) => string;\n  /**\n   * Given a filetype value, try to return a translated and human readable version.\n   *\n   * If the filetype is known and recognized by the framework, a translated value will be returned.\n   *\n   * **Examples**\n   *\n   * >`translatedCaption('doc') => Document`\n   * >\n   * >`translatedCaption('xls') => Spreadsheet Document`\n   *\n   * - `value`: The string value to translate\n   */\n  translatedCaption: (value: string) => string;\n  /**\n   * Replace all carriage return in a string by a &lt;br /&gt; tag\n   *\n   * - `value`: The string value to replace the carriage returns in.\n   */\n  encodeCarriageReturn: (value: string) => string;\n  /**\n   * Detect if the results is being rendered in a mobile device.\n   *\n   * If it's not a mobile device, the helper return null ;\n   *\n   * If it's a mobile device, return the type of device (Android, iPhone, iPad) etc.\n   */\n  isMobileDevice: () => string;\n}\n\n/**\n * Available options for the size templateHelpers.\n *\n * Example:\n * <div class=\"CoveoFieldValue\" data-helper=\"helperName\" data-helper-options-optionName=\"option-value\"></div>\n */\nexport interface ISizeOptions {\n  /**\n   * The base into which to format the value.\n   *\n   * Formula: value * 10^(3 * base)\n   *\n   * **Examples:**\n   * > **Base 0:**\n   * >\n   * > 1 => 1B\n   * >\n   * > 1000 => 1KB\n   *\n   * > **Base 1:**\n   * >\n   * > 1 => 1KB\n   * >\n   * > 1000 => 1MB\n   */\n  base?: number;\n  /**\n   * The precision to use to format the size (i.e., the number of digits to display after the decimal)\n   *\n   * **Examples:**\n   * > **Precision 0:**\n   * >\n   * > 1.0 => 1\n   * >\n   * > 1.85 => 1\n   *\n   * > **Precision 1:**\n   * >\n   * > 1.0 => 1.0\n   * >\n   * > 1.85 => 1.8\n   */\n\n  precision?: number;\n}\n\nexport interface IShortenOptions {\n  length: number;\n  highlights?: IHighlight[];\n  cssClass?: string;\n}\n\nexport interface IHighlightsOptions {\n  highlights: IHighlight[];\n  cssClass?: string;\n}\n\nexport interface IHelperStreamHighlightOptions {\n  termsToHighlight: IHighlightTerm;\n  phrasesToHighlight: IHighlightPhrase;\n  opts?: IStreamHighlightOptions;\n}\n\nexport class CoreHelpers {\n  public constructor() {}\n\n  /**\n   * For backward compatibility reason, the \"global\" template helper should be available under the\n   * coveo namespace.\n   * @param scope\n   */\n  public static exportAllHelpersGlobally(scope: IStringMap<any>) {\n    _.each(TemplateHelpers.getHelpers(), (helper: ITemplateHelperFunction, name: string) => {\n      if (scope[name] == undefined) {\n        scope[name] = helper;\n      }\n    });\n  }\n}\n\nTemplateHelpers.registerFieldHelper('javascriptEncode', (value: string) => {\n  return Utils.exists(value) ? StringUtils.javascriptEncode(value) : undefined;\n});\n\nconst executeShorten = (content: string, options: IShortenOptions) => {\n  const strAndHoles = StringAndHoles.shortenString(content, options.length, '...');\n  if (Utils.exists(options.highlights)) {\n    return HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n  } else {\n    return strAndHoles.value;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('shorten', (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => {\n  return executeShorten(content, {\n    length,\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerTemplateHelper('shortenv2', (content: string, options: IShortenOptions) => {\n  return executeShorten(content, options);\n});\n\nconst executeShortenPath = (content: string, options: IShortenOptions) => {\n  const strAndHoles = StringAndHoles.shortenPath(content, options.length);\n  if (Utils.exists(options.highlights)) {\n    return HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n  } else {\n    return strAndHoles.value;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('shortenPath', (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => {\n  return executeShortenPath(content, {\n    length,\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerFieldHelper('shortenPathv2', (content: string, options: IShortenOptions) => {\n  return executeShortenPath(content, options);\n});\n\nconst executeShortenUri = (content: string, options: IShortenOptions) => {\n  const strAndHoles = StringAndHoles.shortenUri(content, options.length);\n\n  if (Utils.exists(options.highlights)) {\n    return HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n  } else {\n    return strAndHoles.value;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('shortenUri', (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => {\n  return executeShortenUri(content, {\n    length,\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerTemplateHelper('shortenUriv2', (content: string, options: IShortenOptions) => {\n  return executeShortenUri(content, options);\n});\n\nconst executeHighlight = (content: string, options: IHighlightsOptions) => {\n  if (Utils.exists(content)) {\n    if (Utils.exists(options.highlights)) {\n      return HighlightUtils.highlightString(content, options.highlights, null, options.cssClass || 'highlight');\n    } else {\n      return content;\n    }\n  } else {\n    return undefined;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('highlight', (content: string, highlights: IHighlight[], cssClass?: string) => {\n  return executeHighlight(content, {\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerTemplateHelper('highlightv2', (content: string, options: IHighlightsOptions) => {\n  return executeHighlight(content, options);\n});\n\nconst executeHighlightStreamText = (content: string, options: IHelperStreamHighlightOptions) => {\n  if (Utils.exists(content) && Utils.exists(options.termsToHighlight) && Utils.exists(options.phrasesToHighlight)) {\n    if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n      return StreamHighlightUtils.highlightStreamText(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n    } else {\n      return content;\n    }\n  } else {\n    return undefined;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper(\n  'highlightStreamText',\n  (\n    content: string,\n    termsToHighlight = resolveTermsToHighlight(),\n    phrasesToHighlight = resolvePhrasesToHighlight(),\n    opts?: IStreamHighlightOptions\n  ) => {\n    return executeHighlightStreamText(content, {\n      termsToHighlight,\n      phrasesToHighlight,\n      opts\n    });\n  }\n);\n\nTemplateHelpers.registerTemplateHelper('highlightStreamTextv2', (content: string, options: IHelperStreamHighlightOptions) => {\n  const mergedOptions = {\n    termsToHighlight: resolveTermsToHighlight(),\n    phrasesToHighlight: resolvePhrasesToHighlight(),\n    ...options\n  };\n  return executeHighlightStreamText(content, mergedOptions);\n});\n\nconst executeHighlightStreamHTML = (content: string, options: IHelperStreamHighlightOptions) => {\n  if (Utils.exists(content) && Utils.exists(options.termsToHighlight) && Utils.exists(options.phrasesToHighlight)) {\n    if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n      return StreamHighlightUtils.highlightStreamHTML(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n    } else {\n      return content;\n    }\n  } else {\n    return undefined;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper(\n  'highlightStreamHTML',\n  (\n    content: string,\n    termsToHighlight = resolveTermsToHighlight(),\n    phrasesToHighlight = resolvePhrasesToHighlight(),\n    opts?: IStreamHighlightOptions\n  ) => {\n    return executeHighlightStreamHTML(content, {\n      termsToHighlight,\n      phrasesToHighlight,\n      opts\n    });\n  }\n);\n\nTemplateHelpers.registerTemplateHelper('highlightStreamHTMLv2', (content: string, options: IHelperStreamHighlightOptions) => {\n  const mergedOptions = {\n    termsToHighlight: resolveTermsToHighlight(),\n    phrasesToHighlight: resolvePhrasesToHighlight(),\n    ...options\n  };\n  return executeHighlightStreamHTML(content, mergedOptions);\n});\n\nTemplateHelpers.registerFieldHelper('number', (value: any, options?: INumberFormatOptions | string) => {\n  if (!Utils.exists(value)) {\n    return undefined;\n  }\n\n  const numberValue = Number(value);\n  const format = _.isString(options) ? options : options && options.format;\n  if (!format) {\n    return StringUtils.htmlEncode(numberValue.toString());\n  }\n\n  return StringUtils.htmlEncode(Globalize.format(numberValue, <string>format));\n});\n\nTemplateHelpers.registerFieldHelper('date', (value: any, options?: IDateToStringOptions) => {\n  return DateUtils.dateToString(DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\n\nTemplateHelpers.registerFieldHelper('time', (value: any, options?: IDateToStringOptions) => {\n  return DateUtils.timeToString(DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\n\nTemplateHelpers.registerFieldHelper('dateTime', (value: any, options?: IDateToStringOptions) => {\n  return DateUtils.dateTimeToString(DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\n\nTemplateHelpers.registerFieldHelper('emailDateTime', (value: any, options?: IDateToStringOptions) => {\n  var defaultOptions = <IDateToStringOptions>{};\n  defaultOptions.includeTimeIfThisWeek = true;\n  var optionsToUse = <IDateToStringOptions>_.extend(options, defaultOptions);\n  return value ? DateUtils.dateTimeToString(DateUtils.convertFromJsonDateIfNeeded(value), optionsToUse) : undefined;\n});\n\nTemplateHelpers.registerFieldHelper('currency', (value: any, options?: ICurrencyToStringOptions) => {\n  return CurrencyUtils.currencyToString(value, options);\n});\n\nTemplateHelpers.registerFieldHelper('timeSpan', (value: any, options: ITimeSpanUtilsOptions = { isMilliseconds: false }) => {\n  return new TimeSpan(value, options.isMilliseconds).getHHMMSS();\n});\n\nTemplateHelpers.registerFieldHelper('email', (value: string | string[], ...args: any[]) => {\n  // support old arguments (value: any, companyDomain: string, me: string, lengthLimit = 2, truncateName = false)\n  var companyDomain: string;\n  var me: string;\n  var lengthLimit: number;\n  var truncateName: boolean;\n  if (_.isObject(args[0])) {\n    companyDomain = args[0]['companyDomain'];\n    me = args[0]['me'];\n    lengthLimit = args[0]['lengthLimit'];\n    truncateName = args[0]['truncateName'];\n  } else {\n    companyDomain = args[0];\n    me = args[1];\n    lengthLimit = args[2];\n    truncateName = args[3];\n  }\n  if (lengthLimit == undefined) {\n    lengthLimit = 2;\n  }\n  if (truncateName == undefined) {\n    truncateName = false;\n  }\n  if (_.isString(value)) {\n    var listOfAddresses = EmailUtils.splitSemicolonSeparatedListOfEmailAddresses(<string>value);\n    return EmailUtils.emailAddressesToHyperlinks(listOfAddresses, companyDomain, me, lengthLimit, truncateName);\n  } else if (_.isArray(value)) {\n    return EmailUtils.emailAddressesToHyperlinks(<string[]>value, companyDomain, me, lengthLimit, truncateName);\n  } else {\n    return undefined;\n  }\n});\n\nTemplateHelpers.registerTemplateHelper('excessEmailToggle', (target: HTMLElement) => {\n  $$(target).removeClass('coveo-active');\n  if ($$(target).hasClass('coveo-emails-excess-collapsed')) {\n    _.each($$(target).siblings('.coveo-emails-excess-expanded'), sibling => {\n      $$(sibling).addClass('coveo-active');\n    });\n  } else if ($$(target).hasClass('coveo-hide-expanded')) {\n    $$(target.parentElement).addClass('coveo-inactive');\n    _.each($$(target.parentElement).siblings('.coveo-emails-excess-collapsed'), sibling => {\n      $$(sibling).addClass('coveo-active');\n    });\n  }\n  return undefined;\n});\n\nTemplateHelpers.registerFieldHelper('anchor', (href: string, options?: IAnchorUtilsOptions) => {\n  return AnchorUtils.buildAnchor(href, options);\n});\n\nTemplateHelpers.registerFieldHelper('image', (src: string, options?: IImageUtilsOptions, result: IQueryResult = resolveQueryResult()) => {\n  if (options && options.srcTemplate) {\n    return ImageUtils.buildImage(StringUtils.buildStringTemplateFromResult(options.srcTemplate, result), {\n      alt: options.alt,\n      height: options.height,\n      width: options.width\n    });\n  }\n  return ImageUtils.buildImage(src, options);\n});\n\nTemplateHelpers.registerTemplateHelper(\n  'thumbnail',\n  (result: IQueryResult = resolveQueryResult(), endpoint: string = 'default', options?: IImageUtilsOptions) => {\n    if (QueryUtils.hasThumbnail(result)) {\n      return ImageUtils.buildImageFromResult(result, SearchEndpoint.endpoints[endpoint], options);\n    }\n  }\n);\n\nTemplateHelpers.registerTemplateHelper('fromFileTypeToIcon', (result: IQueryResult = resolveQueryResult(), options = {}) => {\n  let icon = Component.getComponentRef('Icon');\n  if (icon) {\n    return icon.createIcon(result, options).outerHTML;\n  }\n});\n\nTemplateHelpers.registerTemplateHelper('attrEncode', (value: string) => {\n  return ('' + value) /* Forces the conversion to string. */\n    .replace(/&/g, '&amp;') /* This MUST be the 1st replacement. */\n    .replace(/'/g, '&apos;') /* The 4 other predefined entities, required. */\n    .replace(/'/g, '&quot;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;');\n});\n\nTemplateHelpers.registerTemplateHelper('loadTemplates', (templatesToLoad: { [id: string]: any }, once = true) => {\n  var ret = '';\n  var data = resolveQueryResult();\n  var atLeastOneWasLoaded = false;\n  var toLoad = templatesToLoad;\n  var defaultTmpl;\n  _.each(templatesToLoad, (value, key?, obj?) => {\n    if (value == 'default') {\n      defaultTmpl = key;\n    }\n  });\n  if (defaultTmpl != undefined) {\n    toLoad = _.omit(templatesToLoad, defaultTmpl);\n  }\n  _.each(toLoad, (condition, id?, obj?) => {\n    if (!atLeastOneWasLoaded || !once) {\n      atLeastOneWasLoaded = atLeastOneWasLoaded || condition;\n      ret += TemplateHelpers.getHelper('loadTemplate')(id, condition, data);\n    }\n  });\n  if (!atLeastOneWasLoaded && defaultTmpl != undefined) {\n    ret += TemplateHelpers.getHelper('loadTemplate')(defaultTmpl, true, data);\n  }\n  return ret;\n});\n\nconst byteMeasure = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB'];\n\nTemplateHelpers.registerFieldHelper('size', (value: any, options?: ISizeOptions) => {\n  var size = parseInt(value, 10);\n  var precision = options != null && options.precision != null ? options.precision : 2;\n  var base = options != null && options.base != null ? options.base : 0;\n  while (size > 1024 && base + 1 < byteMeasure.length) {\n    size /= 1024;\n    base++;\n  }\n  size = Math.floor(size * Math.pow(10, precision)) / Math.pow(10, precision);\n  return size + ' ' + byteMeasure[base];\n});\n\nTemplateHelpers.registerFieldHelper('translatedCaption', (value: string) => {\n  return FacetUtils.tryToGetTranslatedCaption('@filetype', value);\n});\n\nTemplateHelpers.registerTemplateHelper('loadTemplate', (id: string, condition: boolean = true, data?: any) => {\n  if (Utils.isNullOrUndefined(data)) {\n    data = resolveQueryResult();\n  }\n  if (condition) {\n    return TemplateCache.getTemplate(id).instantiateToString(data, {\n      checkCondition: false\n    });\n  }\n  return '';\n});\n\nTemplateHelpers.registerTemplateHelper('encodeCarriageReturn', (data: string) => {\n  if (Utils.isNullOrUndefined(data)) {\n    return undefined;\n  } else {\n    return StringUtils.encodeCarriageReturn(data);\n  }\n});\n\nTemplateHelpers.registerTemplateHelper('isMobileDevice', () => {\n  return DeviceUtils.isMobileDevice() ? DeviceUtils.getDeviceName() : null;\n});\n\nfunction resolveQueryResult(): IQueryResult {\n  let found;\n  let resultList = Component.getComponentRef('ResultList');\n  if (resultList) {\n    found = resultList.resultCurrentlyBeingRendered;\n  }\n  if (!found) {\n    let quickview = Component.getComponentRef('Quickview');\n    if (quickview) {\n      found = quickview.resultCurrentlyBeingRendered;\n    }\n  }\n  return found;\n}\n\nfunction resolveTermsToHighlight(): IHighlightTerm {\n  let currentQueryResult = resolveQueryResult();\n  if (currentQueryResult) {\n    return currentQueryResult.termsToHighlight;\n  }\n}\n\nfunction resolvePhrasesToHighlight(): IHighlightPhrase {\n  let currentQueryResult = resolveQueryResult();\n  if (currentQueryResult) {\n    return currentQueryResult.phrasesToHighlight;\n  }\n}\n\nfunction termsToHighlightAreDefined(termsToHighlight, phrasesToHighlight) {\n  return Utils.isNonEmptyArray(_.keys(termsToHighlight)) || Utils.isNonEmptyArray(_.keys(phrasesToHighlight));\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/CoreHelpers.ts","/**\n * The possible values for the [allowedValuesPatternType]{@link IGroupByRequest.allowedValuesPatternType} property of the `IGroupByRequest` interface.\n */\nexport enum AllowedValuesPatternType {\n  /**\n   * Only supports trailing wildcards in the pattern.\n   */\n  Legacy = 'legacy',\n  /**\n   * Fully supports wildcards.\n   */\n  Wildcards = 'wildcards',\n  /**\n   * Supports regular expression as the pattern.\n   */\n  Regex = 'regex',\n  /**\n   *Applies the Edit Distance algorithm to match values that are close to the specified pattern.\n   */\n  EditDistance = 'editdistance',\n  /**\n   *Applies a phonetic algorithm to match values that are phonetically similar to the specified pattern.\n   */\n  Phonetic = 'phonetic'\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/rest/AllowedValuesPatternType.ts","/// <reference path=\"Facet.ts\" />\nimport { Facet } from './Facet';\nimport { FacetValue } from './FacetValue';\nimport { IPopulateOmniboxObject } from '../Omnibox/OmniboxInterface';\nimport { ValueElementRenderer } from './ValueElementRenderer';\nimport { Utils } from '../../utils/Utils';\nimport { IAnalyticsActionCause, analyticsActionCauseList, IAnalyticsFacetMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { $$ } from '../../utils/Dom';\nimport { KeyboardUtils, KEYBOARD } from '../../utils/KeyboardUtils';\n\nexport interface IValueElementKlass {\n  new (facet: Facet, facetValue: FacetValue): ValueElement;\n}\n\nexport interface IValueElementEventsBinding {\n  displayNextTime: boolean;\n  pinFacet: boolean;\n  omniboxObject?: IPopulateOmniboxObject;\n}\n\nexport class ValueElement {\n  public renderer: ValueElementRenderer;\n  private isOmnibox: boolean;\n\n  constructor(\n    public facet: Facet,\n    public facetValue: FacetValue,\n    public onSelect?: (elem: ValueElement, cause: IAnalyticsActionCause) => void,\n    public onExclude?: (elem: ValueElement, cause: IAnalyticsActionCause) => void\n  ) {}\n\n  public build(): ValueElement {\n    this.renderer = new ValueElementRenderer(this.facet, this.facetValue).build();\n    this.bindEvent({ displayNextTime: true, pinFacet: this.facet.options.preservePosition });\n    return this;\n  }\n\n  public bindEvent(eventBindings: IValueElementEventsBinding) {\n    if (!Utils.isNullOrUndefined(eventBindings.omniboxObject)) {\n      this.isOmnibox = true;\n    } else {\n      this.isOmnibox = false;\n    }\n    this.handleEventForCheckboxChange(eventBindings);\n    if (this.facetValue.excluded) {\n      this.handleEventForExcludedValueElement(eventBindings);\n    } else {\n      this.handleEventForValueElement(eventBindings);\n    }\n  }\n\n  public select() {\n    this.facetValue.selected = true;\n    this.facetValue.excluded = false;\n    this.renderer.setCssClassOnListValueElement();\n  }\n\n  public unselect() {\n    this.facetValue.selected = false;\n    this.facetValue.excluded = false;\n    this.renderer.setCssClassOnListValueElement();\n  }\n\n  public exclude() {\n    this.facetValue.selected = false;\n    this.facetValue.excluded = true;\n    this.renderer.setCssClassOnListValueElement();\n  }\n\n  public unexclude() {\n    this.facetValue.selected = false;\n    this.facetValue.excluded = false;\n    this.renderer.setCssClassOnListValueElement();\n  }\n\n  public toggleExcludeWithUA() {\n    let actionCause: IAnalyticsActionCause;\n    if (this.facetValue.excluded) {\n      actionCause = this.isOmnibox ? analyticsActionCauseList.omniboxFacetUnexclude : analyticsActionCauseList.facetUnexclude;\n    } else {\n      actionCause = this.isOmnibox ? analyticsActionCauseList.omniboxFacetExclude : analyticsActionCauseList.facetExclude;\n    }\n\n    this.facet.toggleExcludeValue(this.facetValue);\n\n    if (this.onExclude) {\n      this.facet.triggerNewQuery(() => this.onExclude(this, actionCause));\n    } else {\n      this.facet.triggerNewQuery(() =>\n        this.facet.usageAnalytics.logSearchEvent<IAnalyticsFacetMeta>(actionCause, this.getAnalyticsFacetMeta())\n      );\n    }\n  }\n\n  protected handleSelectValue(eventBindings: IValueElementEventsBinding) {\n    this.facet.keepDisplayedValuesNextTime = eventBindings.displayNextTime && !this.facet.options.useAnd;\n    var actionCause: IAnalyticsActionCause;\n    if (this.facetValue.excluded) {\n      actionCause = this.isOmnibox ? analyticsActionCauseList.omniboxFacetUnexclude : analyticsActionCauseList.facetUnexclude;\n      this.facet.unexcludeValue(this.facetValue);\n    } else {\n      if (this.facetValue.selected) {\n        actionCause = this.isOmnibox ? analyticsActionCauseList.omniboxFacetDeselect : analyticsActionCauseList.facetDeselect;\n      } else {\n        actionCause = this.isOmnibox ? analyticsActionCauseList.omniboxFacetSelect : analyticsActionCauseList.facetSelect;\n      }\n      this.facet.toggleSelectValue(this.facetValue);\n    }\n    if (this.onSelect) {\n      this.facet.triggerNewQuery(() => this.onSelect(this, actionCause));\n    } else {\n      this.facet.triggerNewQuery(() =>\n        this.facet.usageAnalytics.logSearchEvent<IAnalyticsFacetMeta>(actionCause, this.getAnalyticsFacetMeta())\n      );\n    }\n  }\n\n  protected handleExcludeClick(eventBindings: IValueElementEventsBinding) {\n    this.facet.keepDisplayedValuesNextTime = eventBindings.displayNextTime && !this.facet.options.useAnd;\n    this.toggleExcludeWithUA();\n  }\n\n  protected handleSelectEventForExcludedValueElement(eventBindings: IValueElementEventsBinding) {\n    const clickEvent = () => {\n      if (eventBindings.pinFacet) {\n        this.facet.pinFacetPosition();\n      }\n      if (eventBindings.omniboxObject) {\n        this.omniboxCloseEvent(eventBindings.omniboxObject);\n      }\n      this.handleSelectValue(eventBindings);\n      this.tryDismissSearchResults();\n      return false;\n    };\n\n    $$(this.renderer.label).on('click', e => {\n      e.stopPropagation();\n      clickEvent();\n    });\n\n    $$(this.renderer.stylishCheckbox).on('keydown', KeyboardUtils.keypressAction([KEYBOARD.SPACEBAR, KEYBOARD.ENTER], clickEvent));\n  }\n\n  protected handleExcludeEventForValueElement(eventBindings: IValueElementEventsBinding) {\n    const excludeAction = (event: Event) => {\n      if (eventBindings.omniboxObject) {\n        this.omniboxCloseEvent(eventBindings.omniboxObject);\n      }\n\n      this.handleExcludeClick(eventBindings);\n\n      this.tryDismissSearchResults();\n      event.stopPropagation();\n      event.preventDefault();\n    };\n    $$(this.renderer.excludeIcon).on('click', excludeAction);\n\n    $$(this.renderer.excludeIcon).on('keydown', KeyboardUtils.keypressAction([KEYBOARD.SPACEBAR, KEYBOARD.ENTER], excludeAction));\n  }\n\n  protected handleSelectEventForValueElement(eventBindings: IValueElementEventsBinding) {\n    const selectAction = (event: Event) => {\n      if (eventBindings.pinFacet) {\n        this.facet.pinFacetPosition();\n      }\n\n      this.tryDismissSearchResults();\n      $$(this.renderer.checkbox).trigger('change');\n      event.preventDefault();\n    };\n\n    $$(this.renderer.label).on('click', selectAction);\n\n    $$(this.renderer.stylishCheckbox).on('keydown', KeyboardUtils.keypressAction([KEYBOARD.SPACEBAR, KEYBOARD.ENTER], selectAction));\n  }\n\n  protected handleEventForExcludedValueElement(eventBindings: IValueElementEventsBinding) {\n    this.handleSelectEventForExcludedValueElement(eventBindings);\n    this.handleExcludeEventForValueElement(eventBindings);\n  }\n\n  protected handleEventForValueElement(eventBindings: IValueElementEventsBinding) {\n    this.handleSelectEventForValueElement(eventBindings);\n    this.handleExcludeEventForValueElement(eventBindings);\n  }\n\n  protected handleEventForCheckboxChange(eventBindings: IValueElementEventsBinding) {\n    $$(this.renderer.checkbox).on('change', () => {\n      if (eventBindings.omniboxObject) {\n        this.omniboxCloseEvent(eventBindings.omniboxObject);\n      }\n      this.handleSelectValue(eventBindings);\n    });\n  }\n\n  protected omniboxCloseEvent(eventArg: IPopulateOmniboxObject) {\n    eventArg.closeOmnibox();\n    eventArg.clear();\n  }\n\n  private tryDismissSearchResults() {\n    if (this.facet && this.facet.facetSearch && this.facet.facetSearch.dismissSearchResults) {\n      this.facet.facetSearch.dismissSearchResults();\n    }\n  }\n\n  private getAnalyticsFacetMeta(): IAnalyticsFacetMeta {\n    return {\n      facetId: this.facet.options.id,\n      facetField: this.facet.options.field.toString(),\n      facetValue: this.facetValue.value,\n      facetTitle: this.facet.options.title\n    };\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/ValueElement.ts","import { Facet } from './Facet';\nimport { FacetValue } from './FacetValue';\nimport { $$ } from '../../utils/Dom';\nimport { Utils } from '../../utils/Utils';\nimport { l } from '../../strings/Strings';\nimport { Component } from '../Base/Component';\nimport * as _ from 'underscore';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { SVGDom } from '../../utils/SVGDom';\n\nexport class ValueElementRenderer {\n  public listItem: HTMLElement;\n  public label: HTMLElement;\n  public checkbox: HTMLElement;\n  public stylishCheckbox: HTMLElement;\n  public valueCaption: HTMLElement;\n  public valueCount: HTMLElement;\n  public icon: HTMLElement;\n  public excludeIcon: HTMLElement;\n  public computedField: HTMLElement;\n  private facetValueLabelWrapper: HTMLElement;\n\n  constructor(public facet: Facet, public facetValue: FacetValue) {}\n\n  public withNo(element: HTMLElement[]): ValueElementRenderer;\n  public withNo(element: HTMLElement): ValueElementRenderer;\n  public withNo(element: any): ValueElementRenderer {\n    if (_.isArray(element)) {\n      _.each(element, (e: HTMLElement) => {\n        if (e) {\n          $$(e).detach();\n        }\n      });\n    } else {\n      if (element) {\n        $$(element).detach();\n      }\n    }\n    return this;\n  }\n\n  public build(): ValueElementRenderer {\n    this.buildListItem();\n    this.initAndAppendLabel();\n    this.initAndAppendExcludeIcon();\n    this.setCssClassOnListValueElement();\n    this.addAccessibilityAttributesToTargetElement();\n    return this;\n  }\n\n  public setCssClassOnListValueElement(): void {\n    $$(this.listItem).toggleClass('coveo-selected', this.facetValue.selected);\n    $$(this.listItem).toggleClass('coveo-excluded', this.facetValue.excluded);\n  }\n\n  public get accessibleElement() {\n    return this.stylishCheckbox;\n  }\n\n  protected buildExcludeIcon(): HTMLElement {\n    const isExcluded = this.facetValue.excluded;\n    const excludeIcon = $$('div', {\n      ariaLabel: l('ExcludeValueWithResultCount', this.caption, l('ResultCount', this.count, parseInt(this.count, 10))),\n      className: 'coveo-facet-value-exclude',\n      tabindex: 0,\n      role: 'button',\n      ariaPressed: isExcluded.toString()\n    }).el;\n    this.addFocusAndBlurEventListeners(excludeIcon);\n    excludeIcon.innerHTML = isExcluded ? SVGIcons.icons.plus : SVGIcons.icons.checkboxHookExclusionMore;\n    SVGDom.addClassToSVGInContainer(excludeIcon, isExcluded ? 'coveo-facet-value-unexclude-svg' : 'coveo-facet-value-exclude-svg');\n    SVGDom.addAttributesToSVGInContainer(excludeIcon, { 'aria-hidden': 'true' });\n    return excludeIcon;\n  }\n\n  protected buildValueComputedField(): HTMLElement {\n    const computedField = this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat);\n    if (Utils.isNonEmptyString(computedField)) {\n      const elem = $$('span', {\n        className: 'coveo-facet-value-computed-field'\n      }).el;\n      $$(elem).text(computedField);\n      return elem;\n    } else {\n      return undefined;\n    }\n  }\n\n  protected buildValueCheckbox(): HTMLElement {\n    const checkbox = $$('input', {\n      type: 'checkbox',\n      ariaHidden: true,\n      ariaLabel: this.ariaLabel\n    }).el;\n\n    this.facetValue.selected ? checkbox.setAttribute('checked', 'checked') : checkbox.removeAttribute('checked');\n    this.facetValue.excluded ? checkbox.setAttribute('disabled', 'disabled') : checkbox.removeAttribute('disabled');\n\n    Component.pointElementsToDummyForm(checkbox);\n    return checkbox;\n  }\n\n  protected buildValueStylishCheckbox(): HTMLElement {\n    const checkbox = $$('div', {\n      className: 'coveo-facet-value-checkbox',\n      tabindex: 0\n    }).el;\n    checkbox.innerHTML = SVGIcons.icons.checkboxHookExclusionMore;\n    SVGDom.addClassToSVGInContainer(checkbox, 'coveo-facet-value-checkbox-svg');\n    this.addFocusAndBlurEventListeners(checkbox);\n    return checkbox;\n  }\n\n  protected buildValueIcon(): HTMLElement {\n    const icon = this.getValueIcon();\n    if (Utils.exists(icon)) {\n      return $$('img', {\n        className: 'coveo-facet-value-icon coveo-icon',\n        src: this.getValueIcon()\n      }).el;\n    } else {\n      return this.buildValueIconFromSprite();\n    }\n  }\n\n  protected getValueIcon(): string {\n    if (Utils.exists(this.facet.options.valueIcon)) {\n      return this.facet.options.valueIcon(this.facetValue);\n    } else {\n      return undefined;\n    }\n  }\n\n  protected buildValueIconFromSprite(): HTMLElement {\n    return $$('div', {\n      className: 'coveo-facet-value-icon coveo-icon ' + this.facet.options.field.substr(1) + ' ' + this.facetValue.value\n    }).el;\n  }\n\n  protected buildValueCaption(): HTMLElement {\n    const valueCaption = $$('span', {\n      className: 'coveo-facet-value-caption',\n      title: this.caption,\n      'data-original-value': this.facetValue.value\n    }).el;\n\n    $$(valueCaption).text(this.caption);\n    return valueCaption;\n  }\n\n  protected buildValueCount(): HTMLElement {\n    if (Utils.isNonEmptyString(this.count)) {\n      const countElement = $$('span', {\n        className: 'coveo-facet-value-count'\n      }).el;\n      $$(countElement).text(this.count);\n      return countElement;\n    } else {\n      return undefined;\n    }\n  }\n\n  private get caption() {\n    return this.facet.getValueCaption(this.facetValue);\n  }\n\n  private get count() {\n    return this.facetValue.getFormattedCount();\n  }\n\n  private addFocusAndBlurEventListeners(elem: HTMLElement) {\n    $$(elem).on('focus', () => $$(this.listItem).addClass('coveo-focused'));\n    $$(elem).on('blur', () => $$(this.listItem).removeClass('coveo-focused'));\n  }\n\n  private buildListItem() {\n    this.listItem = $$('li', { className: 'coveo-facet-value coveo-facet-selectable', ariaLabel: this.ariaLabel }).el;\n\n    if (!$$(this.listItem).canHandleEvent('touchstart')) {\n      $$(this.listItem).addClass('coveo-with-hover');\n    }\n\n    this.listItem.setAttribute('data-value', this.facetValue.value);\n  }\n\n  private initAndAppendLabel() {\n    this.label = $$('label', { className: 'coveo-facet-value-label', role: 'group' }).el;\n    this.tryToInitAndAppendComputedField();\n    this.initAndAppendFacetValueLabelWrapper();\n    this.listItem.appendChild(this.label);\n  }\n\n  private initAndAppendExcludeIcon() {\n    this.excludeIcon = this.buildExcludeIcon();\n    this.attachExcludeIconEventHandlers();\n    this.listItem.appendChild(this.excludeIcon);\n  }\n\n  private attachExcludeIconEventHandlers() {\n    $$(this.excludeIcon).on('mouseover', () => {\n      $$(this.listItem).addClass('coveo-facet-value-will-exclude');\n    });\n\n    $$(this.excludeIcon).on('mouseout', () => {\n      $$(this.listItem).removeClass('coveo-facet-value-will-exclude');\n    });\n  }\n\n  private tryToInitAndAppendComputedField() {\n    if (!Utils.exists(this.facetValue.computedField)) {\n      return;\n    }\n\n    this.computedField = this.buildValueComputedField();\n\n    if (!this.computedField) {\n      return;\n    }\n\n    this.label.appendChild(this.computedField);\n    $$(this.label).addClass('coveo-with-computed-field');\n  }\n\n  private initAndAppendFacetValueLabelWrapper() {\n    this.facetValueLabelWrapper = $$('div', { className: 'coveo-facet-value-label-wrapper' }).el;\n\n    this.initAndAppendCheckbox();\n    this.initAndAppendStylishCheckbox();\n    this.initAndAppendValueCaption();\n    this.initAndAppendValueCount();\n\n    this.label.appendChild(this.facetValueLabelWrapper);\n  }\n\n  private initAndAppendCheckbox() {\n    this.checkbox = this.buildValueCheckbox();\n    this.facetValueLabelWrapper.appendChild(this.checkbox);\n  }\n\n  private initAndAppendStylishCheckbox() {\n    this.stylishCheckbox = this.buildValueStylishCheckbox();\n    this.facetValueLabelWrapper.appendChild(this.stylishCheckbox);\n  }\n\n  private initAndAppendValueCount() {\n    this.valueCount = this.buildValueCount();\n\n    if (!this.valueCount) {\n      return;\n    }\n\n    this.facetValueLabelWrapper.appendChild(this.valueCount);\n  }\n\n  private initAndAppendValueCaption() {\n    this.valueCaption = this.buildValueCaption();\n    this.facetValueLabelWrapper.appendChild(this.valueCaption);\n  }\n\n  private addAccessibilityAttributesToTargetElement() {\n    const el = this.accessibleElement;\n    el.setAttribute('aria-label', this.ariaLabel);\n    el.setAttribute('role', 'button');\n    el.setAttribute('aria-pressed', this.ariaPressed);\n  }\n\n  private get ariaLabel() {\n    const resultCount = l('ResultCount', this.count, parseInt(this.count, 10));\n    return `${l('IncludeValueWithResultCount', this.caption, resultCount)}`;\n  }\n\n  private get ariaPressed() {\n    if (this.facetValue.excluded) {\n      return 'mixed';\n    }\n    return this.facetValue.selected ? 'true' : 'false';\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/ValueElementRenderer.ts","import { Facet } from './Facet';\nimport { FacetValue } from './FacetValue';\nimport { StringUtils } from '../../utils/StringUtils';\nimport { FacetSort } from './FacetSort';\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport * as _ from 'underscore';\n\nexport class FacetValuesOrder {\n  constructor(public facet: Facet, public facetSort: FacetSort) {}\n\n  public reorderValues(facetValues: IIndexFieldValue[]): IIndexFieldValue[];\n  public reorderValues(facetValues: FacetValue[]): FacetValue[];\n  public reorderValues(facetValues: any[]): FacetValue[] | IIndexFieldValue[] {\n    if (this.facetSort && this.facetSort.activeSort) {\n      if (this.usingCustomSort) {\n        return this.reorderValuesWithCustomOrder(facetValues);\n      }\n\n      if (this.usingAlphabeticalSort) {\n        return this.reorderValuesWithCustomCaption(facetValues);\n      }\n    }\n    return facetValues;\n  }\n\n  public reorderValuesIfUsingCustomSort(values: FacetValue[]) {\n    return this.usingCustomSort ? this.reorderValuesWithCustomOrder(values) : values;\n  }\n\n  public reorderValuesIfUsingAlphabeticalSort(values: FacetValue[]) {\n    return this.usingAlphabeticalSort ? this.reorderValuesWithCustomCaption(values) : values;\n  }\n\n  private get usingCustomSort() {\n    return this.facetSort.activeSort.name == 'custom' && this.facet.options.customSort != undefined;\n  }\n\n  private get usingAlphabeticalSort() {\n    return this.facetSort.activeSort.name.indexOf('alpha') != -1;\n  }\n\n  private reorderValuesWithCustomOrder(facetValues: FacetValue[]) {\n    let customSortsLowercase = _.map(this.facet.options.customSort, customSort => customSort.toLowerCase());\n    let valueIndexPair = _.map(facetValues, (facetValue, i) => {\n      // Get the index of the current value in the custom sort array.\n      // If it's not found, put it's index to it's original value + the length of customSort so that's always after the specified custom sort order.\n      let index = _.findIndex(customSortsLowercase, customSort => {\n        return (\n          StringUtils.equalsCaseInsensitive(<string>customSort, facetValue.value) ||\n          (facetValue.lookupValue != null && StringUtils.equalsCaseInsensitive(<string>customSort, facetValue.lookupValue))\n        );\n      });\n      if (index == -1) {\n        index = i + customSortsLowercase.length;\n      }\n      return { facetValue: facetValue, index: index };\n    });\n    let sorted = _.sortBy(valueIndexPair, 'index');\n    sorted = this.facetSort.customSortDirection == 'ascending' ? sorted : sorted.reverse();\n    return _.pluck(sorted, 'facetValue');\n  }\n\n  private reorderValuesWithCustomCaption(facetValues: FacetValue[]) {\n    let sorted = facetValues.sort((firstValue, secondValue) => {\n      return this.facet.getValueCaption(firstValue).localeCompare(this.facet.getValueCaption(secondValue), String['locale'], {\n        sensitivity: 'base'\n      });\n    });\n    if (this.facetSort.activeSort.name.indexOf('descending') != -1) {\n      sorted = sorted.reverse();\n    }\n    return sorted;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetValuesOrder.ts","import { $$, Dom } from '../../utils/Dom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { Component } from '../Base/Component';\nimport { l } from '../../strings/Strings';\nimport { EventsUtils } from '../../utils/EventsUtils';\nimport { IFacetSearch } from './IFacetSearch';\nimport { FacetSearchUserInputHandler } from './FacetSearchUserInputHandler';\nimport { uniqueId } from 'underscore';\nimport { ISearchDropdownNavigator, ISearchDropdownConfig } from './FacetSearchDropdownNavigation/DefaultSearchDropdownNavigator';\nimport { SearchDropdownNavigatorFactory } from './FacetSearchDropdownNavigation/SearchDropdownNavigatorFactory';\nimport { KEYBOARD } from '../../utils/KeyboardUtils';\n\nexport class FacetSearchElement {\n  public search: HTMLElement | undefined;\n  public magnifier: HTMLElement | undefined;\n  public wait: HTMLElement | undefined;\n  public clear: HTMLElement | undefined;\n  public input: HTMLInputElement | undefined;\n  public combobox: HTMLElement | undefined;\n  public searchBarIsAnimating: boolean = false;\n  public searchResults: HTMLElement;\n  public facetSearchUserInputHandler: FacetSearchUserInputHandler;\n\n  private triggeredScroll = false;\n  private facetSearchId = uniqueId('coveo-facet-search-results');\n  private facetValueNotFoundId = uniqueId('coveo-facet-value-not-found');\n  private searchDropdownNavigator: ISearchDropdownNavigator;\n\n  constructor(private facetSearch: IFacetSearch) {\n    this.facetSearchUserInputHandler = new FacetSearchUserInputHandler(this.facetSearch);\n    this.initSearchResults();\n  }\n\n  public build(handleFacetSearchClear?: () => void) {\n    this.search = document.createElement('div');\n    $$(this.search).addClass('coveo-facet-search');\n\n    this.magnifier = this.buildMagnifierIcon();\n    this.search.appendChild(this.magnifier);\n\n    this.wait = this.buildWaitIcon();\n    this.search.appendChild(this.wait);\n\n    this.hideFacetSearchWaitingAnimation();\n\n    this.clear = $$('div', { className: 'coveo-facet-search-clear', title: l('Clear', l('Search')) }, SVGIcons.icons.clear).el;\n    SVGDom.addClassToSVGInContainer(this.clear, 'coveo-facet-search-clear-svg');\n    this.clear.style.display = 'none';\n    this.search.appendChild(this.clear);\n\n    this.combobox = this.buildCombobox();\n    this.search.appendChild(this.combobox);\n\n    this.input = this.buildInputElement();\n    Component.pointElementsToDummyForm(this.input);\n    this.combobox.appendChild(this.input);\n\n    $$(this.input).on('keyup', (e: KeyboardEvent) => {\n      this.facetSearchUserInputHandler.handleKeyboardEvent(e);\n    });\n    $$(this.clear).on('click', (e: Event) => {\n      handleFacetSearchClear && handleFacetSearchClear();\n    });\n    $$(this.input).on('focus', (e: Event) => {\n      this.handleFacetSearchFocus();\n    });\n    $$(this.input).on('blur', (e: FocusEvent) => this.onInputBlur(e));\n\n    this.detectSearchBarAnimation();\n    this.initSearchDropdownNavigator();\n\n    return this.search;\n  }\n\n  private initSearchResults() {\n    this.searchResults = $$('ul', { id: this.facetSearchId, className: 'coveo-facet-search-results', role: 'listbox' }).el;\n    $$(this.searchResults).on('scroll', () => this.handleScrollEvent());\n    $$(this.searchResults).on('keyup', (e: KeyboardEvent) => {\n      if (e.which === KEYBOARD.ESCAPE) {\n        this.facetSearch.dismissSearchResults();\n      }\n    });\n    $$(this.searchResults).on('focusout', (event: FocusEvent) => this.onSearchResultsFocusOut(event));\n    $$(this.searchResults).hide();\n  }\n\n  private onInputBlur(e: FocusEvent) {\n    const target = e.relatedTarget as HTMLElement;\n    const isUsingKeyboard = !!target;\n    const focusedOnSearchResult = this.searchResults.contains(target);\n\n    if (isUsingKeyboard && !focusedOnSearchResult) {\n      this.facetSearch.dismissSearchResults();\n    }\n  }\n\n  private onSearchResultsFocusOut(e: FocusEvent) {\n    const target = e.relatedTarget as HTMLElement;\n    const isUsingKeyboard = !!target;\n    const focusedOnInput = this.input.contains(target);\n    const focusedOnSearchResult = this.searchResults.contains(target);\n\n    if (isUsingKeyboard && !focusedOnInput && !focusedOnSearchResult) {\n      this.facetSearch.dismissSearchResults();\n    }\n  }\n\n  private initSearchDropdownNavigator() {\n    const config: ISearchDropdownConfig = {\n      input: this.input,\n      searchResults: this.searchResults,\n      setScrollTrigger: (val: boolean) => (this.triggeredScroll = val)\n    };\n\n    this.searchDropdownNavigator = SearchDropdownNavigatorFactory(this.facetSearch, config);\n  }\n\n  private buildCombobox() {\n    return $$('div', {\n      className: 'coveo-facet-search-middle',\n      ariaHaspopup: 'listbox',\n      ariaExpanded: 'true'\n    }).el;\n  }\n\n  public showFacetSearchWaitingAnimation() {\n    this.magnifier && $$(this.magnifier).hide();\n    $$(this.wait).show();\n  }\n\n  public getValueInInputForFacetSearch() {\n    return this.input.value.trim();\n  }\n\n  public hideFacetSearchWaitingAnimation() {\n    $$(this.magnifier).show();\n    $$(this.wait).hide();\n  }\n\n  public detectSearchBarAnimation() {\n    EventsUtils.addPrefixedEvent(this.search, 'AnimationStart', event => {\n      if (event.animationName == 'grow') {\n        this.searchBarIsAnimating = true;\n      }\n    });\n\n    EventsUtils.addPrefixedEvent(this.search, 'AnimationEnd', event => {\n      if (event.animationName == 'grow') {\n        this.searchBarIsAnimating = false;\n      }\n    });\n  }\n\n  public positionSearchResults() {\n    if (this.searchResults != null) {\n      $$(this.searchResults).insertAfter(this.search);\n      $$(this.searchResults).show();\n\n      if ($$(this.searchResults).css('display') == 'none') {\n        this.searchResults.style.display = '';\n      }\n      let searchBar = $$(this.search);\n      if (searchBar.css('display') == 'none' || this.searchBarIsAnimating) {\n        if ($$(this.searchResults).css('display') == 'none') {\n          this.searchResults.style.display = '';\n        }\n        EventsUtils.addPrefixedEvent(this.search, 'AnimationEnd', () => {\n          EventsUtils.removePrefixedEvent(this.search, 'AnimationEnd', this);\n        });\n      }\n    }\n    this.addAriaAttributes();\n  }\n\n  public setAsCurrentResult(toSet: Dom) {\n    this.searchDropdownNavigator.setAsCurrentResult(toSet);\n  }\n\n  public get currentResult() {\n    return this.searchDropdownNavigator.currentResult;\n  }\n\n  public moveCurrentResultDown() {\n    this.searchDropdownNavigator.focusNextElement();\n  }\n\n  public moveCurrentResultUp() {\n    this.searchDropdownNavigator.focusPreviousElement();\n  }\n\n  public highlightCurrentQueryInSearchResults(regex: RegExp) {\n    const captions = this.facetSearch.getCaptions();\n    captions.forEach(caption => {\n      caption.innerHTML = $$(caption).text().replace(regex, '<span class=\"coveo-highlight\">$1</span>');\n    });\n  }\n\n  public appendToSearchResults(el: HTMLElement) {\n    this.searchResults.appendChild(el);\n    this.setupFacetSearchResultsEvents(el);\n  }\n\n  public emptyAndShowNoResults() {\n    $$(this.searchResults).empty();\n    this.searchResults.appendChild(\n      $$(\n        'li',\n        { id: this.facetValueNotFoundId, className: 'coveo-facet-value-not-found', role: 'option', ariaSelected: 'true', tabindex: 0 },\n        l('NoValuesFound')\n      ).el\n    );\n    this.input.setAttribute('aria-activedescendant', this.facetValueNotFoundId);\n  }\n\n  public updateAriaLiveWithResults(inputValue: string, numberOfResults: number, moreValuesToFetch: boolean) {\n    let ariaLiveText =\n      inputValue === ''\n        ? l('ShowingResults', numberOfResults, inputValue, numberOfResults)\n        : l('ShowingResultsWithQuery', numberOfResults, inputValue, numberOfResults);\n\n    if (moreValuesToFetch) {\n      ariaLiveText = `${ariaLiveText} (${l('MoreValuesAvailable')})`;\n    }\n\n    this.facetSearch.updateAriaLive(ariaLiveText);\n  }\n\n  public focus() {\n    this.input.focus();\n    this.handleFacetSearchFocus();\n  }\n\n  private handleFacetSearchFocus() {\n    if (this.facetSearch.currentlyDisplayedResults == null) {\n      this.facetSearch.displayNewValues();\n      this.addAriaAttributes();\n    }\n  }\n\n  private setupFacetSearchResultsEvents(el: HTMLElement) {\n    $$(el).on('mousemove', () => {\n      this.setAsCurrentResult($$(el));\n    });\n\n    // Prevent closing the search results on the end of a touch drag\n    let touchDragging = false;\n    let mouseDragging = false;\n    $$(el).on('mousedown', () => (mouseDragging = false));\n    $$(el).on('mousemove', () => (mouseDragging = true));\n    $$(el).on('touchmove', () => (touchDragging = true));\n\n    $$(el).on('mouseup touchend', () => {\n      if (!touchDragging && !mouseDragging) {\n        setTimeout(() => {\n          this.facetSearch.dismissSearchResults();\n        }, 0); // setTimeout is to give time to trigger the click event before hiding the search menu.\n      }\n      touchDragging = false;\n      mouseDragging = false;\n    });\n  }\n\n  public hideSearchResultsElement() {\n    this.removeAriaAttributes();\n    $$(this.searchResults).hide();\n    $$(this.searchResults).remove();\n  }\n\n  public clearSearchInput() {\n    if (this.input) {\n      this.input.value = '';\n    }\n  }\n\n  private buildMagnifierIcon() {\n    const magnifier = document.createElement('div');\n    magnifier.innerHTML = SVGIcons.icons.search;\n    $$(magnifier).addClass('coveo-facet-search-magnifier');\n    SVGDom.addClassToSVGInContainer(magnifier, 'coveo-facet-search-magnifier-svg');\n    this.search.appendChild(magnifier);\n    return magnifier;\n  }\n\n  private buildWaitIcon() {\n    const wait = document.createElement('div');\n    wait.innerHTML = SVGIcons.icons.loading;\n    $$(wait).addClass('coveo-facet-search-wait-animation');\n    SVGDom.addClassToSVGInContainer(wait, 'coveo-facet-search-wait-animation-svg');\n    return wait;\n  }\n\n  private buildInputElement() {\n    return <HTMLInputElement>$$('input', {\n      className: 'coveo-facet-search-input',\n      type: 'text',\n      autocapitalize: 'off',\n      autocorrect: 'off',\n      ariaLabel: l('SearchFacetResults', this.facetSearch.facetTitle),\n      ariaHaspopup: 'true',\n      ariaAutocomplete: 'list'\n    }).el;\n  }\n\n  private handleScrollEvent() {\n    if (this.triggeredScroll) {\n      this.triggeredScroll = false;\n    } else {\n      this.facetSearchUserInputHandler.handleFacetSearchResultsScroll();\n    }\n  }\n\n  private addAriaAttributes() {\n    if (!this.input || !this.combobox) {\n      return;\n    }\n\n    this.combobox.setAttribute('role', 'combobox');\n    this.combobox.setAttribute('aria-owns', this.facetSearchId);\n    this.input.setAttribute('aria-controls', this.facetSearchId);\n    this.input.setAttribute('aria-expanded', 'true');\n    this.facetSearch.setExpandedFacetSearchAccessibilityAttributes(this.searchResults);\n  }\n\n  private removeAriaAttributes() {\n    if (!this.input || !this.combobox) {\n      return;\n    }\n\n    this.combobox.removeAttribute('role');\n    this.combobox.removeAttribute('aria-owns');\n    this.input.removeAttribute('aria-controls');\n    this.input.removeAttribute('aria-activedescendant');\n    this.input.setAttribute('aria-expanded', 'false');\n    this.facetSearch.setCollapsedFacetSearchAccessibilityAttributes();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearchElement.ts","import { first, last } from 'underscore';\nimport { $$, Dom } from '../../../utils/Dom';\n\nexport interface ISearchDropdownNavigator {\n  focusNextElement: () => void;\n  focusPreviousElement: () => void;\n  currentResult: Dom;\n  setAsCurrentResult: (el: Dom) => void;\n}\n\nexport interface ISearchDropdownConfig {\n  input: HTMLInputElement;\n  searchResults: HTMLElement;\n  setScrollTrigger: (value: boolean) => void;\n}\n\nexport class DefaultSearchDropdownNavigator implements ISearchDropdownNavigator {\n  public currentResult: Dom;\n\n  constructor(private config: ISearchDropdownConfig) {}\n\n  public setAsCurrentResult(toSet: Dom) {\n    this.currentResult && this.currentResult.removeClass('coveo-facet-search-current-result');\n    this.currentResult = toSet;\n    toSet.addClass('coveo-facet-search-current-result');\n    this.updateSelectedOption(toSet);\n  }\n\n  public focusNextElement() {\n    this.moveCurrentResultDown();\n  }\n\n  public focusPreviousElement() {\n    this.moveCurrentResultUp();\n  }\n\n  public moveCurrentResultDown() {\n    let nextResult = this.currentResult.el.nextElementSibling;\n    if (!nextResult) {\n      nextResult = first(this.searchResults.children);\n    }\n    this.setAsCurrentResult($$(<HTMLElement>nextResult));\n    this.highlightAndShowCurrentResultWithKeyboard();\n  }\n\n  public moveCurrentResultUp() {\n    let previousResult = this.currentResult.el.previousElementSibling;\n    if (!previousResult) {\n      previousResult = last(this.searchResults.children);\n    }\n    this.setAsCurrentResult($$(<HTMLElement>previousResult));\n    this.highlightAndShowCurrentResultWithKeyboard();\n  }\n\n  private highlightAndShowCurrentResultWithKeyboard() {\n    this.currentResult.addClass('coveo-facet-search-current-result');\n    this.config.setScrollTrigger(true);\n    this.searchResults.scrollTop = this.currentResult.el.offsetTop;\n  }\n\n  private get searchResults() {\n    return this.config.searchResults;\n  }\n\n  private updateSelectedOption(option: Dom) {\n    this.config.input.setAttribute('aria-activedescendant', option.getAttribute('id'));\n\n    const previouslySelectedOption = $$(this.searchResults).find('[aria-selected^=\"true\"]');\n    previouslySelectedOption && previouslySelectedOption.setAttribute('aria-selected', 'false');\n\n    option.setAttribute('aria-selected', 'true');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearchDropdownNavigation/DefaultSearchDropdownNavigator.ts","import { Dom } from '../../utils/Dom';\nimport { CategoryFacetTemplates } from './CategoryFacetTemplates';\nimport { CategoryValue, CategoryValueParent } from './CategoryValue';\nimport { CategoryFacet } from './CategoryFacet';\nimport { ICategoryFacetValue } from '../../rest/CategoryFacetValue';\nimport { each } from 'underscore';\n\nexport class CategoryChildrenValueRenderer {\n  public children: CategoryValue[] = [];\n\n  constructor(\n    private element: Dom,\n    private categoryFacetTemplates: CategoryFacetTemplates,\n    private categoryValue: CategoryValueParent,\n    private categoryFacet: CategoryFacet\n  ) {}\n\n  public clearChildren() {\n    this.element.removeClass('coveo-active-category-facet-parent');\n    this.children.forEach(child => {\n      child.clear();\n    });\n    this.children = [];\n  }\n\n  public renderChildren(values: ICategoryFacetValue[]) {\n    each(values, value => {\n      this.renderValue(value, true).makeSelectable();\n    });\n  }\n\n  public renderAsParent(value: ICategoryFacetValue) {\n    const categoryValue = this.renderValue(value, false);\n    return categoryValue;\n  }\n\n  private renderValue(value: ICategoryFacetValue, isChild: boolean) {\n    const path = this.categoryValue.path.concat([value.value]);\n    const categoryValueDescriptor = {\n      value: value.value,\n      count: value.numberOfResults,\n      path\n    };\n    const categoryValue = new CategoryValue(\n      this.categoryValue.listRoot,\n      categoryValueDescriptor,\n      this.categoryFacetTemplates,\n      this.categoryFacet\n    );\n    categoryValue.render(isChild);\n    this.children.push(categoryValue);\n    return categoryValue;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryValueChildrenRenderer.ts","import Popper from 'popper.js';\nimport 'styling/_FacetSettings';\nimport { compact, contains, each, escape, filter, find, findWhere, map } from 'underscore';\nimport { InitializationEvents } from '../../events/InitializationEvents';\nimport { QueryStateModel } from '../../models/QueryStateModel';\nimport { l } from '../../strings/Strings';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\nimport { $$ } from '../../utils/Dom';\nimport { KEYBOARD, KeyboardUtils } from '../../utils/KeyboardUtils';\nimport { LocalStorageUtils } from '../../utils/LocalStorageUtils';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { Utils } from '../../utils/Utils';\nimport { analyticsActionCauseList, IAnalyticsFacetMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { Facet } from './Facet';\nimport { FacetSort, IFacetSortDescription } from './FacetSort';\n\nexport interface IFacetSettingsKlass {\n  new (sorts: string[], facet: Facet): FacetSettings;\n}\n\nexport interface IFacetState {\n  included: string[];\n  excluded: string[];\n  operator: string;\n}\n\n/**\n * Handle the rendering of the {@link Facet} settings menu (typically the ... in the facet header).\n */\nexport class FacetSettings extends FacetSort {\n  public loadedFromSettings: { [attribute: string]: any };\n  public settingsButton: HTMLElement;\n  public settingsPopup: HTMLElement;\n\n  private facetStateLocalStorage: LocalStorageUtils<IFacetState>;\n  private includedStateAttribute: string;\n  private excludedStateAttribute: string;\n  private operatorStateAttribute: string;\n  private directionSection: HTMLElement[];\n  private saveStateSection: HTMLElement;\n  private clearStateSection: HTMLElement;\n  private hideSection: HTMLElement;\n  private showSection: HTMLElement;\n  private sortSection: { element: HTMLElement; sortItems: HTMLElement[] };\n  private customSortDirectionChange = false;\n  private onDocumentClick = () => this.close();\n  private closeTimeout: number;\n  private enabledSortsIgnoreRenderBecauseOfPairs: IFacetSortDescription[] = [];\n\n  private get isExpanded() {\n    return this.settingsButton && this.settingsButton.getAttribute('aria-expanded') === `${true}`;\n  }\n\n  private set isExpanded(expanded: boolean) {\n    this.settingsButton.setAttribute('aria-expanded', `${expanded}`);\n  }\n\n  private get firstFocusablePopupElement() {\n    return find($$(this.settingsPopup).findAll('[tabindex]'), element => element.tabIndex >= 0);\n  }\n\n  constructor(public sorts: string[], public facet: Facet) {\n    super(sorts, facet);\n    this.filterDuplicateForRendering();\n  }\n\n  /**\n   * Build the menu, hook click events.\n   * @returns {HTMLElement}\n   */\n  public build() {\n    this.buildSettingsButton();\n    this.buildSettingsPopup();\n\n    if (Utils.isNonEmptyArray(this.enabledSorts)) {\n      this.sortSection = this.buildSortSection();\n      if (this.enabledSortsAllowDirection()) {\n        this.directionSection = this.buildDirectionSection();\n      }\n    }\n    if (this.facet.options.enableSettingsFacetState) {\n      this.saveStateSection = this.buildSaveStateSection();\n      this.clearStateSection = this.buildClearStateSection();\n    }\n    if (this.facet.options.enableCollapse) {\n      this.hideSection = this.buildHideSection();\n      this.showSection = this.buildShowSection();\n    }\n\n    const appendCommon = () => {\n      this.appendIfNotUndefined(this.saveStateSection);\n      this.appendIfNotUndefined(this.clearStateSection);\n      this.appendIfNotUndefined(this.hideSection);\n      this.appendIfNotUndefined(this.showSection);\n    };\n\n    this.addOnDocumentClickHandler();\n    this.addOnNukeHandler();\n\n    if (Utils.isNonEmptyArray(this.enabledSorts)) {\n      this.settingsPopup.appendChild(this.sortSection.element);\n      each(this.directionSection, d => {\n        this.appendIfNotUndefined(d);\n      });\n      appendCommon();\n    } else {\n      appendCommon();\n    }\n    return this.settingsButton;\n  }\n\n  /**\n   * Restore the facet state from local storage, and apply it in the query state model.\n   */\n  public loadSavedState() {\n    if (this.facetStateLocalStorage) {\n      // set the state from the settings only if there is nothing\n      // in the query state model for the current facet\n      const state = this.facetStateLocalStorage.load();\n      const currentStateIncluded = this.facet.queryStateModel.get(this.includedStateAttribute);\n      const currentStateExcluded = this.facet.queryStateModel.get(this.excludedStateAttribute);\n      const currentStateOperator = this.facet.queryStateModel.get(this.operatorStateAttribute);\n      if (\n        !Utils.isNullOrUndefined(state) &&\n        Utils.isEmptyArray(currentStateIncluded) &&\n        Utils.isEmptyArray(currentStateExcluded) &&\n        !Utils.isNonEmptyString(currentStateOperator)\n      ) {\n        const toSet: { [key: string]: any } = {};\n        toSet[this.includedStateAttribute] = state.included;\n        toSet[this.excludedStateAttribute] = state.excluded;\n        toSet[this.operatorStateAttribute] = state.operator;\n        this.facet.queryStateModel.setMultiple(toSet);\n        this.loadedFromSettings = toSet;\n      }\n    } else {\n      this.facet.logger.info('Facet state local storage not enabled : See Facet.options.enableSettingsFacetState');\n    }\n  }\n\n  /**\n   * Take the current state of the facet and save it in the local storage.\n   */\n  public saveState() {\n    if (this.facetStateLocalStorage) {\n      this.facetStateLocalStorage.save({\n        included: this.facet.queryStateModel.get(this.includedStateAttribute),\n        excluded: this.facet.queryStateModel.get(this.excludedStateAttribute),\n        operator: this.facet.queryStateModel.get(this.operatorStateAttribute)\n      });\n    } else {\n      this.facet.logger.info('Facet state local storage not enabled : See Facet.options.enableSettingsFacetState');\n    }\n  }\n\n  /**\n   * Close the settings menu\n   */\n  public close() {\n    if (!this.isExpanded) {\n      return;\n    }\n    this.isExpanded = false;\n    $$(this.settingsPopup).detach();\n  }\n\n  /**\n   * Open the settings menu\n   */\n  public open() {\n    $$(this.settingsPopup).insertAfter(this.settingsButton);\n    new Popper(this.settingsButton, this.settingsPopup);\n\n    this.isExpanded = true;\n\n    if (this.hideSection && this.showSection) {\n      $$(this.hideSection).toggle(!$$(this.facet.element).hasClass('coveo-facet-collapsed'));\n      $$(this.showSection).toggle($$(this.facet.element).hasClass('coveo-facet-collapsed'));\n    }\n\n    if (this.facet.options.enableSettingsFacetState) {\n      $$(this.clearStateSection).toggle(!Utils.isNullOrUndefined(this.facetStateLocalStorage.load()));\n    }\n\n    each(this.enabledSorts, (criteria: IFacetSortDescription, i) => {\n      if (this.activeSort.name == criteria.name.toLowerCase()) {\n        this.selectItem(this.getSortItem(criteria.name));\n      } else {\n        this.unselectItem(this.getSortItem(criteria.name));\n      }\n    });\n\n    const elementToFocus = this.firstFocusablePopupElement;\n    if (elementToFocus) {\n      elementToFocus.focus();\n    }\n  }\n\n  public getSortItem(sortName: string): HTMLElement {\n    return find(this.sortSection.sortItems, sortItem => {\n      return $$(sortItem).getAttribute('data-sort-name').toLowerCase() == sortName.replace('ascending|descending', '').toLowerCase();\n    });\n  }\n\n  public get button() {\n    return this.settingsButton;\n  }\n\n  private buildSettingsButton() {\n    this.settingsButton = $$('div', { className: 'coveo-facet-header-settings', 'aria-haspopup': 'true' }).el;\n    this.settingsButton.innerHTML = SVGIcons.icons.more;\n    SVGDom.addClassToSVGInContainer(this.settingsButton, 'coveo-facet-settings-more-svg');\n\n    this.hideElementOnMouseEnterLeave(this.settingsButton);\n\n    this.isExpanded = false;\n\n    new AccessibleButton()\n      .withElement(this.settingsButton)\n      .withLabel(l('Settings'))\n      .withClickAction(e => this.handleSettingsButtonClick(e))\n      .withEnterKeyboardAction(e => this.handleSettingsButtonClick(e))\n      .build();\n  }\n\n  private hideElementOnMouseEnterLeave(el: HTMLElement) {\n    const mouseLeave = () => (this.closeTimeout = window.setTimeout(() => this.close(), 300));\n    const mouseEnter = () => clearTimeout(this.closeTimeout);\n\n    $$(el).on('mouseleave', mouseLeave);\n    $$(el).on('mouseenter', mouseEnter);\n    $$(el).on(\n      'keyup',\n      KeyboardUtils.keypressAction(KEYBOARD.ESCAPE, () => this.handleKeyboardClose())\n    );\n  }\n\n  private handleKeyboardClose() {\n    this.close();\n    this.settingsButton.focus();\n  }\n\n  private buildSettingsPopup() {\n    this.settingsPopup = $$('div', { className: 'coveo-facet-settings-popup' }).el;\n    this.hideElementOnMouseEnterLeave(this.settingsPopup);\n    $$(this.settingsPopup).on('focusout', (e: FocusEvent) => {\n      if (e.relatedTarget && this.settingsPopup.contains(e.relatedTarget as Node)) {\n        return;\n      }\n      this.close();\n    });\n  }\n\n  private buildSortSection() {\n    const sortSection = this.buildSection('coveo-facet-settings-section-sort');\n    const sortSectionIcon = this.buildIcon('coveo-facet-settings-section-sort-svg', SVGIcons.icons.sort);\n    const sortSectionItems = this.buildItems();\n\n    const sortTitle = document.createElement('div');\n    $$(sortTitle).addClass('coveo-facet-settings-section-sort-title');\n    $$(sortTitle).text(l('SortBy') + ' :');\n    sortSectionItems.appendChild(sortTitle);\n\n    const sortItems = this.buildSortSectionItems();\n    each(sortItems, s => {\n      sortSectionItems.appendChild(s);\n    });\n    sortSection.appendChild(sortSectionIcon);\n    sortSection.appendChild(sortSectionItems);\n    return { element: sortSection, sortItems: sortItems };\n  }\n\n  private buildSortSectionItems() {\n    let elems = map(this.enabledSorts, enabledSort => {\n      if (contains(this.enabledSortsIgnoreRenderBecauseOfPairs, enabledSort)) {\n        return undefined;\n      } else {\n        const elem = this.buildItem(l(enabledSort.label), enabledSort.description);\n        $$(elem).setAttribute('data-sort-name', enabledSort.name.toLowerCase().replace('ascending|descending', ''));\n\n        new AccessibleButton()\n          .withElement(elem)\n          .withSelectAction((e: Event) => this.handleClickSortButton(e, enabledSort))\n          .withLabel(enabledSort.label)\n          .build();\n\n        return elem;\n      }\n    });\n    elems = compact(elems);\n    return elems;\n  }\n\n  private closePopupAndUpdateSort() {\n    this.close();\n    if (this.activeSort.name != 'custom') {\n      this.facet.updateSort(this.activeSort.name);\n    } else {\n      this.facet.updateSort('nosort');\n      if (this.customSortDirectionChange) {\n        this.customSortDirectionChange = false;\n        this.facet.queryController.executeQuery();\n      }\n    }\n  }\n\n  private enabledSortsAllowDirection() {\n    const allEnabledSortsWithPossibleDirectionToggle = filter(this.enabledSorts, (facetSortDescription: IFacetSortDescription) => {\n      return facetSortDescription.directionToggle;\n    });\n    const allowToggle = filter(allEnabledSortsWithPossibleDirectionToggle, possibleDirectionToggle => {\n      return findWhere(this.enabledSorts, { name: possibleDirectionToggle.relatedSort }) != undefined;\n    });\n    return allowToggle.length > 0;\n  }\n\n  private buildDirectionSection() {\n    const directionAscendingSection = this.buildAscendingOrDescendingSection('Ascending');\n    const iconAscending = this.buildIcon('coveo-facet-settings-section-direction-ascending-svg', SVGIcons.icons.ascending);\n    const iconDescending = this.buildIcon('coveo-facet-settings-section-direction-descending-svg', SVGIcons.icons.descending);\n    const directionItemsAscending = this.buildItems();\n    const ascending = this.buildAscendingOrDescending('Ascending');\n\n    directionItemsAscending.appendChild(ascending);\n    directionAscendingSection.appendChild(iconAscending);\n    directionAscendingSection.appendChild(directionItemsAscending);\n    new AccessibleButton()\n      .withElement(ascending)\n      .withoutLabelOrTitle()\n      .withSelectAction(() => this.handleDirectionClick(ascending, 'ascending'))\n      .build();\n    this.unselectSection(directionAscendingSection);\n\n    const directionDescendingSection = this.buildAscendingOrDescendingSection('Descending');\n    const directionItemsDescending = this.buildItems();\n    const descending = this.buildAscendingOrDescending('Descending');\n\n    directionItemsDescending.appendChild(descending);\n    directionDescendingSection.appendChild(iconDescending);\n    directionDescendingSection.appendChild(directionItemsDescending);\n    new AccessibleButton()\n      .withElement(descending)\n      .withoutLabelOrTitle()\n      .withSelectAction(() => this.handleDirectionClick(descending, 'descending'))\n      .build();\n    this.unselectSection(directionDescendingSection);\n\n    if (!this.activeSort.directionToggle) {\n      $$(directionAscendingSection).addClass('coveo-facet-settings-disabled');\n      $$(directionDescendingSection).addClass('coveo-facet-settings-disabled');\n    } else {\n      this.selectItem(this.getItems(directionAscendingSection)[0]);\n    }\n    return [directionAscendingSection, directionDescendingSection];\n  }\n\n  private buildSaveStateSection() {\n    const saveStateSection = this.buildSection('coveo-facet-settings-section-save-state');\n    const icon = this.buildIcon('coveo-facet-settings-section-save-state-svg', SVGIcons.icons.dropdownMore);\n    const saveStateItems = this.buildItems();\n\n    this.facetStateLocalStorage = new LocalStorageUtils<IFacetState>('facet-state-' + this.facet.options.id);\n    this.includedStateAttribute = QueryStateModel.getFacetId(this.facet.options.id);\n    this.excludedStateAttribute = QueryStateModel.getFacetId(this.facet.options.id, false);\n    this.operatorStateAttribute = QueryStateModel.getFacetOperator(this.facet.options.id);\n\n    const saveStateItem = document.createElement('div');\n    $$(saveStateItem).addClass('coveo-facet-settings-item');\n    saveStateItem.setAttribute('title', l('SaveFacetState'));\n    $$(saveStateItem).text(l('SaveFacetState'));\n    saveStateItems.appendChild(saveStateItem);\n\n    saveStateSection.appendChild(icon);\n    saveStateSection.appendChild(saveStateItems);\n    new AccessibleButton()\n      .withElement(saveStateSection)\n      .withSelectAction(() => this.handleSaveStateClick())\n      .withoutLabelOrTitle()\n      .build();\n\n    return saveStateSection;\n  }\n\n  private buildClearStateSection() {\n    const clearStateSection = this.buildSection('coveo-facet-settings-section-clear-state');\n    const icon = this.buildIcon('coveo-facet-settings-section-clear-state-svg', SVGIcons.icons.dropdownLess);\n    const clearStateItems = this.buildItems();\n    const clearStateItem = this.buildItem(l('ClearFacetState'));\n    clearStateItems.appendChild(clearStateItem);\n    clearStateSection.appendChild(icon);\n    clearStateSection.appendChild(clearStateItems);\n    new AccessibleButton()\n      .withElement(clearStateSection)\n      .withSelectAction(() => this.handleClearStateClick())\n      .withoutLabelOrTitle()\n      .build();\n\n    return clearStateSection;\n  }\n\n  private buildHideSection() {\n    const hideSection = this.buildSection('coveo-facet-settings-section-hide');\n    const icon = this.buildIcon('coveo-facet-settings-section-hide-svg', SVGIcons.icons.facetCollapse);\n    const hideItems = this.buildItems();\n    const hideItem = this.buildItem(l('Collapse'));\n    hideItems.appendChild(hideItem);\n\n    hideSection.appendChild(icon);\n    hideSection.appendChild(hideItems);\n    new AccessibleButton()\n      .withElement(hideSection)\n      .withSelectAction(() => {\n        this.facet.facetHeader.collapseFacet();\n        this.close();\n      })\n      .withLabel(l('CollapseFacet', this.facet.options.title))\n      .build();\n\n    return hideSection;\n  }\n\n  private buildShowSection() {\n    const showSection = this.buildSection('coveo-facet-settings-section-show');\n    const icon = this.buildIcon('coveo-facet-settings-section-show-svg', SVGIcons.icons.facetExpand);\n    const showItems = this.buildItems();\n    const showItem = this.buildItem(l('Expand'));\n    showItems.appendChild(showItem);\n\n    showSection.appendChild(icon);\n    showSection.appendChild(showItems);\n\n    new AccessibleButton()\n      .withElement(showSection)\n      .withSelectAction(() => {\n        this.facet.facetHeader.expandFacet();\n        this.close();\n      })\n      .withLabel(l('ExpandFacet', this.facet.options.title))\n      .build();\n\n    return showSection;\n  }\n\n  private buildIcon(iconClass?: string, svgIcon?: string) {\n    if (iconClass && svgIcon) {\n      const icon = $$('div', { className: 'coveo-icon-container' }, svgIcon);\n      SVGDom.addClassToSVGInContainer(icon.el, iconClass);\n      return icon.el;\n    } else {\n      return $$('div', { className: 'coveo-icon' }).el;\n    }\n  }\n\n  private buildAscendingOrDescending(direction: string) {\n    const elem = this.buildItem(l(direction));\n    elem.setAttribute('aria-disabled', 'true');\n    elem.setAttribute('data-direction', direction.toLowerCase());\n    return elem;\n  }\n\n  private buildAscendingOrDescendingSection(direction: string) {\n    return this.buildSection('coveo-facet-settings-section-direction-' + direction.toLowerCase());\n  }\n\n  private buildItem(label: string, title = label) {\n    return $$(\n      'div',\n      {\n        className: 'coveo-facet-settings-item',\n        title: title\n      },\n      escape(label)\n    ).el;\n  }\n\n  private buildItems() {\n    const elem = document.createElement('div');\n    $$(elem).addClass('coveo-facet-settings-items');\n    return elem;\n  }\n\n  private buildSection(className: string) {\n    const section = document.createElement('div');\n    $$(section).addClass(['coveo-facet-settings-section', className]);\n    return section;\n  }\n\n  private handleSettingsButtonClick(event: Event) {\n    event.stopPropagation();\n    const settingsPopupIsOpen = !Utils.isNullOrUndefined(this.settingsPopup.parentElement);\n    settingsPopupIsOpen ? this.close() : this.open();\n  }\n\n  private handleClickSortButton(e: Event, enabledSort: IFacetSortDescription) {\n    if (this.activeSort != enabledSort && this.activeSort.relatedSort != enabledSort.name) {\n      this.activeSort = enabledSort;\n      if (enabledSort.directionToggle && contains(this.enabledSorts, FacetSettings.availableSorts[this.activeSort.relatedSort])) {\n        this.activateDirectionSection();\n      } else {\n        this.disableDirectionSection();\n      }\n      this.unselectSection(this.sortSection.element);\n      this.selectItem(<HTMLElement>e.target);\n      this.closePopupAndUpdateSort();\n    }\n  }\n\n  private handleDirectionClick(item: HTMLElement, direction: string) {\n    if (item.getAttribute('aria-disabled') === 'false' && this.activeSort.name.indexOf(direction) === -1) {\n      this.activeSort = FacetSettings.availableSorts[this.activeSort.relatedSort];\n      each(this.directionSection, d => {\n        this.unselectSection(d);\n      });\n      this.selectItem(item);\n      if (this.activeSort.name == 'custom' && this.customSortDirection != direction) {\n        this.customSortDirection = direction;\n        this.customSortDirectionChange = true;\n      }\n      this.closePopupAndUpdateSort();\n    }\n  }\n\n  private handleSaveStateClick() {\n    this.saveState();\n    this.close();\n  }\n\n  private handleClearStateClick() {\n    this.facetStateLocalStorage.remove();\n    this.facet.reset();\n    this.close();\n    this.facet.triggerNewQuery(() =>\n      this.facet.usageAnalytics.logSearchEvent<IAnalyticsFacetMeta>(analyticsActionCauseList.facetClearAll, {\n        facetId: this.facet.options.id,\n        facetField: this.facet.options.field.toString(),\n        facetTitle: this.facet.options.title\n      })\n    );\n  }\n\n  private addOnNukeHandler() {\n    $$(this.facet.root).on(InitializationEvents.nuke, () => this.handleNuke());\n  }\n\n  private addOnDocumentClickHandler() {\n    document.addEventListener('click', () => this.onDocumentClick());\n  }\n\n  public getCurrentDirectionItem(directionSection = this.directionSection) {\n    let found: HTMLElement;\n    each(directionSection, direction => {\n      if (!found) {\n        found = find(this.getItems(direction), (direction: HTMLElement) => {\n          return this.activeSort.name.indexOf(direction.getAttribute('data-direction')) != -1;\n        });\n      }\n    });\n    if (!found) {\n      found = directionSection[0];\n    }\n    return found;\n  }\n\n  private activateDirectionSection() {\n    each(this.directionSection, direction => {\n      $$(direction).removeClass('coveo-facet-settings-disabled');\n      $$(direction).find('.coveo-facet-settings-item').setAttribute('aria-disabled', 'false');\n      this.unselectSection(direction);\n    });\n    this.selectItem(this.getCurrentDirectionItem());\n  }\n\n  private disableDirectionSection() {\n    each(this.directionSection, direction => {\n      $$(direction).addClass('coveo-facet-settings-disabled');\n      $$(direction).find('.coveo-facet-settings-item').setAttribute('aria-disabled', 'true');\n      this.unselectSection(direction);\n    });\n  }\n\n  private getItems(section: HTMLElement) {\n    return $$(section).findAll('.coveo-facet-settings-item');\n  }\n\n  private unselectSection(section: HTMLElement) {\n    each(this.getItems(section), i => this.unselectItem(i));\n  }\n\n  private selectItem(item: HTMLElement) {\n    if (item) {\n      $$(item).addClass('coveo-selected');\n      item.setAttribute('aria-pressed', 'true');\n    }\n  }\n\n  private unselectItem(item: HTMLElement) {\n    if (item) {\n      $$(item).removeClass('coveo-selected');\n      item.setAttribute('aria-pressed', 'false');\n    }\n  }\n\n  private filterDuplicateForRendering() {\n    each(this.enabledSorts, (enabledSort: IFacetSortDescription, i: number) => {\n      if (enabledSort.relatedSort != null) {\n        for (let j = i + 1; j < this.enabledSorts.length; j++) {\n          if (this.enabledSorts[j].name == enabledSort.relatedSort) {\n            this.enabledSortsIgnoreRenderBecauseOfPairs.push(this.enabledSorts[j]);\n            break;\n          }\n        }\n      }\n    });\n  }\n\n  private appendIfNotUndefined(toAppend: HTMLElement) {\n    if (!Utils.isNullOrUndefined(toAppend)) {\n      this.settingsPopup.appendChild(toAppend);\n    }\n  }\n\n  private handleNuke() {\n    document.removeEventListener('click', this.onDocumentClick);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSettings.ts","/// <reference path=\"Facet.ts\" />\n/// <reference path=\"FacetSettings.ts\" />\nimport { Facet } from './Facet';\nimport { l } from '../../strings/Strings';\nimport { FacetSettings } from './FacetSettings';\nimport { Utils } from '../../utils/Utils';\nimport * as _ from 'underscore';\n\ndeclare const Coveo;\n\nexport interface IFacetSortKlass {\n  new (sorts: string[], facet: Facet): FacetSort;\n}\n\nexport interface IFacetSortDescription {\n  label: string;\n  directionToggle: boolean;\n  description: string;\n  name: string;\n  relatedSort?: string;\n}\n\nexport class FacetSort {\n  public static availableSorts: { [name: string]: IFacetSortDescription } = {\n    score: {\n      label: l('Score'),\n      directionToggle: false,\n      description: l('ScoreDescription'),\n      name: 'score'\n    },\n    occurrences: {\n      label: l('Occurrences'),\n      directionToggle: false,\n      description: l('OccurrencesDescription'),\n      name: 'occurrences'\n    },\n    alphaascending: {\n      label: l('Label'),\n      directionToggle: true,\n      description: l('LabelDescription'),\n      name: 'alphaascending',\n      relatedSort: 'alphadescending'\n    },\n    alphadescending: {\n      label: l('Label'),\n      directionToggle: true,\n      description: l('LabelDescription'),\n      name: 'alphadescending',\n      relatedSort: 'alphaascending'\n    },\n    computedfieldascending: {\n      label: l('Value'),\n      directionToggle: true,\n      description: l('ValueDescription'),\n      name: 'computedfieldascending',\n      relatedSort: 'computedfielddescending'\n    },\n    computedfielddescending: {\n      label: l('Value'),\n      directionToggle: true,\n      description: l('ValueDescription'),\n      name: 'computedfielddescending',\n      relatedSort: 'computedfieldascending'\n    },\n    chisquare: {\n      label: l('RelativeFrequency'),\n      directionToggle: false,\n      description: l('RelativeFrequencyDescription'),\n      name: 'chisquare'\n    },\n    nosort: {\n      label: l('Nosort'),\n      directionToggle: false,\n      description: l('NosortDescription'),\n      name: 'nosort'\n    },\n    custom: {\n      label: l('Custom'),\n      directionToggle: true,\n      description: l('CustomDescription'),\n      name: 'custom',\n      relatedSort: 'custom'\n    }\n  };\n\n  public enabledSorts: IFacetSortDescription[] = [];\n  public activeSort: IFacetSortDescription;\n  public customSortDirection = 'ascending';\n\n  constructor(sorts: string[], public facet: Facet) {\n    _.each(sorts, sortToActivate => {\n      var newSortToEnable = FacetSettings.availableSorts[sortToActivate.toLowerCase()];\n      if (newSortToEnable != undefined) {\n        this.enabledSorts.push(newSortToEnable);\n      }\n    });\n    this.removeEnabledSortsBasedOnFacetType();\n    if (Utils.isNonEmptyArray(this.enabledSorts)) {\n      if (this.facet.options.sortCriteria != undefined) {\n        this.activeSort = _.find<IFacetSortDescription>(this.enabledSorts, enabledSort => {\n          return enabledSort.name == this.facet.options.sortCriteria;\n        });\n      }\n      if (!this.activeSort) {\n        this.activeSort = this.enabledSorts[0];\n      }\n    }\n  }\n\n  private removeEnabledSortsBasedOnFacetType() {\n    if (Coveo.FacetRange && this.facet instanceof Coveo.FacetRange) {\n      var facetRange = this.facet;\n      if (facetRange.options['slider']) {\n        this.enabledSorts = [];\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSort.ts","import FacetSliderModuleDefinition = require('../FacetSlider/FacetSlider');\nimport FacetModuleDefinition = require('./Facet');\nimport { IFacetSettingsKlass, FacetSettings } from './FacetSettings';\nimport { IFacetSortKlass, FacetSort } from './FacetSort';\nimport { $$ } from '../../utils/Dom';\nimport { l } from '../../strings/Strings';\nimport { IAnalyticsFacetOperatorMeta, IAnalyticsFacetMeta, analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\nimport 'styling/_FacetHeader';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\n\nexport interface IFacetHeaderOptions {\n  facetElement: HTMLElement;\n  facet?: FacetModuleDefinition.Facet;\n  title: string;\n  field: string;\n  enableClearElement: boolean;\n  enableCollapseElement: boolean;\n  icon?: string;\n  facetSlider?: FacetSliderModuleDefinition.FacetSlider;\n  settingsKlass?: IFacetSettingsKlass;\n  sortKlass?: IFacetSortKlass;\n  availableSorts?: string[];\n}\n\nexport class FacetHeader {\n  public element: HTMLElement;\n  public iconElement: HTMLElement;\n  public waitElement: HTMLElement;\n  public collapseElement: HTMLElement;\n  public expandElement: HTMLElement;\n  public operatorElement: HTMLElement;\n  public eraserElement: HTMLElement;\n  public settings: FacetSettings;\n  public sort: FacetSort;\n\n  constructor(public options: IFacetHeaderOptions) {\n    this.element = document.createElement('div');\n    $$(this.element).addClass('coveo-facet-header');\n  }\n\n  public build(): HTMLElement {\n    let titleSection = $$('div', {\n      className: 'coveo-facet-header-title-section'\n    });\n    if (this.options.icon != undefined) {\n      this.iconElement = this.buildIcon();\n      titleSection.append(this.iconElement);\n    }\n    titleSection.append(this.buildTitle());\n    this.waitElement = this.buildWaitAnimation();\n    titleSection.append(this.waitElement);\n    this.element.appendChild(titleSection.el);\n\n    let settingsSection = $$('div', {\n      className: 'coveo-facet-header-settings-section'\n    });\n\n    this.eraserElement = this.buildEraser();\n    settingsSection.append(this.eraserElement);\n\n    if (this.options.facet) {\n      this.operatorElement = this.buildOperatorToggle();\n      settingsSection.append(this.operatorElement);\n      $$(this.operatorElement).toggle(this.options.facet.options.enableTogglingOperator);\n    }\n\n    if (this.options.settingsKlass) {\n      this.sort = this.settings = new this.options.settingsKlass(this.options.availableSorts, this.options.facet);\n      settingsSection.append(this.settings.build());\n    } else if (this.options.sortKlass) {\n      this.sort = new this.options.sortKlass(this.options.availableSorts, this.options.facet);\n    }\n    this.element.appendChild(settingsSection.el);\n\n    return this.element;\n  }\n\n  public switchToAnd(): void {\n    if (this.options.facet) {\n      this.options.facet.options.useAnd = true;\n      this.rebuildOperatorToggle();\n      this.updateOperatorQueryStateModel();\n    }\n  }\n\n  public switchToOr(): void {\n    if (this.options.facet) {\n      this.options.facet.options.useAnd = false;\n      this.rebuildOperatorToggle();\n      this.updateOperatorQueryStateModel();\n    }\n  }\n\n  public collapseFacet(): void {\n    if (this.collapseElement && this.expandElement) {\n      $$(this.collapseElement).hide();\n      $$(this.expandElement).show();\n    }\n    $$(this.options.facetElement).addClass('coveo-facet-collapsed');\n  }\n\n  public expandFacet(): void {\n    if (this.collapseElement && this.expandElement) {\n      $$(this.expandElement).hide();\n      $$(this.collapseElement).show();\n    }\n    $$(this.options.facetElement).removeClass('coveo-facet-collapsed');\n  }\n\n  public updateOperatorQueryStateModel(): void {\n    if (this.options.facet && this.options.facet.options.enableTogglingOperator) {\n      let valueToSet = '';\n      if (this.options.facet.getSelectedValues().length != 0 || this.options.facet.getExcludedValues().length != 0) {\n        valueToSet = this.options.facet.options.useAnd ? 'and' : 'or';\n      }\n      this.options.facet.queryStateModel.set(this.options.facet.operatorAttributeId, valueToSet);\n    }\n  }\n\n  private rebuildOperatorToggle(): void {\n    const newElement = this.buildOperatorToggle();\n    if (this.operatorElement) {\n      $$(this.operatorElement).replaceWith(newElement);\n    }\n    this.operatorElement = newElement;\n  }\n\n  private buildIcon(): HTMLElement {\n    let cssClassForIcon;\n    if (this.options.icon) {\n      cssClassForIcon = 'coveo-icon-custom ' + this.options.icon;\n    } else {\n      cssClassForIcon = 'coveo-icon ' + this.options.field.substr(1);\n    }\n    this.iconElement = document.createElement('div');\n    $$(this.iconElement).addClass(cssClassForIcon);\n    return this.iconElement;\n  }\n\n  private buildWaitAnimation(): HTMLElement {\n    this.waitElement = $$('div', { className: 'coveo-facet-header-wait-animation' }, SVGIcons.icons.loading).el;\n    SVGDom.addClassToSVGInContainer(this.waitElement, 'coveo-facet-header-wait-animation-svg');\n    this.waitElement.style.visibility = 'hidden';\n    return this.waitElement;\n  }\n\n  private buildOperatorToggle(): HTMLElement {\n    const label = l('SwitchTo', this.options.facet.options.useAnd ? l('Or') : l('And'));\n    const icon = $$('span', { className: 'coveo-' + (this.options.facet.options.useAnd ? 'and' : 'or') }, SVGIcons.icons.orAnd);\n    SVGDom.addClassToSVGInContainer(icon.el, 'coveo-or-and-svg');\n    const toggle = $$('div', {\n      className: 'coveo-facet-header-operator',\n      title: label\n    });\n    toggle.append(icon.el);\n\n    new AccessibleButton()\n      .withElement(toggle)\n      .withLabel(label)\n      .withSelectAction(() => this.handleOperatorClick())\n      .build();\n\n    return toggle.el;\n  }\n\n  private handleOperatorClick(): void {\n    if (this.options.facet.options.useAnd) {\n      this.options.facet.switchToOr();\n    } else {\n      this.options.facet.switchToAnd();\n    }\n    if (this.options.facet.getSelectedValues().length != 0) {\n      const operatorNow = this.options.facet.options.useAnd ? 'AND' : 'OR';\n      const operatorBefore = this.options.facet.options.useAnd ? 'OR' : 'AND';\n      this.options.facet.triggerNewQuery(() =>\n        this.options.facet.usageAnalytics.logSearchEvent<IAnalyticsFacetOperatorMeta>(analyticsActionCauseList.facetToggle, {\n          facetId: this.options.facet.options.id,\n          facetField: this.options.field.toString(),\n          facetOperatorBefore: operatorBefore,\n          facetOperatorAfter: operatorNow,\n          facetTitle: this.options.title\n        })\n      );\n    }\n  }\n\n  private buildTitle(): HTMLElement {\n    const title = $$('div', { className: 'coveo-facet-header-title' });\n    title.text(this.options.title);\n    title.setAttribute('role', 'heading');\n    title.setAttribute('aria-level', '2');\n    title.setAttribute('aria-label', `${l('FacetTitle', this.options.title)}.`);\n    return title.el;\n  }\n\n  public buildEraser(): HTMLElement {\n    const eraser = $$('div', { className: 'coveo-facet-header-eraser' }, SVGIcons.icons.mainClear);\n\n    SVGDom.addClassToSVGInContainer(eraser.el, 'coveo-facet-header-eraser-svg');\n\n    new AccessibleButton()\n      .withElement(eraser.el)\n      .withLabel(l('Clear', this.options.title))\n      .withClickAction(() => this.onEraserClick())\n      .withEnterKeyboardAction(() => this.onEraserClick())\n      .build();\n\n    return eraser.el;\n  }\n\n  private onEraserClick() {\n    const cmp = this.options.facet || this.options.facetSlider;\n    cmp.reset();\n    cmp.usageAnalytics.logSearchEvent<IAnalyticsFacetMeta>(analyticsActionCauseList.facetClearAll, {\n      facetId: cmp.options.id,\n      facetField: cmp.options.field.toString(),\n      facetTitle: cmp.options.title\n    });\n    cmp.queryController.executeQuery();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetHeader.ts","import * as _ from 'underscore';\n\nexport class EventsUtils {\n  private static prefixes = ['webkit', 'moz', 'MS', 'o', ''];\n\n  // eventName must be in PascalCase\n  public static addPrefixedEvent(element: HTMLElement, pascalCaseEventName: string, callback) {\n    _.each(this.prefixes, prefix => {\n      if (prefix == '') {\n        pascalCaseEventName = pascalCaseEventName.toLowerCase();\n      }\n      element.addEventListener(prefix + pascalCaseEventName, callback, false);\n    });\n  }\n\n  // eventName must be in PascalCase\n  public static removePrefixedEvent(element: HTMLElement, pascalCaseEventName: string, callback) {\n    _.each(this.prefixes, prefix => {\n      if (prefix == '') {\n        pascalCaseEventName = pascalCaseEventName.toLowerCase();\n      }\n      element.removeEventListener(prefix + pascalCaseEventName, callback, false);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/EventsUtils.ts","/// <reference path=\"Facet.ts\" />\n\nimport 'styling/_FacetBreadcrumb';\nimport { compact, first } from 'underscore';\nimport { Assert } from '../../misc/Assert';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\nimport { $$, Dom } from '../../utils/Dom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { analyticsActionCauseList, IAnalyticsFacetMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { Facet } from './Facet';\nimport { FacetValue } from './FacetValue';\nimport { l } from '../../strings/Strings';\nimport { Component } from '../Base/Component';\n\nexport interface IBreadcrumbValueElementKlass {\n  new (facet: Facet, facetValue: FacetValue): BreadcrumbValueElement;\n}\n\nexport class BreadcrumbValueElement {\n  constructor(public facet: Facet, public facetValue: FacetValue) {}\n\n  public build(): Dom {\n    Assert.exists(this.facetValue);\n\n    const { container, caption, clear, listContainer } = this.buildElements();\n\n    container.append(caption.el);\n    container.append(clear.el);\n    listContainer.append(container.el);\n\n    return listContainer;\n  }\n\n  public getBreadcrumbTooltip(): string {\n    const tooltipParts = [\n      this.facet.getValueCaption(this.facetValue),\n      this.facetValue.getFormattedCount(),\n      this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat)\n    ];\n    return compact(tooltipParts).join(' ');\n  }\n\n  private buildElements() {\n    return {\n      container: this.buildContainer(),\n      clear: this.buildClear(),\n      caption: this.buildCaption(),\n      listContainer: this.buildListContainer()\n    };\n  }\n\n  private buildContainer() {\n    const container = $$('div', {\n      className: 'coveo-facet-breadcrumb-value'\n    });\n\n    container.toggleClass('coveo-selected', this.facetValue.selected);\n    container.toggleClass('coveo-excluded', this.facetValue.excluded);\n\n    const labelString = this.facetValue.excluded ? 'Unexclude' : 'RemoveFilterOn';\n    const label = l(labelString, this.facet.getValueCaption(this.facetValue));\n\n    new AccessibleButton()\n      .withElement(container)\n      .withLabel(label)\n      .withSelectAction(() => this.selectAction())\n      .build();\n\n    return container;\n  }\n\n  private buildListContainer() {\n    return $$('li', {\n      className: 'coveo-facet-breadcrumb-value-list-item'\n    });\n  }\n\n  private buildClear() {\n    const clear = $$(\n      'span',\n      {\n        className: 'coveo-facet-breadcrumb-clear'\n      },\n      SVGIcons.icons.mainClear\n    );\n\n    return clear;\n  }\n\n  private buildCaption() {\n    const caption = $$('span', {\n      className: 'coveo-facet-breadcrumb-caption'\n    });\n    caption.text(this.facet.getValueCaption(this.facetValue));\n    return caption;\n  }\n\n  private selectAction() {\n    if (this.facetValue.excluded) {\n      this.facet.unexcludeValue(this.facetValue.value);\n    } else {\n      this.facet.deselectValue(this.facetValue.value);\n    }\n    this.facet.triggerNewQuery(() =>\n      this.facet.usageAnalytics.logSearchEvent<IAnalyticsFacetMeta>(analyticsActionCauseList.breadcrumbFacet, {\n        facetId: this.facet.options.id,\n        facetField: this.facet.options.field.toString(),\n        facetValue: this.facetValue.value,\n        facetTitle: this.facet.options.title\n      })\n    );\n\n    this.focusOnContainer();\n  }\n\n  private focusOnContainer() {\n    const breadcrumb = first(this.facet.searchInterface.getComponents<Component>('Breadcrumb'));\n    breadcrumb ? breadcrumb.element.focus() : null;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/BreadcrumbValueElement.ts","import * as Globalize from 'globalize';\nimport { first, rest, filter } from 'underscore';\nimport { Assert } from '../../misc/Assert';\nimport { l } from '../../strings/Strings';\nimport { $$ } from '../../utils/Dom';\nimport { IBreadcrumbValueElementKlass } from './BreadcrumbValueElement';\nimport { Facet } from './Facet';\nimport { FacetValue } from './FacetValue';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\n\nexport class BreadcrumbValueList {\n  private expanded: FacetValue[];\n  private collapsed: FacetValue[];\n  protected elem: HTMLElement;\n  private valueContainer: HTMLElement;\n\n  constructor(public facet: Facet, public facetValues: FacetValue[], public breadcrumbValueElementKlass: IBreadcrumbValueElementKlass) {\n    this.setExpandedAndCollapsed();\n    this.elem = $$('div', {\n      className: 'coveo-facet-breadcrumb'\n    }).el;\n\n    const title = $$('span');\n    title.addClass('coveo-facet-breadcrumb-title');\n    title.text(this.facet.options.title + ':');\n    this.elem.appendChild(title.el);\n\n    this.valueContainer = $$('ul', {\n      className: 'coveo-facet-breadcrumb-values'\n    }).el;\n\n    this.elem.appendChild(this.valueContainer);\n  }\n\n  public build(): HTMLElement {\n    this.buildExpanded();\n    if (this.collapsed.length != 0) {\n      this.buildCollapsed();\n    }\n    return this.elem;\n  }\n\n  public buildAsString(): string {\n    this.build();\n    if (this.elem) {\n      return (\n        `${this.facet.options.title}: ` +\n        $$(this.elem)\n          .findAll('.coveo-facet-breadcrumb-value')\n          .map((value: HTMLElement) => {\n            return $$(value).text();\n          })\n          .join(', ')\n      );\n    }\n    return '';\n  }\n\n  private buildExpanded() {\n    this.expanded.forEach((value: FacetValue) => {\n      const elementBreadcrumb = new this.breadcrumbValueElementKlass(this.facet, value).build();\n      this.valueContainer.appendChild(elementBreadcrumb.el);\n    });\n  }\n\n  private buildCollapsed() {\n    const numberOfSelected = filter(this.collapsed, (value: FacetValue) => value.selected).length;\n    const numberOfExcluded = filter(this.collapsed, (value: FacetValue) => value.excluded).length;\n    Assert.check(numberOfSelected + numberOfExcluded == this.collapsed.length);\n\n    const nMoreElement = $$(\n      'div',\n      {\n        className: 'coveo-facet-breadcrumb-value'\n      },\n      $$(\n        'span',\n        {\n          className: 'coveo-facet-breadcrumb-multi-count'\n        },\n        l('NMore', Globalize.format(numberOfSelected + numberOfExcluded, 'n0'))\n      )\n    );\n\n    const nMoreContainer = $$(\n      'li',\n      {\n        className: 'coveo-facet-breadcrumb-value-list-item'\n      },\n      nMoreElement\n    );\n\n    const collapsedBreadcrumbs = this.collapsed.map((value: FacetValue) => new this.breadcrumbValueElementKlass(this.facet, value));\n    const toolTip = collapsedBreadcrumbs.map(element => element.getBreadcrumbTooltip()).join('\\n');\n\n    new AccessibleButton()\n      .withElement(nMoreElement)\n      .withTitle(toolTip)\n      .withSelectAction(() => {\n        nMoreElement.remove();\n        collapsedBreadcrumbs.forEach(breadcrumb => {\n          this.valueContainer.appendChild(breadcrumb.build().el);\n        });\n      })\n      .build();\n\n    this.valueContainer.appendChild(nMoreContainer.el);\n  }\n\n  private setExpandedAndCollapsed() {\n    if (this.facetValues.length > this.facet.options.numberOfValuesInBreadcrumb) {\n      this.collapsed = rest(this.facetValues, this.facet.options.numberOfValuesInBreadcrumb);\n      this.expanded = first(this.facetValues, this.facet.options.numberOfValuesInBreadcrumb);\n    } else {\n      this.collapsed = [];\n      this.expanded = this.facetValues;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/BreadcrumbValuesList.ts","/// <reference path=\"Facet.ts\" />\n\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport { Facet } from './Facet';\nimport { $$ } from '../../utils/Dom';\nimport { Utils } from '../../utils/Utils';\nimport { InitializationEvents } from '../../events/InitializationEvents';\nimport { FacetSearchParameters } from './FacetSearchParameters';\nimport { IAnalyticsFacetMeta, analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\nimport { IEndpointError } from '../../rest/EndpointError';\nimport { l } from '../../strings/Strings';\nimport { Assert } from '../../misc/Assert';\nimport { FacetValue } from './FacetValue';\nimport { StringUtils } from '../../utils/StringUtils';\nimport { IFacetSearchValuesListKlass } from './FacetSearchValuesList';\nimport { FacetValueElement } from './FacetValueElement';\nimport { ModalBox } from '../../ExternalModulesShim';\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\nimport { ResponsiveComponentsUtils } from '../ResponsiveComponents/ResponsiveComponentsUtils';\nimport { FacetValuesOrder } from './FacetValuesOrder';\nimport 'styling/_FacetSearch';\nimport { each, debounce, map, pluck } from 'underscore';\nimport { FacetSearchElement } from './FacetSearchElement';\nimport { IFacetSearch } from './IFacetSearch';\n\n/**\n * Used by the {@link Facet} component to render and handle the facet search part of each facet.\n */\nexport class FacetSearch implements IFacetSearch {\n  public currentlyDisplayedResults: string[];\n  public facetSearchElement: FacetSearchElement;\n  public facetSearchPromise: Promise<IIndexFieldValue[]>;\n  public moreValuesToFetch = true;\n\n  private facetSearchTimeout: number;\n  private onResize: (...args: any[]) => void;\n  private onDocumentClick: (e: Event) => void;\n  private lastSearchWasEmpty = true;\n\n  constructor(public facet: Facet, public facetSearchValuesListKlass: IFacetSearchValuesListKlass, private root: HTMLElement) {\n    this.facetSearchElement = new FacetSearchElement(this);\n    this.onResize = debounce(() => {\n      // Mitigate issues in UT where the window in phantom js might get resized in the scope of another test.\n      // These would point to random instance of a test karma object, and not a real search interface.\n      if (this.facet instanceof Facet && this.facet.searchInterface instanceof SearchInterface) {\n        if (this.shouldPositionSearchResults()) {\n          this.positionSearchResults();\n        }\n      }\n    }, 250);\n    this.onDocumentClick = (e: Event) => {\n      this.handleClickElsewhere(e);\n    };\n    window.addEventListener('resize', this.onResize);\n    document.addEventListener('click', (e: Event) => this.onDocumentClick(e));\n    $$(facet.root).on(InitializationEvents.nuke, () => this.handleNuke());\n  }\n\n  public get facetType() {\n    return Facet.ID;\n  }\n\n  public get facetTitle() {\n    return this.facet.options.title || this.facet.options.field.toString();\n  }\n\n  /**\n   * Build the search component and return an `HTMLElement` which can be appended to the {@link Facet}.\n   * @returns {HTMLElement}\n   */\n  public build(): HTMLElement {\n    return this.buildBaseSearch();\n  }\n\n  /**\n   * Position the search results at the footer of the facet.\n   */\n  public positionSearchResults() {\n    this.facetSearchElement.positionSearchResults();\n  }\n\n  public fetchMoreValues() {\n    this.triggerNewFacetSearch(this.buildParamsForFetchingMore());\n  }\n\n  /**\n   * Dismiss the search results\n   */\n  public dismissSearchResults() {\n    this.cancelAnyPendingSearchOperation();\n    this.facet.unfadeInactiveValuesInMainList();\n    $$(this.searchResults).empty();\n    this.moreValuesToFetch = true;\n    $$(this.search).removeClass('coveo-facet-search-no-results');\n    $$(this.facet.element).removeClass('coveo-facet-searching');\n    this.facetSearchElement.hideSearchResultsElement();\n    this.input.value = '';\n    $$(this.clear).hide();\n    this.currentlyDisplayedResults = undefined;\n  }\n\n  /**\n   * Trigger a new facet search, and display the results.\n   * @param params\n   */\n  public triggerNewFacetSearch(params: FacetSearchParameters) {\n    this.cancelAnyPendingSearchOperation();\n    this.facetSearchElement.showFacetSearchWaitingAnimation();\n\n    this.facet.logger.info('Triggering new facet search');\n\n    this.facetSearchPromise = this.facet.facetQueryController.search(params);\n\n    if (this.facetSearchPromise) {\n      this.facetSearchPromise\n        .then((fieldValues: IIndexFieldValue[]) => {\n          this.facet.usageAnalytics.logCustomEvent<IAnalyticsFacetMeta>(\n            analyticsActionCauseList.facetSearch,\n            {\n              facetId: this.facet.options.id,\n              facetField: this.facet.options.field.toString(),\n              facetTitle: this.facet.options.title\n            },\n            this.facet.root\n          );\n          this.facet.logger.debug('Received field values', fieldValues);\n          this.processNewFacetSearchResults(fieldValues, params);\n          this.facetSearchElement.hideFacetSearchWaitingAnimation();\n          this.facetSearchPromise = undefined;\n        })\n        .catch((error: IEndpointError) => {\n          // The request might be normally cancelled if another search is triggered.\n          // In this case we do not hide the animation to prevent flicking.\n          if (Utils.exists(error)) {\n            this.facet.logger.error('Error while retrieving facet values', error);\n            this.facetSearchElement.hideFacetSearchWaitingAnimation();\n          }\n          this.facetSearchPromise = undefined;\n          return null;\n        });\n    }\n  }\n\n  /**\n   * Trigger the event associated with the focus of the search input.\n   */\n  public focus(): void {\n    this.facetSearchElement.focus();\n  }\n\n  public get searchResults() {\n    return this.facetSearchElement.searchResults;\n  }\n\n  public get searchBarIsAnimating() {\n    return this.facetSearchElement.searchBarIsAnimating;\n  }\n\n  public get search() {\n    return this.facetSearchElement.search;\n  }\n\n  public setExpandedFacetSearchAccessibilityAttributes(searchResultsElement: HTMLElement) {\n    this.facet.setExpandedFacetSearchAccessibilityAttributes(searchResultsElement);\n  }\n\n  public setCollapsedFacetSearchAccessibilityAttributes() {\n    this.facet.setCollapsedFacetSearchAccessibilityAttributes();\n  }\n\n  public keyboardEventDefaultHandler() {\n    this.moreValuesToFetch = true;\n    this.highlightCurrentQueryWithinSearchResults();\n    if (!this.inputIsEmpty()) {\n      this.lastSearchWasEmpty = false;\n      this.displayNewValues(this.buildParamsForNormalSearch());\n    } else if (!this.lastSearchWasEmpty) {\n      // This normally happen if a user delete the search box content to go back to \"empty\" state.\n      this.currentlyDisplayedResults = undefined;\n      $$(this.searchResults).empty();\n      this.lastSearchWasEmpty = true;\n      this.displayNewValues(this.buildParamsForFetchingMore());\n    }\n  }\n\n  public keyboardNavigationEnterPressed(event: KeyboardEvent) {\n    if (event.shiftKey) {\n      this.triggerNewFacetSearch(this.buildParamsForNormalSearch());\n    } else {\n      if (this.searchResults.style.display != 'none') {\n        this.performActionOnCurrentSearchResult();\n        this.dismissSearchResults();\n      } else if ($$(this.search).is('.coveo-facet-search-no-results')) {\n        this.selectAllValuesMatchingSearch();\n      }\n    }\n  }\n\n  public keyboardNavigationDeletePressed(event: KeyboardEvent) {\n    if (event.shiftKey) {\n      this.performExcludeActionOnCurrentSearchResult();\n      this.dismissSearchResults();\n      this.input.value = '';\n    }\n  }\n\n  public displayNewValues(params: FacetSearchParameters = this.buildParamsForExcludingCurrentlyDisplayedValues()) {\n    this.cancelAnyPendingSearchOperation();\n    this.facetSearchTimeout = window.setTimeout(() => {\n      this.triggerNewFacetSearch(params);\n    }, this.facet.options.facetSearchDelay);\n  }\n\n  public getCaptions() {\n    return $$(this.searchResults).findAll('.coveo-facet-value-caption');\n  }\n\n  public getValueInInputForFacetSearch() {\n    return this.facetSearchElement.getValueInInputForFacetSearch();\n  }\n\n  public updateAriaLive(text: string) {\n    this.facet.searchInterface.ariaLive.updateText(text);\n  }\n\n  private get input() {\n    return this.facetSearchElement.input;\n  }\n\n  private get clear() {\n    return this.facetSearchElement.clear;\n  }\n\n  private shouldPositionSearchResults(): boolean {\n    return !ResponsiveComponentsUtils.isSmallFacetActivated($$(this.root)) && $$(this.facet.element).hasClass('coveo-facet-searching');\n  }\n\n  private buildBaseSearch(): HTMLElement {\n    this.facetSearchElement.build(() => this.handleFacetSearchClear());\n    $$(this.facetSearchElement.input).on('keyup', () => this.showOrHideClearElement());\n    return this.search;\n  }\n\n  private handleNuke() {\n    window.removeEventListener('resize', this.onResize);\n    document.removeEventListener('click', this.onDocumentClick);\n  }\n\n  private handleClickElsewhere(event: Event) {\n    if (this.currentlyDisplayedResults && this.search != event.target && this.searchResults != event.target && this.input != event.target) {\n      this.dismissSearchResults();\n    }\n  }\n\n  private handleFacetSearchClear() {\n    this.input.value = '';\n    $$(this.clear).hide();\n    this.dismissSearchResults();\n  }\n\n  private showOrHideClearElement() {\n    if (!this.inputIsEmpty()) {\n      $$(this.clear).show();\n    } else {\n      $$(this.clear).hide();\n      $$(this.search).removeClass('coveo-facet-search-no-results');\n    }\n  }\n  private cancelAnyPendingSearchOperation() {\n    if (Utils.exists(this.facetSearchTimeout)) {\n      clearTimeout(this.facetSearchTimeout);\n      this.facetSearchTimeout = undefined;\n    }\n    if (Utils.exists(this.facetSearchPromise)) {\n      Promise.reject(this.facetSearchPromise).catch(() => {});\n      this.facetSearchPromise = undefined;\n    }\n\n    this.facetSearchElement.hideFacetSearchWaitingAnimation();\n  }\n\n  private inputIsEmpty() {\n    return this.input.value.trim() == '';\n  }\n\n  private processNewFacetSearchResults(fieldValues: IIndexFieldValue[], facetSearchParameters: FacetSearchParameters) {\n    Assert.exists(fieldValues);\n    fieldValues = new FacetValuesOrder(this.facet, this.facet.facetSort).reorderValues(fieldValues);\n    if (fieldValues.length > 0) {\n      $$(this.search).removeClass('coveo-facet-search-no-results');\n      this.facet.fadeInactiveValuesInMainList(this.facet.options.facetSearchDelay);\n      this.rebuildSearchResults(fieldValues, facetSearchParameters);\n      if (!facetSearchParameters.fetchMore) {\n        this.showSearchResultsElement();\n      }\n      this.highlightCurrentQueryWithinSearchResults();\n      this.makeFirstSearchResultTheCurrentOne();\n      this.facetSearchElement.updateAriaLiveWithResults(this.input.value, this.currentlyDisplayedResults.length, this.moreValuesToFetch);\n    } else {\n      if (facetSearchParameters.fetchMore) {\n        this.moreValuesToFetch = false;\n      } else {\n        $$(this.search).addClass('coveo-facet-search-no-results');\n        this.showSearchResultsElement();\n        this.facetSearchElement.emptyAndShowNoResults();\n      }\n    }\n  }\n\n  private rebuildSearchResults(fieldValues: IIndexFieldValue[], facetSearchParameters: FacetSearchParameters) {\n    Assert.exists(fieldValues);\n    if (!facetSearchParameters.fetchMore) {\n      $$(this.searchResults).empty();\n    }\n\n    const facetSearchHasQuery = Utils.isNonEmptyString(facetSearchParameters.valueToSearch);\n\n    if (facetSearchHasQuery) {\n      this.appendSelectAllResultsButton();\n    }\n\n    let facetValues = map(fieldValues, fieldValue => {\n      return FacetValue.create(fieldValue);\n    });\n    each(new this.facetSearchValuesListKlass(this.facet, FacetValueElement).build(facetValues), (listElement: HTMLElement) => {\n      this.facetSearchElement.appendToSearchResults(listElement);\n    });\n    if (this.currentlyDisplayedResults) {\n      this.currentlyDisplayedResults = this.currentlyDisplayedResults.concat(pluck(facetValues, 'value'));\n    } else {\n      this.currentlyDisplayedResults = pluck(facetValues, 'value');\n    }\n\n    each($$(this.searchResults).findAll('.coveo-facet-selectable'), (elem: HTMLElement, index: number) => {\n      $$(elem).setAttribute('id', `coveo-facet-search-${this.facet.options.id}-suggestion-${index}`);\n      $$(elem).setAttribute('role', 'option');\n      $$(elem).setAttribute('aria-selected', 'false');\n      $$(elem).addClass('coveo-facet-search-selectable');\n    });\n  }\n\n  private appendSelectAllResultsButton() {\n    const selectAll = document.createElement('li');\n    $$(selectAll).addClass(['coveo-facet-selectable', 'coveo-facet-search-selectable', 'coveo-facet-search-select-all']);\n    $$(selectAll).text(l('SelectAll'));\n    $$(selectAll).on('click', () => this.selectAllValuesMatchingSearch());\n    this.facetSearchElement.appendToSearchResults(selectAll);\n  }\n\n  private buildParamsForNormalSearch() {\n    let params = new FacetSearchParameters(this.facet);\n    params.setValueToSearch(this.getValueInInputForFacetSearch());\n    params.fetchMore = false;\n    return params;\n  }\n\n  private buildParamsForFetchingMore() {\n    let params = this.buildParamsForExcludingCurrentlyDisplayedValues();\n    params.fetchMore = true;\n    return params;\n  }\n\n  protected buildParamsForExcludingCurrentlyDisplayedValues() {\n    let params = new FacetSearchParameters(this.facet);\n    params.excludeCurrentlyDisplayedValuesInSearch(this.searchResults);\n    params.setValueToSearch(this.getValueInInputForFacetSearch());\n    return params;\n  }\n\n  private showSearchResultsElement() {\n    this.positionSearchResults();\n  }\n\n  private highlightCurrentQueryWithinSearchResults() {\n    let search = this.getValueInInputForFacetSearch();\n    let regex = new RegExp('(' + StringUtils.wildcardsToRegex(search, this.facet.options.facetSearchIgnoreAccents) + ')', 'ig');\n    this.facetSearchElement.highlightCurrentQueryInSearchResults(regex);\n  }\n\n  private makeFirstSearchResultTheCurrentOne() {\n    this.facetSearchElement.setAsCurrentResult($$(this.getSelectables()[0]));\n  }\n\n  private getSelectables(target = this.searchResults) {\n    return $$(target).findAll('.coveo-facet-selectable');\n  }\n\n  private performActionOnCurrentSearchResult() {\n    let current = $$(this.searchResults).find('.coveo-facet-search-current-result');\n    Assert.check(current != undefined);\n\n    const shouldExclude = $$(current).hasClass('coveo-facet-value-will-exclude');\n\n    if (shouldExclude) {\n      const excludeIcon = $$(current).find('.coveo-facet-value-exclude');\n      excludeIcon.click();\n      return;\n    }\n\n    const checkbox = <HTMLInputElement>$$(current).find('input[type=\"checkbox\"]');\n\n    if (checkbox) {\n      checkbox.checked = true;\n      $$(checkbox).trigger('change');\n    } else {\n      current.click();\n    }\n  }\n\n  private performExcludeActionOnCurrentSearchResult() {\n    let current = $$(this.searchResults).find('.coveo-facet-search-current-result');\n    Assert.check(current != null);\n    let valueCaption = $$(current).find('.coveo-facet-value-caption');\n    let valueElement = this.facet.facetValuesList.get($$(valueCaption).text());\n\n    valueElement.toggleExcludeWithUA();\n  }\n\n  protected selectAllValuesMatchingSearch() {\n    this.facet.showWaitingAnimation();\n\n    let searchParameters = new FacetSearchParameters(this.facet);\n    searchParameters.nbResults = 1000;\n    searchParameters.setValueToSearch(this.getValueInInputForFacetSearch());\n    this.facet.facetQueryController.search(searchParameters).then((fieldValues: IIndexFieldValue[]) => {\n      this.dismissSearchResults();\n      ModalBox.close(true);\n      let facetValues = map(fieldValues, fieldValue => {\n        let facetValue = this.facet.values.get(fieldValue.value);\n        if (!Utils.exists(facetValue)) {\n          facetValue = FacetValue.create(fieldValue);\n        }\n        facetValue.selected = true;\n        facetValue.excluded = false;\n        return facetValue;\n      });\n      this.facet.processFacetSearchAllResultsSelected(facetValues);\n    });\n    this.dismissSearchResults();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearch.ts","/// <reference path=\"Facet.ts\" />\nimport { Facet } from './Facet';\nimport { IFacetValueElementKlass } from './FacetValueElement';\nimport { FacetValue } from './FacetValue';\nimport * as _ from 'underscore';\n\nexport interface IFacetSearchValuesListKlass {\n  new (facet: Facet, facetValueElementKlass: IFacetValueElementKlass): FacetSearchValuesList;\n}\n\nexport class FacetSearchValuesList {\n  constructor(public facet: Facet, public facetValueElementKlass: IFacetValueElementKlass) {}\n\n  public build(facetValues: FacetValue[]): HTMLElement[] {\n    var valuesToBuildWith = _.map(facetValues, facetValue => {\n      return (\n        _.find(this.facet.values.getAll(), (valueAlreadyInFacet: FacetValue) => {\n          return valueAlreadyInFacet.value == facetValue.value;\n        }) || facetValue\n      );\n    });\n    return _.map(valuesToBuildWith, facetValue => {\n      const valueElement = new this.facetValueElementKlass(this.facet, facetValue, this.facet.keepDisplayedValuesNextTime).build();\n      valueElement.renderer.excludeIcon.setAttribute('aria-hidden', 'true');\n      valueElement.renderer.label.setAttribute('aria-hidden', 'true');\n      return valueElement.renderer.listItem;\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearchValuesList.ts","/// <reference path=\"Facet.ts\" />\n\nimport { FacetValueElement, IFacetValueElementKlass } from './FacetValueElement';\nimport { Facet } from './Facet';\nimport { $$ } from '../../utils/Dom';\nimport { ValueElement } from './ValueElement';\nimport { FacetValue } from './FacetValue';\nimport { Utils } from '../../utils/Utils';\nimport { FacetUtils } from './FacetUtils';\nimport * as _ from 'underscore';\n\nexport class FacetValuesList {\n  // Dictionary of values. The key is always in lowercase.\n  private valueList: { [value: string]: FacetValueElement } = {};\n\n  public valueContainer: HTMLElement;\n  private currentlyDisplayed: ValueElement[] = [];\n\n  constructor(public facet: Facet, public facetValueElementKlass: IFacetValueElementKlass) {}\n\n  public build(): HTMLElement {\n    this.valueContainer = document.createElement('ul');\n    $$(this.valueContainer).addClass('coveo-facet-values');\n    return this.valueContainer;\n  }\n\n  public getAllCurrentlyDisplayed(): ValueElement[] {\n    return this.currentlyDisplayed;\n  }\n\n  public getAll(): ValueElement[] {\n    return _.toArray<ValueElement>(this.valueList);\n  }\n\n  public getAllFacetValue(): FacetValue[] {\n    return _.map(this.getAll(), (v: ValueElement) => {\n      return v.facetValue;\n    });\n  }\n\n  public get(value: FacetValue | string): ValueElement {\n    var getter;\n    if (value instanceof FacetValue) {\n      getter = value.value;\n    } else {\n      value = Utils.anyTypeToString(value);\n      getter = value;\n    }\n    this.ensureFacetValueIsInList(value);\n    return this.valueList[getter.toLowerCase()];\n  }\n\n  public select(value: FacetValue | string): ValueElement {\n    var valueElement = this.get(value);\n    valueElement.select();\n    return valueElement;\n  }\n\n  public unselect(value: FacetValue | string): ValueElement {\n    var valueElement = this.get(value);\n    valueElement.unselect();\n    return valueElement;\n  }\n\n  public exclude(value: FacetValue | string): ValueElement {\n    var valueElement = this.get(value);\n    valueElement.exclude();\n    return valueElement;\n  }\n\n  public unExclude(value: FacetValue | string): ValueElement {\n    var valueElement = this.get(value);\n    valueElement.unexclude();\n    return valueElement;\n  }\n\n  public toggleSelect(value: FacetValue | string): ValueElement {\n    var valueElement = this.get(value);\n    if (valueElement.facetValue.selected) {\n      valueElement.unselect();\n    } else {\n      valueElement.select();\n    }\n    return valueElement;\n  }\n\n  public toggleExclude(value: FacetValue | string): ValueElement {\n    var valueElement = this.get(value);\n    if (valueElement.facetValue.excluded) {\n      valueElement.unexclude();\n    } else {\n      valueElement.exclude();\n    }\n    return valueElement;\n  }\n\n  public rebuild(numberOfValues: number): void {\n    $$(this.valueContainer).empty();\n    this.currentlyDisplayed = [];\n    var allValues = this.getValuesToBuildWith();\n    var toCompare = numberOfValues;\n    let docFragment = document.createDocumentFragment();\n    _.each(allValues, (facetValue: FacetValue, index?: number, list?) => {\n      if (this.facetValueShouldBeRemoved(facetValue)) {\n        this.facet.values.remove(facetValue.value);\n        toCompare += 1;\n      } else if (index < toCompare) {\n        var valueElement = new this.facetValueElementKlass(this.facet, facetValue, true);\n        this.valueList[facetValue.value.toLowerCase()] = valueElement;\n        var valueListElement = valueElement.build().renderer.listItem;\n        docFragment.appendChild(valueListElement);\n        this.currentlyDisplayed.push(valueElement);\n      }\n    });\n    this.valueContainer.appendChild(docFragment);\n\n    FacetUtils.addNoStateCssClassToFacetValues(this.facet, this.valueContainer);\n  }\n\n  protected getValuesToBuildWith() {\n    return this.facet.values.getAll();\n  }\n\n  private facetValueShouldBeRemoved(facetValue: FacetValue): boolean {\n    return (\n      facetValue.occurrences == 0 &&\n      (facetValue.delta == 0 || facetValue.delta == undefined) &&\n      !facetValue.selected &&\n      !facetValue.excluded &&\n      !this.facet.keepDisplayedValuesNextTime\n    );\n  }\n\n  private ensureFacetValueIsInList(value: any) {\n    var facetValue: FacetValue;\n    if (value instanceof FacetValue) {\n      facetValue = this.facet.values.get((<FacetValue>value).value);\n      if (facetValue == null) {\n        this.facet.values.add(value);\n        facetValue = value;\n      }\n    } else {\n      facetValue = this.facet.values.get(value);\n      if (facetValue == null) {\n        facetValue = FacetValue.createFromValue(value);\n        this.facet.values.add(facetValue);\n      }\n    }\n\n    var key = facetValue.value.toLowerCase();\n    var found = this.valueList[key];\n    if (found == undefined) {\n      found = this.valueList[key] = new FacetValueElement(this.facet, facetValue, true);\n      found.build();\n    } else {\n      found.facetValue = facetValue;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetValuesList.ts","/// <reference path=\"Facet.ts\" />\n\nimport { Facet } from './Facet';\nimport { FacetValue } from './FacetValue';\nimport { IPopulateOmniboxObject } from '../Omnibox/OmniboxInterface';\nimport { ValueElement } from './ValueElement';\nimport { IAnalyticsActionCause } from '../Analytics/AnalyticsActionListMeta';\n\nexport interface IOmniboxValueElementKlass {\n  new (\n    facet: Facet,\n    facetValue: FacetValue,\n    eventArg: IPopulateOmniboxObject,\n    onSelect?: (elem: ValueElement, cause: IAnalyticsActionCause) => void,\n    onExclude?: (elem: ValueElement, cause: IAnalyticsActionCause) => void\n  ): OmniboxValueElement;\n}\n\nexport class OmniboxValueElement extends ValueElement {\n  constructor(\n    public facet: Facet,\n    public facetValue: FacetValue,\n    public eventArg: IPopulateOmniboxObject,\n    onSelect?: (elem: ValueElement, cause: IAnalyticsActionCause) => void,\n    onExclude?: (elem: ValueElement, cause: IAnalyticsActionCause) => void\n  ) {\n    super(facet, facetValue, onSelect, onExclude);\n  }\n\n  public bindEvent() {\n    super.bindEvent({ displayNextTime: false, pinFacet: false, omniboxObject: this.eventArg });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/OmniboxValueElement.ts","/// <reference path=\"Facet.ts\" />\nimport { each, indexOf, pluck } from 'underscore';\nimport { $$ } from '../../utils/Dom';\nimport { Utils } from '../../utils/Utils';\nimport { IAnalyticsActionCause, IAnalyticsOmniboxFacetMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { IPopulateOmniboxObject } from '../Omnibox/OmniboxInterface';\nimport { Facet } from './Facet';\nimport { FacetUtils } from './FacetUtils';\nimport { FacetValue } from './FacetValue';\nimport { IOmniboxValueElementKlass } from './OmniboxValueElement';\nimport { ValueElement } from './ValueElement';\n\nexport class OmniboxValuesList {\n  constructor(\n    public facet: Facet,\n    public facetValues: FacetValue[],\n    public omniboxObject: IPopulateOmniboxObject,\n    public omniboxValueElementKlass: IOmniboxValueElementKlass\n  ) {}\n\n  public build() {\n    const rows: HTMLElement[] = [];\n    each(this.facetValues, (facetValue: FacetValue) => {\n      rows.push(this.buildOmniboxForOneRow(facetValue, this.omniboxObject));\n    });\n    return this.buildFinalOmniboxElement(rows);\n  }\n\n  private buildOmniboxForOneRow(facetValue: FacetValue, omniboxObject: IPopulateOmniboxObject): HTMLElement {\n    const selectCallback = (elem: ValueElement, cause: IAnalyticsActionCause) => this.logAnalyticsEvent(elem, cause);\n    const excludeCallback = (elem: ValueElement, cause: IAnalyticsActionCause) => this.logAnalyticsEvent(elem, cause);\n    const omniboxValueElement = new this.omniboxValueElementKlass(this.facet, facetValue, omniboxObject, selectCallback, excludeCallback);\n    const omniboxRowContent = omniboxValueElement.build().renderer.listItem;\n\n    const regex = omniboxObject.completeQueryExpression.regex;\n    const valueToSearch = omniboxObject.completeQueryExpression.word;\n    const caption = $$(omniboxRowContent).find('.coveo-facet-value-caption');\n    caption.innerHTML = this.highlightOmniboxMatch(this.facet.getValueCaption(facetValue), regex, valueToSearch);\n\n    const omniboxRow = $$('ul', {\n      className: 'coveo-omnibox-selectable coveo-facet-value coveo-omnibox-facet-value'\n    }).el;\n    omniboxRow.appendChild(omniboxRowContent);\n    $$(omniboxRow).on('keyboardSelect', () => {\n      const input = $$(omniboxRowContent).find('input[type=checkbox]');\n      $$(input).trigger('change');\n    });\n    omniboxRow['no-text-suggestion'] = true;\n    return omniboxRow;\n  }\n\n  private buildFinalOmniboxElement(rows: HTMLElement[]) {\n    const header = this.buildOmniboxHeader();\n    if (Utils.isEmptyArray(rows)) {\n      return undefined;\n    } else {\n      const ret = $$('div', {\n        className: 'coveo-omnibox-facet-value'\n      }).el;\n      ret.appendChild(header);\n      each(rows, r => {\n        ret.appendChild(r);\n      });\n      FacetUtils.addNoStateCssClassToFacetValues(this.facet, ret);\n      return ret;\n    }\n  }\n\n  private buildOmniboxHeader(): HTMLElement {\n    const title = this.facet.options.title;\n    const header = $$('div', {\n      className: 'coveo-omnibox-facet-header'\n    }).el;\n    $$(header).text(title);\n    return header;\n  }\n\n  private highlightOmniboxMatch(orignalStr: string, regex: RegExp, valueToSearch: string) {\n    const firstChar = orignalStr.search(regex);\n    const lastChar = firstChar + valueToSearch.length;\n    return (\n      orignalStr.slice(0, firstChar) +\n      '<span class=\"coveo-highlight\">' +\n      orignalStr.slice(firstChar, lastChar) +\n      '</span>' +\n      orignalStr.slice(lastChar)\n    );\n  }\n\n  private logAnalyticsEvent(elem: ValueElement, cause: IAnalyticsActionCause) {\n    const strippedFacetValues = pluck(this.facetValues, 'value');\n    elem.facet.usageAnalytics.logSearchEvent<IAnalyticsOmniboxFacetMeta>(cause, {\n      query: this.omniboxObject.completeQueryExpression.word,\n      facetId: elem.facet.options.id,\n      facetField: elem.facet.options.field.toString(),\n      facetTitle: elem.facet.options.title,\n      facetValue: elem.facetValue.value,\n      suggestions: strippedFacetValues.join(';'),\n      suggestionRanking: indexOf(strippedFacetValues, elem.facetValue.value)\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/OmniboxValuesList.ts","import { IResponsiveComponent, IResponsiveComponentOptions, ResponsiveComponentsManager } from './ResponsiveComponentsManager';\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\nimport { ResultList } from '../ResultList/ResultList';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Component } from '../Base/Component';\nimport { Logger } from '../../misc/Logger';\nimport { ResponsiveDropdown } from './ResponsiveDropdown/ResponsiveDropdown';\n\nexport class ResponsiveDefaultResultTemplate implements IResponsiveComponent {\n  private searchInterface: SearchInterface;\n  private resultList: ResultList;\n\n  private currentMode: string;\n\n  public static init(root: HTMLElement, component: ResultList, options: IResponsiveComponentOptions) {\n    if (!$$(root).find(`.${Component.computeCssClassName(ResultList)}`)) {\n      let logger = new Logger('ResponsiveDefaultResultTemplate');\n      logger.trace('No ResultLayout component found : Cannot instantiate ResponsiveResultLayout');\n      return;\n    }\n    ResponsiveComponentsManager.register(ResponsiveDefaultResultTemplate, $$(root), ResultList.ID, component, options);\n  }\n\n  constructor(public coveoRoot: Dom, public ID: string, options: IResponsiveComponentOptions, responsiveDropdown?: ResponsiveDropdown) {\n    this.searchInterface = <SearchInterface>Component.get(this.coveoRoot.el, SearchInterface, false);\n    this.currentMode = 'large';\n  }\n\n  public registerComponent(accept: ResultList) {\n    if (accept instanceof ResultList) {\n      this.resultList = accept;\n      return true;\n    }\n    return false;\n  }\n\n  public handleResizeEvent() {\n    let lastResults = this.resultList.queryController.getLastResults();\n    if (this.needSmallMode()) {\n      $$(this.resultList.options.resultsContainer).addClass('coveo-card-layout-container');\n      $$(this.resultList.options.resultsContainer).removeClass(`coveo-list-layout-container`);\n      if (this.currentMode != 'small') {\n        if (lastResults) {\n          this.resultList.buildResults(lastResults).then((elements: HTMLElement[]) => {\n            this.resultList.renderResults(elements);\n          });\n        }\n        this.currentMode = 'small';\n      }\n    } else {\n      $$(this.resultList.options.resultsContainer).removeClass('coveo-card-layout-container');\n      $$(this.resultList.options.resultsContainer).addClass(`coveo-list-layout-container`);\n      if (this.currentMode != 'large') {\n        if (lastResults) {\n          this.resultList.buildResults(lastResults).then((elements: HTMLElement[]) => {\n            this.resultList.renderResults(elements);\n          });\n        }\n        this.currentMode = 'large';\n      }\n    }\n  }\n\n  private needSmallMode(): boolean {\n    return this.coveoRoot.width() <= this.searchInterface.responsiveComponents.getSmallScreenWidth();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveDefaultResultTemplate.ts","import { IQueryResult } from '../../rest/QueryResult';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Component } from '../Base/Component';\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\n\nexport interface ResultToRender {\n  resultElement: HTMLElement;\n  componentsInside: Component[];\n}\n\nexport class ResultContainer {\n  public static resultCurrentlyBeingRendered: IQueryResult = null;\n\n  public resultContainerElement: Dom;\n\n  constructor(resultContainer: HTMLElement, private searchInterface: SearchInterface) {\n    this.resultContainerElement = $$(resultContainer);\n  }\n\n  public empty() {\n    this.searchInterface.detachComponentsInside(this.resultContainerElement.el);\n    $$(this.resultContainerElement).empty();\n  }\n\n  public addClass(classToAdd: string) {\n    this.resultContainerElement.addClass(classToAdd);\n  }\n\n  public isEmpty() {\n    return this.resultContainerElement.isEmpty();\n  }\n\n  public hideChildren() {\n    this.resultContainerElement.children().forEach(child => $$(child).hide());\n  }\n\n  public getResultElements() {\n    return this.resultContainerElement.findAll('.CoveoResult');\n  }\n\n  public get el() {\n    return this.resultContainerElement.el;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultContainer.ts","import { ResultListRenderer } from './ResultListRenderer';\nimport { $$ } from '../../utils/Dom';\nimport _ = require('underscore');\n\nexport class ResultListCardRenderer extends ResultListRenderer {\n  getEndFragment(resultElements: HTMLElement[]) {\n    return new Promise<DocumentFragment>(resolve => {\n      if (!_.isEmpty(resultElements)) {\n        // with infinite scrolling, we want the additional results to append at the end of the previous query.\n        // For this, we need to remove the padding.\n        if (this.resultListOptions.enableInfiniteScroll) {\n          const needToBeRemoved = $$(this.resultListOptions.resultsContainer).findAll('.coveo-card-layout-padding');\n          _.each(needToBeRemoved, toRemove => $$(toRemove).remove());\n        }\n        // Used to prevent last card from spanning the grid's whole width\n        const emptyCards = document.createDocumentFragment();\n        _.times(3, () => emptyCards.appendChild($$('div', { className: 'coveo-card-layout coveo-card-layout-padding' }).el));\n        resolve(emptyCards);\n      }\n      resolve(null);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultListCardRenderer.ts","import { IResultListOptions } from './ResultListOptions';\nimport { ResultListRenderer } from './ResultListRenderer';\nimport { TemplateRole } from '../Templates/Template';\nimport { TableTemplate } from '../Templates/TableTemplate';\nimport { $$ } from '../../utils/Dom';\nimport _ = require('underscore');\n\nexport class ResultListTableRenderer extends ResultListRenderer {\n  private shouldDisplayHeader: boolean = true;\n  private shouldDisplayFooter: boolean = false;\n\n  constructor(protected resultListOptions: IResultListOptions, protected autoCreateComponentsFn: Function) {\n    super(resultListOptions, autoCreateComponentsFn);\n    if (this.resultListOptions.resultTemplate instanceof TableTemplate) {\n      if (this.resultListOptions.resultTemplate.hasTemplateWithRole('table-footer')) {\n        this.shouldDisplayFooter = true;\n      }\n      // If custom templates are defined but no header template, do not display it.\n      if (\n        this.resultListOptions.resultTemplate.templates.length !== 0 &&\n        !this.resultListOptions.resultTemplate.hasTemplateWithRole('table-header')\n      ) {\n        this.shouldDisplayHeader = false;\n      }\n    }\n  }\n\n  getStartFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    if (!append && !_.isEmpty(resultElements) && this.shouldDisplayHeader) {\n      return this.renderRoledTemplate('table-header');\n    }\n  }\n\n  getEndFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    if (!append && !_.isEmpty(resultElements) && this.shouldDisplayFooter) {\n      return this.renderRoledTemplate('table-footer');\n    }\n  }\n\n  private async renderRoledTemplate(role: TemplateRole) {\n    const elem = await (<TableTemplate>this.resultListOptions.resultTemplate).instantiateRoleToElement(role);\n    $$(elem).addClass(`coveo-result-list-${role}`);\n    this.autoCreateComponentsFn(elem, undefined);\n    const frag = document.createDocumentFragment();\n    frag.appendChild(elem);\n    return frag;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultListTableRenderer.ts","import { IResponsiveDropdownContent, ResponsiveDropdownContent } from './ResponsiveDropdownContent';\nimport { Dom, $$, l } from '../../../Core';\nimport { SVGIcons } from '../../../utils/SVGIcons';\nimport { FocusTrap } from '../../FocusTrap/FocusTrap';\n\nexport class ResponsiveDropdownModalContent implements IResponsiveDropdownContent {\n  private closeButton: Dom;\n  private className: string;\n  private focusTrap: FocusTrap;\n\n  constructor(private componentName: string, public element: Dom, private closeButtonLabel: string, private close: () => void) {\n    this.className = `coveo-${this.componentName}-dropdown-modal-content`;\n  }\n\n  private set hidden(shouldHide: boolean) {\n    this.element.toggleClass('coveo-hidden', shouldHide);\n  }\n\n  public positionDropdown() {\n    this.element.el.classList.add(this.className, ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n    this.element.setAttribute('role', 'group');\n    this.element.setAttribute('aria-label', l('FiltersDropdown'));\n    this.hidden = false;\n    this.ensureCloseButton();\n    this.ensureFocusTrap();\n  }\n\n  public hideDropdown() {\n    this.element.el.classList.remove(this.className, ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n    this.element.setAttribute('role', null);\n    this.element.setAttribute('aria-label', null);\n    this.hidden = true;\n    this.removeCloseButton();\n    this.removeFocusTrap();\n  }\n\n  public cleanUp() {\n    this.hidden = false;\n  }\n\n  private ensureCloseButton() {\n    if (!this.closeButton) {\n      this.closeButton = $$(\n        'button',\n        {\n          className: 'coveo-facet-modal-close-button',\n          type: 'button',\n          ariaLabel: this.closeButtonLabel\n        },\n        SVGIcons.icons.mainClear\n      );\n      this.closeButton.on('click', () => this.close());\n      this.element.prepend(this.closeButton.el);\n    }\n  }\n\n  private get focusableSelector() {\n    const facetElements = '[data-field]:not(.coveo-facet-empty) [tabindex]';\n    const dynamicFacetsElements = '[data-field]:not(.coveo-hidden) button';\n    const modalButton = '.coveo-facet-modal-close-button';\n    return [facetElements, dynamicFacetsElements, modalButton].join(' , ');\n  }\n\n  private ensureFocusTrap() {\n    if (!this.focusTrap) {\n      this.focusTrap = new FocusTrap(this.element.el, { focusableSelector: this.focusableSelector });\n    }\n  }\n\n  private removeCloseButton() {\n    if (this.closeButton) {\n      this.closeButton.remove();\n      this.closeButton = null;\n    }\n  }\n\n  private removeFocusTrap() {\n    if (this.focusTrap) {\n      this.focusTrap.disable();\n      this.focusTrap = null;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveDropdown/ResponsiveDropdownModalContent.ts","/**\n * The names of the events that can be triggered by the [FacetsMobileMode]{@link FacetsMobileMode} component.\n */\nexport class FacetsMobileModeEvents {\n  /**\n   * The name of the event that gets triggered when the facets pop-up (or modal) is opened in mobile mode.\n   */\n  public static popupOpened = 'popupOpened';\n  /**\n   * The name of the event that gets triggered when the facets pop-up (or modal) is closed in mobile mode.\n   */\n  public static popupClosed = 'popupClosed';\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/events/FacetsMobileModeEvents.ts","import { IFacetSearch } from './IFacetSearch';\nimport { KEYBOARD } from '../../utils/KeyboardUtils';\nexport class FacetSearchUserInputHandler {\n  constructor(private facetSearch: IFacetSearch) {}\n\n  public handleKeyboardEvent(event: KeyboardEvent) {\n    switch (event.which) {\n      case KEYBOARD.ENTER:\n        this.facetSearch.keyboardNavigationEnterPressed(event);\n        break;\n      case KEYBOARD.DELETE:\n        this.facetSearch.keyboardNavigationDeletePressed && this.facetSearch.keyboardNavigationDeletePressed(event);\n        break;\n      case KEYBOARD.ESCAPE:\n        this.facetSearch.dismissSearchResults();\n        break;\n      case KEYBOARD.DOWN_ARROW:\n        this.facetSearch.facetSearchElement.moveCurrentResultDown();\n        break;\n      case KEYBOARD.UP_ARROW:\n        this.facetSearch.facetSearchElement.moveCurrentResultUp();\n        break;\n      default:\n        this.facetSearch.keyboardEventDefaultHandler();\n    }\n  }\n\n  public handleFacetSearchResultsScroll() {\n    if (\n      this.facetSearch.facetSearchPromise ||\n      this.facetSearch.facetSearchElement.getValueInInputForFacetSearch() != '' ||\n      !this.facetSearch.moreValuesToFetch\n    ) {\n      return;\n    }\n\n    let elementHeight = this.facetSearch.facetSearchElement.searchResults.clientHeight;\n    let scrollHeight = this.facetSearch.facetSearchElement.searchResults.scrollHeight;\n    let bottomPosition = this.facetSearch.facetSearchElement.searchResults.scrollTop + elementHeight;\n    if (scrollHeight - bottomPosition < elementHeight / 2) {\n      this.facetSearch.fetchMoreValues();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearchUserInputHandler.ts","import { ISearchDropdownNavigator, ISearchDropdownConfig, DefaultSearchDropdownNavigator } from './DefaultSearchDropdownNavigator';\nimport { FacetSearchDropdownNavigator } from './FacetSearchDropdownNavigator';\nimport { IFacetSearch } from '../IFacetSearch';\nimport { CategoryFacet } from '../../CategoryFacet/CategoryFacet';\nimport { Facet } from '../Facet';\n\nexport function SearchDropdownNavigatorFactory(facetSearch: IFacetSearch, config: ISearchDropdownConfig): ISearchDropdownNavigator {\n  switch (facetSearch.facetType) {\n    case Facet.ID:\n      return new FacetSearchDropdownNavigator({ ...config, facetSearch });\n\n    case CategoryFacet.ID:\n    default:\n      return new DefaultSearchDropdownNavigator(config);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearchDropdownNavigation/SearchDropdownNavigatorFactory.ts","import { ISearchDropdownNavigator, DefaultSearchDropdownNavigator, ISearchDropdownConfig } from './DefaultSearchDropdownNavigator';\nimport { $$, Dom } from '../../../utils/Dom';\nimport { IFacetSearch } from '../IFacetSearch';\n\nexport interface IFacetSearchDropdownConfig extends ISearchDropdownConfig {\n  facetSearch: IFacetSearch;\n}\n\nexport class FacetSearchDropdownNavigator implements ISearchDropdownNavigator {\n  private defaultDropdownNavigator: DefaultSearchDropdownNavigator;\n\n  constructor(private config: IFacetSearchDropdownConfig) {\n    this.defaultDropdownNavigator = new DefaultSearchDropdownNavigator(config);\n  }\n\n  public setAsCurrentResult(dom: Dom) {\n    this.defaultDropdownNavigator.setAsCurrentResult(dom);\n  }\n\n  public get currentResult() {\n    return this.defaultDropdownNavigator.currentResult;\n  }\n\n  public focusNextElement() {\n    this.toggleCanExcludeCurrentResult();\n\n    if (this.willExcludeCurrentResult) {\n      this.announceCurrentResultCanBeExcluded();\n      return;\n    }\n\n    this.defaultDropdownNavigator.moveCurrentResultDown();\n  }\n\n  public focusPreviousElement() {\n    if (this.willExcludeCurrentResult) {\n      this.toggleCanExcludeCurrentResult();\n      return;\n    }\n\n    this.moveResultUp();\n    this.toggleCanExcludeCurrentResult();\n  }\n\n  private moveResultUp() {\n    if (this.willExcludeCurrentResult) {\n      this.toggleCanExcludeCurrentResult();\n      return;\n    }\n\n    this.defaultDropdownNavigator.moveCurrentResultUp();\n    this.toggleCanExcludeCurrentResult();\n  }\n\n  private get isCurrentResultNotAFacetValue() {\n    return this.currentResult.hasClass('coveo-facet-search-select-all') || this.currentResult.hasClass('coveo-facet-value-not-found');\n  }\n\n  private get willExcludeCurrentResult() {\n    return this.currentResult.hasClass('coveo-facet-value-will-exclude');\n  }\n\n  private toggleCanExcludeCurrentResult() {\n    if (this.isCurrentResultNotAFacetValue) {\n      return;\n    }\n\n    this.currentResult.toggleClass('coveo-facet-value-will-exclude', !this.willExcludeCurrentResult);\n  }\n\n  private announceCurrentResultCanBeExcluded() {\n    if (this.isCurrentResultNotAFacetValue) {\n      return;\n    }\n\n    const excludeIcon = $$(this.currentResult).find('.coveo-facet-value-exclude');\n    this.config.facetSearch.updateAriaLive(excludeIcon.getAttribute('aria-label'));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetSearchDropdownNavigation/FacetSearchDropdownNavigator.ts","import { $$, Dom } from '../../utils/Dom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { escape } from 'underscore';\nimport { l } from '../../strings/Strings';\nimport * as Globalize from 'globalize';\n\nexport interface CategoryFacetData {\n  value: string;\n  count: number;\n}\n\nexport class CategoryFacetTemplates {\n  private listRoot: Dom;\n  private collapseArrow: Dom;\n\n  constructor() {\n    this.listRoot = $$('ul', { className: 'coveo-category-facet-values' });\n    this.collapseArrow = $$('span', { className: 'coveo-category-facet-collapse-children' }, SVGIcons.icons.arrowDown);\n    SVGDom.addClassToSVGInContainer(this.collapseArrow.el, 'coveo-category-facet-collapse-children-svg');\n  }\n\n  public buildListRoot() {\n    return this.listRoot.clone(true);\n  }\n\n  public buildListElement(data: CategoryFacetData) {\n    const div = $$('div', {}, this.createListElement(data));\n    return $$(div.el.firstChild as HTMLElement);\n  }\n\n  public buildAllCategoriesButton() {\n    const allCategoriesCaption = $$('span', { className: 'coveo-category-facet-all-categories-caption' }, l('AllCategories'));\n    const allCategories = $$(\n      'li',\n      { className: 'coveo-category-facet-value coveo-category-facet-all-categories' },\n      this.buildCollapseArrow(),\n      allCategoriesCaption\n    );\n    return allCategories;\n  }\n\n  public buildEllipsis() {\n    const ellipsisCaption = $$('span', { className: 'coveo-category-facet-ellipsis-caption' }, '[ ... ]');\n    const ellipsis = $$('li', { className: 'coveo-category-facet-ellipsis' }, ellipsisCaption);\n    return ellipsis;\n  }\n\n  public buildCollapseArrow() {\n    return this.collapseArrow.clone(true);\n  }\n\n  private getFormattedCount(count: number) {\n    return Globalize.format(count, 'n0');\n  }\n\n  private createListElement(data: CategoryFacetData) {\n    return `<li class=\"coveo-category-facet-value\">\n        <label class=\"coveo-category-facet-value-label\">\n          <span title=\"${escape(data.value)}\" class=\"coveo-category-facet-value-caption\">${escape(data.value)}</span>\n          <span class=\"coveo-category-facet-value-count\">${this.getFormattedCount(data.count)}</span>\n        </label>\n      </li>`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryFacetTemplates.ts","import { CategoryFacetTemplates } from './CategoryFacetTemplates';\nimport { Dom } from '../../utils/Dom';\nimport { CategoryChildrenValueRenderer } from './CategoryValueChildrenRenderer';\nimport { CategoryFacet } from './CategoryFacet';\nimport { ICategoryFacetValue } from '../../rest/CategoryFacetValue';\nimport { CategoryValueParent, CategoryValue } from './CategoryValue';\n\nexport class CategoryValueRoot implements CategoryValueParent {\n  public path = [];\n  public categoryChildrenValueRenderer: CategoryChildrenValueRenderer;\n  public listRoot: Dom;\n\n  constructor(private element: Dom, categoryFacetTemplates: CategoryFacetTemplates, categoryFacet: CategoryFacet) {\n    this.categoryChildrenValueRenderer = new CategoryChildrenValueRenderer(element, categoryFacetTemplates, this, categoryFacet);\n    this.listRoot = categoryFacetTemplates.buildListRoot();\n    this.appendListRoot();\n  }\n\n  public renderChildren(values: ICategoryFacetValue[]) {\n    this.appendListRoot();\n    this.categoryChildrenValueRenderer.renderChildren(values);\n  }\n\n  public renderAsParent(value: ICategoryFacetValue): CategoryValue {\n    this.appendListRoot();\n    return this.categoryChildrenValueRenderer.renderAsParent(value);\n  }\n\n  public get children(): CategoryValue[] {\n    return this.categoryChildrenValueRenderer.children;\n  }\n\n  public clear() {\n    this.listRoot.detach();\n    this.listRoot.empty();\n    this.categoryChildrenValueRenderer.clearChildren();\n  }\n\n  private appendListRoot() {\n    this.element.append(this.listRoot.el);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryValueRoot.ts","import { Dom, $$ } from '../../utils/Dom';\nimport { CategoryFacetTemplates } from './CategoryFacetTemplates';\nimport { CategoryChildrenValueRenderer } from './CategoryValueChildrenRenderer';\nimport { CategoryFacet, CategoryValueDescriptor } from './CategoryFacet';\nimport { ICategoryFacetValue } from '../../rest/CategoryFacetValue';\nimport { analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\nimport { l } from '../../strings/Strings';\n\nexport interface CategoryValueParent {\n  listRoot: Dom;\n  path: string[];\n  categoryChildrenValueRenderer: CategoryChildrenValueRenderer;\n  renderAsParent(categoryFacetValue: ICategoryFacetValue): CategoryValue;\n  renderChildren(categoryFacetValues: ICategoryFacetValue[]): void;\n}\n\nexport class CategoryValue implements CategoryValueParent {\n  private collapseArrow: Dom;\n\n  public path: string[];\n  public element: Dom;\n  public isActive = false;\n  public categoryChildrenValueRenderer: CategoryChildrenValueRenderer;\n\n  constructor(\n    public listRoot: Dom,\n    public categoryValueDescriptor: CategoryValueDescriptor,\n    private categoryFacetTemplates: CategoryFacetTemplates,\n    private categoryFacet: CategoryFacet\n  ) {\n    this.element = this.categoryFacetTemplates.buildListElement({\n      value: this.captionedValueDescriptorValue,\n      count: this.categoryValueDescriptor.count\n    });\n    this.collapseArrow = this.categoryFacetTemplates.buildCollapseArrow();\n    this.categoryChildrenValueRenderer = new CategoryChildrenValueRenderer(this.element, categoryFacetTemplates, this, this.categoryFacet);\n    this.path = this.categoryValueDescriptor.path;\n  }\n\n  public render(isChild: boolean) {\n    if (this.pastMaximumDepth()) {\n      this.element.addClass('coveo-category-facet-last-value');\n    }\n\n    if (isChild) {\n      this.element.addClass('coveo-category-facet-child-value');\n    } else {\n      this.element.addClass('coveo-category-facet-parent-value');\n    }\n\n    this.listRoot.append(this.element.el);\n  }\n\n  public getDescriptor() {\n    return {\n      value: this.categoryValueDescriptor.value,\n      count: this.categoryValueDescriptor.count,\n      path: this.path\n    };\n  }\n\n  public clear() {\n    this.element.detach();\n    this.categoryChildrenValueRenderer.clearChildren();\n  }\n\n  public renderChildren(values: ICategoryFacetValue[]) {\n    this.isActive = true;\n    this.element.addClass('coveo-active-category-facet-parent');\n    this.categoryChildrenValueRenderer.renderChildren(values);\n  }\n\n  public renderAsParent(value: ICategoryFacetValue) {\n    return this.categoryChildrenValueRenderer.renderAsParent(value);\n  }\n\n  public get children() {\n    return this.categoryChildrenValueRenderer.children;\n  }\n\n  public makeSelectable() {\n    const element = $$(this.element.find('.coveo-category-facet-value-label'));\n    element.addClass('coveo-selectable');\n\n    const count = this.categoryValueDescriptor.count;\n    const countLabel = l('ResultCount', count.toString(), count);\n    const label = l('IncludeValueWithResultCount', this.captionedValueDescriptorValue, countLabel);\n\n    new AccessibleButton()\n      .withElement(element)\n      .withSelectAction(() => this.onSelect())\n      .withLabel(label)\n      .build();\n\n    return this;\n  }\n\n  public showCollapseArrow() {\n    if (!this.collapseArrow.el.parentElement) {\n      const label = this.element.find('label');\n      $$(label).prepend(this.collapseArrow.el);\n    }\n\n    return this;\n  }\n\n  private get captionedValueDescriptorValue() {\n    const value = this.categoryValueDescriptor.value;\n    return this.categoryFacet.getCaption(value);\n  }\n\n  private onSelect() {\n    if (!this.pastMaximumDepth()) {\n      this.categoryFacet.logAnalyticsEvent(analyticsActionCauseList.categoryFacetSelect, this.path);\n      this.categoryFacet.scrollToTop();\n      this.categoryFacet.changeActivePath(this.path);\n      this.categoryFacet.executeQuery();\n    }\n  }\n\n  private pastMaximumDepth() {\n    return this.path.length - this.categoryFacet.options.basePath.length >= this.categoryFacet.options.maximumDepth;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryValue.ts","import { CategoryFacet } from '../ui/CategoryFacet/CategoryFacet';\nimport { QueryBuilder } from '../ui/Base/QueryBuilder';\nimport { ICategoryFacetRequest } from '../rest/CategoryFacetRequest';\nimport { IGroupByRequest } from '../rest/GroupByRequest';\nimport { AllowedValuesPatternType } from '../rest/AllowedValuesPatternType';\nimport { IGroupByValue } from '../rest/GroupByValue';\nimport { Utils } from '../utils/Utils';\n\nexport class CategoryFacetQueryController {\n  constructor(private categoryFacet: CategoryFacet) {}\n\n  public putCategoryFacetInQueryBuilder(queryBuilder: QueryBuilder, path: string[], maximumNumberOfValues: number): number {\n    const positionInQuery = queryBuilder.categoryFacets.length;\n    this.addQueryFilter(queryBuilder, path);\n    this.addCategoryFacetRequest(queryBuilder, path, maximumNumberOfValues);\n    return positionInQuery;\n  }\n\n  public async searchFacetValues(value: string, numberOfValues: number): Promise<IGroupByValue[]> {\n    const lastQuery = { ...this.categoryFacet.queryController.getLastQuery() };\n\n    const groupByRequest: IGroupByRequest = {\n      allowedValues: [this.getAllowedValuesPattern(value)],\n      allowedValuesPatternType: AllowedValuesPatternType.Wildcards,\n      maximumNumberOfValues: numberOfValues,\n      field: this.categoryFacet.options.field as string,\n      sortCriteria: 'occurrences',\n      injectionDepth: this.categoryFacet.options.injectionDepth\n    };\n\n    lastQuery.groupBy = [groupByRequest];\n    lastQuery.categoryFacets.splice(this.categoryFacet.positionInQuery, 1);\n    const results = await this.categoryFacet.queryController.getEndpoint().search(lastQuery);\n\n    const sortByNumberOfResultsThenPathLength = (firstGroupByValue: IGroupByValue, secondGroupByValue: IGroupByValue) => {\n      if (firstGroupByValue.numberOfResults == secondGroupByValue.numberOfResults) {\n        return firstGroupByValue.value.length - secondGroupByValue.value.length;\n      }\n      return secondGroupByValue.numberOfResults - firstGroupByValue.numberOfResults;\n    };\n\n    return results.groupByResults[0].values.sort(sortByNumberOfResultsThenPathLength);\n  }\n\n  public addDebugGroupBy(queryBuilder: QueryBuilder, value: string) {\n    queryBuilder.groupByRequests.push({\n      field: this.categoryFacet.options.field as string,\n      allowedValues: [`.*${Utils.escapeRegexCharacter(value)}.*`],\n      allowedValuesPatternType: AllowedValuesPatternType.Regex\n    });\n  }\n\n  private shouldAddFilterToQuery(path: string[]) {\n    return path.length != 0 && !Utils.arrayEqual(path, this.categoryFacet.options.basePath);\n  }\n\n  private addQueryFilter(queryBuilder: QueryBuilder, path: string[]) {\n    if (this.shouldAddFilterToQuery(path)) {\n      queryBuilder.advancedExpression.addFieldExpression(this.categoryFacet.options.field as string, '==', [\n        path.join(this.categoryFacet.options.delimitingCharacter)\n      ]);\n    }\n  }\n\n  private addCategoryFacetRequest(queryBuilder: QueryBuilder, path: string[], maximumNumberOfValues: number) {\n    const categoryFacetsRequest: ICategoryFacetRequest = {\n      field: this.categoryFacet.options.field as string,\n      path,\n      injectionDepth: this.categoryFacet.options.injectionDepth,\n      maximumNumberOfValues,\n      delimitingCharacter: this.categoryFacet.options.delimitingCharacter\n    };\n    queryBuilder.categoryFacets.push(categoryFacetsRequest);\n  }\n\n  private getAllowedValuesPattern(value: string) {\n    const basePath = this.categoryFacet.options.basePath;\n    const delimiter = this.categoryFacet.options.delimitingCharacter;\n\n    if (Utils.isNonEmptyArray(basePath)) {\n      return `${basePath.join(delimiter)}${delimiter}*${value}*`;\n    }\n    return `*${value}*`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/CategoryFacetQueryController.ts","import { CategoryFacet } from './CategoryFacet';\nimport { FacetSearchElement } from '../Facet/FacetSearchElement';\nimport { pluck, debounce, last } from 'underscore';\nimport { $$, Dom } from '../../utils/Dom';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { l } from '../../strings/Strings';\nimport { IGroupByValue } from '../../rest/GroupByValue';\nimport 'styling/_CategoryFacetSearch';\nimport { StringUtils } from '../../utils/StringUtils';\nimport { analyticsActionCauseList, IAnalyticsCategoryFacetMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { IFacetSearch } from '../Facet/IFacetSearch';\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\nimport * as Globalize from 'globalize';\n\nexport class CategoryFacetSearch implements IFacetSearch {\n  public container: Dom | undefined;\n  public facetSearchElement: FacetSearchElement;\n  public displayNewValues: () => void;\n  public currentlyDisplayedResults: string[];\n  public moreValuesToFetch = true;\n  public facetSearchPromise: Promise<IIndexFieldValue[]>;\n\n  private numberOfValuesToFetch: number;\n\n  constructor(private categoryFacet: CategoryFacet, private displayButton = true) {\n    this.facetSearchElement = new FacetSearchElement(this);\n    this.displayNewValues = debounce(this.getDisplayNewValuesFunction(), this.categoryFacet.options.facetSearchDelay);\n    this.categoryFacet.root.addEventListener('click', (e: MouseEvent) => this.handleClickElsewhere(e));\n    this.numberOfValuesToFetch = this.categoryFacet.options.numberOfResultsInFacetSearch;\n  }\n\n  public get facetType() {\n    return CategoryFacet.ID;\n  }\n\n  public get facetTitle() {\n    return this.categoryFacet.options.title || this.categoryFacet.options.field.toString();\n  }\n\n  public setExpandedFacetSearchAccessibilityAttributes(searchResultsElements: HTMLElement) {\n    this.container.setAttribute('aria-expanded', 'true');\n  }\n\n  public setCollapsedFacetSearchAccessibilityAttributes() {\n    this.container.setAttribute('aria-expanded', 'false');\n  }\n\n  public build() {\n    this.container = $$('div', {\n      className: 'coveo-category-facet-search-container',\n      role: 'button'\n    });\n    this.container.toggleClass('coveo-category-facet-search-without-button', !this.displayButton);\n\n    this.displayButton && this.buildButton();\n\n    this.container.append(this.facetSearchElement.build());\n    $$(this.facetSearchElement.search).toggleClass('without-animation', !this.displayButton);\n    return this.container;\n  }\n\n  private buildButton() {\n    new AccessibleButton()\n      .withElement(this.container)\n      .withSelectAction(() => {\n        $$(this.categoryFacet.element).addClass('coveo-category-facet-searching');\n        this.focus();\n      })\n      .withLabel(l('SearchFacetResults', this.facetTitle))\n      .build();\n\n    this.buildfacetSearchPlaceholder();\n  }\n\n  public focus() {\n    this.facetSearchElement.focus();\n  }\n\n  public clear() {\n    this.dismissSearchResults();\n    this.container && this.container.detach();\n  }\n\n  public dismissSearchResults() {\n    this.removeNoResultsCssClasses();\n    $$(this.categoryFacet.element).removeClass('coveo-category-facet-searching');\n    $$(this.facetSearchElement.searchResults).empty();\n    this.facetSearchElement.clearSearchInput();\n    this.facetSearchElement.hideSearchResultsElement();\n    this.currentlyDisplayedResults = null;\n    this.numberOfValuesToFetch = this.categoryFacet.options.numberOfResultsInFacetSearch;\n    this.moreValuesToFetch = true;\n  }\n\n  public keyboardEventDefaultHandler() {\n    this.moreValuesToFetch = true;\n    this.displayNewValues();\n  }\n\n  public keyboardNavigationEnterPressed() {\n    this.selectCurrentResult();\n  }\n\n  public fetchMoreValues() {\n    this.numberOfValuesToFetch += this.categoryFacet.options.numberOfResultsInFacetSearch;\n    this.displayNewValues();\n  }\n\n  public getCaptions() {\n    const searchResults = $$(this.facetSearchElement.searchResults);\n    const captions = searchResults\n      .findAll('.coveo-category-facet-search-value-caption')\n      .concat(searchResults.findAll('.coveo-category-facet-search-path-parents'))\n      .concat(searchResults.findAll('.coveo-category-facet-search-path-last-value'));\n    return captions;\n  }\n\n  public updateAriaLive(text: string) {\n    this.categoryFacet.searchInterface.ariaLive.updateText(text);\n  }\n\n  private selectCurrentResult() {\n    if (this.facetSearchElement.currentResult) {\n      const currentResultPathData = this.facetSearchElement.currentResult.el.dataset.path;\n      const delimiter = this.categoryFacet.options.delimitingCharacter;\n      const path = currentResultPathData.split(delimiter);\n      this.categoryFacet.changeActivePath(path);\n      this.categoryFacet.logAnalyticsEvent(analyticsActionCauseList.categoryFacetSelect, path);\n      this.categoryFacet.executeQuery();\n      this.categoryFacet.scrollToTop();\n    }\n  }\n\n  private handleClickElsewhere(e: MouseEvent) {\n    const closestContainer = $$(<HTMLElement>e.target).closest('.coveo-category-facet-search-container');\n\n    const isSelfContainer = this.container && closestContainer === this.container.el;\n    if (!closestContainer || !isSelfContainer) {\n      this.dismissSearchResults();\n    }\n  }\n\n  private buildfacetSearchPlaceholder() {\n    const placeholder = $$('div', { className: 'coveo-category-facet-search-placeholder' });\n\n    const icon = $$('div', { className: 'coveo-category-facet-search-icon' }, SVGIcons.icons.checkboxHookExclusionMore);\n    SVGDom.addClassToSVGInContainer(icon.el, 'coveo-category-facet-search-icon-svg');\n\n    const label = $$('span', { className: 'coveo-category-facet-search-label' }, l('Search'));\n\n    placeholder.append(icon.el);\n    placeholder.append(label.el);\n    this.container.append(placeholder.el);\n  }\n\n  private getDisplayNewValuesFunction() {\n    return async () => {\n      this.facetSearchElement.showFacetSearchWaitingAnimation();\n      this.categoryFacet.logger.info('Triggering new Category Facet search');\n      const categoryFacetValues = await this.categoryFacet.categoryFacetQueryController.searchFacetValues(\n        this.facetSearchElement.input.value,\n        this.numberOfValuesToFetch\n      );\n      this.logAnalyticsEvent();\n      if (categoryFacetValues.length < this.numberOfValuesToFetch) {\n        this.moreValuesToFetch = false;\n      }\n      if (categoryFacetValues.length == 0) {\n        this.noFacetSearchResults();\n        return;\n      }\n      this.removeNoResultsCssClasses();\n      this.setFacetSearchResults(categoryFacetValues);\n\n      if (this.shouldPositionSearchResults) {\n        this.facetSearchElement.positionSearchResults();\n      }\n\n      this.facetSearchElement.hideFacetSearchWaitingAnimation();\n    };\n  }\n\n  private setFacetSearchResults(categoryFacetValues: IGroupByValue[]) {\n    $$(this.facetSearchElement.searchResults).empty();\n    this.currentlyDisplayedResults = pluck(categoryFacetValues, 'value');\n    for (let i = 0; i < categoryFacetValues.length; i++) {\n      const searchResult = this.buildFacetSearchValue(categoryFacetValues[i], i);\n      if (i == 0) {\n        this.facetSearchElement.setAsCurrentResult(searchResult);\n      }\n      this.facetSearchElement.appendToSearchResults(searchResult.el);\n    }\n    this.highlightCurrentQueryWithinSearchResults();\n    this.facetSearchElement.updateAriaLiveWithResults(\n      this.facetSearchElement.input.value,\n      this.currentlyDisplayedResults.length,\n      this.moreValuesToFetch\n    );\n  }\n\n  private getFormattedCount(count: number) {\n    return Globalize.format(count, 'n0');\n  }\n\n  private buildFacetSearchValue(categoryFacetValue: IGroupByValue, index: number) {\n    const path = categoryFacetValue.value.split(this.categoryFacet.options.delimitingCharacter);\n\n    const pathParents = path.slice(0, -1).length != 0 ? `${path.slice(0, -1).join('/')}/` : '';\n\n    const value = $$('span', { className: 'coveo-category-facet-search-value-caption' }, last(path));\n    const number = $$(\n      'span',\n      { className: 'coveo-category-facet-search-value-number' },\n      this.getFormattedCount(categoryFacetValue.numberOfResults)\n    );\n    const pathParentsCaption = $$('span', { className: 'coveo-category-facet-search-path-parents' }, pathParents);\n\n    const pathToValueCaption = $$('span', { className: 'coveo-category-facet-search-path' }, pathParentsCaption);\n\n    const firstRow = $$('div', { className: 'coveo-category-facet-search-first-row' }, value, number);\n    const secondRow = $$('div', { className: 'coveo-category-facet-search-second-row' }, pathToValueCaption);\n    const item = $$(\n      'li',\n      {\n        id: `coveo-category-facet-search-suggestion-${index}`,\n        role: 'option',\n        ariaSelected: 'false',\n        className: 'coveo-category-facet-search-value',\n        title: path\n      },\n      firstRow,\n      secondRow\n    );\n    item.el.dataset.path = categoryFacetValue.value;\n\n    const countLabel = l('ResultCount', this.getFormattedCount(categoryFacetValue.numberOfResults), categoryFacetValue.numberOfResults);\n    const label = l('IncludeValueWithResultCount', last(path), countLabel);\n\n    new AccessibleButton()\n      .withElement(item)\n      .withSelectAction(() => {\n        this.categoryFacet.changeActivePath(path);\n        this.categoryFacet.scrollToTop();\n        this.categoryFacet.logAnalyticsEvent(analyticsActionCauseList.categoryFacetSelect, path);\n        this.categoryFacet.executeQuery();\n      })\n      .withLabel(label)\n      .build();\n\n    return item;\n  }\n\n  private noFacetSearchResults() {\n    this.facetSearchElement.hideFacetSearchWaitingAnimation();\n    this.facetSearchElement.emptyAndShowNoResults();\n    $$(this.facetSearchElement.search).addClass('coveo-facet-search-no-results');\n    $$(this.categoryFacet.element).addClass('coveo-no-results');\n  }\n\n  private removeNoResultsCssClasses() {\n    this.facetSearchElement.search && $$(this.facetSearchElement.search).removeClass('coveo-facet-search-no-results');\n    $$(this.categoryFacet.element).removeClass('coveo-no-results');\n  }\n\n  private highlightCurrentQueryWithinSearchResults() {\n    const regex = new RegExp(`(${StringUtils.stringToRegex(this.facetSearchElement.input.value, true)})`, 'ig');\n    this.facetSearchElement.highlightCurrentQueryInSearchResults(regex);\n  }\n\n  private logAnalyticsEvent() {\n    this.categoryFacet.usageAnalytics.logCustomEvent<IAnalyticsCategoryFacetMeta>(\n      analyticsActionCauseList.categoryFacetSearch,\n      {\n        categoryFacetId: this.categoryFacet.options.id,\n        categoryFacetField: this.categoryFacet.options.field.toString(),\n        categoryFacetTitle: this.categoryFacet.options.title\n      },\n      this.categoryFacet.root\n    );\n  }\n\n  private get shouldPositionSearchResults() {\n    const searchResults = this.facetSearchElement.searchResults;\n    return searchResults && !searchResults.parentElement;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryFacetSearch.ts","import { $$ } from '../../utils/Dom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { CategoryValueDescriptor, CategoryFacet } from './CategoryFacet';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\nimport { l } from '../../strings/Strings';\nimport { without } from 'underscore';\n\nexport class CategoryFacetBreadcrumb {\n  constructor(\n    private categoryFacet: CategoryFacet,\n    private onClickHandler: (e: MouseEvent) => void,\n    private categoryValueDescriptor: CategoryValueDescriptor\n  ) {}\n\n  public build(): HTMLElement {\n    const clear = $$(\n      'span',\n      {\n        className: 'coveo-facet-breadcrumb-clear'\n      },\n      SVGIcons.icons.mainClear\n    );\n\n    const pathToRender = without(this.categoryValueDescriptor.path, ...this.categoryFacet.options.basePath);\n    const captionLabel = pathToRender.map(pathPart => this.categoryFacet.getCaption(pathPart)).join('/');\n\n    const breadcrumbTitle = $$('span', { className: 'coveo-category-facet-breadcrumb-title' }, `${this.categoryFacet.options.title}:`);\n    const valuesContainer = $$('span', { className: 'coveo-category-facet-breadcrumb-values' }, captionLabel, clear);\n\n    new AccessibleButton()\n      .withElement(valuesContainer)\n      .withLabel(l('RemoveFilterOn', captionLabel))\n      .withSelectAction(this.onClickHandler)\n      .build();\n\n    const breadcrumb = $$('span', { className: 'coveo-category-facet-breadcrumb' }, breadcrumbTitle, valuesContainer);\n    return breadcrumb.el;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryFacetBreadcrumb.ts","import { CategoryFacet } from './CategoryFacet';\nimport { IBuildingQueryEventArgs, QueryEvents, IQuerySuccessEventArgs } from '../../events/QueryEvents';\nimport { IGroupByResult } from '../../rest/GroupByResult';\nimport { QueryBuilder } from '../Base/QueryBuilder';\nimport { sortBy, chain } from 'underscore';\nimport { Logger } from '../../misc/Logger';\nimport { IGroupByValue } from '../../rest/GroupByValue';\n\nclass PathMap {\n  get: (key: string) => PathMap;\n  set: (key: string, value?: PathMap) => void;\n}\n\ntype DebugGroupByPositionInQuery = {\n  start: number;\n  end: number;\n};\n\nexport class CategoryFacetDebug {\n  private static logger = new Logger(CategoryFacet);\n  private positionInQuery: DebugGroupByPositionInQuery;\n  constructor(private categoryFacet: CategoryFacet) {\n    this.categoryFacet.bind.onRootElement<IBuildingQueryEventArgs>(QueryEvents.buildingQuery, args => this.handleBuildingQuery(args));\n    this.categoryFacet.bind.onRootElement<IQuerySuccessEventArgs>(QueryEvents.querySuccess, args => {\n      this.handleQuerySuccess(args);\n    });\n  }\n\n  private handleBuildingQuery(args: IBuildingQueryEventArgs) {\n    const firstPositionInQuery = args.queryBuilder.groupByRequests.length;\n    if (this.categoryFacet.activePath.length == 0) {\n      this.positionInQuery = { start: firstPositionInQuery, end: firstPositionInQuery + 1 };\n      this.addGroupByForEmptyPath(args.queryBuilder);\n    } else {\n      const path = this.categoryFacet.activePath;\n      this.positionInQuery = { start: firstPositionInQuery, end: firstPositionInQuery + path.length };\n      this.addGroupByForEachPathElement(args.queryBuilder, path);\n    }\n  }\n\n  private handleQuerySuccess(args: IQuerySuccessEventArgs) {\n    args.results.groupByResults\n      .slice(this.positionInQuery.start, this.positionInQuery.end)\n      .forEach(groupByResult => CategoryFacetDebug.analyzeResults(groupByResult, this.categoryFacet.options.delimitingCharacter));\n  }\n\n  private addGroupByForEmptyPath(queryBuilder: QueryBuilder) {\n    queryBuilder.groupByRequests.push({\n      field: this.categoryFacet.options.field as string,\n      injectionDepth: this.categoryFacet.options.injectionDepth\n    });\n  }\n\n  private addGroupByForEachPathElement(queryBuilder: QueryBuilder, path: string[]) {\n    path.forEach(pathElement => {\n      this.categoryFacet.categoryFacetQueryController.addDebugGroupBy(queryBuilder, pathElement);\n    });\n  }\n\n  public static analyzeResults(groupByResults: IGroupByResult, delimiter: string) {\n    const treeRoot: PathMap = new Map<string, PathMap>();\n    const orphans: string[] = [];\n\n    let paths = this.buildPathsFromGroupByValues(groupByResults.values, delimiter);\n    paths = sortBy(paths, value => value.length);\n\n    paths.forEach(path => {\n      if (path.length == 1) {\n        this.addFirstNodeToTree(treeRoot, path);\n      } else {\n        let pathIsValid = true;\n        const parentsOnly = path.slice(0, -1);\n        let currentNode = treeRoot;\n        for (const parent of parentsOnly) {\n          currentNode = currentNode.get(parent);\n          if (!currentNode) {\n            this.processOrphan(orphans, path, delimiter);\n            pathIsValid = false;\n            break;\n          }\n        }\n        if (pathIsValid) {\n          this.addValidNodeToTree(currentNode, path);\n        }\n      }\n    });\n    return orphans;\n  }\n\n  private static buildPathsFromGroupByValues(values: IGroupByValue[], delimiter: string) {\n    return chain(values)\n      .pluck('value')\n      .map((value: string) => value.split(delimiter))\n      .sortBy(value => value.length)\n      .value();\n  }\n\n  private static addFirstNodeToTree(treeRoot: PathMap, path: string[]) {\n    treeRoot.set(path[0], new Map<string, PathMap>());\n  }\n\n  private static addValidNodeToTree(node: PathMap, path: string[]) {\n    node.set(path.slice(-1)[0], new Map<string, PathMap>());\n  }\n\n  private static processOrphan(orphans: string[], path: string[], delimiter: string) {\n    const formattedOrphan = path.join(delimiter);\n    orphans.push(formattedOrphan);\n    this.logger.error(`Value ${formattedOrphan} has no parent.`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryFacetDebug.ts","import { CategoryFacet } from './CategoryFacet';\nimport { $$ } from '../../utils/Dom';\nimport { l } from '../../strings/Strings';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\n\nexport interface ICategoryFacetHeaderOptions {\n  categoryFacet: CategoryFacet;\n  title: string;\n}\n\nexport class CategoryFacetHeader {\n  public element: HTMLElement;\n\n  constructor(private options: ICategoryFacetHeaderOptions) {\n    this.element = document.createElement('div');\n    $$(this.element).addClass('coveo-facet-header');\n  }\n\n  public build(): HTMLElement {\n    const waitElement = this.buildWaitAnimation();\n\n    const titleSection = $$(\n      'div',\n      {\n        className: 'coveo-category-facet-title',\n        role: 'heading',\n        'aria-level': '2',\n        'aria-label': `${l('FacetTitle', this.options.title)}.`\n      },\n      this.options.title\n    );\n    this.element = $$('div', { className: 'coveo-category-facet-header' }, titleSection).el;\n    $$(this.element).append(waitElement);\n\n    const eraserElement = this.buildEraser();\n    $$(this.element).append(eraserElement);\n    return this.element;\n  }\n\n  private buildWaitAnimation(): HTMLElement {\n    const waitElement = $$('div', { className: CategoryFacet.WAIT_ELEMENT_CLASS }, SVGIcons.icons.loading).el;\n    SVGDom.addClassToSVGInContainer(waitElement, 'coveo-category-facet-header-wait-animation-svg');\n    waitElement.style.visibility = 'hidden';\n    return waitElement;\n  }\n\n  private buildEraser() {\n    const eraserElement = $$('div', { className: 'coveo-category-facet-header-eraser coveo-facet-header-eraser' }, SVGIcons.icons.mainClear)\n      .el;\n\n    SVGDom.addClassToSVGInContainer(eraserElement, 'coveo-facet-header-eraser-svg');\n\n    const onClearClick = () => {\n      this.options.categoryFacet.reset();\n      this.options.categoryFacet.scrollToTop();\n    };\n\n    new AccessibleButton()\n      .withElement(eraserElement)\n      .withLabel(l('Clear', this.options.title))\n      .withClickAction(onClearClick)\n      .withEnterKeyboardAction(onClearClick)\n      .build();\n\n    return eraserElement;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryFacetHeader.ts","import { ICategoryFacetValue } from '../../rest/CategoryFacetValue';\nimport { ICategoryFacetResult } from '../../rest/CategoryFacetResult';\nimport { find } from 'underscore';\n\nexport type ISeenValue = { result: ICategoryFacetValue; children: ISeenValue[] };\n\nexport class CategoryFacetValuesTree {\n  public seenValues: ISeenValue[] = [];\n\n  public getValueForLastPartInPath(path: string[]) {\n    const nullCategoryFacetValue: ICategoryFacetValue = { value: '', numberOfResults: 0 };\n    let currentNode: ISeenValue;\n\n    for (const part of path) {\n      const nodesToSearch = currentNode ? currentNode.children : this.seenValues;\n      const node = this.findNodeWithValue(nodesToSearch, part);\n\n      if (!node) {\n        return nullCategoryFacetValue;\n      }\n\n      currentNode = node;\n    }\n\n    return currentNode ? currentNode.result : nullCategoryFacetValue;\n  }\n\n  public storeNewValues(categoryFacetResult: ICategoryFacetResult) {\n    let currentNodes = this.seenValues;\n\n    for (const parent of categoryFacetResult.parentValues) {\n      const node = this.findNodeWithValue(currentNodes, parent.value);\n\n      if (!node) {\n        const newNode: ISeenValue = { result: parent, children: [] };\n        currentNodes.push(newNode);\n      }\n\n      currentNodes = this.findNodeWithValue(currentNodes, parent.value).children;\n    }\n\n    categoryFacetResult.values\n      .filter(result => !this.findNodeWithValue(currentNodes, result.value))\n      .forEach(result => currentNodes.push({ result, children: [] }));\n  }\n\n  private findNodeWithValue(nodes: ISeenValue[], value: string) {\n    return find(nodes, node => node.result.value === value);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryFacetValuesTree.ts","import { Assert } from '../../misc/Assert';\nimport { Utils } from '../../utils/Utils';\nimport { IGroupByResult } from '../../rest/GroupByResult';\nimport { FacetValue } from './FacetValue';\nimport * as _ from 'underscore';\nimport { FacetValuesOrder } from './FacetValuesOrder';\n\nexport interface ISortFacetValuesOptions {\n  facetValuesOrder: FacetValuesOrder;\n  numberOfValues: number;\n}\n\nexport class FacetValues {\n  private values: FacetValue[];\n\n  constructor(groupByResult?: IGroupByResult) {\n    if (Utils.exists(groupByResult)) {\n      this.values = _.map(groupByResult.values, groupByValue => FacetValue.createFromGroupByValue(groupByValue));\n    } else {\n      this.values = [];\n    }\n  }\n\n  add(facetValue: FacetValue) {\n    Assert.exists(facetValue);\n    Assert.check(!this.contains(facetValue.value));\n    this.values.push(facetValue);\n  }\n\n  remove(value: string) {\n    Assert.isNonEmptyString(value);\n    value = value;\n    this.values = _.filter(this.values, (elem: FacetValue) => elem.value != value);\n  }\n\n  size(): number {\n    return this.values.length;\n  }\n\n  isEmpty(): boolean {\n    return this.values.length == 0;\n  }\n\n  at(index: number): FacetValue {\n    Assert.isLargerOrEqualsThan(0, index);\n    Assert.isSmallerThan(this.values.length, index);\n    return this.values[index];\n  }\n\n  get(value: string): FacetValue {\n    return _.find(this.values, (elem: FacetValue) => elem.value.toLowerCase() == value.toLowerCase());\n  }\n\n  contains(value: string): boolean {\n    return Utils.exists(this.get(value));\n  }\n\n  getAll(): FacetValue[] {\n    return this.values;\n  }\n\n  getSelected(): FacetValue[] {\n    return _.filter(this.values, (value: FacetValue) => value.selected);\n  }\n\n  getExcluded(): FacetValue[] {\n    return _.filter(this.values, (value: FacetValue) => value.excluded);\n  }\n\n  hasSelectedOrExcludedValues(): boolean {\n    return this.getSelected().length != 0 || this.getExcluded().length != 0;\n  }\n\n  hasSelectedAndExcludedValues(): boolean {\n    return this.getSelected().length != 0 && this.getExcluded().length != 0;\n  }\n\n  hasOnlyExcludedValues(): boolean {\n    return this.getSelected().length == 0 && this.getExcluded().length != 0;\n  }\n\n  hasOnlySelectedValues(): boolean {\n    return this.getSelected().length != 0 && this.getExcluded().length == 0;\n  }\n\n  reset() {\n    _.each(this.values, (elem: FacetValue) => elem.reset());\n  }\n\n  importActiveValuesFromOtherList(other: FacetValues) {\n    Assert.exists(other);\n\n    _.each(other.getSelected(), (otherValue: FacetValue) => {\n      var myValue = this.get(otherValue.value);\n      if (Utils.exists(myValue)) {\n        myValue.selected = true;\n      } else {\n        this.values.push(otherValue.cloneWithZeroOccurrences());\n      }\n    });\n\n    _.each(other.getExcluded(), (otherValue: FacetValue) => {\n      var myValue = this.get(otherValue.value);\n      if (Utils.exists(myValue)) {\n        myValue.excluded = true;\n      } else if (otherValue.occurrences != 0) {\n        var occurrences = otherValue.occurrences;\n        var clone = otherValue.cloneWithZeroOccurrences();\n        clone.occurrences = occurrences;\n        this.values.push(clone);\n      } else {\n        this.values.push(otherValue.cloneWithZeroOccurrences());\n      }\n    });\n  }\n\n  updateCountsFromNewValues(newValues: FacetValues) {\n    Assert.exists(newValues);\n\n    this.values = _.map(this.values, (myValue: FacetValue) => {\n      var newValue = newValues.get(myValue.value);\n      if (Utils.exists(newValue)) {\n        myValue.updateCountsFromNewValue(newValue);\n        return myValue;\n      } else if (myValue.occurrences == null) {\n        return myValue.cloneWithZeroOccurrences();\n      }\n      return myValue;\n    });\n  }\n\n  updateDeltaWithFilteredFacetValues(filtered: FacetValues, isMultiValueField: boolean) {\n    Assert.exists(filtered);\n    _.each(this.values, (unfilteredValue: FacetValue) => {\n      var filteredValue = filtered.get(unfilteredValue.value);\n      unfilteredValue.waitingForDelta = false;\n      if (Utils.exists(filteredValue)) {\n        if (unfilteredValue.occurrences - filteredValue.occurrences > 0) {\n          // When there are only exclusion in the facet, there should be no \"delta\"\n          // The number of value for each facet will be what is selected, no addition.\n          if (this.hasOnlyExcludedValues()) {\n            unfilteredValue.delta = null;\n            unfilteredValue.occurrences = filteredValue.occurrences;\n          } else {\n            unfilteredValue.delta = unfilteredValue.occurrences - filteredValue.occurrences;\n          }\n        } else {\n          unfilteredValue.delta = null;\n        }\n      } else if (!unfilteredValue.selected && !unfilteredValue.excluded) {\n        if (isMultiValueField && filtered.values.length == 0) {\n          unfilteredValue.delta = null;\n          unfilteredValue.occurrences = 0;\n        } else {\n          unfilteredValue.delta = unfilteredValue.occurrences;\n        }\n      }\n    });\n  }\n\n  mergeWithUnfilteredFacetValues(unfiltered: FacetValues) {\n    Assert.exists(unfiltered);\n\n    var values: FacetValue[] = [];\n    _.each(unfiltered.values, (unfilteredValue: FacetValue) => {\n      var filteredValue = this.get(unfilteredValue.value);\n      if (Utils.exists(filteredValue)) {\n        if (filteredValue.occurrences == unfilteredValue.occurrences) {\n          values.push(filteredValue);\n        } else {\n          values.push(unfilteredValue.cloneWithDelta(unfilteredValue.occurrences, unfilteredValue.occurrences - filteredValue.occurrences));\n        }\n      } else {\n        values.push(unfilteredValue.cloneWithDelta(unfilteredValue.occurrences, unfilteredValue.occurrences));\n      }\n    });\n\n    var index = 0;\n    _.each(this.values, (value: FacetValue) => {\n      var unfilteredValue = unfiltered.get(value.value);\n      if (!Utils.exists(unfilteredValue)) {\n        if (value.selected || value.excluded) {\n          values.splice(index, 0, value);\n          index++;\n        }\n      } else {\n        for (var i = 0; i < values.length; i++) {\n          if (values[i].value == value.value) {\n            index = i + 1;\n            break;\n          }\n        }\n      }\n    });\n    this.values = values;\n  }\n\n  sort(options: ISortFacetValuesOptions) {\n    const { facetValuesOrder, numberOfValues } = options;\n\n    this.values = facetValuesOrder.reorderValuesIfUsingAlphabeticalSort(this.values);\n    this.sortValuesDependingOnStatus(numberOfValues);\n    this.values = facetValuesOrder.reorderValuesIfUsingCustomSort(this.values);\n  }\n\n  sortValuesDependingOnStatus(numOfDisplayedValues: number) {\n    this.values = _.sortBy(this.values, (value: FacetValue) => {\n      if (value.selected) {\n        return 1;\n      } else if (value.excluded) {\n        return 3;\n      } else {\n        return 2;\n      }\n    });\n\n    this.ensureExcludedValuesAreDisplayed(numOfDisplayedValues);\n  }\n\n  private ensureExcludedValuesAreDisplayed(numOfDisplayedValues: number) {\n    if (numOfDisplayedValues != null && numOfDisplayedValues < this.values.length) {\n      var nbExclude = this.getExcluded().length;\n      var excludedValues = this.values.splice(this.values.length - nbExclude, nbExclude);\n      this.values.splice(numOfDisplayedValues - nbExclude, 0, ...excludedValues);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetValues.ts","/// <reference path=\"HierarchicalFacet.ts\" />\n\nimport { FacetValuesList } from '../Facet/FacetValuesList';\nimport { FacetValue } from '../Facet/FacetValue';\nimport { HierarchicalFacet, IValueHierarchy } from './HierarchicalFacet';\nimport { IFacetValueElementKlass } from '../Facet/FacetValueElement';\nimport * as _ from 'underscore';\n\nexport class HierarchicalFacetValuesList extends FacetValuesList {\n  public hierarchyFacetValues: FacetValue[];\n\n  constructor(public facet: HierarchicalFacet, public facetValueElementKlass: IFacetValueElementKlass) {\n    super(facet, facetValueElementKlass);\n  }\n\n  public sortFacetValues(hierarchyFacetValues = this.hierarchyFacetValues): FacetValue[] {\n    if (!this.facet.shouldReshuffleFacetValuesClientSide) {\n      let sortArray = _.map(hierarchyFacetValues, (hierarchy: FacetValue, idx: number) => {\n        return {\n          hierarchy: hierarchy,\n          idx: idx\n        };\n      });\n\n      // If we exclude the top level, the alpha order is not respected (since it is done by the index, and the first level is omitted by client side code).\n      // Do the ordering client side, in the precise case where its alpha ordering and the starting level is not 0;\n      if (\n        this.facet.options.levelStart != 0 &&\n        this.facet.options.sortCriteria &&\n        this.facet.options.sortCriteria.toLowerCase().indexOf('alpha') != -1\n      ) {\n        let reversed = this.facet.options.sortCriteria.toLowerCase().indexOf('descending') != -1;\n\n        sortArray = sortArray.sort((first, second) => {\n          let firstInTopLevel =\n            _.find(this.facet.topLevelHierarchy, (hierarchy: IValueHierarchy) => {\n              return hierarchy.facetValue.value.toLowerCase() == first.hierarchy.value.toLowerCase();\n            }) != null;\n\n          let secondInTopLevel =\n            _.find(this.facet.topLevelHierarchy, (hierarchy: IValueHierarchy) => {\n              return hierarchy.facetValue.value.toLowerCase() == first.hierarchy.value.toLowerCase();\n            }) != null;\n\n          if (firstInTopLevel && secondInTopLevel) {\n            let firstValue = this.facet.getValueCaption(first.hierarchy);\n            let secondValue = this.facet.getValueCaption(second.hierarchy);\n            let compared = firstValue.localeCompare(secondValue);\n            return reversed ? -1 * compared : compared;\n          }\n          return first.idx - second.idx;\n        });\n      }\n\n      // Normally facet values are sorted by selected first, then inactive, then excluded values.\n      // For hierarchical, we want selected first, then those that have childs selected, then normal sorting.\n      sortArray = sortArray.sort((first, second) => {\n        if (first.hierarchy.selected === second.hierarchy.selected) {\n          let firstFromHierarchy = this.facet.getValueFromHierarchy(first.hierarchy);\n          let secondFromHierarchy = this.facet.getValueFromHierarchy(second.hierarchy);\n          if (firstFromHierarchy.hasChildSelected === secondFromHierarchy.hasChildSelected) {\n            return first.idx - second.idx;\n          } else {\n            return firstFromHierarchy.hasChildSelected ? -1 : 1;\n          }\n        } else {\n          return first.hierarchy.selected ? -1 : 1;\n        }\n      });\n      return _.pluck(sortArray, 'hierarchy');\n    }\n    return hierarchyFacetValues;\n  }\n\n  protected getValuesToBuildWith() {\n    if (this.facet.shouldReshuffleFacetValuesClientSide) {\n      return this.hierarchyFacetValues;\n    } else {\n      return this.sortFacetValues();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalFacetValuesList.ts","/// <reference path=\"../ui/HierarchicalFacet/HierarchicalFacet.ts\" />\n/// <reference path=\"./FacetQueryController.ts\" />\n\nimport { FacetQueryController } from './FacetQueryController';\nimport { HierarchicalFacet, IValueHierarchy } from '../ui/HierarchicalFacet/HierarchicalFacet';\nimport { FacetSearchParameters } from '../ui/Facet/FacetSearchParameters';\nimport { IIndexFieldValue } from '../rest/FieldValue';\nimport { FacetUtils } from '../ui/Facet/FacetUtils';\nimport * as _ from 'underscore';\n\nexport class HierarchicalFacetQueryController extends FacetQueryController {\n  constructor(public facet: HierarchicalFacet) {\n    super(facet);\n  }\n\n  public search(params: FacetSearchParameters, oldLength = params.nbResults): Promise<IIndexFieldValue[]> {\n    // Do a client side search, since HierarchicalFacet should normally have all value client side\n    let regex = FacetUtils.getRegexToUseForFacetSearch(\n      this.facet.facetSearch.getValueInInputForFacetSearch(),\n      this.facet.options.facetSearchIgnoreAccents\n    );\n    return new Promise<IIndexFieldValue[]>(resolve => {\n      const match = _.chain(this.facet.getAllValueHierarchy())\n        .toArray()\n        .filter((v: IValueHierarchy) => {\n          return (\n            this.facet.getValueCaption(v.facetValue).match(regex) != null &&\n            !_.contains(<any>_.map(params.alwaysExclude, toExclude => toExclude.toLowerCase()), v.facetValue.value.toLowerCase())\n          );\n        })\n        .first(this.facet.options.numberOfValuesInFacetSearch)\n        .value();\n\n      const facetValues: IIndexFieldValue[] = _.map(match, (v: IValueHierarchy) => {\n        return <any>v.facetValue;\n      });\n\n      resolve(facetValues);\n    });\n  }\n\n  protected getAllowedValuesFromSelected() {\n    return [];\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/HierarchicalFacetQueryController.ts","/// <reference path=\"../Facet/Facet.ts\" />\n\nimport { Facet } from '../Facet/Facet';\nimport { FacetSearchValuesList } from '../Facet/FacetSearchValuesList';\nimport { HierarchicalFacetSearchValueElement } from './HierarchicalFacetSearchValueElement';\n\nexport class HierarchicalFacetSearchValuesList extends FacetSearchValuesList {\n  constructor(public facet: Facet) {\n    super(facet, HierarchicalFacetSearchValueElement);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalFacetSearchValuesList.ts","import { FacetValueElement } from '../Facet/FacetValueElement';\nimport { HierarchicalFacet } from '../HierarchicalFacet/HierarchicalFacet';\nimport { IValueElementEventsBinding } from '../Facet/ValueElement';\nimport { FacetValue } from '../Facet/FacetValue';\n\nexport class HierarchicalFacetSearchValueElement extends FacetValueElement {\n  constructor(public facet: HierarchicalFacet, public facetValue: FacetValue, public keepDisplayedValueNextTime: boolean) {\n    super(facet, facetValue, keepDisplayedValueNextTime);\n  }\n\n  public _handleSelectValue(eventBindings: IValueElementEventsBinding) {\n    this.facet.open(this.facetValue);\n    super.handleSelectValue(eventBindings);\n  }\n\n  public _handleExcludeClick(eventBindings: IValueElementEventsBinding) {\n    this.facet.open(this.facetValue);\n    super.handleExcludeClick(eventBindings);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalFacetSearchValueElement.ts","/// <reference path=\"HierarchicalFacet.ts\" />\n\nimport { FacetSearch } from '../Facet/FacetSearch';\nimport { HierarchicalFacet, IValueHierarchy } from './HierarchicalFacet';\nimport { IFacetSearchValuesListKlass } from '../Facet/FacetSearchValuesList';\nimport { FacetSearchParameters } from '../Facet/FacetSearchParameters';\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport { FacetValue } from '../Facet/FacetValue';\nimport { Utils } from '../../utils/Utils';\nimport { ModalBox } from '../../ExternalModulesShim';\nimport * as _ from 'underscore';\n\nexport class HierarchicalFacetSearch extends FacetSearch {\n  constructor(public facet: HierarchicalFacet, public facetSearchValuesListKlass: IFacetSearchValuesListKlass, root: HTMLElement) {\n    super(facet, facetSearchValuesListKlass, root);\n  }\n\n  protected buildParamsForExcludingCurrentlyDisplayedValues() {\n    var params = super.buildParamsForExcludingCurrentlyDisplayedValues();\n    params.alwaysExclude = this.facet.getDisplayedValues();\n    if (this.facet.facetSearch.currentlyDisplayedResults) {\n      params.alwaysExclude = params.alwaysExclude.concat(this.facet.facetSearch.currentlyDisplayedResults);\n    }\n    return params;\n  }\n\n  protected selectAllValuesMatchingSearch() {\n    this.facet.showWaitingAnimation();\n\n    var searchParameters = new FacetSearchParameters(this.facet);\n    searchParameters.nbResults = this.facet.numberOfValues;\n    searchParameters.alwaysInclude = this.facet.getDisplayedValues();\n    searchParameters.setValueToSearch(this.getValueInInputForFacetSearch());\n    this.facet.facetQueryController.search(searchParameters).then((fieldValues: IIndexFieldValue[]) => {\n      this.dismissSearchResults();\n      ModalBox.close(true);\n      var facetValues = this.getFacetValues(fieldValues);\n      this.facet.processFacetSearchAllResultsSelected(facetValues);\n    });\n    this.dismissSearchResults();\n  }\n\n  private getFacetValues(fieldValues: IIndexFieldValue[]): FacetValue[] {\n    var values = [];\n    _.each(fieldValues, fieldValue => {\n      var hierarchy = this.facet.getValueFromHierarchy(fieldValue.value);\n      values.push(this.createFacetValuesFromHierarchy(hierarchy));\n    });\n    return _.flatten(values);\n  }\n\n  private createFacetValuesFromHierarchy(hierarchy: IValueHierarchy): FacetValue[] {\n    var values = [];\n    var fieldValue = hierarchy.facetValue.value;\n    var facetValue = this.facet.values.get(fieldValue);\n    if (!Utils.exists(facetValue)) {\n      facetValue = FacetValue.create(fieldValue);\n    }\n    facetValue.selected = true;\n    facetValue.excluded = false;\n    values.push(facetValue);\n    var childs = hierarchy.childs;\n    _.each(childs, child => {\n      var childHierarchy = this.facet.getValueFromHierarchy(child.facetValue.value);\n      values.push(this.createFacetValuesFromHierarchy(childHierarchy));\n    });\n    return values;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalFacetSearch.ts","/// <reference path=\"HierarchicalFacet.ts\" />\n\nimport { BreadcrumbValueList } from '../Facet/BreadcrumbValuesList';\nimport { HierarchicalFacet, IValueHierarchy } from './HierarchicalFacet';\nimport { FacetValue } from '../Facet/FacetValue';\nimport { HierarchicalBreadcrumbValueElement } from './HierarchicalBreadcrumbValueElement';\nimport { $$ } from '../../utils/Dom';\nimport * as _ from 'underscore';\n\nexport class HierarchicalBreadcrumbValuesList extends BreadcrumbValueList {\n  constructor(\n    public facet: HierarchicalFacet,\n    public facetValues: FacetValue[],\n    public valueHierarchy: { [facetValue: string]: IValueHierarchy }\n  ) {\n    super(facet, facetValues, HierarchicalBreadcrumbValueElement);\n  }\n\n  public buildAsString() {\n    this.build();\n    if (this.elem) {\n      let joined =\n        `${this.facet.options.title}: ` +\n        _.map($$(this.elem).findAll('.coveo-facet-breadcrumb-value'), (value: HTMLElement) => {\n          _.each($$(value).findAll('.coveo-hierarchical-breadcrumb-separator'), separator => {\n            // small right black triangle\n            $$(separator).text('\\u25B8');\n          });\n          return $$(value).text();\n        }).join(', ');\n      return joined;\n    }\n    return '';\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalBreadcrumbValuesList.ts","import { BreadcrumbValueElement } from '../Facet/BreadcrumbValueElement';\nimport { FacetValue } from '../Facet/FacetValue';\nimport { HierarchicalFacet } from './HierarchicalFacet';\nimport { Dom } from '../../utils/Dom';\nimport * as _ from 'underscore';\n\nexport class HierarchicalBreadcrumbValueElement extends BreadcrumbValueElement {\n  constructor(public facet: HierarchicalFacet, public facetValue: FacetValue) {\n    super(facet, facetValue);\n  }\n\n  public build(): Dom {\n    var build = super.build();\n    build.addClass('coveo-hierarchical-facet-value');\n    var caption = build.find('.coveo-facet-breadcrumb-caption');\n    var values = this.facetValue.value.split(this.facet.options.delimitingCharacter);\n    values = _.map(values, v => {\n      return _.escape(v);\n    });\n    caption.innerHTML = values.join(\"<span class='coveo-hierarchical-breadcrumb-separator'></span>\");\n    return build;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalBreadcrumbValueElement.ts","/// <reference path=\"../HierarchicalFacet/HierarchicalFacet.ts\" />\n\nimport { OmniboxValuesList } from '../Facet/OmniboxValuesList';\nimport { FacetValue } from '../Facet/FacetValue';\nimport { HierarchicalFacet } from '../HierarchicalFacet/HierarchicalFacet';\nimport { IPopulateOmniboxObject } from '../Omnibox/OmniboxInterface';\nimport { OmniboxHierarchicalValueElement } from './OmniboxHierarchicalValueElement';\n\nexport class OmniboxHierarchicalValuesList extends OmniboxValuesList {\n  constructor(public facet: HierarchicalFacet, public facetValues: FacetValue[], public omniboxObject: IPopulateOmniboxObject) {\n    super(facet, facetValues, omniboxObject, OmniboxHierarchicalValueElement);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/OmniboxHierarchicalValuesList.ts","/// <reference path=\"HierarchicalFacet.ts\" />\n\nimport { OmniboxValueElement } from '../Facet/OmniboxValueElement';\nimport { HierarchicalFacet } from './HierarchicalFacet';\nimport { FacetValue } from '../Facet/FacetValue';\nimport { IPopulateOmniboxObject } from '../Omnibox/OmniboxInterface';\nimport { IValueElementEventsBinding } from '../Facet/ValueElement';\n\nexport class OmniboxHierarchicalValueElement extends OmniboxValueElement {\n  constructor(public facet: HierarchicalFacet, public facetValue: FacetValue, public eventArg: IPopulateOmniboxObject) {\n    super(facet, facetValue, eventArg);\n  }\n\n  public _handleSelectValue(eventBindings: IValueElementEventsBinding) {\n    this.facet.open(this.facetValue);\n    super.handleSelectValue(eventBindings);\n  }\n\n  public _handleExcludeClick(eventBindings: IValueElementEventsBinding) {\n    this.facet.open(this.facetValue);\n    super.handleExcludeClick(eventBindings);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/OmniboxHierarchicalValueElement.ts","/// <reference path=\"HierarchicalFacet.ts\" />\n\nimport { FacetValueElement } from '../Facet/FacetValueElement';\nimport { HierarchicalFacet } from './HierarchicalFacet';\nimport { FacetValue } from '../Facet/FacetValue';\n\nexport class HierarchicalFacetValueElement extends FacetValueElement {\n  constructor(public facet: HierarchicalFacet, public facetValue: FacetValue, public keepDisplayedValueNextTime: boolean) {\n    super(facet, facetValue, keepDisplayedValueNextTime);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/HierarchicalFacet/HierarchicalFacetValueElement.ts","import 'styling/_Facet';\nimport 'styling/_FacetFooter';\nimport * as _ from 'underscore';\nimport { FacetQueryController } from '../../controllers/FacetQueryController';\nimport { BreadcrumbEvents, IClearBreadcrumbEventArgs, IPopulateBreadcrumbEventArgs } from '../../events/BreadcrumbEvents';\nimport { IPopulateOmniboxEventArgs, OmniboxEvents } from '../../events/OmniboxEvents';\nimport { IDoneBuildingQueryEventArgs, INewQueryEventArgs, IQuerySuccessEventArgs, QueryEvents } from '../../events/QueryEvents';\nimport { ISearchAlertsPopulateMessageEventArgs, SearchAlertsEvents } from '../../events/SearchAlertEvents';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Assert } from '../../misc/Assert';\nimport { Defer } from '../../misc/Defer';\nimport { IAttributesChangedEventArg, MODEL_EVENTS } from '../../models/Model';\nimport { IQueryStateExcludedAttribute, IQueryStateIncludedAttribute, QueryStateModel } from '../../models/QueryStateModel';\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport { IStringMap } from '../../rest/GenericParam';\nimport { IGroupByResult } from '../../rest/GroupByResult';\nimport { IGroupByValue } from '../../rest/GroupByValue';\nimport { IQueryResults } from '../../rest/QueryResults';\nimport { ISearchEndpoint } from '../../rest/SearchEndpointInterface';\nimport { l } from '../../strings/Strings';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\nimport { ComponentsTypes } from '../../utils/ComponentsTypes';\nimport {\n  DependsOnManager,\n  IDependentFacet,\n  IDependsOnCompatibleFacetOptions,\n  IDependentFacetCondition\n} from '../../utils/DependsOnManager';\nimport { DeviceUtils } from '../../utils/DeviceUtils';\nimport { $$, Win } from '../../utils/Dom';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { Utils } from '../../utils/Utils';\nimport {\n  analyticsActionCauseList,\n  IAnalyticsActionCause,\n  IAnalyticsFacetMeta,\n  IAnalyticsFacetSortMeta\n} from '../Analytics/AnalyticsActionListMeta';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IFieldOption, IQueryExpression } from '../Base/IComponentOptions';\nimport { Initialization } from '../Base/Initialization';\nimport { IOmniboxDataRow } from '../Omnibox/OmniboxInterface';\nimport { IResponsiveComponentOptions } from '../ResponsiveComponents/ResponsiveComponentsManager';\nimport { ResponsiveFacetOptions } from '../ResponsiveComponents/ResponsiveFacetOptions';\nimport { ResponsiveFacets } from '../ResponsiveComponents/ResponsiveFacets';\nimport { BreadcrumbValueElement } from './BreadcrumbValueElement';\nimport { BreadcrumbValueList } from './BreadcrumbValuesList';\nimport { FacetHeader } from './FacetHeader';\nimport { FacetSearch } from './FacetSearch';\nimport { FacetSearchParameters } from './FacetSearchParameters';\nimport { FacetSearchValuesList } from './FacetSearchValuesList';\nimport { FacetSettings } from './FacetSettings';\nimport { FacetSort } from './FacetSort';\nimport { FacetSortCriterion } from './FacetSortCriterion';\nimport { FacetUtils } from './FacetUtils';\nimport { FacetValueElement } from './FacetValueElement';\nimport { FacetValue } from './FacetValue';\nimport { FacetValues, ISortFacetValuesOptions } from './FacetValues';\nimport { FacetValuesList } from './FacetValuesList';\nimport { FacetValuesOrder } from './FacetValuesOrder';\nimport { OmniboxValueElement } from './OmniboxValueElement';\nimport { OmniboxValuesList } from './OmniboxValuesList';\nimport { ValueElement } from './ValueElement';\nimport { ValueElementRenderer } from './ValueElementRenderer';\nimport { IFieldValueCompatibleFacet } from '../FieldValue/IFieldValueCompatibleFacet';\n\ntype ComputedFieldOperation = 'sum' | 'average' | 'minimum' | 'maximum';\ntype ComputedFieldFormat = 'c0' | 'n0' | 'n2';\n\nexport interface IFacetOptions extends IResponsiveComponentOptions, IDependsOnCompatibleFacetOptions {\n  title?: string;\n  field?: IFieldOption;\n  isMultiValueField?: boolean;\n  numberOfValues?: number;\n  pageSize?: number;\n  sortCriteria?: string;\n  availableSorts?: string[];\n  injectionDepth?: number;\n  showIcon?: boolean;\n  useAnd?: boolean;\n  enableCollapse?: boolean;\n  enableTogglingOperator?: boolean;\n  enableMoreLess?: boolean;\n  valueCaption?: any;\n  lookupField?: IFieldOption;\n  enableFacetSearch?: boolean;\n  facetSearchDelay?: number;\n  facetSearchIgnoreAccents?: boolean;\n  numberOfValuesInFacetSearch?: number;\n  includeInBreadcrumb?: boolean;\n  includeInOmnibox?: boolean;\n  numberOfValuesInOmnibox?: number;\n  numberOfValuesInBreadcrumb?: number;\n  computedField?: IFieldOption;\n  computedFieldOperation?: string;\n  computedFieldFormat?: string;\n  computedFieldCaption?: string;\n  preservePosition?: boolean;\n  scrollContainer?: HTMLElement;\n  paddingContainer?: HTMLElement;\n  customSort?: string[];\n  enableSettings?: boolean;\n  enableSettingsFacetState?: boolean;\n  allowedValues?: string[];\n  headerIcon?: string;\n  valueIcon?: (facetValue: FacetValue) => string;\n  additionalFilter?: IQueryExpression;\n  useWildcardsInFacetSearch?: boolean;\n}\n\n/**\n * The `Facet` component displays a *facet* of the results for the current query. A facet is a list of values for a\n * certain field occurring in the results, ordered using a configurable criteria (e.g., number of occurrences).\n *\n * The list of values is obtained using a [`GroupByRequest`]{@link IGroupByRequest} operation performed at the same time\n * as the main query.\n *\n * The `Facet` component allows the end user to drill down inside a result set by restricting the result to certain\n * field values. It also allows filtering out values from the facet itself, and can provide a search box to look for\n * specific values inside larger sets.\n *\n * This is probably the most complex component in the Coveo JavaScript Search Framework and as such, it allows for many\n * configuration options.\n *\n * See also the [`FacetRange`]{@link FacetRange} and [`TimespanFacet`]{@link TimespanFacet} components (which\n * extend this component), and the [`FacetSlider`]{@link FacetSlider} and [`CategoryFacet`]{@link CategoryFacet} components (which do not extend this\n * component, but are very similar).\n */\nexport class Facet extends Component implements IFieldValueCompatibleFacet {\n  static ID = 'Facet';\n  static omniboxIndex = 50;\n\n  static doExport = () => {\n    exportGlobally({\n      Facet: Facet,\n      FacetHeader: FacetHeader,\n      FacetSearchValuesList: FacetSearchValuesList,\n      FacetSettings: FacetSettings,\n      FacetSort: FacetSort,\n      FacetUtils: FacetUtils,\n      FacetValueElement: FacetValueElement,\n      FacetValue: FacetValue\n    });\n  };\n\n  /**\n   * The possible options for a facet\n   * @componentOptions\n   */\n  static options: IFacetOptions = {\n    /**\n     * Specifies the title to display at the top of the facet.\n     *\n     * Default value is the localized string for `NoTitle`.\n     */\n    title: ComponentOptions.buildLocalizedStringOption({\n      localizedString: () => l('NoTitle'),\n      section: 'CommonOptions',\n      priority: 10\n    }),\n    /**\n     * Specifies the index field whose values the facet should use.\n     *\n     * The field must of the `string` type.\n     *\n     * This requires the given field to be configured correctly in the index as a *Facet field* (see\n     * [Add or Edit Fields](https://docs.coveo.com/en/1982/)).\n     *\n     * Specifying a value for this option is required for the `Facet` component to work.\n     */\n    field: ComponentOptions.buildFieldOption({ required: true, groupByField: true, section: 'CommonOptions' }),\n    headerIcon: ComponentOptions.buildStringOption({\n      deprecated: 'This option is exposed for legacy reasons, and the recommendation is to not use this option.'\n    }),\n    /**\n     * Specifies a unique identifier for the facet. Among other things, this identifier serves the purpose of saving\n     * the facet state in the URL hash.\n     *\n     * If you have two facets with the same field on the same page, you should specify an `id` value for at least one of\n     * those two facets. This `id` must be unique among the facets.\n     *\n     * Non-word characters except - @ $ _ . + ! * ' ( ) , , ( `^a-zA-Z0-9-@$_.+!*'(),,]+` ) are automatically removed from the `id` value.\n     *\n     * Default value is the [`field`]{@link Facet.options.field} option value.\n     */\n    id: ComponentOptions.buildStringOption({\n      postProcessing: (value: string, options: IFacetOptions) => {\n        if (value) {\n          // All non-word characters, except @ (the default character that specifies a field in the index)\n          // and characters that do no need to be encoded in the URL : - @ $ _ . + ! * ' ( ) , ,\n          const modified = value.replace(/[^a-zA-Z0-9-@$_.+!*'(),,]+/g, '');\n          if (Utils.isNullOrEmptyString(modified)) {\n            return options.field as string;\n          }\n          return modified;\n        }\n        return options.field as string;\n      }\n    }),\n    /**\n     * Specifies whether the facet [`field`]{@link Facet.options.field} is configured in the index as a multi-value\n     * field (semicolon separated values such as `abc;def;ghi`).\n     *\n     * Default value is `false`.\n     */\n    isMultiValueField: ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'CommonOptions' }),\n    /**\n     * Specifies the field whose values the Facet should display.\n     *\n     * @deprecated This option is exposed for legacy reasons. It is not recommended to use this option.\n     */\n    lookupField: ComponentOptions.buildFieldOption({\n      deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n    }),\n    /**\n     * Specifies whether to display the facet **Settings** menu.\n     *\n     * See also the [`enableSettingsFacetState`]{@link Facet.options.enableSettingsFacetState},\n     * [`availableSorts`]{@link Facet.options.availableSorts}, and\n     * [`enableCollapse`]{@link Facet.options.enableCollapse} options.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `true`.\n     */\n    enableSettings: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'Sorting', priority: 9 }),\n    /**\n     * If the [`enableSettings`]{@link Facet.options.enableSettings} option is `true`, specifies whether the\n     * **Save state** menu option is available in the facet **Settings** menu.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `false`.\n     */\n    enableSettingsFacetState: ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableSettings' }),\n    /**\n     * If the [`enableSettings`]{@link Facet.options.enableSettings} option is `true`, specifies the sort criteria\n     * options to display in the facet **Settings** menu.\n     *\n     * Possible values are:\n     * - `\"occurrences\"`\n     * - `\"score\"`\n     * - `\"alphaascending\"`\n     * - `\"alphadescending\"`\n     * - `\"computedfieldascending\"`\n     * - `\"computedfielddescending\"`\n     * - `\"custom\"`\n     *\n     * See {@link IGroupByRequest.sortCriteria} for a description of each possible value.\n     *\n     * **Notes:**\n     * > * The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * > * Using value captions will disable alphabetical sorts (see the [valueCaption]{@link Facet.options.valueCaption} option).\n     *\n     * Default value is `occurrences,score,alphaascending,alphadescending`.\n     */\n    availableSorts: ComponentOptions.buildListOption<FacetSortCriterion>({\n      defaultValue: ['occurrences', 'score', 'alphaascending', 'alphadescending'],\n      section: 'Sorting',\n      depend: 'enableSettings',\n      values: [\n        'occurrences',\n        'score',\n        'alphaascending',\n        'alphadescending',\n        'computedfieldascending',\n        'computedfielddescending',\n        'chisquare',\n        'nosort'\n      ]\n    }),\n    /**\n     * Specifies the criteria to use to sort the facet values.\n     *\n     * See {@link IGroupByRequest.sortCriteria} for the list and description of possible values.\n     *\n     * Default value is the first sort criteria specified in the [`availableSorts`]{@link Facet.options.availableSorts}\n     * option, or `occurrences` if no sort criteria is specified.\n     */\n    sortCriteria: ComponentOptions.buildStringOption<FacetSortCriterion>({\n      postProcessing: (value, options: IFacetOptions) =>\n        value || (options.availableSorts.length > 0 ? (options.availableSorts[0] as FacetSortCriterion) : 'occurrences'),\n      section: 'Sorting'\n    }),\n    /**\n     * Specifies a custom order by which to sort the facet values.\n     *\n     * **Example:**\n     *\n     * You could use this option to specify a logical order for support tickets, such as:\n     * ```html\n     * <div class=\"CoveoFacet\" data-field=\"@ticketstatus\" data-title=\"Ticket Status\" data-tab=\"All\" data-custom-sort=\"New,Opened,Feedback,Resolved\"></div>\n     * ```\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     */\n    customSort: ComponentOptions.buildListOption<string>({ section: 'Sorting' }),\n    /**\n     * Specifies the maximum number of field values to display by default in the facet before the user\n     * clicks the arrow to show more.\n     *\n     * See also the [`enableMoreLess`]{@link Facet.options.enableMoreLess} option.\n     */\n    numberOfValues: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0, section: 'CommonOptions' }),\n    /**\n     * Specifies the *injection depth* to use for the [`GroupByRequest`]{@link IGroupByRequest} operation.\n     *\n     * The injection depth determines how many results to scan in the index to ensure that the facet lists all potential\n     * facet values. Increasing this value enhances the accuracy of the listed values at the cost of performance.\n     *\n     * Default value is `1000`. Minimum value is `0`.\n     * @notSupportedIn salesforcefree\n     */\n    injectionDepth: ComponentOptions.buildNumberOption({ defaultValue: 1000, min: 0 }),\n    showIcon: ComponentOptions.buildBooleanOption({\n      defaultValue: false,\n      deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n    }),\n    /**\n     * Specifies whether to use the `AND` operator in the resulting filter when multiple values are selected in the\n     * facet.\n     *\n     * Setting this option to `true` means that items must have all of the selected values to match the resulting\n     * query.\n     *\n     * Default value is `false`, which means that the filter uses the `OR` operator. Thus, by default, items must\n     * have at least one of the selected values to match the query.\n     */\n    useAnd: ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Filtering' }),\n    /**\n     * Specifies whether to allow the user to toggle between the `OR` and `AND` modes in the facet.\n     *\n     * Setting this option to `true` displays an icon in the top right corner of the facet. The user can click this icon\n     * to toggle between between the two modes.\n     *\n     * Default value is `false`.\n     */\n    enableTogglingOperator: ComponentOptions.buildBooleanOption({\n      defaultValue: false,\n      alias: 'allowTogglingOperator'\n    }),\n    /**\n     * Specifies whether to display a search box at the bottom of the facet for searching among the available facet\n     * [`field`]{@link Facet.options.field} values.\n     *\n     * See also the [`facetSearchDelay`]{@link Facet.options.facetSearchDelay},\n     * [`facetSearchIgnoreAccents`]{@link Facet.options.facetSearchIgnoreAccents}, and\n     * [`numberOfValuesInFacetSearch`]{@link Facet.options.numberOfValuesInFacetSearch} options.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `true`.\n     */\n    enableFacetSearch: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'FacetSearch', priority: 8 }),\n    /**\n     * If the [`enableFacetSearch`]{@link Facet.options.enableFacetSearch} option is `true`, specifies the delay (in\n     * milliseconds) before sending a search request to the server when the user starts typing in the facet search box.\n     *\n     * Specifying a smaller value makes results appear faster. However, chances of having to cancel many requests\n     * sent to the server increase as the user keeps on typing new characters.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `100`. Minimum value is `0`.\n     */\n    facetSearchDelay: ComponentOptions.buildNumberOption({ defaultValue: 100, min: 0, depend: 'enableFacetSearch' }),\n    /**\n     * If the [`enableFacetSearch`]{@link Facet.options.enableFacetSearch} option is `true`, specifies whether to ignore\n     * accents in the facet search box.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `false`.\n     */\n    facetSearchIgnoreAccents: ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableFacetSearch' }),\n    /**\n     * If the [`enableFacetSearch`]{@link Facet.options.enableFacetSearch} option is `true`, specifies the number of v\n     * alues to display in the facet search results popup.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `15`. Minimum value is `1`.\n     */\n    numberOfValuesInFacetSearch: ComponentOptions.buildNumberOption({ defaultValue: 15, min: 1, section: 'FacetSearch' }),\n    /**\n     * Specifies whether [wildcards]{@link AllowedValuesPatternType.wildcards} are used as the [allowedValuesPatternType]{@link IGroupByRequest.allowedValuesPatternType}\n     * in the [groupBy]{@link IGroupByRequest} for the facet search.\n     *\n     * Enabling this option returns results that end with the entered value. For example, searching for `veo` would match with `Coveo`.\n     *\n     * **Note:**\n     * > If you are experiencing slow facet search and/or timeouts when this option is set to `true`, consider enabling the **Use cache for nested queries**\n     * > option on your facet [field]{@link Facet.options.field} in the Coveo Cloud Admninistration Console (see [Add or Edit Fields]{@link https://docs.coveo.com/en/1982/}).\n     */\n    useWildcardsInFacetSearch: ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'FacetSearch' }),\n    /**\n     * Specifies whether the facet should push data to the [`Breadcrumb`]{@link Breadcrumb} component.\n     *\n     * See also the [`numberOfValuesInBreadcrumb`]{@link Facet.options.numberOfValuesInBreadcrumb} option.\n     *\n     * Default value is `true`.\n     */\n    includeInBreadcrumb: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n    /**\n     * If the [`includeInBreadcrumb`]{@link Facet.options.includeInBreadcrumb} option is `true`, specifies the maximum\n     * number of values that the facet should display in the [`Breadcrumb`]{@link Breadcrumb} before outputting a\n     * **more...** button.\n     *\n     * Default value is `5` on a desktop computer and `3` on a mobile device. Minimum value is `0`.\n     */\n    numberOfValuesInBreadcrumb: ComponentOptions.buildNumberOption({\n      defaultFunction: () => (DeviceUtils.isMobileDevice() ? 3 : 5),\n      min: 0,\n      depend: 'includeInBreadcrumb'\n    }),\n    /**\n     * Specifies whether the Facet should push data to the {@link Omnibox} component.\n     *\n     * See also {@link Facet.options.numberOfValuesInOmnibox}.\n     *\n     * Default value is `false`.\n     *\n     * @deprecated This option is exposed for legacy reasons. It is not recommended to use this option.\n     */\n    includeInOmnibox: ComponentOptions.buildBooleanOption({\n      defaultValue: false,\n      deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n    }),\n    /**\n     * When {@link Facet.options.includeInOmnibox} is `true`, specifies the number of values to populate the\n     * {@link Breadcrumb} with.\n     *\n     * Default value is `5` on desktop computer and `3` on a mobile device. Minimum value is `0`.\n     *\n     * @deprecated This option is exposed for legacy reasons. It is not recommended to use this option.\n     */\n    numberOfValuesInOmnibox: ComponentOptions.buildNumberOption({\n      defaultFunction: () => (DeviceUtils.isMobileDevice() ? 3 : 5),\n      min: 0,\n      depend: 'includeInOmnibox',\n      deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option.'\n    }),\n    /**\n     * Specifies the name of a field on which to execute an aggregate operation for all distinct values of the facet\n     * [`field`]{@link Facet.options.field}.\n     *\n     * The facet displays the result of the operation along with the number of occurrences for each value.\n     *\n     * You can use this option to compute the sum of a field (like a money amount) for each listed facet value.\n     *\n     * Works in conjunction with the [`computedFieldOperation`]{@link Facet.options.computedFieldOperation},\n     * [`computedFieldFormat`]{@link Facet.options.computedFieldFormat}, and\n     * [`computedFieldCaption`]{@link Facet.options.computedFieldCaption} options.\n     * @notSupportedIn salesforcefree\n     */\n    computedField: ComponentOptions.buildFieldOption({ priority: 7 }),\n    /**\n     * Specifies the type of aggregate operation to perform on the [`computedField`]{@link Facet.options.computedField}.\n     *\n     * The possible values are:\n     * - `sum` - Computes the sum of the computed field values.\n     * - `average` - Computes the average of the computed field values.\n     * - `minimum` - Finds the minimum value of the computed field values.\n     * - `maximum` - Finds the maximum value of the computed field values.\n     *\n     * Default value is `sum`.\n     * @notSupportedIn salesforcefree\n     */\n    computedFieldOperation: ComponentOptions.buildStringOption<ComputedFieldOperation>({\n      defaultValue: 'sum',\n      section: 'ComputedField'\n    }),\n    /**\n     * Specifies how to format the values resulting from a\n     * [`computedFieldOperation`]{@link Facet.options.computedFieldOperation}.\n     *\n     * The Globalize library defines all available formats (see\n     * [Globalize](https://github.com/klaaspieter/jquery-global#globalizeformat-value-format-culture-)).\n     *\n     * The most commonly used formats are:\n     * - `c0` - Formats the value as a currency.\n     * - `n0` - Formats the value as an integer.\n     * - `n2` - Formats the value as a floating point with 2 decimal digits.\n     *\n     * Default value is `\"c0\"`.\n     * @notSupportedIn salesforcefree\n     */\n    computedFieldFormat: ComponentOptions.buildStringOption<ComputedFieldFormat>({\n      defaultValue: 'c0',\n      section: 'ComputedField'\n    }),\n    /**\n     * Specifies what the caption of the [`computedField`]{@link Facet.options.computedField} should be in the facet\n     * **Settings** menu for sorting.\n     *\n     * For example, setting this option to `\"Money\"` will display `\"Money Ascending\"` for computed field ascending.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is the localized string for `ComputedField`.\n     * @notSupportedIn salesforcefree\n     */\n    computedFieldCaption: ComponentOptions.buildLocalizedStringOption({\n      localizedString: () => l('ComputedField'),\n      section: 'ComputedField'\n    }),\n    /**\n     * Specifies whether the facet should remain stable in its current position in the viewport while the mouse cursor\n     * is over it.\n     *\n     * Whenever the value selection changes in a facet, the search interface automatically performs a query. This new\n     * query might cause other elements in the page to resize themselves (typically, other facets above or below the\n     * one the user is interacting with).\n     *\n     * This option is responsible for adding the `<div class='coveo-topSpace'>` and\n     * `<div class='coveo-bottomSpace'>` around the Facet container. The Facet adjusts the scroll amount of the page to\n     * ensure that it does not move relatively to the mouse when the results are updated.\n     *\n     * In some cases, the facet also adds margins to the `scrollContainer`, if scrolling alone is not enough to\n     * preserve position.\n     *\n     * See also the [`paddingContainer`]{@link Facet.options.paddingContainer}, and\n     * [`scrollContainer`]{@link Facet.options.scrollContainer} options.\n     *\n     * Default value is `true`.\n     */\n    preservePosition: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n    /**\n     * Specifies the parent container of the facets.\n     *\n     * Used by the [`preservePosition`]{@link Facet.options.preservePosition} option.\n     *\n     * Default value is `element.parentElement`.\n     */\n    paddingContainer: ComponentOptions.buildSelectorOption({\n      defaultFunction: element => {\n        const standardColumn = $$(element).parent('coveo-facet-column');\n        if (standardColumn != null) {\n          return standardColumn;\n        }\n        return element.parentElement;\n      }\n    }),\n    /**\n     * Specifies the HTML element (through a CSS selector) whose scroll amount the facet should adjust to preserve its\n     * position when results are updated.\n     *\n     * Used by the [`preservePosition`]{@link Facet.options.preservePosition} option.\n     *\n     * Default value is `document.body`.\n     */\n    scrollContainer: ComponentOptions.buildSelectorOption({ defaultFunction: element => document.body }),\n    /**\n     * Specifies whether to enable the **More** and **Less** buttons in the Facet.\n     *\n     * See also the [`pageSize`]{@link Facet.options.pageSize} option.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `true`.\n     */\n    enableMoreLess: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n    /**\n     * If the [`enableMoreLess`]{@link Facet.options.enableMoreLess} option is `true`, specifies the number of\n     * additional results to fetch when clicking the **More** button.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `10`. Minimum value is `1`.\n     */\n    pageSize: ComponentOptions.buildNumberOption({ defaultValue: 10, min: 1, depend: 'enableMoreLess' }),\n    /**\n     * If the [`enableSettings`]{@link Facet.options.enableSettings} option is `true`, specifies whether the\n     * **Collapse \\ Expand** menu option is available in the facet **Settings** menu.\n     *\n     * **Note:**\n     * > The [`FacetRange`]{@link FacetRange} component does not support this option.\n     *\n     * Default value is `true`.\n     */\n    enableCollapse: ComponentOptions.buildBooleanOption({ defaultValue: true, depend: 'enableSettings' }),\n    /**\n     * Specifies an explicit list of [`allowedValues`]{@link IGroupByRequest.allowedValues} in the\n     * [`GroupByRequest`]{@link IGroupByRequest}.\n     *\n     * If you specify a list of values for this option, the facet uses only these values (if they are available in\n     * the current result set).\n     *\n     * **Example:**\n     *\n     * The following facet only uses the `Contact`, `Account`, and `File` values of the `@objecttype` field. Even if the\n     * current result set contains other `@objecttype` values, such as `Message`, or `Product`, the facet does not use\n     * those other values.\n     *\n     * ```html\n     *\n     * <div class=\"CoveoFacet\" data-field=\"@objecttype\" data-title=\"Object Type\" data-tab=\"All\" data-allowed-values=\"Contact,Account,File\"></div>\n     * ```\n     *\n     * Default value is `undefined`, and the facet uses all available values for its\n     * [`field`]{@link Facet.options.field} in the current result set.\n     */\n    allowedValues: ComponentOptions.buildListOption<string>(),\n    /**\n     * Specifies an additional query expression (query override) to add to each\n     * [`GroupByRequest`]{@link IGroupByRequest} that this facet performs.\n     *\n     * Example: `@date>=2014/01/01`\n     * @notSupportedIn salesforcefree\n     */\n    additionalFilter: ComponentOptions.buildQueryExpressionOption(),\n    /**\n     * Specifies whether this facet only appears when a value is selected in its \"parent\" facet.\n     *\n     * To specify the parent facet, use its [`id`]{@link Facet.options.id}.\n     *\n     * Remember that by default, a facet `id` value is the same as its [`field`]{@link Facet.options.field} option\n     * value.\n     *\n     * **Examples:**\n     *\n     * First case: the \"parent\" facet has no custom `id`:\n     * ```html\n     * <!-- \"Parent\" Facet: -->\n     * <div class='CoveoFacet' data-field='@myfield' data-title='My Parent Facet'></div>\n     *\n     * <!-- The \"dependent\" Facet must refer to the default `id` of its \"parent\" Facet, which is the name of its field. -->\n     * <div class='CoveoFacet' data-field='@myotherfield' data-title='My Dependent Facet' data-depends-on='@myfield'></div>\n     * ```\n     *\n     * Second case: the \"parent\" facet has a custom `id`:\n     * ```html\n     * <!-- \"Parent\" Facet: -->\n     * <div class='CoveoFacet' data-field='@myfield' data-title='My Parent Facet' data-id='myParentCustomId'></div>\n     *\n     * <!-- The \"dependent\" Facet must refer to the custom `id` of its \"parent\" Facet, which is 'myParentCustomId'. -->\n     * <div class='CoveoFacet' data-field='@myotherfield' data-title='My Dependent Facet' data-depends-on='myParentCustomId'></div>\n     * ```\n     *\n     * Default value is `undefined`\n     */\n    dependsOn: ComponentOptions.buildStringOption(),\n    /**\n     * A function that verifies whether the current state of the `dependsOn` facet allows the dependent facet to be displayed.\n     *\n     * If specified, the function receives a reference to the resolved `dependsOn` facet component instance as an argument, and must return a boolean.\n     * The function's argument should typically be treated as read-only.\n     *\n     * By default, the dependent facet is displayed whenever one or more values are selected in its `dependsOn` facet.\n     *\n     * @externaldocs [Defining Dependent Facets](https://docs.coveo.com/3210/)\n     */\n    dependsOnCondition: ComponentOptions.buildCustomOption<IDependentFacetCondition>(\n      () => {\n        return null;\n      },\n      { depend: 'dependsOn', section: 'CommonOptions' }\n    ),\n    /**\n     * Specifies a JSON object describing a mapping of facet values to their desired captions. See\n     * [Normalizing Facet Value Captions](https://docs.coveo.com/en/368/).\n     *\n     * **Examples:**\n     *\n     * You can set the option in the ['init']{@link init} call:\n     * ```javascript\n     * var myValueCaptions = {\n     *   \"txt\" : \"Text files\",\n     *   \"html\" : \"Web page\",\n     *   [ ... ]\n     * };\n     *\n     * Coveo.init(document.querySelector(\"#search\"), {\n     *   Facet : {\n     *     valueCaption : myValueCaptions\n     *   }\n     * });\n     * ```\n     *\n     * Or before the `init` call, using the ['options']{@link options} top-level function:\n     * ```javascript\n     * Coveo.options(document.querySelector(\"#search\"), {\n     *   Facet : {\n     *     valueCaption : myValueCaptions\n     *   }\n     * });\n     * ```\n     *\n     * Or directly in the markup:\n     * ```html\n     * <!-- Ensure that the double quotes are properly handled in data-value-caption. -->\n     * <div class='CoveoFacet' data-field='@myotherfield' data-value-caption='{\"txt\":\"Text files\",\"html\":\"Web page\"}'></div>\n     * ```\n     *\n     * **Note:**\n     * > Using value captions will disable alphabetical sorts (see the [availableSorts]{@link Facet.options.availableSorts} option).\n     */\n    valueCaption: ComponentOptions.buildJsonOption<IStringMap<string>>(),\n    ...ResponsiveFacetOptions\n  };\n\n  public facetQueryController: FacetQueryController;\n  public keepDisplayedValuesNextTime: boolean = false;\n  public values = new FacetValues();\n  public currentPage: number = 0;\n  public numberOfValues: number;\n  public firstQuery = true;\n  public operatorAttributeId: string;\n  public isFieldValueCompatible = true;\n\n  /**\n   * Renders and handles the facet **Search** part of the component.\n   */\n  public facetSearch: FacetSearch;\n\n  /**\n   * Renders and handles the facet **Settings** part of the component\n   */\n  public facetSettings: FacetSettings;\n  public facetSort: FacetSort;\n  public facetValuesList: FacetValuesList;\n  public facetHeader: FacetHeader;\n  public searchContainer: ValueElementRenderer;\n  public dependsOnManager: DependsOnManager;\n\n  protected omniboxZIndex;\n  protected moreElement: HTMLElement;\n  protected lessElement: HTMLElement;\n\n  protected headerElement: HTMLElement;\n  protected footerElement: HTMLElement;\n  private canFetchMore: boolean = true;\n  private nbAvailableValues: number;\n\n  private showingWaitAnimation = false;\n  private pinnedViewportPosition: number;\n  private unpinnedViewportPosition: number;\n  private pinnedTopSpace: HTMLElement;\n  private pinnedBottomSpace: HTMLElement;\n\n  private componentStateId: string;\n  private includedAttributeId: string;\n  private excludedAttributeId: string;\n  private lookupValueAttributeId: string;\n  private listenToQueryStateChange = true;\n\n  /**\n   * Creates a new `Facet` component. Binds multiple query events as well.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `Facet` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   * @param facetClassId The ID to use for this facet (as `Facet` inherited from by other component\n   * (e.g., [`FacetRange`]{@link FacetRange}). Default value is `Facet`.\n   */\n  constructor(public element: HTMLElement, public options: IFacetOptions, bindings?: IComponentBindings, facetClassId: string = Facet.ID) {\n    super(element, facetClassId, bindings);\n    this.options = ComponentOptions.initComponentOptions(element, Facet, options);\n\n    if (this.options.valueCaption != null) {\n      this.options.availableSorts = _.filter(this.options.availableSorts, (sort: string) => !/^alpha.*$/.test(sort));\n      this.logger.warn(`Because the ${this.options.field} facet is using value captions, alphabetical sorts are disabled.`);\n    }\n\n    ResponsiveFacets.init(this.root, this, this.options);\n\n    // Serves as a way to render facet in the omnibox in the order in which they are instantiated\n    this.omniboxZIndex = Facet.omniboxIndex;\n    Facet.omniboxIndex--;\n\n    this.checkForComputedFieldAndSort();\n    this.checkForValueCaptionType();\n    this.checkForCustomSort();\n    this.initDependsOnManager();\n    this.initFacetQueryController();\n    this.initQueryEvents();\n    this.initQueryStateEvents();\n    this.initComponentStateEvents();\n    this.initOmniboxEvents();\n    this.initBreadCrumbEvents();\n    this.initSearchAlertEvents();\n    this.updateNumberOfValues();\n\n    this.bind.oneRootElement(QueryEvents.querySuccess, () => {\n      this.firstQuery = false;\n    });\n  }\n\n  public setExpandedFacetSearchAccessibilityAttributes(searchResultsElement: HTMLElement) {\n    if (!this.searchContainer) {\n      return;\n    }\n    Assert.exists(searchResultsElement);\n    const { accessibleElement } = this.searchContainer;\n    accessibleElement.setAttribute('aria-expanded', true.toString());\n  }\n\n  public setCollapsedFacetSearchAccessibilityAttributes() {\n    if (!this.searchContainer) {\n      return;\n    }\n    this.searchContainer.accessibleElement.setAttribute('aria-expanded', false.toString());\n  }\n\n  public isCurrentlyDisplayed() {\n    if (!$$(this.element).isVisible()) {\n      return false;\n    }\n\n    if ($$(this.element).hasClass('coveo-active')) {\n      return true;\n    }\n\n    if ($$(this.element).hasClass('coveo-facet-empty')) {\n      return false;\n    }\n\n    return true;\n  }\n\n  public createDom() {\n    this.initBottomAndTopSpacer();\n    this.buildFacetContent();\n    this.updateAppearanceDependingOnState();\n    // After the facet has been created (and before the first query is applied)\n    // Try to load a state from the setting, if it's available\n    // Execute only _.once (only the first query, or the first time the user switch to a tab that contains a newly set of active facet)\n    if (this.facetSettings && this.options.enableSettingsFacetState) {\n      const loadOnce = <(args: INewQueryEventArgs) => any>_.once(() => {\n        this.facetSettings.loadSavedState.apply(this.facetSettings);\n      });\n      this.bind.onRootElement(QueryEvents.newQuery, loadOnce);\n    }\n  }\n\n  /**\n   * Selects a single value.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param value Can be a [`FacetValue`]{@link FacetValue} or a string (e.g., `selectValue('foobar')` or\n   * `selectValue(new FacetValue('foobar'))`).\n   */\n  public selectValue(value: FacetValue | string): void {\n    Assert.exists(value);\n    this.ensureDom();\n    this.logger.info('Selecting facet value', this.facetValuesList.select(value));\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Selects multiple values.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n   */\n  public selectMultipleValues(values: FacetValue[] | string[]): void {\n    Assert.exists(values);\n    this.ensureDom();\n    _.each(values as FacetValue[], value => {\n      this.logger.info('Selecting facet value', this.facetValuesList.select(value));\n    });\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Deselects a single value.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param value Can be a [`FacetValue`]{@link FacetValue} or a string (e.g., `deselectValue('foobar')` or\n   * `deselectValue(new FacetValue('foobar'))`).\n   */\n  public deselectValue(value: FacetValue | string): void {\n    Assert.exists(value);\n    this.ensureDom();\n    this.logger.info('Deselecting facet value', this.facetValuesList.unselect(value));\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Deselects multiple values.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n   */\n  public deselectMultipleValues(values: FacetValue[] | string[]): void {\n    Assert.exists(values);\n    this.ensureDom();\n    _.each(values as FacetValue[], value => {\n      this.logger.info('Deselecting facet value', this.facetValuesList.unselect(value));\n    });\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Excludes a single value.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param value Can be a [`FacetValue`]{@link FacetValue} or a string (e.g., `excludeValue('foobar')` or\n   * `excludeValue(new FacetValue('foobar'))`).\n   */\n  public excludeValue(value: FacetValue | string): void {\n    Assert.exists(value);\n    this.ensureDom();\n    this.logger.info('Excluding facet value', this.facetValuesList.exclude(value));\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Excludes multiple values.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n   */\n  public excludeMultipleValues(values: FacetValue[] | string[]): void {\n    Assert.exists(values);\n    this.ensureDom();\n    _.each(values as FacetValue[], value => {\n      this.logger.info('Excluding facet value', this.facetValuesList.exclude(value));\n    });\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Unexcludes a single value.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param value Can be a [`FacetValue`]{@link FacetValue} or a string.\n   */\n  public unexcludeValue(value: FacetValue | string): void {\n    Assert.exists(value);\n    this.ensureDom();\n    this.logger.info('Unexcluding facet value', this.facetValuesList.unExclude(value));\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Unexcludes multiple values.\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param values Can be an array of [`FacetValue`]{@link FacetValue} or an array of strings.\n   */\n  public unexcludeMultipleValues(values: FacetValue[] | string[]): void {\n    Assert.exists(values);\n    this.ensureDom();\n    _.each(values as FacetValue[], value => {\n      this.logger.info('Unexcluding facet value', this.facetValuesList.unExclude(value));\n    });\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Toggles the selection state of a single value (selects the value if it is not already selected; un-selects the\n   * value if it is already selected).\n   *\n   * Does not trigger a query automatically.\n   * @param value Can be a [`FacetValue`]{@link FacetValue} or a string.\n   */\n  public toggleSelectValue(value: FacetValue | string): void {\n    Assert.exists(value);\n    this.ensureDom();\n    this.logger.info('Toggle select facet value', this.facetValuesList.toggleSelect(value));\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Toggles the exclusion state of a single value (excludes the value if it is not already excluded; un-excludes the\n   * value if it is already excluded).\n   *\n   * Does not trigger a query automatically.\n   *\n   * @param value Can be a [`FacetValue`]{@link FacetValue} or a string.\n   */\n  public toggleExcludeValue(value: FacetValue | string): void {\n    Assert.exists(value);\n    this.ensureDom();\n    this.logger.info('Toggle exclude facet value', this.facetValuesList.toggleExclude(value));\n    this.facetValueHasChanged();\n  }\n\n  /**\n   * Returns the currently displayed values as an array of strings.\n   *\n   * @returns {any[]} The currently displayed values.\n   */\n  public getDisplayedValues(): string[] {\n    return _.pluck(this.getDisplayedFacetValues(), 'value');\n  }\n\n  /**\n   * Returns the currently displayed values as an array of [`FacetValue`]{@link FacetValue}.\n   *\n   * @returns {T[]} The currently displayed values.\n   */\n  public getDisplayedFacetValues(): FacetValue[] {\n    this.ensureDom();\n    const displayed = this.facetValuesList.getAllCurrentlyDisplayed();\n    return _.map(displayed, (value: ValueElement) => {\n      return value.facetValue;\n    });\n  }\n\n  /**\n   * Returns the currently selected values as an array of strings.\n   * @returns {string[]} The currently selected values.\n   */\n  public getSelectedValues(): string[] {\n    this.ensureDom();\n    return _.map(this.values.getSelected(), (value: FacetValue) => value.value);\n  }\n\n  /**\n   * Determines whether the specified value is selected in the facet.\n   * @param value The name of the facet value to verify.\n   */\n  public hasSelectedValue(value: string) {\n    const facetValue = this.values.get(value);\n    return facetValue && facetValue.selected;\n  }\n\n  /**\n   * Returns the currently excluded values as an array of strings.\n   * @returns {string[]} The currently excluded values.\n   */\n  public getExcludedValues(): string[] {\n    this.ensureDom();\n    return _.map(this.values.getExcluded(), (value: FacetValue) => value.value);\n  }\n\n  /**\n   * Resets the facet by un-selecting all values, un-excluding all values, and redrawing the facet.\n   */\n  public reset(): void {\n    this.ensureDom();\n    this.values.reset();\n    this.rebuildValueElements();\n    this.updateAppearanceDependingOnState();\n    this.updateQueryStateModel();\n  }\n\n  /**\n   * Switches the facet to `AND` mode.\n   *\n   * See the [`useAnd`]{@link Facet.options.useAnd}, and\n   * [`enableTogglingOperator`]{@link Facet.options.enableTogglingOperator} options.\n   */\n  public switchToAnd(): void {\n    this.ensureDom();\n    this.logger.info('Switching to AND');\n    this.facetHeader.switchToAnd();\n  }\n\n  /**\n   * Switches the facet to `OR` mode.\n   *\n   * See the [`useAnd`]{@link Facet.options.useAnd}, and\n   * [`enableTogglingOperator`]{@link Facet.options.enableTogglingOperator} options.\n   */\n  public switchToOr(): void {\n    this.ensureDom();\n    this.logger.info('Switching to OR');\n    this.facetHeader.switchToOr();\n  }\n\n  /**\n   * Returns the endpoint for the facet.\n   * @returns {ISearchEndpoint} The endpoint for the facet.\n   */\n  public getEndpoint(): ISearchEndpoint {\n    return this.queryController.getEndpoint();\n  }\n\n  /**\n   * Changes the sort parameter for the facet.\n   *\n   * See {@link Facet.options.availableSorts} for the list of possible values.\n   *\n   * Also triggers a new query.\n   *\n   * @param criteria The new sort parameter for the facet.\n   */\n  public updateSort(criteria: string): void {\n    this.ensureDom();\n    if (this.options.sortCriteria != criteria) {\n      this.options.sortCriteria = criteria;\n      this.usageAnalytics.logCustomEvent<IAnalyticsFacetSortMeta>(\n        analyticsActionCauseList.facetUpdateSort,\n        {\n          criteria,\n          facetId: this.options.id,\n          facetField: this.options.field.toString(),\n          facetTitle: this.options.title\n        },\n        this.element\n      );\n      this.triggerNewQuery();\n    }\n  }\n\n  public unfadeInactiveValuesInMainList(): void {\n    $$(this.element).removeClass('coveo-facet-fade');\n  }\n\n  public fadeInactiveValuesInMainList(delay: number): void {\n    $$(this.element).addClass('coveo-facet-fade');\n  }\n\n  /**\n   * Shows a waiting animation in the facet header (a spinner).\n   */\n  public showWaitingAnimation() {\n    this.ensureDom();\n    if (!this.showingWaitAnimation) {\n      $$(this.headerElement).find('.coveo-facet-header-wait-animation').style.visibility = 'visible';\n      this.showingWaitAnimation = true;\n    }\n  }\n\n  /**\n   * Hides the waiting animation in the facet header.\n   */\n  public hideWaitingAnimation(): void {\n    this.ensureDom();\n    if (this.showingWaitAnimation) {\n      $$(this.headerElement).find('.coveo-facet-header-wait-animation').style.visibility = 'hidden';\n      this.showingWaitAnimation = false;\n    }\n  }\n\n  public processFacetSearchAllResultsSelected(facetValues: FacetValue[]): void {\n    const valuesForAnalytics = [];\n    _.each(facetValues, facetValue => {\n      this.ensureFacetValueIsInList(facetValue);\n      valuesForAnalytics.push(facetValue.value);\n    });\n    // Calculate the correct number of values from the current selected/excluded values (those will stay no matter what next rendering)\n    // add the new one that will be selected (and are not already selected in the facet)\n    // The minimum number of values is the number of values set in the option\n    const valuesThatStays = this.values.getSelected().concat(this.values.getExcluded());\n    this.numberOfValues = valuesThatStays.length + _.difference(valuesThatStays, facetValues).length;\n    this.numberOfValues = Math.max(this.numberOfValues, this.options.numberOfValues);\n\n    this.updateQueryStateModel();\n    this.triggerNewQuery(() =>\n      this.usageAnalytics.logSearchEvent<IAnalyticsFacetMeta>(analyticsActionCauseList.facetSelectAll, {\n        facetId: this.options.id,\n        facetField: this.options.field.toString(),\n        facetTitle: this.options.title\n      })\n    );\n  }\n\n  public pinFacetPosition() {\n    if (this.options.preservePosition) {\n      this.pinnedViewportPosition = this.element.getBoundingClientRect().top;\n    }\n  }\n\n  /**\n   * Returns the configured caption for the given [`FacetValue`]{@link FacetValue}.\n   *\n   * @param facetValue The `FacetValue` whose caption the method should return.\n   */\n  public getValueCaption(facetValue: IIndexFieldValue | FacetValue | string): string {\n    Assert.exists(facetValue);\n    const lookupValue = typeof facetValue === 'string' ? facetValue : facetValue.lookupValue || facetValue.value;\n    let ret = FacetUtils.tryToGetTranslatedCaption(<string>this.options.field, lookupValue);\n\n    if (Utils.exists(this.options.valueCaption)) {\n      if (typeof this.options.valueCaption == 'object') {\n        ret = this.options.valueCaption[lookupValue] || ret;\n      }\n      if (typeof this.options.valueCaption == 'function') {\n        const fv = facetValue instanceof FacetValue ? facetValue : FacetValue.create(facetValue);\n        const valueFromList = this.facetValuesList.get(fv).facetValue;\n        ret = this.options.valueCaption.call(this, valueFromList);\n      }\n    }\n    return ret;\n  }\n\n  /**\n   * Returns the configured caption for a desired facet value.\n   *\n   * @param value The string facet value whose caption the method should return.\n   */\n  public getCaptionForStringValue(value: string) {\n    Assert.exists(value);\n    return this.getValueCaption(value);\n  }\n\n  /**\n   * Shows the next page of results in the facet.\n   *\n   * See the [`enableMoreLess`]{@link Facet.options.enableMoreLess}, and [`pageSize`]{@link Facet.options.pageSize}\n   * options.\n   *\n   * Triggers a query if needed, or displays the already available values.\n   */\n  public showMore() {\n    this.currentPage = Math.floor((this.numberOfValues - this.options.numberOfValues) / this.options.pageSize) + 1;\n    this.updateNumberOfValues();\n    if (this.nbAvailableValues >= this.numberOfValues || !this.canFetchMore) {\n      this.rebuildValueElements();\n    } else {\n      this.triggerMoreQuery();\n    }\n  }\n\n  /**\n   * Shows less elements in the Facet (up to the original number of values).\n   *\n   * See the [`enableMoreLess`]{@link Facet.options.enableMoreLess}, and\n   * [`numberOfValues`]{@link Facet.options.numberOfValues} options.\n   */\n  public showLess() {\n    $$(this.lessElement).removeClass('coveo-active');\n    this.currentPage = 0;\n    this.updateNumberOfValues();\n    $$(this.moreElement).addClass('coveo-active');\n    this.values.sortValuesDependingOnStatus(this.numberOfValues);\n    this.rebuildValueElements();\n    this.logAnalyticsFacetShowMoreLess(analyticsActionCauseList.facetShowLess);\n  }\n\n  /**\n   * Collapses the facet.\n   */\n  public collapse() {\n    this.ensureDom();\n    if (this.facetHeader) {\n      this.facetHeader.collapseFacet();\n    }\n  }\n\n  /**\n   * Expands the facet.\n   */\n  public expand() {\n    this.ensureDom();\n    if (this.facetHeader) {\n      this.facetHeader.expandFacet();\n    }\n  }\n\n  public triggerNewQuery(beforeExecuteQuery?: () => void) {\n    if (!beforeExecuteQuery) {\n      this.queryController.executeQuery({ ignoreWarningSearchEvent: true });\n    } else {\n      this.queryController.executeQuery({ beforeExecuteQuery });\n    }\n    this.showWaitingAnimation();\n  }\n\n  protected handleDeferredQuerySuccess(data: IQuerySuccessEventArgs) {\n    Assert.exists(data);\n    this.unfadeInactiveValuesInMainList();\n    this.hideWaitingAnimation();\n    const groupByResult = data.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];\n    this.facetQueryController.lastGroupByResult = groupByResult;\n    // Two corner case to handle regarding the \"sticky\" aspect of facets :\n    // 1) The group by is empty (so there is nothing to \"sticky\")\n    // 2) There is only one value displayed currently, so there is nothing to \"sticky\" either\n    if (!groupByResult) {\n      this.keepDisplayedValuesNextTime = false;\n    }\n    if (this.values.getAll().length == 1) {\n      this.keepDisplayedValuesNextTime = false;\n    }\n    this.processNewGroupByResults(groupByResult);\n  }\n\n  protected handleQueryError() {\n    this.updateValues(new FacetValues());\n    this.updateAppearanceDependingOnState();\n    this.hideWaitingAnimation();\n  }\n\n  protected handlePopulateBreadcrumb(args: IPopulateBreadcrumbEventArgs) {\n    Assert.exists(args);\n\n    if (this.values.hasSelectedOrExcludedValues()) {\n      const element = new BreadcrumbValueList(\n        this,\n        this.values.getSelected().concat(this.values.getExcluded()),\n        BreadcrumbValueElement\n      ).build();\n      args.breadcrumbs.push({ element: element });\n    }\n  }\n\n  protected handlePopulateSearchAlerts(args: ISearchAlertsPopulateMessageEventArgs) {\n    if (this.values.hasSelectedOrExcludedValues()) {\n      const excludedValues = this.values.getExcluded();\n      const selectedValues = this.values.getSelected();\n\n      if (!_.isEmpty(excludedValues)) {\n        args.text.push({\n          value: new BreadcrumbValueList(this, excludedValues, BreadcrumbValueElement).buildAsString(),\n          lineThrough: true\n        });\n      }\n\n      if (!_.isEmpty(selectedValues)) {\n        args.text.push({\n          value: new BreadcrumbValueList(this, selectedValues, BreadcrumbValueElement).buildAsString(),\n          lineThrough: false\n        });\n      }\n    }\n  }\n\n  protected initFacetQueryController() {\n    this.facetQueryController = new FacetQueryController(this);\n  }\n\n  protected initFacetValuesList() {\n    this.facetValuesList = new FacetValuesList(this, FacetValueElement);\n    this.element.appendChild(this.facetValuesList.build());\n  }\n\n  protected initFacetSearch() {\n    this.facetSearch = new FacetSearch(this, FacetSearchValuesList, this.root);\n    this.element.appendChild(this.facetSearch.build());\n  }\n\n  protected facetValueHasChanged() {\n    this.updateQueryStateModel();\n    this.rebuildValueElements();\n    Defer.defer(() => {\n      this.updateAppearanceDependingOnState();\n    });\n  }\n\n  protected updateAppearanceDependingOnState() {\n    $$(this.element).toggleClass('coveo-active', this.values.hasSelectedOrExcludedValues());\n    $$(this.element).toggleClass('coveo-facet-empty', !this.isAnyValueCurrentlyDisplayed());\n    $$(this.facetHeader.eraserElement).toggleClass('coveo-facet-header-eraser-visible', this.values.hasSelectedOrExcludedValues());\n  }\n\n  protected initQueryEvents() {\n    this.bind.onRootElement(QueryEvents.duringQuery, () => this.handleDuringQuery());\n    this.bind.onRootElement(QueryEvents.buildingQuery, (args: IDoneBuildingQueryEventArgs) => this.handleBuildingQuery(args));\n    this.bind.onRootElement(QueryEvents.doneBuildingQuery, (args: IDoneBuildingQueryEventArgs) => this.handleDoneBuildingQuery(args));\n    this.bind.onRootElement(QueryEvents.deferredQuerySuccess, (args: IQuerySuccessEventArgs) => this.handleDeferredQuerySuccess(args));\n    this.bind.onRootElement(QueryEvents.queryError, () => this.handleQueryError());\n  }\n\n  protected initQueryStateEvents() {\n    this.includedAttributeId = QueryStateModel.getFacetId(this.options.id);\n    this.excludedAttributeId = QueryStateModel.getFacetId(this.options.id, false);\n    this.operatorAttributeId = QueryStateModel.getFacetOperator(this.options.id);\n    this.lookupValueAttributeId = QueryStateModel.getFacetLookupValue(this.options.id);\n\n    this.queryStateModel.registerNewAttribute(this.includedAttributeId, []);\n    this.queryStateModel.registerNewAttribute(this.excludedAttributeId, []);\n    this.queryStateModel.registerNewAttribute(this.operatorAttributeId, '');\n    this.queryStateModel.registerNewAttribute(this.lookupValueAttributeId, {});\n\n    this.bind.onQueryState(MODEL_EVENTS.CHANGE, undefined, (args: IAttributesChangedEventArg) => this.handleQueryStateChanged(args));\n  }\n\n  protected initComponentStateEvents() {\n    this.componentStateId = QueryStateModel.getFacetId(this.options.id);\n    this.componentStateModel.registerComponent(this.componentStateId, this);\n  }\n\n  protected initOmniboxEvents() {\n    if (this.options.includeInOmnibox) {\n      this.bind.onRootElement(OmniboxEvents.populateOmnibox, (args: IPopulateOmniboxEventArgs) => this.handlePopulateOmnibox(args));\n    }\n  }\n\n  protected initBreadCrumbEvents() {\n    if (this.options.includeInBreadcrumb) {\n      this.bind.onRootElement(BreadcrumbEvents.populateBreadcrumb, (args: IPopulateBreadcrumbEventArgs) =>\n        this.handlePopulateBreadcrumb(args)\n      );\n      this.bind.onRootElement(BreadcrumbEvents.clearBreadcrumb, (args: IClearBreadcrumbEventArgs) => this.handleClearBreadcrumb());\n    }\n  }\n\n  protected initSearchAlertEvents() {\n    this.bind.onRootElement(SearchAlertsEvents.searchAlertsPopulateMessage, (args: ISearchAlertsPopulateMessageEventArgs) =>\n      this.handlePopulateSearchAlerts(args)\n    );\n  }\n\n  protected handleOmniboxWithStaticValue(eventArg: IPopulateOmniboxEventArgs) {\n    const regex = new RegExp('^' + eventArg.completeQueryExpression.regex.source, 'i');\n    const match = _.first(\n      _.filter(this.getDisplayedValues(), (displayedValue: string) => {\n        const value = this.getValueCaption(this.facetValuesList.get(displayedValue).facetValue);\n        return regex.test(value);\n      }),\n      this.options.numberOfValuesInOmnibox\n    );\n    const facetValues = _.map(match, (gotAMatch: string) => {\n      return this.facetValuesList.get(gotAMatch).facetValue;\n    });\n    const element = new OmniboxValuesList(this, facetValues, eventArg, OmniboxValueElement).build();\n    eventArg.rows.push({ element: element, zIndex: this.omniboxZIndex });\n  }\n\n  protected processNewGroupByResults(groupByResult: IGroupByResult) {\n    this.logger.trace('Displaying group by results', groupByResult);\n    if (groupByResult != undefined && groupByResult.values != undefined) {\n      this.nbAvailableValues = groupByResult.values.length;\n    }\n    const newFacetValues = new FacetValues(groupByResult);\n    this.updateValues(newFacetValues);\n    this.canFetchMore = this.numberOfValues < this.nbAvailableValues;\n\n    if (this.values.hasSelectedOrExcludedValues() && !this.options.useAnd && this.options.isMultiValueField) {\n      this.triggerUpdateDeltaQuery(\n        _.filter(this.values.getAll(), (facetValue: FacetValue) => {\n          return !facetValue.selected && !facetValue.excluded;\n        })\n      );\n    } else if (this.values.getSelected().length > 0 && !this.options.useAnd) {\n      this.values.updateDeltaWithFilteredFacetValues(new FacetValues(), this.options.isMultiValueField);\n    }\n    if (!this.values.hasSelectedOrExcludedValues() || this.options.useAnd || !this.options.isMultiValueField) {\n      this.rebuildValueElements();\n      this.updateAppearanceDependingOnState();\n      this.ensurePinnedFacetHasntMoved();\n    }\n    this.keepDisplayedValuesNextTime = false;\n  }\n\n  protected updateQueryStateModel() {\n    this.listenToQueryStateChange = false;\n    this.updateExcludedQueryStateModel();\n    this.updateIncludedQueryStateModel();\n    this.facetHeader.updateOperatorQueryStateModel();\n    this.updateLookupValueQueryStateModel();\n    this.listenToQueryStateChange = true;\n  }\n\n  protected rebuildValueElements() {\n    this.updateNumberOfValues();\n    this.facetValuesList.rebuild(this.numberOfValues);\n    if (this.shouldRenderMoreLess()) {\n      this.updateMoreLess();\n      if (this.shouldRenderFacetSearch()) {\n        this.updateSearchElement(this.nbAvailableValues > this.numberOfValues);\n      }\n    } else if (this.shouldRenderFacetSearch()) {\n      this.updateSearchElement();\n    }\n  }\n\n  protected updateSearchElement(moreValuesAvailable = true) {\n    if (!moreValuesAvailable) {\n      return;\n    }\n\n    const renderer = new ValueElementRenderer(this, FacetValue.create(l('Search')));\n    this.searchContainer = renderer.build().withNo([renderer.excludeIcon, renderer.icon]);\n    $$(this.searchContainer.listItem).addClass('coveo-facet-search-button');\n\n    new AccessibleButton()\n      .withElement(this.searchContainer.accessibleElement)\n      .withLabel(l('SearchFacetResults', this.options.title))\n      .withEnterKeyboardAction(e => this.toggleSearchMenu(e))\n      .build();\n\n    this.setCollapsedFacetSearchAccessibilityAttributes();\n\n    // Mobile do not like label. Use click event\n    if (DeviceUtils.isMobileDevice()) {\n      $$(this.searchContainer.label).on('click', e => this.toggleSearchMenu(e));\n    }\n\n    $$(this.searchContainer.checkbox).on('change', () => {\n      $$(this.element).addClass('coveo-facet-searching');\n      this.facetSearch.focus();\n    });\n    this.facetValuesList.valueContainer.appendChild(this.searchContainer.listItem);\n  }\n\n  protected updateMoreLess(\n    lessElementIsShown = this.getMinimumNumberOfValuesToDisplay() < this.numberOfValues,\n    moreValuesAvailable = this.nbAvailableValues > this.numberOfValues\n  ) {\n    if (lessElementIsShown) {\n      $$(this.lessElement).addClass('coveo-active');\n    } else {\n      $$(this.lessElement).removeClass('coveo-active');\n    }\n\n    if (moreValuesAvailable) {\n      $$(this.moreElement).addClass('coveo-active');\n    } else {\n      $$(this.moreElement).removeClass('coveo-active');\n    }\n\n    if (lessElementIsShown || moreValuesAvailable) {\n      $$(this.footerElement).removeClass('coveo-facet-empty');\n    } else {\n      $$(this.footerElement).addClass('coveo-facet-empty');\n    }\n  }\n\n  protected handleClickMore(): void {\n    this.showMore();\n  }\n\n  protected handleClickLess() {\n    this.showLess();\n  }\n\n  private toggleSearchMenu(e: Event) {\n    const searchButton = this.searchContainer;\n\n    if (searchButton.checkbox.getAttribute('checked')) {\n      searchButton.checkbox.removeAttribute('checked');\n    } else {\n      searchButton.checkbox.setAttribute('checked', 'checked');\n    }\n\n    $$(searchButton.checkbox).trigger('change');\n\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  private checkForComputedFieldAndSort() {\n    if (this.options.sortCriteria.toLowerCase().indexOf('computedfield') != -1 && Utils.isNullOrUndefined(this.options.computedField)) {\n      this.logger.warn(\n        'Sort criteria is specified as ComputedField, but the facet uses no computed field. Facet will always be empty !',\n        this\n      );\n    }\n  }\n\n  private checkForValueCaptionType() {\n    if (this.options.valueCaption && typeof this.options.valueCaption == 'function') {\n      this.options.enableFacetSearch = false;\n      this.options.includeInOmnibox = false;\n      this.logger.warn(\n        'Using a function as valueCaption is now deprecated. Use a json key value pair instead. Facet search and omnibox has been disabled for this facet',\n        this\n      );\n    }\n  }\n\n  private checkForCustomSort() {\n    if (this.options.customSort != undefined && !_.contains(this.options.availableSorts, 'custom')) {\n      this.options.availableSorts.unshift('custom');\n    }\n    if (this.options.availableSorts[0] == 'custom') {\n      this.options.sortCriteria = 'nosort';\n    }\n  }\n\n  private initDependsOnManager() {\n    const facetInfo: IDependentFacet = {\n      reset: () => this.reset(),\n      ref: this\n    };\n    this.dependsOnManager = new DependsOnManager(facetInfo);\n  }\n\n  private dependsOnUpdateParentDisplayValue() {\n    if (!this.options.dependsOn) {\n      return;\n    }\n\n    const masterFacetComponent = ComponentsTypes.getAllFacetInstancesFromElement(this.root).filter((cmp: Facet) => {\n      const idFacet = cmp instanceof Facet;\n      return idFacet && cmp.options.id === this.options.dependsOn;\n    }) as Facet[];\n\n    if (!masterFacetComponent.length) {\n      this.logger.warn(\n        `Unable to find a Facet with the id or field \"${this.options.dependsOn}\".`,\n        `The master facet values can't be updated.`\n      );\n      return;\n    }\n    if (masterFacetComponent.length > 1) {\n      this.logger.warn(\n        `Multiple facets with id \"${this.options.dependsOn}\" found.`,\n        `A given facet may only depend on a single other facet.`,\n        `Ensure that each facet in your search interface has a unique id.`,\n        `The master facet cannot be updated.`,\n        masterFacetComponent\n      );\n      return;\n    }\n    const masterFacet = masterFacetComponent[0];\n    masterFacet.keepDisplayedValuesNextTime = false;\n  }\n\n  private initBottomAndTopSpacer() {\n    const bottomSpace = $$(this.options.paddingContainer).find('.coveo-bottomSpace');\n    const topSpace = $$(this.options.paddingContainer).find('.coveo-topSpace');\n    if (this.options.preservePosition) {\n      $$(this.options.paddingContainer).on('mouseleave', () => this.unpinFacetPosition());\n\n      this.pinnedTopSpace = topSpace;\n      this.pinnedBottomSpace = bottomSpace;\n\n      if (!this.pinnedTopSpace) {\n        this.pinnedTopSpace = document.createElement('div');\n        $$(this.pinnedTopSpace).addClass('coveo-topSpace');\n        $$(this.pinnedTopSpace).insertBefore(<HTMLElement>this.options.paddingContainer.firstChild);\n      }\n      if (!this.pinnedBottomSpace) {\n        this.pinnedBottomSpace = document.createElement('div');\n        $$(this.pinnedBottomSpace).addClass('coveo-bottomSpace');\n        this.options.paddingContainer.appendChild(this.pinnedBottomSpace);\n      }\n    }\n  }\n\n  private updateIncludedQueryStateModel() {\n    const selectedValues: IQueryStateIncludedAttribute = { included: this.getSelectedValues(), title: this.includedAttributeId };\n    this.queryStateModel.set(this.includedAttributeId, selectedValues.included);\n  }\n\n  private updateExcludedQueryStateModel() {\n    const excludedValues: IQueryStateExcludedAttribute = { title: this.excludedAttributeId, excluded: this.getExcludedValues() };\n\n    this.queryStateModel.set(this.excludedAttributeId, excludedValues.excluded);\n  }\n\n  private updateLookupValueQueryStateModel() {\n    if (this.options.lookupField) {\n      const valueToSet = {};\n      _.each(this.values.getSelected().concat(this.values.getExcluded()), value => {\n        valueToSet[value.value] = value.lookupValue;\n      });\n      this.queryStateModel.set(this.lookupValueAttributeId, valueToSet);\n    }\n  }\n\n  private handleQueryStateChangedOperator(operator: string) {\n    if (operator == 'and') {\n      this.switchToAnd();\n    } else if (operator == 'or') {\n      this.switchToOr();\n    }\n  }\n\n  private handleQueryStateChangedIncluded(includedChanged) {\n    const toUnSelect = _.difference(this.getSelectedValues(), includedChanged);\n    if (Utils.isNonEmptyArray(toUnSelect)) {\n      this.deselectMultipleValues(toUnSelect);\n    }\n    if (!Utils.arrayEqual(this.getSelectedValues(), includedChanged, false)) {\n      this.selectMultipleValues(includedChanged);\n    }\n  }\n\n  private handleQueryStateChangedExcluded(excludedChanged) {\n    const toUnExclude = _.difference(this.getExcludedValues(), excludedChanged);\n    if (Utils.isNonEmptyArray(toUnExclude)) {\n      this.unexcludeMultipleValues(toUnExclude);\n    }\n    if (!Utils.arrayEqual(this.getExcludedValues(), excludedChanged, false)) {\n      this.excludeMultipleValues(excludedChanged);\n    }\n  }\n\n  private handleLookupvalueChanged(lookupFieldChanged: { [value: string]: string }) {\n    _.each(lookupFieldChanged, (lookupvalue, value) => {\n      this.facetValuesList.get(decodeURIComponent(value)).facetValue.lookupValue = decodeURIComponent(lookupvalue);\n    });\n  }\n\n  private handleQueryStateChanged(data: IAttributesChangedEventArg) {\n    Assert.exists(data);\n    this.ensureDom();\n    this.dependsOnUpdateParentDisplayValue();\n    const trimValuesFromModel = (values?: string[]) => {\n      if (values) {\n        values = _.map(values, value => value.trim());\n      }\n      return values;\n    };\n\n    const queryStateAttributes: IStringMap<any> = data.attributes;\n    let includedChanged: string[] = trimValuesFromModel(queryStateAttributes[this.includedAttributeId]);\n    let excludedChanged: string[] = trimValuesFromModel(queryStateAttributes[this.excludedAttributeId]);\n    const operator: string = queryStateAttributes[this.operatorAttributeId];\n    const lookupValueChanged: IStringMap<string> = queryStateAttributes[this.lookupValueAttributeId];\n\n    if (this.listenToQueryStateChange) {\n      if (!Utils.isNullOrEmptyString(operator)) {\n        this.handleQueryStateChangedOperator(operator);\n      }\n      if (!Utils.isNullOrUndefined(includedChanged)) {\n        this.handleQueryStateChangedIncluded(includedChanged);\n      }\n      if (!Utils.isNullOrUndefined(excludedChanged)) {\n        this.handleQueryStateChangedExcluded(excludedChanged);\n      }\n      if (!Utils.isNullOrUndefined(lookupValueChanged)) {\n        this.handleLookupvalueChanged(lookupValueChanged);\n      }\n    }\n  }\n\n  private handlePopulateOmnibox(data: IPopulateOmniboxEventArgs) {\n    Assert.exists(data);\n    Assert.exists(data.completeQueryExpression);\n\n    // The omnibox calls can come in before a first query was executed (atypical, but\n    // if no query is auto-triggered on initialization). To ensure that we've got the\n    // proper filters, we ensure that at least a dumbshow query builder run occured\n    // before proceeding.\n    this.queryController.ensureCreatedQueryBuilder();\n\n    if (this.canFetchMore) {\n      this.handleOmniboxWithSearchInFacet(data);\n    } else {\n      this.handleOmniboxWithStaticValue(data);\n    }\n  }\n\n  private handleOmniboxWithSearchInFacet(eventArg: IPopulateOmniboxEventArgs) {\n    const regex = new RegExp('^' + eventArg.completeQueryExpression.regex.source, 'i');\n\n    const promise = new Promise<IOmniboxDataRow>((resolve, reject) => {\n      const searchParameters = new FacetSearchParameters(this);\n      searchParameters.setValueToSearch(eventArg.completeQueryExpression.word);\n      searchParameters.nbResults = this.options.numberOfValuesInOmnibox;\n      this.facetQueryController\n        .search(searchParameters)\n        .then(fieldValues => {\n          const facetValues = _.map(\n            _.filter(fieldValues, (fieldValue: IIndexFieldValue) => {\n              return regex.test(fieldValue.lookupValue);\n            }),\n            fieldValue => {\n              return this.values.get(fieldValue.lookupValue) || FacetValue.create(fieldValue);\n            }\n          );\n          const element = new OmniboxValuesList(this, facetValues, eventArg, OmniboxValueElement).build();\n          resolve({ element: element, zIndex: this.omniboxZIndex });\n        })\n        .catch(() => {\n          resolve({ element: undefined });\n        });\n    });\n    eventArg.rows.push({ deferred: promise });\n  }\n\n  private handleDuringQuery() {\n    this.ensureDom();\n    if (!this.keepDisplayedValuesNextTime) {\n      this.fadeInactiveValuesInMainList(this.options.facetSearchDelay);\n    }\n  }\n\n  private handleBuildingQuery(data: IDoneBuildingQueryEventArgs) {\n    Assert.exists(data);\n    Assert.exists(data.queryBuilder);\n\n    this.facetQueryController.prepareForNewQuery();\n    if (this.values.hasSelectedOrExcludedValues()) {\n      const expression = this.facetQueryController.computeOurFilterExpression();\n      this.logger.trace('Putting filter in query', expression);\n      data.queryBuilder.advancedExpression.add(expression);\n    }\n  }\n\n  private handleDoneBuildingQuery(data: IDoneBuildingQueryEventArgs) {\n    Assert.exists(data);\n    Assert.exists(data.queryBuilder);\n    const queryBuilder = data.queryBuilder;\n    this.facetQueryController.putGroupByIntoQueryBuilder(queryBuilder);\n  }\n\n  private handleClearBreadcrumb() {\n    this.reset();\n  }\n\n  private updateValues(facetValues: FacetValues) {\n    Assert.exists(facetValues);\n    if (this.keepDisplayedValuesNextTime) {\n      this.values.updateCountsFromNewValues(facetValues);\n    } else {\n      this.values = this.consolidateAndSortNewFacetValues(facetValues);\n    }\n\n    this.updateNumberOfValues();\n  }\n\n  private consolidateAndSortNewFacetValues(newValues: FacetValues) {\n    newValues.importActiveValuesFromOtherList(this.values);\n    newValues.sort(this.optionsToSortFacetValues);\n    return newValues;\n  }\n\n  private get optionsToSortFacetValues(): ISortFacetValuesOptions {\n    return {\n      facetValuesOrder: this.facetValuesOrder,\n      numberOfValues: this.numberOfValues\n    };\n  }\n\n  private get facetValuesOrder() {\n    return new FacetValuesOrder(this, this.facetSort);\n  }\n\n  private ensureFacetValueIsInList(facetValue: FacetValue) {\n    Assert.exists(facetValue);\n    if (!this.values.contains(facetValue.value)) {\n      this.values.add(facetValue);\n    }\n  }\n\n  private isAnyValueCurrentlyDisplayed(): boolean {\n    return !this.values.isEmpty();\n  }\n\n  private buildFacetContent() {\n    this.headerElement = this.buildHeader();\n    this.element.appendChild(this.headerElement);\n    this.initFacetValuesList();\n    if (this.shouldRenderFacetSearch()) {\n      this.initFacetSearch();\n    }\n    if (this.shouldRenderMoreLess()) {\n      this.moreElement = this.buildMore();\n      this.lessElement = this.buildLess();\n    }\n    this.footerElement = this.buildFooter();\n    this.element.appendChild(this.footerElement);\n    if (this.lessElement && this.moreElement) {\n      this.footerElement.appendChild(this.lessElement);\n      this.footerElement.appendChild(this.moreElement);\n    }\n  }\n\n  private buildHeader() {\n    let icon = this.options.headerIcon;\n    if (this.options.headerIcon == this.options.field) {\n      icon = undefined;\n    }\n    this.facetHeader = new FacetHeader({\n      facetElement: this.element,\n      title: this.options.title,\n      icon: icon,\n      field: <string>this.options.field,\n      enableClearElement: true,\n      enableCollapseElement: this.options.enableCollapse,\n      facet: this,\n      settingsKlass: this.options.enableSettings ? FacetSettings : undefined,\n      sortKlass: FacetSort,\n      availableSorts: this.options.availableSorts\n    });\n    const built = this.facetHeader.build();\n    this.facetSettings = this.facetHeader.settings;\n    this.facetSort = this.facetHeader.sort;\n    return built;\n  }\n\n  private unpinFacetPosition() {\n    if (this.shouldFacetUnpin() && this.options.preservePosition) {\n      $$(this.pinnedTopSpace).addClass('coveo-with-animation');\n      $$(this.pinnedBottomSpace).addClass('coveo-with-animation');\n      this.pinnedTopSpace.style.height = '0px';\n      this.pinnedBottomSpace.style.height = '0px';\n    }\n    this.unpinnedViewportPosition = undefined;\n    this.pinnedViewportPosition = undefined;\n  }\n\n  private isFacetPinned(): boolean {\n    return Utils.exists(this.pinnedViewportPosition);\n  }\n\n  private shouldFacetUnpin(): boolean {\n    return Utils.exists(this.unpinnedViewportPosition);\n  }\n\n  private ensurePinnedFacetHasntMoved(): void {\n    if (this.isFacetPinned()) {\n      Assert.exists(this.pinnedViewportPosition);\n      $$(this.pinnedTopSpace).removeClass('coveo-with-animation');\n      $$(this.pinnedBottomSpace).removeClass('coveo-with-animation');\n      this.pinnedTopSpace.style.height = '0px';\n      this.pinnedBottomSpace.style.height = '0px';\n\n      // Under firefox scrolling the body doesn't work, but window does\n      // on all browser, so we substitute those here when needed.\n      const elementToScroll: any = this.options.scrollContainer == document.body ? window : this.options.scrollContainer;\n      let currentViewportPosition = this.element.getBoundingClientRect().top;\n      let offset = currentViewportPosition - this.pinnedViewportPosition;\n      const scrollToOffset = () => {\n        if (elementToScroll instanceof Window) {\n          window.scrollTo(0, new Win(elementToScroll).scrollY() + offset);\n        } else {\n          (<HTMLElement>elementToScroll).scrollTop = elementToScroll.scrollTop + offset;\n        }\n      };\n      // First try to adjust position by scrolling the page\n      scrollToOffset();\n      currentViewportPosition = this.element.getBoundingClientRect().top;\n      offset = currentViewportPosition - this.pinnedViewportPosition;\n      // If scrolling has worked (offset == 0), we're good to go, nothing to do anymore.\n\n      if (offset < 0) {\n        // This means the facet element is scrolled up in the viewport,\n        // scroll it down by adding space in the top container\n        this.pinnedTopSpace.style.height = offset * -1 + 'px';\n      }\n      this.unpinnedViewportPosition = this.pinnedViewportPosition;\n      this.pinnedViewportPosition = null;\n    }\n  }\n\n  private buildFooter(): HTMLElement {\n    return $$('div', { className: 'coveo-facet-footer' }).el;\n  }\n\n  private buildMore(): HTMLElement {\n    const svgContainer = $$('span', { className: 'coveo-facet-more-icon' }, SVGIcons.icons.arrowDown).el;\n    SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-more-icon-svg');\n    const more = $$('div', { className: 'coveo-facet-more', tabindex: 0 }, svgContainer).el;\n\n    new AccessibleButton()\n      .withElement(more)\n      .withLabel(l('ShowMoreFacetResults', this.options.title))\n      .withSelectAction(() => this.handleClickMore())\n      .build();\n\n    return more;\n  }\n\n  private buildLess(): HTMLElement {\n    const svgContainer = $$('span', { className: 'coveo-facet-less-icon' }, SVGIcons.icons.arrowUp).el;\n    SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-less-icon-svg');\n    const less = $$('div', { className: 'coveo-facet-less', tabindex: 0 }, svgContainer).el;\n\n    new AccessibleButton()\n      .withElement(less)\n      .withLabel(l('ShowLessFacetResults', this.options.title))\n      .withSelectAction(() => this.handleClickLess())\n      .build();\n\n    return less;\n  }\n\n  private triggerMoreQuery() {\n    this.logger.info('Triggering new facet more query');\n    this.showWaitingAnimation();\n    // fetch 1 more value than we need, so we can see if there is more value to fetch still or if we have reached\n    // the end of the availables values\n    this.facetQueryController\n      .fetchMore(this.numberOfValues + 1)\n      .then((queryResults: IQueryResults) => {\n        this.logAnalyticsFacetShowMoreLess(analyticsActionCauseList.facetShowMore);\n        const facetValues = new FacetValues(queryResults.groupByResults[0]);\n        this.values = this.consolidateAndSortNewFacetValues(facetValues);\n\n        this.nbAvailableValues = this.values.size();\n\n        this.updateNumberOfValues();\n        this.canFetchMore = this.numberOfValues < this.nbAvailableValues;\n\n        if (this.values.hasSelectedOrExcludedValues() && !this.options.useAnd && this.options.isMultiValueField) {\n          this.triggerUpdateDeltaQuery(\n            _.filter(this.values.getAll(), (facetValue: FacetValue) => !facetValue.selected && !facetValue.excluded)\n          );\n        } else if (this.values.hasSelectedOrExcludedValues() && !this.options.useAnd) {\n          this.values.updateDeltaWithFilteredFacetValues(new FacetValues(), this.options.isMultiValueField);\n          this.hideWaitingAnimation();\n        } else {\n          this.hideWaitingAnimation();\n        }\n        this.rebuildValueElements();\n      })\n      .catch(() => this.hideWaitingAnimation());\n  }\n\n  protected triggerUpdateDeltaQuery(facetValues: FacetValue[]): void {\n    this.showWaitingAnimation();\n    this.facetQueryController.searchInFacetToUpdateDelta(facetValues).then((queryResults?) => {\n      const values: FacetValues = new FacetValues();\n      _.each(queryResults.groupByResults, (groupByResult: IGroupByResult) => {\n        _.each(groupByResult.values, (groupByValue: IGroupByValue) => {\n          if (!values.contains(groupByValue.value)) {\n            values.add(FacetValue.createFromGroupByValue(groupByValue));\n          }\n        });\n      });\n      this.values.updateDeltaWithFilteredFacetValues(values, this.options.isMultiValueField);\n      this.cleanupDeltaValuesForMultiValueField();\n      this.rebuildValueElements();\n      this.hideWaitingAnimation();\n    });\n  }\n\n  protected updateNumberOfValues() {\n    if (this.keepDisplayedValuesNextTime) {\n      return;\n    }\n\n    if (this.currentPage <= 0) {\n      // We're on the first page, let's reset the number of values to a minimum.\n      this.currentPage = 0;\n      this.numberOfValues = 0;\n    } else {\n      // Calculate the number of value with the current page.\n      this.numberOfValues = this.options.numberOfValues + this.currentPage * this.options.pageSize;\n    }\n\n    // Make sure we have at least the absolute minimum of value to display.\n    this.numberOfValues = Math.max(this.numberOfValues, this.getMinimumNumberOfValuesToDisplay());\n  }\n\n  private getMinimumNumberOfValuesToDisplay() {\n    // The min value is the number of used values.\n    let minValue = this.values.getExcluded().length + this.values.getSelected().length;\n\n    // When using a custom sort, we have to show all values between the selected ones.\n    // Thus, we must find the last selected value after a reorder and use that value as the number of value.\n    if (this.options.customSort != null && this.facetSort != null && this.options.customSort.length > 0) {\n      let lastSelectedValueIndex = -1;\n      new FacetValuesOrder(this, this.facetSort).reorderValues(this.values.getAll()).forEach((facetValue, index) => {\n        if (facetValue.selected) {\n          lastSelectedValueIndex = index;\n        }\n      });\n      minValue = lastSelectedValueIndex + 1;\n    }\n    return Math.max(minValue, this.options.numberOfValues);\n  }\n\n  private cleanupDeltaValuesForMultiValueField() {\n    // On a multi value field, it's possible to end up in a scenario where many of the current values are empty\n    // Crop those out, and adjust the nbAvailable values for the \"search\" and \"show more\";\n    if (this.options.isMultiValueField) {\n      _.each(this.values.getAll(), v => {\n        if (v.occurrences == 0 && !v.selected && !v.excluded) {\n          this.values.remove(v.value);\n        }\n      });\n      this.nbAvailableValues = this.values.getAll().length;\n    }\n  }\n\n  private shouldRenderFacetSearch() {\n    return this.options.enableFacetSearch;\n  }\n\n  private shouldRenderMoreLess() {\n    return this.options.enableMoreLess;\n  }\n\n  public debugInfo() {\n    const info: any = {};\n    info[this['constructor']['ID']] = {\n      component: this,\n      groupByRequest: this.facetQueryController.lastGroupByRequest,\n      groupByResult: this.facetQueryController.lastGroupByResult\n    };\n    return info;\n  }\n\n  private logAnalyticsFacetShowMoreLess(cause: IAnalyticsActionCause) {\n    this.usageAnalytics.logCustomEvent<IAnalyticsFacetMeta>(\n      cause,\n      {\n        facetId: this.options.id,\n        facetField: this.options.field.toString(),\n        facetTitle: this.options.title\n      },\n      this.element\n    );\n  }\n}\n\nInitialization.registerAutoCreateComponent(Facet);\n\nFacet.doExport();\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/Facet.ts","import { ComponentOptions } from '../Base/ComponentOptions';\n\n/**\n * ResponsiveFacets options\n */\nexport const ResponsiveFacetOptions = {\n  /**\n   * Specifies whether to enable *responsive mode* for facets. Setting this options to `false` on any `Facet`, or\n   * [`FacetSlider`]{@link FacetSlider} component in a search interface disables responsive mode for all other facets\n   * in the search interface.\n   *\n   * Responsive mode displays all facets under a single dropdown button whenever the width of the HTML element which\n   * the search interface is bound to reaches or falls behind a certain threshold (see\n   * {@link SearchInterface.responsiveComponents}).\n   *\n   * See also the [`dropdownHeaderLabel`]{@link Facet.options.dropdownHeaderLabel} option.\n   *\n   * Default value is `true`.\n   */\n  enableResponsiveMode: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'ResponsiveOptions' }),\n  responsiveBreakpoint: ComponentOptions.buildNumberOption({\n    deprecated:\n      'This option is exposed for legacy reasons. It is not recommended to use this option. Instead, use `SearchInterface.options.responsiveMediumBreakpoint` options exposed on the `SearchInterface`.'\n  }),\n  /**\n   * If the [`enableResponsiveMode`]{@link Facet.options.enableResponsiveMode} option is `true` for all facets and\n   * {@link FacetSlider.options.enableResponsiveMode} is also `true` for all sliders, specifies the label of the\n   * dropdown button that allows to display the facets when in responsive mode.\n   *\n   * If more than one `Facet` or {@link FacetSlider} component in the search interface specifies a value for this\n   * option, the framework uses the first occurrence of the option.\n   *\n   * Default value is `Filters`.\n   */\n  dropdownHeaderLabel: ComponentOptions.buildLocalizedStringOption({ section: 'ResponsiveOptions' })\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveFacetOptions.ts","import 'styling/_Result';\nimport 'styling/_ResultFrame';\nimport 'styling/_ResultList';\nimport { chain, compact, contains, each, flatten, map, unique, without, uniqueId, find } from 'underscore';\nimport {\n  IBuildingQueryEventArgs,\n  IDuringQueryEventArgs,\n  INewQueryEventArgs,\n  IQueryErrorEventArgs,\n  IQuerySuccessEventArgs,\n  QueryEvents\n} from '../../events/QueryEvents';\nimport { IResultLayoutPopulateArgs, ResultLayoutEvents } from '../../events/ResultLayoutEvents';\nimport {\n  IChangeLayoutEventArgs,\n  IDisplayedNewResultEventArgs,\n  IDisplayedNewResultsEventArgs,\n  ResultListEvents\n} from '../../events/ResultListEvents';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Assert } from '../../misc/Assert';\nimport { Defer } from '../../misc/Defer';\nimport { MODEL_EVENTS } from '../../models/Model';\nimport { QUERY_STATE_ATTRIBUTES } from '../../models/QueryStateModel';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { IQueryResults } from '../../rest/QueryResults';\nimport { DeviceUtils } from '../../utils/DeviceUtils';\nimport { $$, Doc, Win } from '../../utils/Dom';\nimport { DomUtils } from '../../utils/DomUtils';\nimport { Utils } from '../../utils/Utils';\nimport { analyticsActionCauseList, IAnalyticsNoMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IInitializationParameters, IInitResult, Initialization } from '../Base/Initialization';\nimport { InitializationPlaceholder } from '../Base/InitializationPlaceholder';\nimport { TemplateComponentOptions } from '../Base/TemplateComponentOptions';\nimport { ResponsiveDefaultResultTemplate } from '../ResponsiveComponents/ResponsiveDefaultResultTemplate';\nimport { ValidLayout, RendererValidLayout } from '../ResultLayoutSelector/ValidLayout';\nimport { CoreHelpers } from '../Templates/CoreHelpers';\nimport { DefaultRecommendationTemplate } from '../Templates/DefaultRecommendationTemplate';\nimport { DefaultResultTemplate } from '../Templates/DefaultResultTemplate';\nimport { TableTemplate } from '../Templates/TableTemplate';\nimport { Template } from '../Templates/Template';\nimport { TemplateCache } from '../Templates/TemplateCache';\nimport { TemplateList } from '../Templates/TemplateList';\nimport { ResultContainer } from './ResultContainer';\nimport { ResultListCardRenderer } from './ResultListCardRenderer';\nimport { ResultListRenderer } from './ResultListRenderer';\nimport { ResultListTableRenderer } from './ResultListTableRenderer';\nimport ResultLayoutSelectorModule = require('../ResultLayoutSelector/ResultLayoutSelector');\nimport { IResultListOptions } from './ResultListOptions';\nimport { ResultListUtils } from '../../utils/ResultListUtils';\nimport { TemplateToHtml, ITemplateToHtml } from '../Templates/TemplateToHtml';\n\nCoreHelpers.exportAllHelpersGlobally(window['Coveo']);\n\ntype WaitAnimation = 'fade' | 'spinner' | 'none';\n\n/**\n * The `ResultList` component is responsible for displaying query results by applying one or several result templates\n * (see [Result Templates](https://docs.coveo.com/en/413/)).\n *\n * It is possible to include multiple `ResultList` components along with a single `ResultLayout`\n * component in a search page to provide different result layouts (see\n * [Result Layouts](https://docs.coveo.com/en/360/)).\n *\n * This component supports infinite scrolling (see the\n * [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll} option).\n */\nexport class ResultList extends Component {\n  private static getDefaultTemplate(e: HTMLElement): Template {\n    const template = ResultList.loadTemplatesFromCache();\n    if (template != null) {\n      return template;\n    }\n\n    const component = <ResultList>Component.get(e);\n    if (Coveo['Recommendation'] && component.searchInterface instanceof Coveo['Recommendation']) {\n      return new DefaultRecommendationTemplate();\n    }\n    return new DefaultResultTemplate();\n  }\n\n  private static loadTemplatesFromCache(): Template {\n    var pageTemplateNames = TemplateCache.getResultListTemplateNames();\n    if (pageTemplateNames.length > 0) {\n      return new TemplateList(compact(map(pageTemplateNames, templateName => TemplateCache.getTemplate(templateName))));\n    }\n\n    return null;\n  }\n\n  static ID = 'ResultList';\n\n  static doExport = () => {\n    exportGlobally({\n      ResultList: ResultList\n    });\n  };\n\n  /**\n   * The options for the ResultList\n   * @componentOptions\n   */\n  static options: IResultListOptions = {\n    /**\n     * The element inside which to insert the rendered result templates.\n     *\n     * Performing a new query clears the content of this element.\n     *\n     * You can change the container by specifying its selector (e.g.,\n     * `data-result-container-selector='#someCssSelector'`).\n     *\n     * If you specify no value for this option, a `div` element will be dynamically created and appended to the result\n     * list. This element will then be used as a result container.\n     */\n    resultsContainer: ComponentOptions.buildChildHtmlElementOption({ alias: 'resultContainerSelector' }),\n    resultTemplate: TemplateComponentOptions.buildTemplateOption({ defaultFunction: ResultList.getDefaultTemplate }),\n\n    /**\n     * The type of animation to display while waiting for a query to return.\n     *\n     * The possible values are:\n     * - `fade`: Fades out the current list of results while the query is executing.\n     * - `spinner`: Shows a spinning animation while the query is executing.\n     * - `none`: Use no animation during queries.\n     *\n     * See also the [`waitAnimationContainer`]{@link ResultList.options.waitAnimationContainer} option.\n     *\n     * @examples spinner\n     */\n    waitAnimation: ComponentOptions.buildStringOption<WaitAnimation>({ defaultValue: 'none' }),\n\n    /**\n     * The element inside which to display the [`waitAnimation`]{@link ResultList.options.waitAnimation}.\n     *\n     * You can change this by specifying a CSS selector (e.g.,\n     * `data-wait-animation-container-selector='#someCssSelector'`).\n     *\n     * Defaults to the value of the [`resultsContainer`]{@link ResultList.options.resultsContainer} option.\n     */\n    waitAnimationContainer: ComponentOptions.buildChildHtmlElementOption({\n      postProcessing: (value, options: IResultListOptions) => value || options.resultsContainer\n    }),\n\n    /**\n     * Whether to automatically retrieve an additional page of results and append it to the\n     * results that the `ResultList` is currently displaying when the user scrolls down to the bottom of the\n     * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n     *\n     * See also the [`infiniteScrollPageSize`]{@link ResultList.options.infiniteScrollPageSize} and\n     * [`enableInfiniteScrollWaitingAnimation`]{@link ResultList.options.enableInfiniteScrollWaitingAnimation} options.\n     *\n     * It is important to specify the `infiniteScrollContainer` option manually if you want the scrolling element to be\n     * something else than the default `window` element. Otherwise, you might find yourself in a strange state where the\n     * framework rapidly triggers multiple successive query.\n     */\n    enableInfiniteScroll: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n\n    /**\n     * The number of additional results to fetch when the user scrolls down to the bottom of the\n     * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n     *\n     * @examples 5\n     */\n    infiniteScrollPageSize: ComponentOptions.buildNumberOption({\n      defaultValue: 10,\n      min: 1,\n      depend: 'enableInfiniteScroll'\n    }),\n\n    /**\n     * The element that triggers fetching additional results when the end user scrolls down to its bottom.\n     *\n     * You can change the container by specifying its selector (e.g.,\n     * `data-infinite-scroll-container-selector='#someCssSelector'`).\n     *\n     * By default, the framework uses the first vertically scrollable parent element it finds, starting from the\n     * `ResultList` element itself. A vertically scrollable element is an element whose CSS `overflow-y` attribute is\n     * `scroll`.\n     *\n     * This implies that if the framework can find no scrollable parent, it uses the `window` itself as a scrollable\n     * container.\n     *\n     * This heuristic is not perfect, for technical reasons. There are always some corner case CSS combination which the\n     * framework will not be able to correctly detect as 'scrollable'.\n     *\n     * It is highly recommended that you manually set this option if you wish something else than the `window` to be the\n     * scrollable element.\n     */\n    infiniteScrollContainer: ComponentOptions.buildChildHtmlElementOption({\n      depend: 'enableInfiniteScroll',\n      defaultFunction: element => ComponentOptions.findParentScrolling(element)\n    }),\n\n    /**\n     * Whether to display the [`waitingAnimation`]{@link ResultList.options.waitAnimation} while fetching additional\n     * results.\n     */\n    enableInfiniteScrollWaitingAnimation: ComponentOptions.buildBooleanOption({\n      depend: 'enableInfiniteScroll',\n      defaultValue: true\n    }),\n    mobileScrollContainer: ComponentOptions.buildSelectorOption({\n      defaultFunction: () => <HTMLElement>document.querySelector('.coveo-results-column')\n    }),\n\n    /**\n     * Whether the `ResultList` should scan its result templates to discover which fields it must request to\n     * be able to render all results.\n     *\n     * Setting this option to `true` ensures that the Coveo Search API does not return fields that are unnecessary for\n     * the UI to function.\n     * \n     * If you set this option to `true`, the fields referenced in your result folding templates won't be automatically resolved.\n     * In such a case, you must manually specify those fields using the [`fieldsToInclude`]{@link ResultList.options.fieldsToInclude} option.\n     *\n     * **Notes:**\n     *\n     * - Many interfaces created with the JavaScript Search Interface Editor explicitly set this option to `true`.   \n     * - You cannot set this option to `true` in the Coveo for Sitecore integration.\n     */\n    autoSelectFieldsToInclude: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n\n    /**\n     * A list of fields to include in the query results.\n     *\n     * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n     * `true`, the Coveo Search API returns the fields you specify for this option (if those fields are available) in\n     * addition to the fields which the `ResultList` automatically requests. Note that the `autoSelectFieldsToInclude`\n     * option doesn't automatically request fields for folding templates; in such a case, you must manually specify \n     * fields using this option to avoid empty results.\n     *\n     * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n     * `false`, the Coveo Search API only returns the fields you specify for this option (if those fields are\n     * available).\n     * \n     * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n     * `false` and leave this option undefined, the Coveo Search API returns all available fields.\n     */\n    fieldsToInclude: ComponentOptions.buildFieldsOption({ includeInResults: true }),\n\n    /**\n     * Specifies the layout to use when displaying results in this `ResultList` (see\n     * [Result Layouts](https://docs.coveo.com/en/360/)). Specifying a value for this option automatically\n     * populates a [`ResultLayout`]{@link ResultLayout} component with a switcher for the layout.\n     *\n     * For example, if there are two `ResultList` components in the page, one with its `layout` set to `list` and the\n     * other with the same option set to `card`, then the `ResultLayout` component will render two buttons respectively\n     * entitled **List** and **Card**.\n     *\n     * See the [`ValidLayout`]{@link ValidLayout} type for the list of possible values.\n     *\n     * @examples card\n     */\n    layout: ComponentOptions.buildStringOption<ValidLayout>({\n      defaultValue: 'list',\n      required: true\n    }),\n\n    /**\n     * Whether to scroll back to the top of the page when the end-user:\n     *  - interacts with a facet when [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer} is set to `true`\n     *  - interacts with the [`Pager`]{@link Pager} component when [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer} is set to `false`\n     *\n     * **Note:** Setting this option to `false` has no effect on dynamic facets. To disable this behavior on a `DynamicFacet` component, you must set its own [`enableScrollToTop`]{@link DynamicFacet.options.enableScrollToTop} option to `false`.\n     *\n     * @availablesince [July 2019 Release (v2.6459)](https://docs.coveo.com/en/2938/)\n     */\n    enableScrollToTop: ComponentOptions.buildBooleanOption({\n      defaultValue: true\n    })\n  };\n\n  public static resultCurrentlyBeingRendered: IQueryResult = null;\n  public currentlyDisplayedResults: IQueryResult[] = [];\n  private fetchingMoreResults: Promise<IQueryResults>;\n  private reachedTheEndOfResults = false;\n  private disableLayoutChange = false;\n  private renderer: ResultListRenderer;\n  private resultContainer: ResultContainer;\n\n  // This variable serves to block some setup where the framework fails to correctly identify the \"real\" scrolling container.\n  // Since it's not technically feasible to correctly identify the scrolling container in every possible scenario without some very complex logic, we instead try to add some kind of mechanism to\n  // block runaway requests where UI will keep asking more results in the index, eventually bringing the browser to it's knee.\n  // Those successive request are needed in \"displayMoreResults\" to ensure we fill the scrolling container correctly.\n  // Since the container is not identified correctly, it is never \"full\", so we keep asking for more.\n  // It is reset every time the user actually scroll the container manually.\n  private successiveScrollCount = 0;\n  private static MAX_AMOUNT_OF_SUCESSIVE_REQUESTS = 5;\n\n  /**\n   * Creates a new `ResultList` component. Binds various event related to queries (e.g., on querySuccess ->\n   * renderResults). Binds scroll event if the [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll}\n   * option is `true`.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `ResultList` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   * @param elementClassId The class that this component should instantiate. Components that extend the base ResultList\n   * use this. Default value is `CoveoResultList`.\n   */\n  constructor(\n    public element: HTMLElement,\n    public options?: IResultListOptions,\n    public bindings?: IComponentBindings,\n    elementClassId: string = ResultList.ID\n  ) {\n    super(element, elementClassId, bindings);\n    this.options = ComponentOptions.initComponentOptions(element, ResultList, options);\n\n    Assert.exists(element);\n    Assert.exists(this.options);\n    Assert.exists(this.options.resultTemplate);\n    Assert.exists(this.options.infiniteScrollContainer);\n\n    this.showOrHideElementsDependingOnState(false, false);\n\n    this.addListeners();\n\n    this.resultContainer = this.initResultContainer();\n    Assert.exists(this.options.resultsContainer);\n\n    this.initWaitAnimationContainer();\n    Assert.exists(this.options.waitAnimationContainer);\n\n    this.setupTemplatesVersusLayouts();\n    $$(this.root).on(ResultLayoutEvents.populateResultLayout, (e, args: IResultLayoutPopulateArgs) =>\n      args.layouts.push(this.options.layout)\n    );\n    this.setupRenderer();\n    this.makeElementFocusable();\n    this.ensureHasId();\n  }\n\n  private addListeners() {\n    this.bind.onRootElement<INewQueryEventArgs>(QueryEvents.newQuery, (args: INewQueryEventArgs) => this.handleNewQuery());\n    this.bind.onRootElement<IBuildingQueryEventArgs>(QueryEvents.buildingQuery, (args: IBuildingQueryEventArgs) =>\n      this.handleBuildingQuery(args)\n    );\n    this.bind.onRootElement<IQuerySuccessEventArgs>(QueryEvents.querySuccess, (args: IQuerySuccessEventArgs) =>\n      this.handleQuerySuccess(args)\n    );\n    this.bind.onRootElement<IDuringQueryEventArgs>(QueryEvents.duringQuery, (args: IDuringQueryEventArgs) => this.handleDuringQuery());\n    this.bind.onRootElement<IQueryErrorEventArgs>(QueryEvents.queryError, (args: IQueryErrorEventArgs) => this.handleQueryError());\n    $$(this.root).on(ResultListEvents.changeLayout, (e: Event, args: IChangeLayoutEventArgs) => this.handleChangeLayout(args));\n\n    if (this.options.enableInfiniteScroll) {\n      this.addInfiniteScrollListeners();\n    } else {\n      this.addPagerListeners();\n    }\n  }\n\n  private addInfiniteScrollListeners() {\n    this.bind.on(<HTMLElement>this.options.infiniteScrollContainer, 'scroll', () => {\n      this.successiveScrollCount = 0;\n      this.handleScrollOfResultList();\n    });\n    this.bind.onRootElement(QueryEvents.deferredQuerySuccess, () => {\n      setTimeout(() => {\n        this.scrollToTopIfEnabled();\n      }, 0);\n    });\n  }\n\n  private addPagerListeners() {\n    this.bind.onQueryState(MODEL_EVENTS.CHANGE_ONE, QUERY_STATE_ATTRIBUTES.FIRST, () => {\n      this.bind.oneRootElement(QueryEvents.deferredQuerySuccess, () => {\n        setTimeout(() => {\n          this.scrollToTopIfEnabled();\n        }, 0);\n      });\n    });\n  }\n\n  /**\n   * Get the fields needed to be automatically included in the query for this result list.\n   * @returns {string[]}\n   */\n  public getAutoSelectedFieldsToInclude(): string[] {\n    return chain(this.options.resultTemplate.getFields()).concat(this.getMinimalFieldsToInclude()).compact().unique().value();\n  }\n\n  private setupTemplatesVersusLayouts() {\n    const layoutClassToAdd = `coveo-${this.options.layout}-layout-container`;\n    this.resultContainer.addClass(layoutClassToAdd);\n\n    if (this.options.layout === 'table') {\n      this.options.resultTemplate = new TableTemplate((<TemplateList>this.options.resultTemplate).templates || []);\n    }\n\n    // A TemplateList is the scenario where the result template are directly embedded inside the ResultList\n    // This is the typical scenario when a page gets created by the interface editor, for example.\n    // In that case, we try to stick closely that what is actually configured inside the page, and do no \"special magic\".\n    // Stick to the \"hardcoded\" configuration present in the page.\n    // We only add the correct layout options if it has not been set manually.\n    if (this.options.resultTemplate instanceof TemplateList) {\n      each((<TemplateList>this.options.resultTemplate).templates, (tmpl: Template) => {\n        if (!tmpl.layout) {\n          tmpl.layout = <ValidLayout>this.options.layout;\n        }\n      });\n    } else if (this.options.resultTemplate instanceof DefaultResultTemplate && this.options.layout == 'list') {\n      ResponsiveDefaultResultTemplate.init(this.root, this, {});\n    }\n  }\n\n  /**\n   * Empties the current result list content and appends the given array of HTMLElement.\n   *\n   * Can append to existing elements in the result list, or replace them.\n   *\n   * Triggers the `newResultsDisplayed` and `newResultDisplayed` events.\n   * @param resultsElement\n   * @param append\n   */\n  public renderResults(resultElements: HTMLElement[], append = false): Promise<void> {\n    if (!append) {\n      this.resultContainer.empty();\n    }\n\n    return this.renderer\n      .renderResults(resultElements, append, this.triggerNewResultDisplayed.bind(this))\n      .then(() => this.triggerNewResultsDisplayed());\n  }\n\n  /**\n   * Builds and returns an array of HTMLElement with the given result set.\n   * @param results the result set to build an array of HTMLElement from.\n   */\n  public buildResults(results: IQueryResults): Promise<HTMLElement[]> {\n    const layout = <RendererValidLayout>this.options.layout;\n    return this.templateToHtml.buildResults(results, layout, this.currentlyDisplayedResults);\n  }\n\n  /**\n   * Builds and returns an HTMLElement for the given result.\n   * @param result the result to build an HTMLElement from.\n   * @returns {HTMLElement}\n   */\n  public buildResult(result: IQueryResult): Promise<HTMLElement> {\n    const layout = <RendererValidLayout>this.options.layout;\n    return this.templateToHtml.buildResult(result, layout, this.currentlyDisplayedResults);\n  }\n\n  /**\n   * Executes a query to fetch new results. After the query returns, renders the new results.\n   *\n   * Asserts that there are more results to display by verifying whether the last query has returned as many results as\n   * requested.\n   *\n   * Asserts that the `ResultList` is not currently fetching results.\n   * @param count The number of results to fetch and display.\n   */\n  public displayMoreResults(count: number) {\n    Assert.isLargerOrEqualsThan(1, count);\n\n    if (this.isCurrentlyFetchingMoreResults()) {\n      this.logger.warn(\"Ignoring request to display more results since we're already doing so\");\n      return;\n    }\n    if (!this.hasPotentiallyMoreResultsToDisplay()) {\n      this.logger.warn(\"Ignoring request to display more results since we know there aren't more to display\");\n      return;\n    }\n\n    if (this.options.enableInfiniteScrollWaitingAnimation) {\n      this.showWaitingAnimationForInfiniteScrolling();\n    }\n\n    return this.fetchAndRenderMoreResults(count);\n  }\n\n  public get templateToHtml() {\n    const templateToHtmlArgs: ITemplateToHtml = {\n      resultTemplate: this.options.resultTemplate,\n      searchInterface: this.searchInterface,\n      queryStateModel: this.queryStateModel\n    };\n    return new TemplateToHtml(templateToHtmlArgs);\n  }\n\n  /**\n   * Gets the list of currently displayed result.\n   * @returns {IQueryResult[]}\n   */\n  public getDisplayedResults(): IQueryResult[] {\n    return this.currentlyDisplayedResults;\n  }\n\n  /**\n   * Gets the list of currently displayed result HTMLElement.\n   * @returns {HTMLElement[]}\n   */\n  public getDisplayedResultsElements(): HTMLElement[] {\n    return this.resultContainer.getResultElements();\n  }\n\n  public enable(): void {\n    this.disableLayoutChange = false;\n    if (this.resultLayoutSelectors.length > 0) {\n      this.enableBasedOnActiveLayouts();\n    } else {\n      super.enable();\n      $$(this.element).removeClass('coveo-hidden');\n    }\n  }\n\n  public disable(): void {\n    super.disable();\n    const otherLayoutsStillActive = map(this.otherResultLists, otherResultList => otherResultList.options.layout);\n    if (!contains(otherLayoutsStillActive, this.options.layout) && !this.disableLayoutChange) {\n      each(this.resultLayoutSelectors, resultLayoutSelector => {\n        resultLayoutSelector.disableLayouts([this.options.layout] as ValidLayout[]);\n      });\n    }\n    this.disableLayoutChange = false;\n    $$(this.element).addClass('coveo-hidden');\n  }\n\n  protected autoCreateComponentsInsideResult(element: HTMLElement, result: IQueryResult): IInitResult {\n    return this.templateToHtml.autoCreateComponentsInsideResult(element, result);\n  }\n\n  protected triggerNewResultDisplayed(result: IQueryResult, resultElement: HTMLElement) {\n    const args: IDisplayedNewResultEventArgs = {\n      result: result,\n      item: resultElement\n    };\n    $$(this.element).trigger(ResultListEvents.newResultDisplayed, args);\n  }\n\n  protected triggerNewResultsDisplayed() {\n    const args: IDisplayedNewResultsEventArgs = {\n      isInfiniteScrollEnabled: this.options.enableInfiniteScroll\n    };\n    $$(this.element).trigger(ResultListEvents.newResultsDisplayed, args);\n  }\n\n  private async fetchAndRenderMoreResults(count: number): Promise<IQueryResults> {\n    this.fetchingMoreResults = this.queryController.fetchMore(count);\n\n    try {\n      const data = await this.fetchingMoreResults;\n      Assert.exists(data);\n      this.usageAnalytics.logCustomEvent<IAnalyticsNoMeta>(analyticsActionCauseList.pagerScrolling, {}, this.element);\n\n      this.reachedTheEndOfResults = count > data.results.length;\n      this.renderNewResults(data);\n\n      this.resetStateAfterFetchingMoreResults();\n\n      return data;\n    } catch (e) {\n      this.resetStateAfterFetchingMoreResults();\n      return Promise.reject(e);\n    }\n  }\n\n  private async renderNewResults(data: IQueryResults) {\n    const elements = await this.buildResults(data);\n    this.renderResults(elements, true);\n    this.currentlyDisplayedResults.push(...data.results);\n    this.triggerNewResultsDisplayed();\n  }\n\n  private resetStateAfterFetchingMoreResults() {\n    this.hideWaitingAnimationForInfiniteScrolling();\n    this.fetchingMoreResults = undefined;\n    Defer.defer(() => {\n      this.successiveScrollCount++;\n      if (this.successiveScrollCount <= ResultList.MAX_AMOUNT_OF_SUCESSIVE_REQUESTS) {\n        this.handleScrollOfResultList();\n      } else {\n        this.logger.info(\n          `Result list has triggered 5 consecutive queries to try and fill up the scrolling container, but it is still unable to do so.\n          Try explicitly setting the 'data-infinite-scroll-container-selector' option on the result list. See: https://coveo.github.io/search-ui/components/resultlist.html#options.infinitescrollcontainer`\n        );\n      }\n    });\n  }\n\n  private handleDuringQuery() {\n    this.logger.trace('Emptying the result container');\n    this.cancelFetchingMoreResultsIfNeeded();\n    this.showWaitingAnimation();\n    this.showOrHideElementsDependingOnState(false, false);\n  }\n\n  private handleQueryError() {\n    this.hideWaitingAnimation();\n    this.resultContainer.empty();\n    this.currentlyDisplayedResults = [];\n    this.reachedTheEndOfResults = true;\n  }\n\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\n    Assert.exists(data);\n    Assert.exists(data.results);\n    const results = data.results;\n    this.logger.trace('Received query results from new query', results);\n    this.hideWaitingAnimation();\n\n    ResultList.resultCurrentlyBeingRendered = undefined;\n    this.reachedTheEndOfResults = data.query.numberOfResults > data.results.results.length;\n\n    this.currentlyDisplayedResults = [];\n    this.buildResults(data.results).then(async (elements: HTMLElement[]) => {\n      await this.renderResults(elements);\n\n      this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length != 0);\n\n      if (DeviceUtils.isMobileDevice() && this.options.mobileScrollContainer != undefined) {\n        this.options.mobileScrollContainer.scrollTop = 0;\n      }\n\n      if (this.options.enableInfiniteScroll && results.results.length == data.queryBuilder.numberOfResults) {\n        // This will check right away if we need to add more results to make the scroll container full & scrolling.\n        this.scrollToTopIfEnabled();\n        this.handleScrollOfResultList();\n      }\n    });\n  }\n\n  private handleScrollOfResultList() {\n    if (this.isCurrentlyFetchingMoreResults() || !this.options.enableInfiniteScroll) {\n      return;\n    }\n    if (this.isScrollingOfResultListAlmostAtTheBottom() && this.hasPotentiallyMoreResultsToDisplay()) {\n      this.displayMoreResults(this.options.infiniteScrollPageSize);\n    }\n  }\n\n  private scrollToTopIfEnabled() {\n    if (!this.options.enableScrollToTop) {\n      return;\n    }\n\n    ResultListUtils.scrollToTop(this.root);\n  }\n\n  private handleNewQuery() {\n    $$(this.element).removeClass('coveo-hidden');\n    ResultList.resultCurrentlyBeingRendered = undefined;\n  }\n\n  private get otherResultLists() {\n    const allResultLists = this.searchInterface.getComponents(ResultList.ID) as ResultList[];\n    return without(allResultLists, this);\n  }\n\n  private get resultLayoutSelectors() {\n    return this.searchInterface.getComponents('ResultLayoutSelector') as ResultLayoutSelectorModule.ResultLayoutSelector[];\n  }\n\n  protected handleBuildingQuery(args: IBuildingQueryEventArgs) {\n    if (this.options.fieldsToInclude != null) {\n      // remove the @\n      args.queryBuilder.addFieldsToInclude(map(this.options.fieldsToInclude, field => field.substr(1)));\n    }\n    if (this.options.autoSelectFieldsToInclude) {\n      const otherFields = flatten(\n        map(this.otherResultLists, otherResultList => {\n          return otherResultList.getAutoSelectedFieldsToInclude();\n        })\n      );\n\n      args.queryBuilder.addRequiredFields(unique(otherFields.concat(this.getAutoSelectedFieldsToInclude())));\n      args.queryBuilder.includeRequiredFields = true;\n    }\n  }\n\n  protected handleChangeLayout(args: IChangeLayoutEventArgs) {\n    if (args.layout === this.options.layout) {\n      this.disableLayoutChange = false;\n      this.enable();\n      this.options.resultTemplate.layout = <ValidLayout>this.options.layout;\n      if (args.results) {\n        // Prevent flickering when switching to a new layout that is empty\n        // add a temporary placeholder, the same that is used on initialization\n        if (this.resultContainer.isEmpty()) {\n          new InitializationPlaceholder(this.root).withVisibleRootElement().withPlaceholderForResultList();\n        }\n        Defer.defer(async () => {\n          const elements = await this.buildResults(args.results);\n          this.renderResults(elements);\n          this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length !== 0);\n        });\n      }\n    } else {\n      this.disableLayoutChange = true;\n      this.disable();\n      this.resultContainer.empty();\n    }\n  }\n\n  private isCurrentlyFetchingMoreResults(): boolean {\n    return Utils.exists(this.fetchingMoreResults);\n  }\n\n  private getMinimalFieldsToInclude() {\n    // these fields are needed for analytics click event\n    return ['author', 'language', 'urihash', 'objecttype', 'collection', 'source', 'language', 'permanentid'];\n  }\n\n  private isScrollingOfResultListAlmostAtTheBottom(): boolean {\n    // this is in a try catch because the unit test fail otherwise (Window does not exist for phantom js in the console)\n    let isWindow;\n    try {\n      isWindow = this.options.infiniteScrollContainer instanceof Window;\n    } catch (e) {\n      isWindow = false;\n    }\n    return isWindow ? this.isScrollAtBottomForWindowElement() : this.isScrollAtBottomForHtmlElement();\n  }\n\n  private isScrollAtBottomForWindowElement() {\n    const win = new Win(window);\n    const windowHeight = win.height();\n    const scrollTop = win.scrollY();\n    const bodyHeight = new Doc(document).height();\n    return bodyHeight - (windowHeight + scrollTop) < windowHeight / 2;\n  }\n\n  private isScrollAtBottomForHtmlElement() {\n    const el = <HTMLElement>this.options.infiniteScrollContainer;\n    const elementHeight = el.clientHeight;\n    const scrollHeight = el.scrollHeight;\n    const bottomPosition = el.scrollTop + elementHeight;\n    return scrollHeight - bottomPosition < elementHeight / 2;\n  }\n\n  public hasPotentiallyMoreResultsToDisplay(): boolean {\n    return this.currentlyDisplayedResults.length > 0 && !this.reachedTheEndOfResults;\n  }\n\n  private cancelFetchingMoreResultsIfNeeded() {\n    if (this.isCurrentlyFetchingMoreResults()) {\n      this.logger.trace('Cancelling fetching more results');\n      Promise.reject(this.fetchingMoreResults);\n      this.fetchingMoreResults = undefined;\n    }\n  }\n\n  private showOrHideElementsDependingOnState(hasQuery: boolean, hasResults: boolean) {\n    const showIfQuery = $$(this.element).findAll('.coveo-show-if-query');\n    const showIfNoQuery = $$(this.element).findAll('.coveo-show-if-no-query');\n    const showIfResults = $$(this.element).findAll('.coveo-show-if-results');\n    const showIfNoResults = $$(this.element).findAll('.coveo-show-if-no-results');\n\n    each(showIfQuery, (s: HTMLElement) => {\n      $$(s).toggle(hasQuery);\n    });\n    each(showIfNoQuery, (s: HTMLElement) => {\n      $$(s).toggle(!hasQuery);\n    });\n    each(showIfResults, (s: HTMLElement) => {\n      $$(s).toggle(hasQuery && hasResults);\n    });\n    each(showIfNoResults, (s: HTMLElement) => {\n      $$(s).toggle(hasQuery && !hasResults);\n    });\n  }\n\n  private get waitAnimation() {\n    return this.options.waitAnimation.toLowerCase() as WaitAnimation;\n  }\n\n  private showWaitingAnimation() {\n    switch (this.waitAnimation) {\n      case 'fade':\n        $$(this.options.waitAnimationContainer).addClass('coveo-fade-out');\n        break;\n      case 'spinner':\n        this.resultContainer.hideChildren();\n        if ($$(this.options.waitAnimationContainer).find('.coveo-wait-animation') == undefined) {\n          this.options.waitAnimationContainer.appendChild(DomUtils.getBasicLoadingAnimation());\n        }\n        break;\n    }\n  }\n\n  private hideWaitingAnimation() {\n    switch (this.waitAnimation) {\n      case 'fade':\n        $$(this.options.waitAnimationContainer).removeClass('coveo-fade-out');\n        break;\n      case 'spinner':\n        const spinner = $$(this.options.waitAnimationContainer).find('.coveo-loading-spinner');\n        if (spinner) {\n          $$(spinner).detach();\n        }\n        break;\n    }\n  }\n\n  private showWaitingAnimationForInfiniteScrolling() {\n    const spinner = DomUtils.getLoadingSpinner();\n    if (this.options.layout == 'card' && this.options.enableInfiniteScroll) {\n      const previousSpinnerContainer = $$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n      each(previousSpinnerContainer, previousSpinner => $$(previousSpinner).remove());\n      const spinnerContainer = $$('div', {\n        className: 'coveo-loading-spinner-container'\n      });\n      spinnerContainer.append(spinner);\n      this.options.waitAnimationContainer.appendChild(spinnerContainer.el);\n    } else {\n      this.options.waitAnimationContainer.appendChild(DomUtils.getLoadingSpinner());\n    }\n  }\n\n  private hideWaitingAnimationForInfiniteScrolling() {\n    const spinners = $$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner');\n    const containers = $$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n    each(spinners, spinner => $$(spinner).remove());\n    each(containers, container => $$(container).remove());\n  }\n\n  private initResultContainer(): ResultContainer {\n    if (!this.options.resultsContainer) {\n      const elemType = this.options.layout === 'table' ? 'table' : 'div';\n      this.options.resultsContainer = $$(elemType, { className: 'coveo-result-list-container' }).el;\n      this.initResultContainerAddToDom();\n    }\n    return new ResultContainer(this.options.resultsContainer, this.searchInterface);\n  }\n\n  protected initResultContainerAddToDom() {\n    this.element.appendChild(this.options.resultsContainer);\n  }\n\n  private initWaitAnimationContainer() {\n    if (!this.options.waitAnimationContainer) {\n      this.options.waitAnimationContainer = this.resultContainer.el;\n    }\n  }\n\n  private setupRenderer() {\n    const initParameters: IInitializationParameters = {\n      options: this.searchInterface.options.originalOptionsObject,\n      bindings: this.bindings\n    };\n\n    const autoCreateComponentsFn = (elem: HTMLElement) => Initialization.automaticallyCreateComponentsInside(elem, initParameters);\n\n    switch (this.options.layout) {\n      case 'card':\n        this.renderer = new ResultListCardRenderer(this.options, autoCreateComponentsFn);\n        break;\n      case 'table':\n        this.renderer = new ResultListTableRenderer(this.options, autoCreateComponentsFn);\n        break;\n      case 'list':\n      default:\n        this.renderer = new ResultListRenderer(this.options, autoCreateComponentsFn);\n        break;\n    }\n  }\n\n  private makeElementFocusable() {\n    $$(this.element).setAttribute('tabindex', '-1');\n  }\n\n  private ensureHasId() {\n    const currentId = this.element.id;\n    if (currentId === '') {\n      this.element.id = uniqueId('coveo-result-list');\n    }\n  }\n\n  private enableBasedOnActiveLayouts() {\n    // We should try to enable a result list only when the result layout selector currently allow that result list layout to be displayed.\n    each(this.resultLayoutSelectors, resultLayoutSelector => {\n      const found = find(resultLayoutSelector.activeLayouts, (activeLayout, activeLayoutKey) => activeLayoutKey == this.options.layout);\n      if (found) {\n        super.enable();\n        resultLayoutSelector.enableLayouts([this.options.layout] as ValidLayout[]);\n        $$(this.element).removeClass('coveo-hidden');\n      }\n    });\n  }\n}\n\nInitialization.registerAutoCreateComponent(ResultList);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultList.ts","import { Component } from '../Base/Component';\nimport { l } from '../../strings/Strings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IFieldOption } from '../Base/IComponentOptions';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Initialization } from '../Base/Initialization';\nimport { exportGlobally } from '../../GlobalExports';\nimport { CategoryFacetTemplates } from './CategoryFacetTemplates';\nimport { CategoryValueRoot } from './CategoryValueRoot';\nimport { CategoryFacetQueryController } from '../../controllers/CategoryFacetQueryController';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { QueryStateModel } from '../../models/QueryStateModel';\nimport 'styling/_CategoryFacet';\nimport { IAttributesChangedEventArg, MODEL_EVENTS } from '../../models/Model';\nimport { Utils } from '../../utils/Utils';\nimport { CategoryValue, CategoryValueParent } from './CategoryValue';\nimport { pluck, reduce, find, first, last, contains, isArray, keys } from 'underscore';\nimport { Assert } from '../../misc/Assert';\nimport { QueryEvents, IBuildingQueryEventArgs, IQuerySuccessEventArgs } from '../../events/QueryEvents';\nimport { CategoryFacetSearch } from './CategoryFacetSearch';\nimport { ICategoryFacetResult } from '../../rest/CategoryFacetResult';\nimport { BreadcrumbEvents, IPopulateBreadcrumbEventArgs } from '../../events/BreadcrumbEvents';\nimport { CategoryFacetBreadcrumb } from './CategoryFacetBreadcrumb';\nimport { ICategoryFacetValue } from '../../rest/CategoryFacetValue';\nimport { ISearchEndpoint } from '../../rest/SearchEndpointInterface';\nimport {\n  IAnalyticsCategoryFacetMeta,\n  analyticsActionCauseList,\n  IAnalyticsActionCause,\n  IAnalyticsFacetMeta\n} from '../Analytics/AnalyticsActionListMeta';\nimport { CategoryFacetDebug } from './CategoryFacetDebug';\nimport { QueryBuilder } from '../Base/QueryBuilder';\nimport { IAutoLayoutAdjustableInsideFacetColumn } from '../SearchInterface/FacetColumnAutoLayoutAdjustment';\nimport { ResponsiveFacets } from '../ResponsiveComponents/ResponsiveFacets';\nimport { IResponsiveComponentOptions } from '../ResponsiveComponents/ResponsiveComponentsManager';\nimport { ResponsiveFacetOptions } from '../ResponsiveComponents/ResponsiveFacetOptions';\nimport { CategoryFacetHeader } from './CategoryFacetHeader';\nimport { AccessibleButton } from '../../utils/AccessibleButton';\nimport { IStringMap } from '../../rest/GenericParam';\nimport {\n  DependsOnManager,\n  IDependentFacet,\n  IDependsOnCompatibleFacetOptions,\n  IDependentFacetCondition\n} from '../../utils/DependsOnManager';\nimport { ResultListUtils } from '../../utils/ResultListUtils';\nimport { CategoryFacetValuesTree } from './CategoryFacetValuesTree';\n\nexport interface ICategoryFacetOptions extends IResponsiveComponentOptions, IDependsOnCompatibleFacetOptions {\n  field: IFieldOption;\n  title?: string;\n  numberOfResultsInFacetSearch?: number;\n  id?: string;\n  enableFacetSearch?: boolean;\n  facetSearchDelay?: number;\n  numberOfValues?: number;\n  injectionDepth?: number;\n  enableMoreLess?: boolean;\n  pageSize?: number;\n  delimitingCharacter?: string;\n  debug?: boolean;\n  basePath?: string[];\n  maximumDepth?: number;\n  valueCaption?: IStringMap<string>;\n  dependsOn?: string;\n  displaySearchOnTop?: boolean;\n  displaySearchButton?: boolean;\n}\n\nexport type CategoryValueDescriptor = {\n  value: string;\n  count: number;\n  path: string[];\n};\n\n/**\n * The `CategoryFacet` component is a facet that renders values in a hierarchical fashion. It determines the filter to apply depending on the\n * current selected path of values.\n *\n * The path is a sequence of values that leads to a specific value in the hierarchy.\n * It is an array listing all the parents of a file (e.g., `['c', 'folder1']` for the `c:\\folder1\\text1.txt` file).\n *\n * This facet requires a [`field`]{@link CategoryFacet.options.field} with a special format to work correctly (see [Using the Category Facet Component](https://docs.coveo.com/en/2667)).\n *\n * @notSupportedIn salesforcefree\n * @availablesince [January 2019 Release (v2.5395.12)]({{ site.baseurl }}/2938/)\n */\nexport class CategoryFacet extends Component implements IAutoLayoutAdjustableInsideFacetColumn {\n  static doExport = () => {\n    exportGlobally({\n      CategoryFacet\n    });\n  };\n\n  static ID = 'CategoryFacet';\n\n  /**\n   * The options for the component\n   * @componentOptions\n   */\n  static options: ICategoryFacetOptions = {\n    /**\n     * The index field whose values the facet should use. The field values should have the form:\n     * `the; the|path; the|path|to; the|path|to|given; the|path|to|given|item;`\n     * where the delimiting character is `|`. This default delimiting character can be changed using the [delimitingCharacter]{@link CategoryFacet.options.delimitingCharacter} option.\n     *\n     * To help you verify whether your fields are setup correctly, see the {@link CategoryFacet.options.debug} option\n     * and the {@link CategoryFacet.debugValue} method.\n     *\n     * See [Using the Category Facet Component](https://docs.coveo.com/en/2667).\n     */\n    field: ComponentOptions.buildFieldOption({ required: true }),\n    /**\n     * The title to display at the top of the facet.\n     *\n     * Default value is the localized string for `NoTitle`.\n     */\n    title: ComponentOptions.buildLocalizedStringOption({\n      localizedString: () => l('NoTitle')\n    }),\n    /**\n     * The maximum number of field values to display by default in the facet before the user\n     * clicks the arrow to show more.\n     *\n     * See also the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess} option.\n     */\n    numberOfValues: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0, section: 'CommonOptions' }),\n    /**\n     * Whether to display a search box at the bottom of the facet for searching among the available facet\n     * [`field`]{@link CategoryFacet.options.field} values.\n     *\n     * See also the [`facetSearchDelay`]{@link CategoryFacet.options.facetSearchDelay}, and\n     * [`numberOfResultsInFacetSearch`]{@link CategoryFacet.options.numberOfResultsInFacetSearch} options.\n     *\n     *\n     * Default value is `true`.\n     */\n    enableFacetSearch: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n    /**\n     * A unique identifier for the facet. Among other things, this identifier serves the purpose of saving\n     * the facet state in the URL hash.\n     *\n     * If you have two facets with the same field on the same page, you should specify an `id` value for at least one of\n     * those two facets. This `id` must be unique among the facets.\n     *\n     * Default value is the [`field`]{@link CategoryFacet.options.field} option value.\n     */\n    id: ComponentOptions.buildStringOption({\n      postProcessing: (value, options: ICategoryFacetOptions) => value || (options.field as string)\n    }),\n    /**\n     * The *injection depth* to use.\n     *\n     * The injection depth determines how many results to scan in the index to ensure that the category facet lists all potential\n     * facet values. Increasing this value enhances the accuracy of the listed values at the cost of performance.\n     *\n     * Default value is `1000`. Minimum value is `0`.\n     * @notSupportedIn salesforcefree\n     */\n    injectionDepth: ComponentOptions.buildNumberOption({ defaultValue: 1000, min: 0 }),\n    /**\n     * If the [`enableFacetSearch`]{@link CategoryFacet.options.enableFacetSearch} option is `true`, specifies the number of\n     * values to display in the facet search results popup.\n     *\n     * Default value is `15`. Minimum value is `1`.\n     */\n    numberOfResultsInFacetSearch: ComponentOptions.buildNumberOption({ defaultValue: 15, min: 1 }),\n    /**\n     * If the [`enableFacetSearch`]{@link CategoryFacet.options.enableFacetSearch} option is `true`, specifies the delay (in\n     * milliseconds) before sending a search request to the server when the user starts typing in the category facet search box.\n     *\n     * Specifying a smaller value makes results appear faster. However, chances of having to cancel many requests\n     * sent to the server increase as the user keeps on typing new characters.\n     *\n     * Default value is `100`. Minimum value is `0`.\n     */\n    facetSearchDelay: ComponentOptions.buildNumberOption({ defaultValue: 100, min: 0 }),\n    /**\n     * Whether to enable the **More** and **Less** buttons in the Facet.\n     *\n     * See also the [`pageSize`]{@link CategoryFacet.options.pageSize} option.\n     *\n     * Default value is `true`.\n     */\n    enableMoreLess: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n    /**\n     * If the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess} option is `true`, specifies the number of\n     * additional results to fetch when clicking the **More** button.\n     *\n     * Default value is `10`. Minimum value is `1`.\n     */\n    pageSize: ComponentOptions.buildNumberOption({ defaultValue: 10, min: 1, depend: 'enableMoreLess' }),\n    /**\n     * The character that specifies the hierarchical dependency.\n     *\n     * **Example:**\n     *\n     * If your field has the following values:\n     *\n     * `@field: c; c>folder2; c>folder2>folder3;`\n     *\n     * The delimiting character is `>`.\n     *\n     * Default value is `|`.\n     */\n    delimitingCharacter: ComponentOptions.buildStringOption({ defaultValue: '|' }),\n    /**\n     * The path to use as the path prefix for every query.\n     *\n     * **Example:**\n     *\n     * You have the following files indexed on a file system:\n     * ```\n     * c:\\\n     *    folder1\\\n     *      text1.txt\n     *    folder2\\\n     *      folder3\\\n     *        text2.txt\n     * ```\n     * Setting the `basePath` to `c` would display `folder1` and `folder2` in the `CategoryFacet`, but omit `c`.\n     *\n     * This options accepts an array of values. To specify a \"deeper\" starting path in your tree, you need to use comma-separated values.\n     *\n     * For example, setting `data-base-path=\"c,folder1\"` on the component markup would display `folder3` in the `CategoryFacet`, but omit `c` and `folder1`.\n     *\n     */\n    basePath: ComponentOptions.buildListOption<string>({ defaultValue: [] }),\n    /**\n     * The maximum number of levels to traverse in the hierarchy.\n     * This option does not count the length of the base path. The depth depends on what is shown in the interface.\n     *\n     * Default value is `Number.MAX_VALUE`.\n     */\n    maximumDepth: ComponentOptions.buildNumberOption({ min: 1, defaultValue: Number.MAX_VALUE }),\n    /**\n     * Whether to activate field format debugging.\n     * This options logs messages in the console for any potential encountered issues.\n     * This option can have negative effects on performance, and should only be activated when debugging.\n     */\n    debug: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n    /**\n     * Specifies a JSON object describing a mapping of facet values to their desired captions. See\n     * [Normalizing Facet Value Captions](https://developers.coveo.com/x/jBsvAg).\n     *\n     * **Note:**\n     * If this option is specified, the facet search box will be unavailable.\n     *\n     * **Examples:**\n     *\n     * You can set the option in the ['init']{@link init} call:\n     * ```javascript\n     * var myValueCaptions = {\n     *   \"txt\" : \"Text files\",\n     *   \"html\" : \"Web page\",\n     *   [ ... ]\n     * };\n     *\n     * Coveo.init(document.querySelector(\"#search\"), {\n     *   Facet : {\n     *     valueCaption : myValueCaptions\n     *   }\n     * });\n     * ```\n     *\n     * Or before the `init` call, using the ['options']{@link options} top-level function:\n     * ```javascript\n     * Coveo.options(document.querySelector(\"#search\"), {\n     *   Facet : {\n     *     valueCaption : myValueCaptions\n     *   }\n     * });\n     * ```\n     *\n     * Or directly in the markup:\n     * ```html\n     * <!-- Ensure that the double quotes are properly handled in data-value-caption. -->\n     * <div class='CoveoCategoryFacet' data-field='@myotherfield' data-value-caption='{\"txt\":\"Text files\",\"html\":\"Web page\"}'></div>\n     * ```\n     */\n    valueCaption: ComponentOptions.buildJsonOption<IStringMap<string>>({ defaultValue: {} }),\n    /**\n     * The [id](@link Facet.options.id) of another facet in which at least one value must be selected in order\n     * for the dependent category facet to be visible.\n     *\n     * **Default:** `undefined` and the category facet does not depend on any other facet to be displayed.\n     *\n     * @availablesince [September 2019 Release (v2.7023)](https://docs.coveo.com/en/2990/)\n     */\n    dependsOn: ComponentOptions.buildStringOption(),\n\n    /**\n     * A function that verifies whether the current state of the `dependsOn` facet allows the dependent facet to be displayed.\n     *\n     * If specified, the function receives a reference to the resolved `dependsOn` facet component instance as an argument, and must return a boolean.\n     * The function's argument should typically be treated as read-only.\n     *\n     * By default, the dependent facet is displayed whenever one or more values are selected in its `dependsOn` facet.\n     *\n     * @externaldocs [Defining Dependent Facets](https://docs.coveo.com/3210/)\n     */\n    dependsOnCondition: ComponentOptions.buildCustomOption<IDependentFacetCondition>(\n      () => {\n        return null;\n      },\n      { depend: 'dependsOn', section: 'CommonOptions' }\n    ),\n    /**\n     * Whether to display the facet search widget above the facet values instead of below them.\n     *\n     * @availablesince [July 2020 Release (v2.9373)](https://docs.coveo.com/3293/)\n     */\n    displaySearchOnTop: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n    /**\n     * Whether to display the facet search widget as a button instead of a search bar.\n     *\n     * @availablesince [July 2020 Release (v2.9373)](https://docs.coveo.com/3293/)\n     */\n    displaySearchButton: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n    ...ResponsiveFacetOptions\n  };\n\n  public categoryFacetQueryController: CategoryFacetQueryController;\n  public listenToQueryStateChange = true;\n  public categoryFacetSearch: CategoryFacetSearch;\n  public activeCategoryValue: CategoryValue | undefined;\n  public positionInQuery: number;\n  public dependsOnManager: DependsOnManager;\n  public static MAXIMUM_NUMBER_OF_VALUES_BEFORE_TRUNCATING = 15;\n  public static NUMBER_OF_VALUES_TO_KEEP_AFTER_TRUNCATING = 10;\n\n  private categoryValueRoot: CategoryValueRoot;\n  private categoryFacetTemplates: CategoryFacetTemplates;\n  private headerElement: HTMLElement;\n  private currentPage: number;\n  private moreLessContainer: Dom;\n  private moreValuesToFetch: boolean = true;\n  private showingWaitAnimation = false;\n  private numberOfChildValuesCurrentlyDisplayed = 0;\n  private numberOfValues: number;\n  private categoryFacetValuesTree: CategoryFacetValuesTree;\n\n  public static WAIT_ELEMENT_CLASS = 'coveo-category-facet-header-wait-animation';\n\n  constructor(public element: HTMLElement, public options: ICategoryFacetOptions, bindings?: IComponentBindings) {\n    super(element, 'CategoryFacet', bindings);\n    this.options = ComponentOptions.initComponentOptions(element, CategoryFacet, options);\n\n    this.categoryFacetQueryController = new CategoryFacetQueryController(this);\n    this.categoryFacetTemplates = new CategoryFacetTemplates();\n    this.categoryValueRoot = new CategoryValueRoot($$(this.element), this.categoryFacetTemplates, this);\n    this.categoryValueRoot.path = this.activePath;\n    this.currentPage = 0;\n    this.numberOfValues = this.options.numberOfValues;\n    this.categoryFacetValuesTree = new CategoryFacetValuesTree();\n\n    this.tryToInitFacetSearch();\n\n    if (this.options.debug) {\n      new CategoryFacetDebug(this);\n    }\n\n    ResponsiveFacets.init(this.root, this, this.options);\n    this.initDependsOnManager();\n    this.bind.onRootElement<IBuildingQueryEventArgs>(QueryEvents.buildingQuery, args => this.handleBuildingQuery(args));\n    this.bind.onRootElement<IQuerySuccessEventArgs>(QueryEvents.querySuccess, args => this.handleQuerySuccess(args));\n    this.bind.onRootElement(QueryEvents.duringQuery, () => this.addFading());\n    this.bind.onRootElement(QueryEvents.deferredQuerySuccess, () => this.handleDeferredQuerySuccess());\n    this.bind.onRootElement<IPopulateBreadcrumbEventArgs>(BreadcrumbEvents.populateBreadcrumb, args => this.handlePopulateBreadCrumb(args));\n    this.bind.onRootElement(BreadcrumbEvents.clearBreadcrumb, () => this.handleClearBreadcrumb());\n    this.buildFacetHeader();\n    this.initQueryStateEvents();\n  }\n\n  public isCurrentlyDisplayed() {\n    return $$(this.element).isVisible();\n  }\n\n  public get activePath() {\n    return this.queryStateModel.get(this.queryStateAttribute) || this.options.basePath;\n  }\n\n  public set activePath(newPath: string[]) {\n    this.listenToQueryStateChange = false;\n    this.queryStateModel.set(this.queryStateAttribute, newPath);\n    this.listenToQueryStateChange = true;\n  }\n\n  public get queryStateAttribute() {\n    return QueryStateModel.getFacetId(this.options.id);\n  }\n\n  public handleBuildingQuery(args: IBuildingQueryEventArgs) {\n    this.positionInQuery = this.categoryFacetQueryController.putCategoryFacetInQueryBuilder(\n      args.queryBuilder,\n      this.activePath,\n      this.numberOfValues + 1\n    );\n  }\n\n  public scrollToTop() {\n    ResultListUtils.scrollToTop(this.root);\n  }\n\n  private tryToInitFacetSearch() {\n    if (!this.isFacetSearchAvailable) {\n      return this.logDisabledFacetSearchWarning();\n    }\n\n    this.categoryFacetSearch = new CategoryFacetSearch(this, this.options.displaySearchButton);\n  }\n\n  private logDisabledFacetSearchWarning() {\n    if (this.isEnableFacetSearchFalsy) {\n      return;\n    }\n\n    const valueCaptionAttributeName = this.getOptionAttributeName('valueCaption');\n    const enableFacetSearchAttributeName = this.getOptionAttributeName('enableFacetSearch');\n    const field = this.options.field;\n\n    this.logger.warn(`The search box is disabled on the ${field} CategoryFacet. To hide this warning,\n    either remove the ${valueCaptionAttributeName} option or set the ${enableFacetSearchAttributeName} option to \"false\".`);\n  }\n\n  private getOptionAttributeName(optionName: keyof ICategoryFacetOptions) {\n    return ComponentOptions.attrNameFromName(optionName);\n  }\n\n  private get isFacetSearchAvailable() {\n    if (this.areValueCaptionsSpecified) {\n      return false;\n    }\n\n    if (this.isEnableFacetSearchFalsy) {\n      return false;\n    }\n\n    return true;\n  }\n\n  private get areValueCaptionsSpecified() {\n    const valueCaptions = this.options.valueCaption;\n    return keys(valueCaptions).length !== 0;\n  }\n\n  private get isEnableFacetSearchFalsy() {\n    return !this.options.enableFacetSearch;\n  }\n\n  private get isCategoryEmpty() {\n    return !this.categoryValueRoot.children.length;\n  }\n\n  private updateAppearance() {\n    if (this.disabled || this.isCategoryEmpty) {\n      return this.hide();\n    }\n\n    this.show();\n  }\n\n  public handleQuerySuccess(args: IQuerySuccessEventArgs) {\n    if (Utils.isNullOrUndefined(args.results.categoryFacets)) {\n      return this.notImplementedError();\n    }\n\n    if (Utils.isNullOrUndefined(args.results.categoryFacets[this.positionInQuery])) {\n      return;\n    }\n\n    const numberOfRequestedValues = args.query.categoryFacets[this.positionInQuery].maximumNumberOfValues;\n    const categoryFacetResult = args.results.categoryFacets[this.positionInQuery];\n    this.moreValuesToFetch = numberOfRequestedValues == categoryFacetResult.values.length;\n    this.clear();\n\n    if (categoryFacetResult.notImplemented) {\n      return this.notImplementedError();\n    }\n\n    if (!categoryFacetResult.values.length && !categoryFacetResult.parentValues.length) {\n      return;\n    }\n\n    this.renderValues(categoryFacetResult, numberOfRequestedValues);\n    if (this.isFacetSearchAvailable) {\n      const facetSearch = this.categoryFacetSearch.build();\n      this.options.displaySearchOnTop\n        ? $$(facetSearch).insertBefore(this.categoryValueRoot.listRoot.el)\n        : $$(facetSearch).insertAfter(this.categoryValueRoot.listRoot.el);\n    }\n\n    this.moreLessContainer = $$('div', { className: 'coveo-category-facet-more-less-container' });\n    $$(this.element).append(this.moreLessContainer.el);\n\n    if (this.options.enableMoreLess) {\n      this.renderMoreLess();\n    }\n\n    if (!this.isPristine()) {\n      $$(this.element).addClass('coveo-category-facet-non-empty-path');\n    }\n  }\n\n  /**\n   * Changes the active path.\n   *\n   */\n  public changeActivePath(path: string[]) {\n    this.activePath = path;\n  }\n\n  public async executeQuery() {\n    this.showWaitingAnimation();\n    try {\n      await this.queryController.executeQuery();\n    } finally {\n      this.hideWaitingAnimation();\n    }\n  }\n\n  /**\n   * Reloads the facet with the same path.\n   */\n  public reload() {\n    this.changeActivePath(this.activePath);\n    this.logAnalyticsEvent(analyticsActionCauseList.categoryFacetReload);\n    this.executeQuery();\n  }\n\n  /**\n   * Returns all the visible parent values.\n   * @returns simple object with three fields: `value`, `count` and `path`.\n   */\n  public getVisibleParentValues(): CategoryValueDescriptor[] {\n    return this.getVisibleParentCategoryValues().map(categoryValue => categoryValue.getDescriptor());\n  }\n\n  private getVisibleParentCategoryValues() {\n    if (this.categoryValueRoot.children.length == 0 || this.categoryValueRoot.children[0].children.length == 0) {\n      return [];\n    }\n    let currentParentvalue = this.categoryValueRoot.children[0];\n    const parentValues = [currentParentvalue];\n    while (currentParentvalue.children.length != 0 && !Utils.arrayEqual(currentParentvalue.path, this.activePath)) {\n      currentParentvalue = currentParentvalue.children[0];\n      parentValues.push(currentParentvalue);\n    }\n    return parentValues;\n  }\n\n  /**\n   * Shows more values according to {@link CategoryFacet.options.pageSize}.\n   *\n   * See the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess}, and\n   * [`numberOfValues`]{@link CategoryFacet.options.numberOfValues} options.\n   */\n  public showMore() {\n    if (this.moreValuesToFetch) {\n      this.currentPage++;\n      this.numberOfValues = this.options.numberOfValues + this.currentPage * this.options.pageSize;\n      this.reload();\n      this.logAnalyticsFacetShowMoreLess(analyticsActionCauseList.facetShowMore);\n    }\n  }\n\n  /**\n   * Shows less values, up to the original number of values.\n   *\n   * See the [`enableMoreLess`]{@link CategoryFacet.options.enableMoreLess}, and\n   * [`numberOfValues`]{@link CategoryFacet.options.numberOfValues} options.\n   */\n  public showLess() {\n    if (this.currentPage > 0) {\n      this.currentPage--;\n      this.numberOfValues = this.options.numberOfValues + this.currentPage * this.options.pageSize;\n      this.reload();\n      this.logAnalyticsFacetShowMoreLess(analyticsActionCauseList.facetShowLess);\n    }\n  }\n\n  /**\n   * Returns the values at the bottom of the hierarchy. These are the values that are not yet applied to the query.\n   * @returns simple object with three fields: `value`, `count` and `path`.\n   */\n  public getAvailableValues() {\n    if (!this.activeCategoryValue) {\n      return [];\n    }\n    return this.activeCategoryValue.children.map(categoryValue => {\n      return {\n        value: categoryValue.categoryValueDescriptor.value,\n        count: categoryValue.categoryValueDescriptor.count,\n        path: categoryValue.path\n      };\n    });\n  }\n\n  /**\n   * Selects a value from the currently available values.\n   * If the given value to select is not in the available values, it will throw an error.\n   */\n  public selectValue(value: string) {\n    Assert.check(\n      contains(pluck(this.getAvailableValues(), 'value'), value),\n      'Failed while trying to select a value that is not available.'\n    );\n    const newPath = this.activePath.slice(0);\n    newPath.push(value);\n    this.changeActivePath(newPath);\n    this.logAnalyticsEvent(analyticsActionCauseList.categoryFacetSelect);\n    this.executeQuery();\n  }\n\n  /**\n   * Deselects the last value in the hierarchy that is applied to the query. When at the top of the hierarchy, this method does nothing.\n   */\n  public deselectCurrentValue() {\n    if (this.activePath.length == 0) {\n      return;\n    }\n\n    const newPath = this.activePath.slice(0);\n    newPath.pop();\n    this.changeActivePath(newPath);\n    this.logAnalyticsEvent(analyticsActionCauseList.categoryFacetSelect);\n    this.executeQuery();\n  }\n\n  private resetPath() {\n    this.changeActivePath(this.options.basePath);\n  }\n\n  /**\n   * Resets the facet to its initial state.\n   */\n  public reset() {\n    this.resetPath();\n    this.logAnalyticsEvent(analyticsActionCauseList.categoryFacetClear);\n    this.executeQuery();\n  }\n\n  /**\n   * Hides the component.\n   */\n  public hide() {\n    $$(this.element).addClass('coveo-hidden');\n  }\n\n  /**\n   * Shows the component.\n   */\n  public show() {\n    $$(this.element).removeClass('coveo-hidden');\n  }\n\n  public enable() {\n    super.enable();\n    this.updateAppearance();\n  }\n\n  public disable() {\n    super.disable();\n    this.updateAppearance();\n  }\n\n  /**\n   * Goes through any value that contains the value parameter, and verifies whether there are missing parents.\n   * Issues are then logged in the console.\n   * If you do not want to specify a value, you can simply enable {@link CategoryFacet.options.debug} and do an empty query.\n   */\n  public async debugValue(value: string) {\n    const queryBuilder = new QueryBuilder();\n    this.categoryFacetQueryController.addDebugGroupBy(queryBuilder, value);\n    const queryResults = await this.queryController.getEndpoint().search(queryBuilder.build());\n    CategoryFacetDebug.analyzeResults(queryResults.groupByResults[0], this.options.delimitingCharacter);\n  }\n\n  /**\n   *\n   * @param value The string to find a caption for.\n   * Returns the caption for a value or the value itself if no caption is available.\n   */\n  public getCaption(value: string) {\n    const valueCaptions = this.options.valueCaption;\n    const caption = valueCaptions[value];\n    return caption ? caption : value;\n  }\n\n  public showWaitingAnimation() {\n    this.ensureDom();\n    if (!this.showingWaitAnimation) {\n      $$(this.headerElement).find('.coveo-category-facet-header-wait-animation').style.visibility = 'visible';\n      this.showingWaitAnimation = true;\n    }\n  }\n\n  public hideWaitingAnimation() {\n    this.ensureDom();\n    if (this.showingWaitAnimation) {\n      $$(this.headerElement).find('.coveo-category-facet-header-wait-animation').style.visibility = 'hidden';\n      this.showingWaitAnimation = false;\n    }\n  }\n\n  public logAnalyticsEvent(eventName: IAnalyticsActionCause, path = this.activePath) {\n    this.usageAnalytics.logSearchEvent<IAnalyticsCategoryFacetMeta>(eventName, {\n      categoryFacetId: this.options.id,\n      categoryFacetField: this.options.field.toString(),\n      categoryFacetPath: path,\n      categoryFacetTitle: this.options.title\n    });\n  }\n\n  public getEndpoint(): ISearchEndpoint {\n    return this.queryController.getEndpoint();\n  }\n\n  get children(): CategoryValue[] {\n    return this.categoryValueRoot.children;\n  }\n\n  private renderValues(categoryFacetResult: ICategoryFacetResult, numberOfRequestedValues: number) {\n    this.categoryFacetValuesTree.storeNewValues(categoryFacetResult);\n    let sortedParentValues = this.sortParentValues(categoryFacetResult.parentValues);\n    let currentParentValue: CategoryValueParent = this.categoryValueRoot;\n    let needToTruncate = false;\n    let pathOfLastTruncatedParentValue: string[];\n\n    const numberOfItemsInFirstSlice = Math.floor(CategoryFacet.NUMBER_OF_VALUES_TO_KEEP_AFTER_TRUNCATING / 2);\n    const numberOfItemsInSecondSlice = Math.ceil(CategoryFacet.NUMBER_OF_VALUES_TO_KEEP_AFTER_TRUNCATING / 2);\n\n    sortedParentValues = this.hideBasePathInParentValues(sortedParentValues);\n\n    if (this.shouldTruncate(sortedParentValues)) {\n      pathOfLastTruncatedParentValue = this.findPathOfLastTruncatedParentValue(sortedParentValues, numberOfItemsInSecondSlice);\n      needToTruncate = true;\n      sortedParentValues = first(sortedParentValues, numberOfItemsInFirstSlice).concat(\n        last(sortedParentValues, numberOfItemsInSecondSlice)\n      );\n    }\n\n    if (!this.isPristine()) {\n      this.addAllCategoriesButton();\n    }\n\n    for (let i = 0; i < sortedParentValues.length; i++) {\n      currentParentValue = currentParentValue.renderAsParent(sortedParentValues[i]);\n\n      // We do not want to make the \"last\" parent selectable, as clicking it would be a noop (re-selecting the same filter)\n      const isLastParent = i == sortedParentValues.length - 1;\n      if (!isLastParent) {\n        (currentParentValue as CategoryValue).makeSelectable().showCollapseArrow();\n      }\n\n      if (needToTruncate) {\n        if (i == numberOfItemsInFirstSlice - 1) {\n          this.addEllipsis();\n        }\n\n        if (i == numberOfItemsInFirstSlice) {\n          currentParentValue.path = [...pathOfLastTruncatedParentValue, sortedParentValues[i].value];\n        }\n      }\n    }\n\n    const childrenValuesToRender = this.moreValuesToFetch\n      ? categoryFacetResult.values.slice(0, numberOfRequestedValues - 1)\n      : categoryFacetResult.values.slice(0, numberOfRequestedValues);\n\n    this.numberOfChildValuesCurrentlyDisplayed = childrenValuesToRender.length;\n\n    currentParentValue.renderChildren(childrenValuesToRender);\n    this.activeCategoryValue = currentParentValue as CategoryValue;\n  }\n\n  private hideBasePathInParentValues(parentValues: ICategoryFacetValue[]) {\n    if (Utils.arrayEqual(first(this.activePath, this.options.basePath.length), this.options.basePath)) {\n      parentValues = last(parentValues, parentValues.length - this.options.basePath.length);\n    }\n    return parentValues;\n  }\n\n  private shouldTruncate(parentValues: ICategoryFacetValue[]) {\n    return parentValues.length > CategoryFacet.MAXIMUM_NUMBER_OF_VALUES_BEFORE_TRUNCATING;\n  }\n\n  private addEllipsis() {\n    this.categoryValueRoot.listRoot.append(this.categoryFacetTemplates.buildEllipsis().el);\n  }\n\n  private findPathOfLastTruncatedParentValue(sortedParentValues: ICategoryFacetValue[], numberOfItemsInSecondSlice: number) {\n    const indexOfLastTruncatedParentValue = sortedParentValues.length - numberOfItemsInSecondSlice - 1;\n    return reduce(first(sortedParentValues, indexOfLastTruncatedParentValue + 1), (path, parentValue) => [...path, parentValue.value], []);\n  }\n\n  private addAllCategoriesButton() {\n    const allCategories = this.categoryFacetTemplates.buildAllCategoriesButton();\n    new AccessibleButton()\n      .withLabel(l('AllCategories'))\n      .withElement(allCategories)\n      .withSelectAction(() => {\n        this.reset();\n        this.scrollToTop();\n      })\n      .build();\n    this.categoryValueRoot.listRoot.append(allCategories.el);\n  }\n\n  private isPristine() {\n    return Utils.arrayEqual(this.activePath, this.options.basePath);\n  }\n\n  private buildFacetHeader() {\n    const facetHeader = new CategoryFacetHeader({ categoryFacet: this, title: this.options.title });\n    this.headerElement = facetHeader.build();\n    $$(this.element).prepend(this.headerElement);\n  }\n\n  private handleQueryStateChanged(data: IAttributesChangedEventArg) {\n    if (this.listenToQueryStateChange) {\n      let path = data.attributes[this.queryStateAttribute];\n      if (!Utils.isNullOrUndefined(path) && isArray(path) && path.length != 0) {\n        this.activePath = path;\n      }\n    }\n  }\n\n  private initQueryStateEvents() {\n    this.queryStateModel.registerNewAttribute(this.queryStateAttribute, this.options.basePath);\n    this.bind.onQueryState<IAttributesChangedEventArg>(MODEL_EVENTS.CHANGE, undefined, data => this.handleQueryStateChanged(data));\n  }\n\n  private initDependsOnManager() {\n    const facetInfo: IDependentFacet = {\n      reset: () => this.dependsOnReset(),\n      ref: this\n    };\n    this.dependsOnManager = new DependsOnManager(facetInfo);\n  }\n\n  private dependsOnReset() {\n    this.changeActivePath(this.options.basePath);\n    this.clear();\n  }\n\n  private addFading() {\n    $$(this.element).addClass('coveo-category-facet-values-fade');\n  }\n\n  private handleDeferredQuerySuccess() {\n    this.updateAppearance();\n    this.removeFading();\n  }\n\n  private removeFading() {\n    $$(this.element).removeClass('coveo-category-facet-values-fade');\n  }\n\n  private notImplementedError() {\n    const errorMessage = 'Category Facets are not supported by your current search endpoint. Disabling this component.';\n    this.logger.error(errorMessage);\n    this.disable();\n  }\n\n  private sortParentValues(parentValues: ICategoryFacetValue[]) {\n    if (this.activePath.length != parentValues.length) {\n      this.logger.warn('Inconsistent CategoryFacet results: Number of parent values results does not equal length of active path');\n      return parentValues;\n    }\n\n    const sortedParentvalues: ICategoryFacetValue[] = [];\n    for (const pathElement of this.activePath) {\n      const currentParentValue = find(parentValues, parentValue => parentValue.value.toLowerCase() == pathElement.toLowerCase());\n      if (!currentParentValue) {\n        this.logger.warn('Inconsistent CategoryFacet results: path not consistent with parent values results');\n        return parentValues;\n      }\n      sortedParentvalues.push(currentParentValue);\n    }\n    return sortedParentvalues;\n  }\n\n  private renderMoreLess() {\n    if (this.numberOfChildValuesCurrentlyDisplayed > this.options.numberOfValues) {\n      this.moreLessContainer.append(this.buildLessButton());\n    }\n\n    if (this.moreValuesToFetch) {\n      this.moreLessContainer.append(this.buildMoreButton());\n    }\n  }\n\n  private clear() {\n    this.categoryValueRoot.clear();\n    if (this.isFacetSearchAvailable) {\n      this.categoryFacetSearch.clear();\n    }\n    this.moreLessContainer && this.moreLessContainer.detach();\n    $$(this.element).removeClass('coveo-category-facet-non-empty-path');\n  }\n\n  private buildMoreButton() {\n    const svgContainer = $$('span', { className: 'coveo-facet-more-icon' }, SVGIcons.icons.arrowDown).el;\n    SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-more-icon-svg');\n    const more = $$('div', { className: 'coveo-category-facet-more' }, svgContainer);\n\n    new AccessibleButton()\n      .withElement(more)\n      .withSelectAction(() => this.showMore())\n      .withLabel(l('ShowMoreFacetResults', this.options.title))\n      .build();\n\n    return more.el;\n  }\n\n  private buildLessButton() {\n    const svgContainer = $$('span', { className: 'coveo-facet-less-icon' }, SVGIcons.icons.arrowUp).el;\n    SVGDom.addClassToSVGInContainer(svgContainer, 'coveo-facet-less-icon-svg');\n    const less = $$('div', { className: 'coveo-category-facet-less' }, svgContainer);\n\n    new AccessibleButton()\n      .withElement(less)\n      .withSelectAction(() => this.showLess())\n      .withLabel(l('ShowLessFacetResults', this.options.title))\n      .build();\n\n    return less.el;\n  }\n\n  private handlePopulateBreadCrumb(args: IPopulateBreadcrumbEventArgs) {\n    if (this.isPristine()) {\n      return;\n    }\n\n    const lastParentValue = this.categoryFacetValuesTree.getValueForLastPartInPath(this.activePath);\n    const descriptor: CategoryValueDescriptor = {\n      path: this.activePath,\n      count: lastParentValue.numberOfResults,\n      value: lastParentValue.value\n    };\n\n    const resetFacet = () => {\n      this.logAnalyticsEvent(analyticsActionCauseList.breadcrumbFacet);\n      this.reset();\n    };\n\n    const categoryFacetBreadcrumbBuilder = new CategoryFacetBreadcrumb(this, resetFacet, descriptor);\n\n    args.breadcrumbs.push({ element: categoryFacetBreadcrumbBuilder.build() });\n  }\n\n  private handleClearBreadcrumb() {\n    this.changeActivePath(this.options.basePath);\n  }\n\n  private logAnalyticsFacetShowMoreLess(cause: IAnalyticsActionCause) {\n    this.usageAnalytics.logCustomEvent<IAnalyticsFacetMeta>(\n      cause,\n      {\n        facetId: this.options.id,\n        facetField: this.options.field.toString(),\n        facetTitle: this.options.title\n      },\n      this.element\n    );\n  }\n}\n\nInitialization.registerAutoCreateComponent(CategoryFacet);\nCategoryFacet.doExport();\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/CategoryFacet/CategoryFacet.ts"],"sourceRoot":""}